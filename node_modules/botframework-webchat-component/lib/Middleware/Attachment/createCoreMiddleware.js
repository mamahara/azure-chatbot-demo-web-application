"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = createCoreMiddleware;

var _propTypes = _interopRequireDefault(require("prop-types"));

var _react = _interopRequireDefault(require("react"));

var _AudioAttachment = _interopRequireDefault(require("../../Attachment/AudioAttachment"));

var _FileAttachment = _interopRequireDefault(require("../../Attachment/FileAttachment"));

var _ImageAttachment = _interopRequireDefault(require("../../Attachment/ImageAttachment"));

var _TextAttachment = _interopRequireDefault(require("../../Attachment/TextAttachment"));

var _VideoAttachment = _interopRequireDefault(require("../../Attachment/VideoAttachment"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// TODO: [P4] Rename this file or the whole middleware, it looks either too simple or too comprehensive now
function createCoreMiddleware() {
  return function () {
    return function (next) {
      var Attachment = function Attachment(_ref) {
        var _ref$activity = _ref.activity,
            activity = _ref$activity === void 0 ? {} : _ref$activity,
            _ref$activity2 = _ref.activity;
        _ref$activity2 = _ref$activity2 === void 0 ? {} : _ref$activity2;
        var _ref$activity2$from = _ref$activity2.from;
        _ref$activity2$from = _ref$activity2$from === void 0 ? {} : _ref$activity2$from;
        var role = _ref$activity2$from.role,
            attachment = _ref.attachment,
            _ref$attachment = _ref.attachment;
        _ref$attachment = _ref$attachment === void 0 ? {} : _ref$attachment;
        var contentType = _ref$attachment.contentType,
            contentUrl = _ref$attachment.contentUrl,
            thumbnailUrl = _ref$attachment.thumbnailUrl;
        return role === 'user' && !/^text\//.test(contentType) && !thumbnailUrl ? /*#__PURE__*/_react.default.createElement(_FileAttachment.default, {
          activity: activity,
          attachment: attachment
        }) : /^audio\//.test(contentType) ? /*#__PURE__*/_react.default.createElement(_AudioAttachment.default, {
          activity: activity,
          attachment: attachment
        }) : /^image\//.test(contentType) ? /*#__PURE__*/_react.default.createElement(_ImageAttachment.default, {
          activity: activity,
          attachment: attachment
        }) : /^video\//.test(contentType) ? /*#__PURE__*/_react.default.createElement(_VideoAttachment.default, {
          activity: activity,
          attachment: attachment
        }) : contentUrl || contentType === 'application/octet-stream' ? /*#__PURE__*/_react.default.createElement(_FileAttachment.default, {
          activity: activity,
          attachment: attachment
        }) : /^text\//.test(contentType) ? /*#__PURE__*/_react.default.createElement(_TextAttachment.default, {
          activity: activity,
          attachment: attachment
        }) : next({
          activity: activity,
          attachment: attachment
        });
      };

      Attachment.propTypes = {
        activity: _propTypes.default.any.isRequired,
        attachment: _propTypes.default.shape({
          contentType: _propTypes.default.string.isRequired,
          contentUrl: _propTypes.default.string,
          thumbnailUrl: _propTypes.default.string
        }).isRequired
      };
      return Attachment;
    };
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9NaWRkbGV3YXJlL0F0dGFjaG1lbnQvY3JlYXRlQ29yZU1pZGRsZXdhcmUuanMiXSwibmFtZXMiOlsiY3JlYXRlQ29yZU1pZGRsZXdhcmUiLCJuZXh0IiwiQXR0YWNobWVudCIsImFjdGl2aXR5IiwiZnJvbSIsInJvbGUiLCJhdHRhY2htZW50IiwiY29udGVudFR5cGUiLCJjb250ZW50VXJsIiwidGh1bWJuYWlsVXJsIiwidGVzdCIsInByb3BUeXBlcyIsIlByb3BUeXBlcyIsImFueSIsImlzUmVxdWlyZWQiLCJzaGFwZSIsInN0cmluZyJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7O0FBRUE7QUFDZSxTQUFTQSxvQkFBVCxHQUFnQztBQUM3QyxTQUFPO0FBQUEsV0FBTSxVQUFBQyxJQUFJLEVBQUk7QUFDbkIsVUFBTUMsVUFBVSxHQUFHLFNBQWJBLFVBQWE7QUFBQSxpQ0FDakJDLFFBRGlCO0FBQUEsWUFDakJBLFFBRGlCLDhCQUNOLEVBRE07QUFBQSxrQ0FFakJBLFFBRmlCO0FBQUEscURBRW1CLEVBRm5CO0FBQUEsaURBRUxDLElBRks7QUFBQSwrREFFWSxFQUZaO0FBQUEsWUFFR0MsSUFGSCx1QkFFR0EsSUFGSDtBQUFBLFlBR2pCQyxVQUhpQixRQUdqQkEsVUFIaUI7QUFBQSxtQ0FJakJBLFVBSmlCO0FBQUEsdURBSXVDLEVBSnZDO0FBQUEsWUFJSEMsV0FKRyxtQkFJSEEsV0FKRztBQUFBLFlBSVVDLFVBSlYsbUJBSVVBLFVBSlY7QUFBQSxZQUlzQkMsWUFKdEIsbUJBSXNCQSxZQUp0QjtBQUFBLGVBTWpCSixJQUFJLEtBQUssTUFBVCxJQUFtQixDQUFDLFVBQVdLLElBQVgsQ0FBZ0JILFdBQWhCLENBQXBCLElBQW9ELENBQUNFLFlBQXJELGdCQUNFLDZCQUFDLHVCQUFEO0FBQWdCLFVBQUEsUUFBUSxFQUFFTixRQUExQjtBQUFvQyxVQUFBLFVBQVUsRUFBRUc7QUFBaEQsVUFERixHQUVJLFdBQVlJLElBQVosQ0FBaUJILFdBQWpCLGlCQUNGLDZCQUFDLHdCQUFEO0FBQWlCLFVBQUEsUUFBUSxFQUFFSixRQUEzQjtBQUFxQyxVQUFBLFVBQVUsRUFBRUc7QUFBakQsVUFERSxHQUVBLFdBQVlJLElBQVosQ0FBaUJILFdBQWpCLGlCQUNGLDZCQUFDLHdCQUFEO0FBQWlCLFVBQUEsUUFBUSxFQUFFSixRQUEzQjtBQUFxQyxVQUFBLFVBQVUsRUFBRUc7QUFBakQsVUFERSxHQUVBLFdBQVlJLElBQVosQ0FBaUJILFdBQWpCLGlCQUNGLDZCQUFDLHdCQUFEO0FBQWlCLFVBQUEsUUFBUSxFQUFFSixRQUEzQjtBQUFxQyxVQUFBLFVBQVUsRUFBRUc7QUFBakQsVUFERSxHQUVBRSxVQUFVLElBQUlELFdBQVcsS0FBSywwQkFBOUIsZ0JBQ0YsNkJBQUMsdUJBQUQ7QUFBZ0IsVUFBQSxRQUFRLEVBQUVKLFFBQTFCO0FBQW9DLFVBQUEsVUFBVSxFQUFFRztBQUFoRCxVQURFLEdBRUEsVUFBV0ksSUFBWCxDQUFnQkgsV0FBaEIsaUJBQ0YsNkJBQUMsdUJBQUQ7QUFBZ0IsVUFBQSxRQUFRLEVBQUVKLFFBQTFCO0FBQW9DLFVBQUEsVUFBVSxFQUFFRztBQUFoRCxVQURFLEdBR0ZMLElBQUksQ0FBQztBQUFFRSxVQUFBQSxRQUFRLEVBQVJBLFFBQUY7QUFBWUcsVUFBQUEsVUFBVSxFQUFWQTtBQUFaLFNBQUQsQ0FuQlc7QUFBQSxPQUFuQjs7QUFzQkFKLE1BQUFBLFVBQVUsQ0FBQ1MsU0FBWCxHQUF1QjtBQUNyQlIsUUFBQUEsUUFBUSxFQUFFUyxtQkFBVUMsR0FBVixDQUFjQyxVQURIO0FBRXJCUixRQUFBQSxVQUFVLEVBQUVNLG1CQUFVRyxLQUFWLENBQWdCO0FBQzFCUixVQUFBQSxXQUFXLEVBQUVLLG1CQUFVSSxNQUFWLENBQWlCRixVQURKO0FBRTFCTixVQUFBQSxVQUFVLEVBQUVJLG1CQUFVSSxNQUZJO0FBRzFCUCxVQUFBQSxZQUFZLEVBQUVHLG1CQUFVSTtBQUhFLFNBQWhCLEVBSVRGO0FBTmtCLE9BQXZCO0FBU0EsYUFBT1osVUFBUDtBQUNELEtBakNNO0FBQUEsR0FBUDtBQWtDRCIsInNvdXJjZVJvb3QiOiJjb21wb25lbnQ6Ly8vIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5cbmltcG9ydCBBdWRpb0F0dGFjaG1lbnQgZnJvbSAnLi4vLi4vQXR0YWNobWVudC9BdWRpb0F0dGFjaG1lbnQnO1xuaW1wb3J0IEZpbGVBdHRhY2htZW50IGZyb20gJy4uLy4uL0F0dGFjaG1lbnQvRmlsZUF0dGFjaG1lbnQnO1xuaW1wb3J0IEltYWdlQXR0YWNobWVudCBmcm9tICcuLi8uLi9BdHRhY2htZW50L0ltYWdlQXR0YWNobWVudCc7XG5pbXBvcnQgVGV4dEF0dGFjaG1lbnQgZnJvbSAnLi4vLi4vQXR0YWNobWVudC9UZXh0QXR0YWNobWVudCc7XG5pbXBvcnQgVmlkZW9BdHRhY2htZW50IGZyb20gJy4uLy4uL0F0dGFjaG1lbnQvVmlkZW9BdHRhY2htZW50JztcblxuLy8gVE9ETzogW1A0XSBSZW5hbWUgdGhpcyBmaWxlIG9yIHRoZSB3aG9sZSBtaWRkbGV3YXJlLCBpdCBsb29rcyBlaXRoZXIgdG9vIHNpbXBsZSBvciB0b28gY29tcHJlaGVuc2l2ZSBub3dcbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGNyZWF0ZUNvcmVNaWRkbGV3YXJlKCkge1xuICByZXR1cm4gKCkgPT4gbmV4dCA9PiB7XG4gICAgY29uc3QgQXR0YWNobWVudCA9ICh7XG4gICAgICBhY3Rpdml0eSA9IHt9LFxuICAgICAgYWN0aXZpdHk6IHsgZnJvbTogeyByb2xlIH0gPSB7fSB9ID0ge30sXG4gICAgICBhdHRhY2htZW50LFxuICAgICAgYXR0YWNobWVudDogeyBjb250ZW50VHlwZSwgY29udGVudFVybCwgdGh1bWJuYWlsVXJsIH0gPSB7fVxuICAgIH0pID0+XG4gICAgICByb2xlID09PSAndXNlcicgJiYgIS9edGV4dFxcLy91LnRlc3QoY29udGVudFR5cGUpICYmICF0aHVtYm5haWxVcmwgPyAoXG4gICAgICAgIDxGaWxlQXR0YWNobWVudCBhY3Rpdml0eT17YWN0aXZpdHl9IGF0dGFjaG1lbnQ9e2F0dGFjaG1lbnR9IC8+XG4gICAgICApIDogL15hdWRpb1xcLy91LnRlc3QoY29udGVudFR5cGUpID8gKFxuICAgICAgICA8QXVkaW9BdHRhY2htZW50IGFjdGl2aXR5PXthY3Rpdml0eX0gYXR0YWNobWVudD17YXR0YWNobWVudH0gLz5cbiAgICAgICkgOiAvXmltYWdlXFwvL3UudGVzdChjb250ZW50VHlwZSkgPyAoXG4gICAgICAgIDxJbWFnZUF0dGFjaG1lbnQgYWN0aXZpdHk9e2FjdGl2aXR5fSBhdHRhY2htZW50PXthdHRhY2htZW50fSAvPlxuICAgICAgKSA6IC9edmlkZW9cXC8vdS50ZXN0KGNvbnRlbnRUeXBlKSA/IChcbiAgICAgICAgPFZpZGVvQXR0YWNobWVudCBhY3Rpdml0eT17YWN0aXZpdHl9IGF0dGFjaG1lbnQ9e2F0dGFjaG1lbnR9IC8+XG4gICAgICApIDogY29udGVudFVybCB8fCBjb250ZW50VHlwZSA9PT0gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScgPyAoXG4gICAgICAgIDxGaWxlQXR0YWNobWVudCBhY3Rpdml0eT17YWN0aXZpdHl9IGF0dGFjaG1lbnQ9e2F0dGFjaG1lbnR9IC8+XG4gICAgICApIDogL150ZXh0XFwvL3UudGVzdChjb250ZW50VHlwZSkgPyAoXG4gICAgICAgIDxUZXh0QXR0YWNobWVudCBhY3Rpdml0eT17YWN0aXZpdHl9IGF0dGFjaG1lbnQ9e2F0dGFjaG1lbnR9IC8+XG4gICAgICApIDogKFxuICAgICAgICBuZXh0KHsgYWN0aXZpdHksIGF0dGFjaG1lbnQgfSlcbiAgICAgICk7XG5cbiAgICBBdHRhY2htZW50LnByb3BUeXBlcyA9IHtcbiAgICAgIGFjdGl2aXR5OiBQcm9wVHlwZXMuYW55LmlzUmVxdWlyZWQsXG4gICAgICBhdHRhY2htZW50OiBQcm9wVHlwZXMuc2hhcGUoe1xuICAgICAgICBjb250ZW50VHlwZTogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgICAgICBjb250ZW50VXJsOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgICAgICB0aHVtYm5haWxVcmw6IFByb3BUeXBlcy5zdHJpbmdcbiAgICAgIH0pLmlzUmVxdWlyZWRcbiAgICB9O1xuXG4gICAgcmV0dXJuIEF0dGFjaG1lbnQ7XG4gIH07XG59XG4iXX0=