"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.useSendBoxSpeechInterimsVisible = useSendBoxSpeechInterimsVisible;
exports.default = void 0;

var _botframeworkWebchatCore = require("botframework-webchat-core");

var _glamor = require("glamor");

var _classnames = _interopRequireDefault(require("classnames"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _react = _interopRequireDefault(require("react"));

var _DictationInterims = _interopRequireDefault(require("./SendBox/DictationInterims"));

var _MicrophoneButton = _interopRequireDefault(require("./SendBox/MicrophoneButton"));

var _SendButton = _interopRequireDefault(require("./SendBox/SendButton"));

var _SuggestedActions = _interopRequireDefault(require("./SendBox/SuggestedActions"));

var _TextBox = _interopRequireDefault(require("./SendBox/TextBox"));

var _UploadButton = _interopRequireDefault(require("./SendBox/UploadButton"));

var _useActivities3 = _interopRequireDefault(require("./hooks/useActivities"));

var _useDirection3 = _interopRequireDefault(require("./hooks/useDirection"));

var _useDictateState3 = _interopRequireDefault(require("./hooks/useDictateState"));

var _useStyleOptions3 = _interopRequireDefault(require("./hooks/useStyleOptions"));

var _useStyleSet3 = _interopRequireDefault(require("./hooks/useStyleSet"));

var _useWebSpeechPonyfill4 = _interopRequireDefault(require("./hooks/useWebSpeechPonyfill"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }

function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function _iterableToArrayLimit(arr, i) { if (typeof Symbol === "undefined" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }

function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

var _Constants$DictateSta = _botframeworkWebchatCore.Constants.DictateState,
    DICTATING = _Constants$DictateSta.DICTATING,
    STARTING = _Constants$DictateSta.STARTING;
var ROOT_CSS = (0, _glamor.css)({
  '& > .main': {
    display: 'flex'
  }
});
var DICTATION_INTERIMS_CSS = (0, _glamor.css)({
  flex: 10000
});
var MICROPHONE_BUTTON_CSS = (0, _glamor.css)({
  flex: 1
});
var TEXT_BOX_CSS = (0, _glamor.css)({
  flex: 10000
}); // TODO: [P3] We should consider exposing core/src/definitions and use it instead

function activityIsSpeakingOrQueuedToSpeak(_ref) {
  var _ref$channelData = _ref.channelData;
  _ref$channelData = _ref$channelData === void 0 ? {} : _ref$channelData;
  var speak = _ref$channelData.speak;
  return !!speak;
}

function useSendBoxSpeechInterimsVisible() {
  var _useActivities = (0, _useActivities3.default)(),
      _useActivities2 = _slicedToArray(_useActivities, 1),
      activities = _useActivities2[0];

  var _useDictateState = (0, _useDictateState3.default)(),
      _useDictateState2 = _slicedToArray(_useDictateState, 1),
      dictateState = _useDictateState2[0];

  return [(dictateState === STARTING || dictateState === DICTATING) && !activities.filter(activityIsSpeakingOrQueuedToSpeak).length];
}

var BasicSendBox = function BasicSendBox(_ref2) {
  var className = _ref2.className;

  var _useStyleOptions = (0, _useStyleOptions3.default)(),
      _useStyleOptions2 = _slicedToArray(_useStyleOptions, 1),
      hideUploadButton = _useStyleOptions2[0].hideUploadButton;

  var _useStyleSet = (0, _useStyleSet3.default)(),
      _useStyleSet2 = _slicedToArray(_useStyleSet, 1),
      sendBoxStyleSet = _useStyleSet2[0].sendBox;

  var _useWebSpeechPonyfill = (0, _useWebSpeechPonyfill4.default)(),
      _useWebSpeechPonyfill2 = _slicedToArray(_useWebSpeechPonyfill, 1),
      _useWebSpeechPonyfill3 = _useWebSpeechPonyfill2[0];

  _useWebSpeechPonyfill3 = _useWebSpeechPonyfill3 === void 0 ? {} : _useWebSpeechPonyfill3;
  var SpeechRecognition = _useWebSpeechPonyfill3.SpeechRecognition;

  var _useDirection = (0, _useDirection3.default)(),
      _useDirection2 = _slicedToArray(_useDirection, 1),
      direction = _useDirection2[0];

  var _useSendBoxSpeechInte = useSendBoxSpeechInterimsVisible(),
      _useSendBoxSpeechInte2 = _slicedToArray(_useSendBoxSpeechInte, 1),
      speechInterimsVisible = _useSendBoxSpeechInte2[0];

  var supportSpeechRecognition = !!SpeechRecognition;
  return /*#__PURE__*/_react.default.createElement("div", {
    className: (0, _classnames.default)(sendBoxStyleSet + '', ROOT_CSS + '', className + ''),
    dir: direction,
    role: "form"
  }, /*#__PURE__*/_react.default.createElement(_SuggestedActions.default, null), /*#__PURE__*/_react.default.createElement("div", {
    className: "main"
  }, !hideUploadButton && /*#__PURE__*/_react.default.createElement(_UploadButton.default, null), speechInterimsVisible ? /*#__PURE__*/_react.default.createElement(_DictationInterims.default, {
    className: DICTATION_INTERIMS_CSS + ''
  }) : /*#__PURE__*/_react.default.createElement(_TextBox.default, {
    className: TEXT_BOX_CSS + ''
  }), /*#__PURE__*/_react.default.createElement("div", null, supportSpeechRecognition ? /*#__PURE__*/_react.default.createElement(_MicrophoneButton.default, {
    className: MICROPHONE_BUTTON_CSS + ''
  }) : /*#__PURE__*/_react.default.createElement(_SendButton.default, null))));
};

BasicSendBox.defaultProps = {
  className: ''
};
BasicSendBox.propTypes = {
  className: _propTypes.default.string
};
var _default = BasicSendBox;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9CYXNpY1NlbmRCb3guanMiXSwibmFtZXMiOlsiQ29uc3RhbnRzIiwiRGljdGF0ZVN0YXRlIiwiRElDVEFUSU5HIiwiU1RBUlRJTkciLCJST09UX0NTUyIsImRpc3BsYXkiLCJESUNUQVRJT05fSU5URVJJTVNfQ1NTIiwiZmxleCIsIk1JQ1JPUEhPTkVfQlVUVE9OX0NTUyIsIlRFWFRfQk9YX0NTUyIsImFjdGl2aXR5SXNTcGVha2luZ09yUXVldWVkVG9TcGVhayIsImNoYW5uZWxEYXRhIiwic3BlYWsiLCJ1c2VTZW5kQm94U3BlZWNoSW50ZXJpbXNWaXNpYmxlIiwiYWN0aXZpdGllcyIsImRpY3RhdGVTdGF0ZSIsImZpbHRlciIsImxlbmd0aCIsIkJhc2ljU2VuZEJveCIsImNsYXNzTmFtZSIsImhpZGVVcGxvYWRCdXR0b24iLCJzZW5kQm94U3R5bGVTZXQiLCJzZW5kQm94IiwiU3BlZWNoUmVjb2duaXRpb24iLCJkaXJlY3Rpb24iLCJzcGVlY2hJbnRlcmltc1Zpc2libGUiLCJzdXBwb3J0U3BlZWNoUmVjb2duaXRpb24iLCJkZWZhdWx0UHJvcHMiLCJwcm9wVHlwZXMiLCJQcm9wVHlwZXMiLCJzdHJpbmciXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7NEJBSUlBLGtDLENBREZDLFk7SUFBZ0JDLFMseUJBQUFBLFM7SUFBV0MsUSx5QkFBQUEsUTtBQUc3QixJQUFNQyxRQUFRLEdBQUcsaUJBQUk7QUFDbkIsZUFBYTtBQUNYQyxJQUFBQSxPQUFPLEVBQUU7QUFERTtBQURNLENBQUosQ0FBakI7QUFNQSxJQUFNQyxzQkFBc0IsR0FBRyxpQkFBSTtBQUFFQyxFQUFBQSxJQUFJLEVBQUU7QUFBUixDQUFKLENBQS9CO0FBQ0EsSUFBTUMscUJBQXFCLEdBQUcsaUJBQUk7QUFBRUQsRUFBQUEsSUFBSSxFQUFFO0FBQVIsQ0FBSixDQUE5QjtBQUNBLElBQU1FLFlBQVksR0FBRyxpQkFBSTtBQUFFRixFQUFBQSxJQUFJLEVBQUU7QUFBUixDQUFKLENBQXJCLEMsQ0FFQTs7QUFDQSxTQUFTRyxpQ0FBVCxPQUE0RTtBQUFBLDhCQUEvQkMsV0FBK0I7QUFBQSxtREFBTixFQUFNO0FBQUEsTUFBaEJDLEtBQWdCLG9CQUFoQkEsS0FBZ0I7QUFDMUUsU0FBTyxDQUFDLENBQUNBLEtBQVQ7QUFDRDs7QUFFRCxTQUFTQywrQkFBVCxHQUEyQztBQUFBLHVCQUNwQiw4QkFEb0I7QUFBQTtBQUFBLE1BQ2xDQyxVQURrQzs7QUFBQSx5QkFFbEIsZ0NBRmtCO0FBQUE7QUFBQSxNQUVsQ0MsWUFGa0M7O0FBSXpDLFNBQU8sQ0FDTCxDQUFDQSxZQUFZLEtBQUtaLFFBQWpCLElBQTZCWSxZQUFZLEtBQUtiLFNBQS9DLEtBQ0UsQ0FBQ1ksVUFBVSxDQUFDRSxNQUFYLENBQWtCTixpQ0FBbEIsRUFBcURPLE1BRm5ELENBQVA7QUFJRDs7QUFFRCxJQUFNQyxZQUFZLEdBQUcsU0FBZkEsWUFBZSxRQUFtQjtBQUFBLE1BQWhCQyxTQUFnQixTQUFoQkEsU0FBZ0I7O0FBQUEseUJBQ1AsZ0NBRE87QUFBQTtBQUFBLE1BQzdCQyxnQkFENkIsd0JBQzdCQSxnQkFENkI7O0FBQUEscUJBRUMsNEJBRkQ7QUFBQTtBQUFBLE1BRXBCQyxlQUZvQixvQkFFN0JDLE9BRjZCOztBQUFBLDhCQUdELHFDQUhDO0FBQUE7QUFBQTs7QUFBQSwrREFHUCxFQUhPO0FBQUEsTUFHN0JDLGlCQUg2QiwwQkFHN0JBLGlCQUg2Qjs7QUFBQSxzQkFJbEIsNkJBSmtCO0FBQUE7QUFBQSxNQUkvQkMsU0FKK0I7O0FBQUEsOEJBS05YLCtCQUErQixFQUx6QjtBQUFBO0FBQUEsTUFLL0JZLHFCQUwrQjs7QUFPdEMsTUFBTUMsd0JBQXdCLEdBQUcsQ0FBQyxDQUFDSCxpQkFBbkM7QUFFQSxzQkFDRTtBQUFLLElBQUEsU0FBUyxFQUFFLHlCQUFXRixlQUFlLEdBQUcsRUFBN0IsRUFBaUNqQixRQUFRLEdBQUcsRUFBNUMsRUFBZ0RlLFNBQVMsR0FBRyxFQUE1RCxDQUFoQjtBQUFpRixJQUFBLEdBQUcsRUFBRUssU0FBdEY7QUFBaUcsSUFBQSxJQUFJLEVBQUM7QUFBdEcsa0JBQ0UsNkJBQUMseUJBQUQsT0FERixlQUVFO0FBQUssSUFBQSxTQUFTLEVBQUM7QUFBZixLQUNHLENBQUNKLGdCQUFELGlCQUFxQiw2QkFBQyxxQkFBRCxPQUR4QixFQUVHSyxxQkFBcUIsZ0JBQ3BCLDZCQUFDLDBCQUFEO0FBQW1CLElBQUEsU0FBUyxFQUFFbkIsc0JBQXNCLEdBQUc7QUFBdkQsSUFEb0IsZ0JBR3BCLDZCQUFDLGdCQUFEO0FBQVMsSUFBQSxTQUFTLEVBQUVHLFlBQVksR0FBRztBQUFuQyxJQUxKLGVBT0UsMENBQ0dpQix3QkFBd0IsZ0JBQUcsNkJBQUMseUJBQUQ7QUFBa0IsSUFBQSxTQUFTLEVBQUVsQixxQkFBcUIsR0FBRztBQUFyRCxJQUFILGdCQUFpRSw2QkFBQyxtQkFBRCxPQUQ1RixDQVBGLENBRkYsQ0FERjtBQWdCRCxDQXpCRDs7QUEyQkFVLFlBQVksQ0FBQ1MsWUFBYixHQUE0QjtBQUMxQlIsRUFBQUEsU0FBUyxFQUFFO0FBRGUsQ0FBNUI7QUFJQUQsWUFBWSxDQUFDVSxTQUFiLEdBQXlCO0FBQ3ZCVCxFQUFBQSxTQUFTLEVBQUVVLG1CQUFVQztBQURFLENBQXpCO2VBSWVaLFkiLCJzb3VyY2VSb290IjoiY29tcG9uZW50Oi8vLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbnN0YW50cyB9IGZyb20gJ2JvdGZyYW1ld29yay13ZWJjaGF0LWNvcmUnO1xuaW1wb3J0IHsgY3NzIH0gZnJvbSAnZ2xhbW9yJztcbmltcG9ydCBjbGFzc05hbWVzIGZyb20gJ2NsYXNzbmFtZXMnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5cbmltcG9ydCBEaWN0YXRpb25JbnRlcmltcyBmcm9tICcuL1NlbmRCb3gvRGljdGF0aW9uSW50ZXJpbXMnO1xuaW1wb3J0IE1pY3JvcGhvbmVCdXR0b24gZnJvbSAnLi9TZW5kQm94L01pY3JvcGhvbmVCdXR0b24nO1xuaW1wb3J0IFNlbmRCdXR0b24gZnJvbSAnLi9TZW5kQm94L1NlbmRCdXR0b24nO1xuaW1wb3J0IFN1Z2dlc3RlZEFjdGlvbnMgZnJvbSAnLi9TZW5kQm94L1N1Z2dlc3RlZEFjdGlvbnMnO1xuaW1wb3J0IFRleHRCb3ggZnJvbSAnLi9TZW5kQm94L1RleHRCb3gnO1xuaW1wb3J0IFVwbG9hZEJ1dHRvbiBmcm9tICcuL1NlbmRCb3gvVXBsb2FkQnV0dG9uJztcbmltcG9ydCB1c2VBY3Rpdml0aWVzIGZyb20gJy4vaG9va3MvdXNlQWN0aXZpdGllcyc7XG5pbXBvcnQgdXNlRGlyZWN0aW9uIGZyb20gJy4vaG9va3MvdXNlRGlyZWN0aW9uJztcbmltcG9ydCB1c2VEaWN0YXRlU3RhdGUgZnJvbSAnLi9ob29rcy91c2VEaWN0YXRlU3RhdGUnO1xuaW1wb3J0IHVzZVN0eWxlT3B0aW9ucyBmcm9tICcuL2hvb2tzL3VzZVN0eWxlT3B0aW9ucyc7XG5pbXBvcnQgdXNlU3R5bGVTZXQgZnJvbSAnLi9ob29rcy91c2VTdHlsZVNldCc7XG5pbXBvcnQgdXNlV2ViU3BlZWNoUG9ueWZpbGwgZnJvbSAnLi9ob29rcy91c2VXZWJTcGVlY2hQb255ZmlsbCc7XG5cbmNvbnN0IHtcbiAgRGljdGF0ZVN0YXRlOiB7IERJQ1RBVElORywgU1RBUlRJTkcgfVxufSA9IENvbnN0YW50cztcblxuY29uc3QgUk9PVF9DU1MgPSBjc3Moe1xuICAnJiA+IC5tYWluJzoge1xuICAgIGRpc3BsYXk6ICdmbGV4J1xuICB9XG59KTtcblxuY29uc3QgRElDVEFUSU9OX0lOVEVSSU1TX0NTUyA9IGNzcyh7IGZsZXg6IDEwMDAwIH0pO1xuY29uc3QgTUlDUk9QSE9ORV9CVVRUT05fQ1NTID0gY3NzKHsgZmxleDogMSB9KTtcbmNvbnN0IFRFWFRfQk9YX0NTUyA9IGNzcyh7IGZsZXg6IDEwMDAwIH0pO1xuXG4vLyBUT0RPOiBbUDNdIFdlIHNob3VsZCBjb25zaWRlciBleHBvc2luZyBjb3JlL3NyYy9kZWZpbml0aW9ucyBhbmQgdXNlIGl0IGluc3RlYWRcbmZ1bmN0aW9uIGFjdGl2aXR5SXNTcGVha2luZ09yUXVldWVkVG9TcGVhayh7IGNoYW5uZWxEYXRhOiB7IHNwZWFrIH0gPSB7fSB9KSB7XG4gIHJldHVybiAhIXNwZWFrO1xufVxuXG5mdW5jdGlvbiB1c2VTZW5kQm94U3BlZWNoSW50ZXJpbXNWaXNpYmxlKCkge1xuICBjb25zdCBbYWN0aXZpdGllc10gPSB1c2VBY3Rpdml0aWVzKCk7XG4gIGNvbnN0IFtkaWN0YXRlU3RhdGVdID0gdXNlRGljdGF0ZVN0YXRlKCk7XG5cbiAgcmV0dXJuIFtcbiAgICAoZGljdGF0ZVN0YXRlID09PSBTVEFSVElORyB8fCBkaWN0YXRlU3RhdGUgPT09IERJQ1RBVElORykgJiZcbiAgICAgICFhY3Rpdml0aWVzLmZpbHRlcihhY3Rpdml0eUlzU3BlYWtpbmdPclF1ZXVlZFRvU3BlYWspLmxlbmd0aFxuICBdO1xufVxuXG5jb25zdCBCYXNpY1NlbmRCb3ggPSAoeyBjbGFzc05hbWUgfSkgPT4ge1xuICBjb25zdCBbeyBoaWRlVXBsb2FkQnV0dG9uIH1dID0gdXNlU3R5bGVPcHRpb25zKCk7XG4gIGNvbnN0IFt7IHNlbmRCb3g6IHNlbmRCb3hTdHlsZVNldCB9XSA9IHVzZVN0eWxlU2V0KCk7XG4gIGNvbnN0IFt7IFNwZWVjaFJlY29nbml0aW9uIH0gPSB7fV0gPSB1c2VXZWJTcGVlY2hQb255ZmlsbCgpO1xuICBjb25zdCBbZGlyZWN0aW9uXSA9IHVzZURpcmVjdGlvbigpO1xuICBjb25zdCBbc3BlZWNoSW50ZXJpbXNWaXNpYmxlXSA9IHVzZVNlbmRCb3hTcGVlY2hJbnRlcmltc1Zpc2libGUoKTtcblxuICBjb25zdCBzdXBwb3J0U3BlZWNoUmVjb2duaXRpb24gPSAhIVNwZWVjaFJlY29nbml0aW9uO1xuXG4gIHJldHVybiAoXG4gICAgPGRpdiBjbGFzc05hbWU9e2NsYXNzTmFtZXMoc2VuZEJveFN0eWxlU2V0ICsgJycsIFJPT1RfQ1NTICsgJycsIGNsYXNzTmFtZSArICcnKX0gZGlyPXtkaXJlY3Rpb259IHJvbGU9XCJmb3JtXCI+XG4gICAgICA8U3VnZ2VzdGVkQWN0aW9ucyAvPlxuICAgICAgPGRpdiBjbGFzc05hbWU9XCJtYWluXCI+XG4gICAgICAgIHshaGlkZVVwbG9hZEJ1dHRvbiAmJiA8VXBsb2FkQnV0dG9uIC8+fVxuICAgICAgICB7c3BlZWNoSW50ZXJpbXNWaXNpYmxlID8gKFxuICAgICAgICAgIDxEaWN0YXRpb25JbnRlcmltcyBjbGFzc05hbWU9e0RJQ1RBVElPTl9JTlRFUklNU19DU1MgKyAnJ30gLz5cbiAgICAgICAgKSA6IChcbiAgICAgICAgICA8VGV4dEJveCBjbGFzc05hbWU9e1RFWFRfQk9YX0NTUyArICcnfSAvPlxuICAgICAgICApfVxuICAgICAgICA8ZGl2PlxuICAgICAgICAgIHtzdXBwb3J0U3BlZWNoUmVjb2duaXRpb24gPyA8TWljcm9waG9uZUJ1dHRvbiBjbGFzc05hbWU9e01JQ1JPUEhPTkVfQlVUVE9OX0NTUyArICcnfSAvPiA6IDxTZW5kQnV0dG9uIC8+fVxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICApO1xufTtcblxuQmFzaWNTZW5kQm94LmRlZmF1bHRQcm9wcyA9IHtcbiAgY2xhc3NOYW1lOiAnJ1xufTtcblxuQmFzaWNTZW5kQm94LnByb3BUeXBlcyA9IHtcbiAgY2xhc3NOYW1lOiBQcm9wVHlwZXMuc3RyaW5nXG59O1xuXG5leHBvcnQgZGVmYXVsdCBCYXNpY1NlbmRCb3g7XG5cbmV4cG9ydCB7IHVzZVNlbmRCb3hTcGVlY2hJbnRlcmltc1Zpc2libGUgfTtcbiJdfQ==