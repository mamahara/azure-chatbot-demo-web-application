"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.connectSuggestedActions = exports.default = void 0;

var _glamor = require("glamor");

var _reactFilm = _interopRequireDefault(require("react-film"));

var _classnames = _interopRequireDefault(require("classnames"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _react = _interopRequireDefault(require("react"));

var _connectToWebChat = _interopRequireDefault(require("../connectToWebChat"));

var _ScreenReaderText = _interopRequireDefault(require("../ScreenReaderText"));

var _SuggestedAction = _interopRequireDefault(require("./SuggestedAction"));

var _useDirection3 = _interopRequireDefault(require("../hooks/useDirection"));

var _useLocalizeAccessKey = _interopRequireDefault(require("../hooks/internal/useLocalizeAccessKey"));

var _useLocalizer = _interopRequireDefault(require("../hooks/useLocalizer"));

var _useStyleOptions3 = _interopRequireDefault(require("../hooks/useStyleOptions"));

var _useStyleSet3 = _interopRequireDefault(require("../hooks/useStyleSet"));

var _useSuggestedActionsAccessKey = _interopRequireDefault(require("../hooks/internal/useSuggestedActionsAccessKey"));

var _useUniqueId = _interopRequireDefault(require("../hooks/internal/useUniqueId"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }

function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function _iterableToArrayLimit(arr, i) { if (typeof Symbol === "undefined" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }

function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

var SUGGESTED_ACTION_STACKED_CSS = (0, _glamor.css)({
  display: 'flex',
  flexDirection: 'column'
});

function suggestedActionText(_ref) {
  var displayText = _ref.displayText,
      title = _ref.title,
      type = _ref.type,
      value = _ref.value;

  if (type === 'messageBack') {
    return title || displayText;
  } else if (title) {
    return title;
  } else if (typeof value === 'string') {
    return value;
  }

  return JSON.stringify(value);
}

var connectSuggestedActions = function connectSuggestedActions() {
  for (var _len = arguments.length, selectors = new Array(_len), _key = 0; _key < _len; _key++) {
    selectors[_key] = arguments[_key];
  }

  return _connectToWebChat.default.apply(void 0, [function (_ref2) {
    var language = _ref2.language,
        suggestedActions = _ref2.suggestedActions;
    return {
      language: language,
      suggestedActions: suggestedActions
    };
  }].concat(selectors));
};

exports.connectSuggestedActions = connectSuggestedActions;

var SuggestedActions = function SuggestedActions(_ref3) {
  var className = _ref3.className,
      _ref3$suggestedAction = _ref3.suggestedActions,
      suggestedActions = _ref3$suggestedAction === void 0 ? [] : _ref3$suggestedAction;

  var _useStyleOptions = (0, _useStyleOptions3.default)(),
      _useStyleOptions2 = _slicedToArray(_useStyleOptions, 1),
      _useStyleOptions2$ = _useStyleOptions2[0],
      suggestedActionLayout = _useStyleOptions2$.suggestedActionLayout,
      suggestedActionsStyleSetForReactFilm = _useStyleOptions2$.suggestedActionsStyleSet;

  var _useStyleSet = (0, _useStyleSet3.default)(),
      _useStyleSet2 = _slicedToArray(_useStyleSet, 1),
      suggestedActionsStyleSet = _useStyleSet2[0].suggestedActions;

  var _useSuggestedActionsA = (0, _useSuggestedActionsAccessKey.default)(),
      _useSuggestedActionsA2 = _slicedToArray(_useSuggestedActionsA, 1),
      accessKey = _useSuggestedActionsA2[0];

  var _useDirection = (0, _useDirection3.default)(),
      _useDirection2 = _slicedToArray(_useDirection, 1),
      direction = _useDirection2[0];

  var ariaLabelId = (0, _useUniqueId.default)('webchat__suggested-actions');
  var localize = (0, _useLocalizer.default)();
  var localizeAccessKey = (0, _useLocalizeAccessKey.default)();
  var suggestedActionsContainerText = localize('SUGGESTED_ACTIONS_ALT', suggestedActions.length ? accessKey ? localize('SUGGESTED_ACTIONS_ALT_HAS_CONTENT_AND_ACCESS_KEY', localizeAccessKey(accessKey)) : localize('SUGGESTED_ACTIONS_ALT_HAS_CONTENT') : localize('SUGGESTED_ACTIONS_ALT_NO_CONTENT'));

  if (!suggestedActions.length) {
    return /*#__PURE__*/_react.default.createElement("div", {
      "aria-labelledby": ariaLabelId,
      "aria-live": "polite",
      role: "status"
    }, /*#__PURE__*/_react.default.createElement(_ScreenReaderText.default, {
      id: ariaLabelId,
      text: suggestedActionsContainerText
    }));
  }

  var children = suggestedActions.map(function (_ref4, index) {
    var displayText = _ref4.displayText,
        image = _ref4.image,
        imageAltText = _ref4.imageAltText,
        text = _ref4.text,
        title = _ref4.title,
        type = _ref4.type,
        value = _ref4.value;
    return /*#__PURE__*/_react.default.createElement(_SuggestedAction.default, {
      ariaHidden: true,
      buttonText: suggestedActionText({
        displayText: displayText,
        title: title,
        type: type,
        value: value
      }),
      displayText: displayText,
      image: image,
      imageAlt: imageAltText,
      key: index,
      text: text,
      type: type,
      value: value
    });
  });

  if (suggestedActionLayout === 'stacked') {
    return /*#__PURE__*/_react.default.createElement("div", {
      "aria-labelledby": ariaLabelId,
      "aria-live": "polite",
      role: "status"
    }, /*#__PURE__*/_react.default.createElement(_ScreenReaderText.default, {
      id: ariaLabelId,
      text: suggestedActionsContainerText
    }), /*#__PURE__*/_react.default.createElement("div", {
      className: (0, _classnames.default)(suggestedActionsStyleSet + '', SUGGESTED_ACTION_STACKED_CSS + '', className + '')
    }, children));
  }

  return (
    /*#__PURE__*/
    // TODO: The content of suggested actions should be the labelled by the activity.
    //       That means, when the user focus into the suggested actions, it should read similar to "Bot said, what's your preference of today? Suggested actions has items: apple button, orange button, banana button."
    _react.default.createElement("div", {
      "aria-labelledby": ariaLabelId,
      "aria-live": "polite",
      role: "status"
    }, /*#__PURE__*/_react.default.createElement(_ScreenReaderText.default, {
      id: ariaLabelId,
      text: suggestedActionsContainerText
    }), /*#__PURE__*/_react.default.createElement(_reactFilm.default, {
      autoCenter: false,
      className: (0, _classnames.default)(suggestedActionsStyleSet + '', className + ''),
      dir: direction,
      flipperBlurFocusOnClick: true,
      showDots: false,
      showScrollBar: false,
      styleSet: suggestedActionsStyleSetForReactFilm
    }, children))
  );
};

SuggestedActions.defaultProps = {
  className: ''
};
SuggestedActions.propTypes = {
  className: _propTypes.default.string,
  suggestedActions: _propTypes.default.arrayOf(_propTypes.default.shape({
    displayText: _propTypes.default.string,
    image: _propTypes.default.string,
    imageAltText: _propTypes.default.string,
    text: _propTypes.default.string,
    title: _propTypes.default.string,
    type: _propTypes.default.string.isRequired,
    value: _propTypes.default.any
  })).isRequired
};

var _default = connectSuggestedActions()(SuggestedActions);

exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9TZW5kQm94L1N1Z2dlc3RlZEFjdGlvbnMuanMiXSwibmFtZXMiOlsiU1VHR0VTVEVEX0FDVElPTl9TVEFDS0VEX0NTUyIsImRpc3BsYXkiLCJmbGV4RGlyZWN0aW9uIiwic3VnZ2VzdGVkQWN0aW9uVGV4dCIsImRpc3BsYXlUZXh0IiwidGl0bGUiLCJ0eXBlIiwidmFsdWUiLCJKU09OIiwic3RyaW5naWZ5IiwiY29ubmVjdFN1Z2dlc3RlZEFjdGlvbnMiLCJzZWxlY3RvcnMiLCJjb25uZWN0VG9XZWJDaGF0IiwibGFuZ3VhZ2UiLCJzdWdnZXN0ZWRBY3Rpb25zIiwiU3VnZ2VzdGVkQWN0aW9ucyIsImNsYXNzTmFtZSIsInN1Z2dlc3RlZEFjdGlvbkxheW91dCIsInN1Z2dlc3RlZEFjdGlvbnNTdHlsZVNldEZvclJlYWN0RmlsbSIsInN1Z2dlc3RlZEFjdGlvbnNTdHlsZVNldCIsImFjY2Vzc0tleSIsImRpcmVjdGlvbiIsImFyaWFMYWJlbElkIiwibG9jYWxpemUiLCJsb2NhbGl6ZUFjY2Vzc0tleSIsInN1Z2dlc3RlZEFjdGlvbnNDb250YWluZXJUZXh0IiwibGVuZ3RoIiwiY2hpbGRyZW4iLCJtYXAiLCJpbmRleCIsImltYWdlIiwiaW1hZ2VBbHRUZXh0IiwidGV4dCIsImRlZmF1bHRQcm9wcyIsInByb3BUeXBlcyIsIlByb3BUeXBlcyIsInN0cmluZyIsImFycmF5T2YiLCJzaGFwZSIsImlzUmVxdWlyZWQiLCJhbnkiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7Ozs7Ozs7OztBQUVBLElBQU1BLDRCQUE0QixHQUFHLGlCQUFJO0FBQ3ZDQyxFQUFBQSxPQUFPLEVBQUUsTUFEOEI7QUFFdkNDLEVBQUFBLGFBQWEsRUFBRTtBQUZ3QixDQUFKLENBQXJDOztBQUtBLFNBQVND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QUQ7QUFDRSxNQUFBLFVBQVUsRUFBRSxLQURkO0FBRUUsTUFBQSxTQUFTLEVBQUUseUJBQVdOLHdCQUF3QixHQUFHLEVBQXRDLEVBQTBDSCxTQUFTLEdBQUcsRUFBdEQsQ0FGYjtBQUdFLE1BQUEsR0FBRyxFQUFFSyxTQUhQO0FBSUUsTUFBQSx1QkFBdUIsRUFBRSxJQUozQjtBQUtFLE1BQUEsUUFBUSxFQUFFLEtBTFo7QUFNRSxNQUFBLGFBQWEsRUFBRSxLQU5qQjtBQU9FLE1BQUEsUUFBUSxFQUFFSDtBQVBaLE9BU0dTLFFBVEgsQ0FGRjtBQUhGO0FBa0JELENBckVEOztBQXVFQVosZ0JBQWdCLENBQUNrQixZQUFqQixHQUFnQztBQUM5QmpCLEVBQUFBLFNBQVMsRUFBRTtBQURtQixDQUFoQztBQUlBRCxnQkFBZ0IsQ0FBQ21CLFNBQWpCLEdBQTZCO0FBQzNCbEIsRUFBQUEsU0FBUyxFQUFFbUIsbUJBQVVDLE1BRE07QUFFM0J0QixFQUFBQSxnQkFBZ0IsRUFBRXFCLG1CQUFVRSxPQUFWLENBQ2hCRixtQkFBVUcsS0FBVixDQUFnQjtBQUNkbEMsSUFBQUEsV0FBVyxFQUFFK0IsbUJBQVVDLE1BRFQ7QUFFZE4sSUFBQUEsS0FBSyxFQUFFSyxtQkFBVUMsTUFGSDtBQUdkTCxJQUFBQSxZQUFZLEVBQUVJLG1CQUFVQyxNQUhWO0FBSWRKLElBQUFBLElBQUksRUFBRUcsbUJBQVVDLE1BSkY7QUFLZC9CLElBQUFBLEtBQUssRUFBRThCLG1CQUFVQyxNQUxIO0FBTWQ5QixJQUFBQSxJQUFJLEVBQUU2QixtQkFBVUMsTUFBVixDQUFpQkcsVUFOVDtBQU9kaEMsSUFBQUEsS0FBSyxFQUFFNEIsbUJBQVVLO0FBUEgsR0FBaEIsQ0FEZ0IsRUFVaEJEO0FBWnlCLENBQTdCOztlQWVlN0IsdUJBQXVCLEdBQUdLLGdCQUFILEMiLCJzb3VyY2VSb290IjoiY29tcG9uZW50Oi8vLyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludCByZWFjdC9uby1hcnJheS1pbmRleC1rZXk6IFwib2ZmXCIgKi9cblxuaW1wb3J0IHsgY3NzIH0gZnJvbSAnZ2xhbW9yJztcbmltcG9ydCBCYXNpY0ZpbG0gZnJvbSAncmVhY3QtZmlsbSc7XG5pbXBvcnQgY2xhc3NOYW1lcyBmcm9tICdjbGFzc25hbWVzJztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuXG5pbXBvcnQgY29ubmVjdFRvV2ViQ2hhdCBmcm9tICcuLi9jb25uZWN0VG9XZWJDaGF0JztcbmltcG9ydCBTY3JlZW5SZWFkZXJUZXh0IGZyb20gJy4uL1NjcmVlblJlYWRlclRleHQnO1xuaW1wb3J0IFN1Z2dlc3RlZEFjdGlvbiBmcm9tICcuL1N1Z2dlc3RlZEFjdGlvbic7XG5pbXBvcnQgdXNlRGlyZWN0aW9uIGZyb20gJy4uL2hvb2tzL3VzZURpcmVjdGlvbic7XG5pbXBvcnQgdXNlTG9jYWxpemVBY2Nlc3NLZXkgZnJvbSAnLi4vaG9va3MvaW50ZXJuYWwvdXNlTG9jYWxpemVBY2Nlc3NLZXknO1xuaW1wb3J0IHVzZUxvY2FsaXplciBmcm9tICcuLi9ob29rcy91c2VMb2NhbGl6ZXInO1xuaW1wb3J0IHVzZVN0eWxlT3B0aW9ucyBmcm9tICcuLi9ob29rcy91c2VTdHlsZU9wdGlvbnMnO1xuaW1wb3J0IHVzZVN0eWxlU2V0IGZyb20gJy4uL2hvb2tzL3VzZVN0eWxlU2V0JztcbmltcG9ydCB1c2VTdWdnZXN0ZWRBY3Rpb25zQWNjZXNzS2V5IGZyb20gJy4uL2hvb2tzL2ludGVybmFsL3VzZVN1Z2dlc3RlZEFjdGlvbnNBY2Nlc3NLZXknO1xuaW1wb3J0IHVzZVVuaXF1ZUlkIGZyb20gJy4uL2hvb2tzL2ludGVybmFsL3VzZVVuaXF1ZUlkJztcblxuY29uc3QgU1VHR0VTVEVEX0FDVElPTl9TVEFDS0VEX0NTUyA9IGNzcyh7XG4gIGRpc3BsYXk6ICdmbGV4JyxcbiAgZmxleERpcmVjdGlvbjogJ2NvbHVtbidcbn0pO1xuXG5mdW5jdGlvbiBzdWdnZXN0ZWRBY3Rpb25UZXh0KHsgZGlzcGxheVRleHQsIHRpdGxlLCB0eXBlLCB2YWx1ZSB9KSB7XG4gIGlmICh0eXBlID09PSAnbWVzc2FnZUJhY2snKSB7XG4gICAgcmV0dXJuIHRpdGxlIHx8IGRpc3BsYXlUZXh0O1xuICB9IGVsc2UgaWYgKHRpdGxlKSB7XG4gICAgcmV0dXJuIHRpdGxlO1xuICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cblxuICByZXR1cm4gSlNPTi5zdHJpbmdpZnkodmFsdWUpO1xufVxuXG5jb25zdCBjb25uZWN0U3VnZ2VzdGVkQWN0aW9ucyA9ICguLi5zZWxlY3RvcnMpID0+XG4gIGNvbm5lY3RUb1dlYkNoYXQoXG4gICAgKHsgbGFuZ3VhZ2UsIHN1Z2dlc3RlZEFjdGlvbnMgfSkgPT4gKHtcbiAgICAgIGxhbmd1YWdlLFxuICAgICAgc3VnZ2VzdGVkQWN0aW9uc1xuICAgIH0pLFxuICAgIC4uLnNlbGVjdG9yc1xuICApO1xuXG5jb25zdCBTdWdnZXN0ZWRBY3Rpb25zID0gKHsgY2xhc3NOYW1lLCBzdWdnZXN0ZWRBY3Rpb25zID0gW10gfSkgPT4ge1xuICBjb25zdCBbeyBzdWdnZXN0ZWRBY3Rpb25MYXlvdXQsIHN1Z2dlc3RlZEFjdGlvbnNTdHlsZVNldDogc3VnZ2VzdGVkQWN0aW9uc1N0eWxlU2V0Rm9yUmVhY3RGaWxtIH1dID0gdXNlU3R5bGVPcHRpb25zKCk7XG4gIGNvbnN0IFt7IHN1Z2dlc3RlZEFjdGlvbnM6IHN1Z2dlc3RlZEFjdGlvbnNTdHlsZVNldCB9XSA9IHVzZVN0eWxlU2V0KCk7XG4gIGNvbnN0IFthY2Nlc3NLZXldID0gdXNlU3VnZ2VzdGVkQWN0aW9uc0FjY2Vzc0tleSgpO1xuICBjb25zdCBbZGlyZWN0aW9uXSA9IHVzZURpcmVjdGlvbigpO1xuICBjb25zdCBhcmlhTGFiZWxJZCA9IHVzZVVuaXF1ZUlkKCd3ZWJjaGF0X19zdWdnZXN0ZWQtYWN0aW9ucycpO1xuICBjb25zdCBsb2NhbGl6ZSA9IHVzZUxvY2FsaXplcigpO1xuICBjb25zdCBsb2NhbGl6ZUFjY2Vzc0tleSA9IHVzZUxvY2FsaXplQWNjZXNzS2V5KCk7XG5cbiAgY29uc3Qgc3VnZ2VzdGVkQWN0aW9uc0NvbnRhaW5lclRleHQgPSBsb2NhbGl6ZShcbiAgICAnU1VHR0VTVEVEX0FDVElPTlNfQUxUJyxcbiAgICBzdWdnZXN0ZWRBY3Rpb25zLmxlbmd0aFxuICAgICAgPyBhY2Nlc3NLZXlcbiAgICAgICAgPyBsb2NhbGl6ZSgnU1VHR0VTVEVEX0FDVElPTlNfQUxUX0hBU19DT05URU5UX0FORF9BQ0NFU1NfS0VZJywgbG9jYWxpemVBY2Nlc3NLZXkoYWNjZXNzS2V5KSlcbiAgICAgICAgOiBsb2NhbGl6ZSgnU1VHR0VTVEVEX0FDVElPTlNfQUxUX0hBU19DT05URU5UJylcbiAgICAgIDogbG9jYWxpemUoJ1NVR0dFU1RFRF9BQ1RJT05TX0FMVF9OT19DT05URU5UJylcbiAgKTtcblxuICBpZiAoIXN1Z2dlc3RlZEFjdGlvbnMubGVuZ3RoKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIDxkaXYgYXJpYS1sYWJlbGxlZGJ5PXthcmlhTGFiZWxJZH0gYXJpYS1saXZlPVwicG9saXRlXCIgcm9sZT1cInN0YXR1c1wiPlxuICAgICAgICA8U2NyZWVuUmVhZGVyVGV4dCBpZD17YXJpYUxhYmVsSWR9IHRleHQ9e3N1Z2dlc3RlZEFjdGlvbnNDb250YWluZXJUZXh0fSAvPlxuICAgICAgPC9kaXY+XG4gICAgKTtcbiAgfVxuXG4gIGNvbnN0IGNoaWxkcmVuID0gc3VnZ2VzdGVkQWN0aW9ucy5tYXAoKHsgZGlzcGxheVRleHQsIGltYWdlLCBpbWFnZUFsdFRleHQsIHRleHQsIHRpdGxlLCB0eXBlLCB2YWx1ZSB9LCBpbmRleCkgPT4gKFxuICAgIDxTdWdnZXN0ZWRBY3Rpb25cbiAgICAgIGFyaWFIaWRkZW49e3RydWV9XG4gICAgICBidXR0b25UZXh0PXtzdWdnZXN0ZWRBY3Rpb25UZXh0KHsgZGlzcGxheVRleHQsIHRpdGxlLCB0eXBlLCB2YWx1ZSB9KX1cbiAgICAgIGRpc3BsYXlUZXh0PXtkaXNwbGF5VGV4dH1cbiAgICAgIGltYWdlPXtpbWFnZX1cbiAgICAgIGltYWdlQWx0PXtpbWFnZUFsdFRleHR9XG4gICAgICBrZXk9e2luZGV4fVxuICAgICAgdGV4dD17dGV4dH1cbiAgICAgIHR5cGU9e3R5cGV9XG4gICAgICB2YWx1ZT17dmFsdWV9XG4gICAgLz5cbiAgKSk7XG5cbiAgaWYgKHN1Z2dlc3RlZEFjdGlvbkxheW91dCA9PT0gJ3N0YWNrZWQnKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIDxkaXYgYXJpYS1sYWJlbGxlZGJ5PXthcmlhTGFiZWxJZH0gYXJpYS1saXZlPVwicG9saXRlXCIgcm9sZT1cInN0YXR1c1wiPlxuICAgICAgICA8U2NyZWVuUmVhZGVyVGV4dCBpZD17YXJpYUxhYmVsSWR9IHRleHQ9e3N1Z2dlc3RlZEFjdGlvbnNDb250YWluZXJUZXh0fSAvPlxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT17Y2xhc3NOYW1lcyhzdWdnZXN0ZWRBY3Rpb25zU3R5bGVTZXQgKyAnJywgU1VHR0VTVEVEX0FDVElPTl9TVEFDS0VEX0NTUyArICcnLCBjbGFzc05hbWUgKyAnJyl9PlxuICAgICAgICAgIHtjaGlsZHJlbn1cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICApO1xuICB9XG5cbiAgcmV0dXJuIChcbiAgICAvLyBUT0RPOiBUaGUgY29udGVudCBvZiBzdWdnZXN0ZWQgYWN0aW9ucyBzaG91bGQgYmUgdGhlIGxhYmVsbGVkIGJ5IHRoZSBhY3Rpdml0eS5cbiAgICAvLyAgICAgICBUaGF0IG1lYW5zLCB3aGVuIHRoZSB1c2VyIGZvY3VzIGludG8gdGhlIHN1Z2dlc3RlZCBhY3Rpb25zLCBpdCBzaG91bGQgcmVhZCBzaW1pbGFyIHRvIFwiQm90IHNhaWQsIHdoYXQncyB5b3VyIHByZWZlcmVuY2Ugb2YgdG9kYXk/IFN1Z2dlc3RlZCBhY3Rpb25zIGhhcyBpdGVtczogYXBwbGUgYnV0dG9uLCBvcmFuZ2UgYnV0dG9uLCBiYW5hbmEgYnV0dG9uLlwiXG4gICAgPGRpdiBhcmlhLWxhYmVsbGVkYnk9e2FyaWFMYWJlbElkfSBhcmlhLWxpdmU9XCJwb2xpdGVcIiByb2xlPVwic3RhdHVzXCI+XG4gICAgICA8U2NyZWVuUmVhZGVyVGV4dCBpZD17YXJpYUxhYmVsSWR9IHRleHQ9e3N1Z2dlc3RlZEFjdGlvbnNDb250YWluZXJUZXh0fSAvPlxuICAgICAgPEJhc2ljRmlsbVxuICAgICAgICBhdXRvQ2VudGVyPXtmYWxzZX1cbiAgICAgICAgY2xhc3NOYW1lPXtjbGFzc05hbWVzKHN1Z2dlc3RlZEFjdGlvbnNTdHlsZVNldCArICcnLCBjbGFzc05hbWUgKyAnJyl9XG4gICAgICAgIGRpcj17ZGlyZWN0aW9ufVxuICAgICAgICBmbGlwcGVyQmx1ckZvY3VzT25DbGljaz17dHJ1ZX1cbiAgICAgICAgc2hvd0RvdHM9e2ZhbHNlfVxuICAgICAgICBzaG93U2Nyb2xsQmFyPXtmYWxzZX1cbiAgICAgICAgc3R5bGVTZXQ9e3N1Z2dlc3RlZEFjdGlvbnNTdHlsZVNldEZvclJlYWN0RmlsbX1cbiAgICAgID5cbiAgICAgICAge2NoaWxkcmVufVxuICAgICAgPC9CYXNpY0ZpbG0+XG4gICAgPC9kaXY+XG4gICk7XG59O1xuXG5TdWdnZXN0ZWRBY3Rpb25zLmRlZmF1bHRQcm9wcyA9IHtcbiAgY2xhc3NOYW1lOiAnJ1xufTtcblxuU3VnZ2VzdGVkQWN0aW9ucy5wcm9wVHlwZXMgPSB7XG4gIGNsYXNzTmFtZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgc3VnZ2VzdGVkQWN0aW9uczogUHJvcFR5cGVzLmFycmF5T2YoXG4gICAgUHJvcFR5cGVzLnNoYXBlKHtcbiAgICAgIGRpc3BsYXlUZXh0OiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgICAgaW1hZ2U6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgICBpbWFnZUFsdFRleHQ6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgICB0ZXh0OiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgICAgdGl0bGU6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgICB0eXBlOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gICAgICB2YWx1ZTogUHJvcFR5cGVzLmFueVxuICAgIH0pXG4gICkuaXNSZXF1aXJlZFxufTtcblxuZXhwb3J0IGRlZmF1bHQgY29ubmVjdFN1Z2dlc3RlZEFjdGlvbnMoKShTdWdnZXN0ZWRBY3Rpb25zKTtcblxuZXhwb3J0IHsgY29ubmVjdFN1Z2dlc3RlZEFjdGlvbnMgfTtcbiJdfQ==