"use strict";

function _typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.connectSuggestedAction = exports.default = void 0;

var _glamor = require("glamor");

var _classnames = _interopRequireDefault(require("classnames"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _react = _interopRequireWildcard(require("react"));

var _AccessibleButton = _interopRequireDefault(require("../Utils/AccessibleButton"));

var _connectToWebChat = _interopRequireDefault(require("../connectToWebChat"));

var _useDirection3 = _interopRequireDefault(require("../hooks/useDirection"));

var _useDisabled3 = _interopRequireDefault(require("../hooks/useDisabled"));

var _useFocus = _interopRequireDefault(require("../hooks/useFocus"));

var _useFocusAccessKeyEffect = _interopRequireDefault(require("../Utils/AccessKeySink/useFocusAccessKeyEffect"));

var _useLocalizeAccessKey = _interopRequireDefault(require("../hooks/internal/useLocalizeAccessKey"));

var _usePerformCardAction = _interopRequireDefault(require("../hooks/usePerformCardAction"));

var _useScrollToEnd = _interopRequireDefault(require("../hooks/useScrollToEnd"));

var _useStyleSet3 = _interopRequireDefault(require("../hooks/useStyleSet"));

var _useSuggestedActions3 = _interopRequireDefault(require("../hooks/useSuggestedActions"));

var _useSuggestedActionsAccessKey = _interopRequireDefault(require("../hooks/internal/useSuggestedActionsAccessKey"));

function _getRequireWildcardCache() { if (typeof WeakMap !== "function") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }

function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }

function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function _iterableToArrayLimit(arr, i) { if (typeof Symbol === "undefined" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }

function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

var SUGGESTED_ACTION_CSS = (0, _glamor.css)({
  '&.webchat__suggested-action': {
    display: 'flex',
    flexDirection: 'column',
    whiteSpace: 'initial',
    '& .webchat__suggested-action__button': {
      display: 'flex',
      overflow: 'hidden'
    }
  }
});

var connectSuggestedAction = function connectSuggestedAction() {
  for (var _len = arguments.length, selectors = new Array(_len), _key = 0; _key < _len; _key++) {
    selectors[_key] = arguments[_key];
  }

  return _connectToWebChat.default.apply(void 0, [function (_ref, _ref2) {
    var clearSuggestedActions = _ref.clearSuggestedActions,
        disabled = _ref.disabled,
        language = _ref.language,
        onCardAction = _ref.onCardAction;
    var displayText = _ref2.displayText,
        text = _ref2.text,
        type = _ref2.type,
        value = _ref2.value;
    return {
      click: function click() {
        onCardAction({
          displayText: displayText,
          text: text,
          type: type,
          value: value
        });
        type === 'openUrl' && clearSuggestedActions();
      },
      disabled: disabled,
      language: language
    };
  }].concat(selectors));
};

exports.connectSuggestedAction = connectSuggestedAction;

var SuggestedAction = function SuggestedAction(_ref3) {
  var ariaHidden = _ref3['aria-hidden'],
      buttonText = _ref3.buttonText,
      displayText = _ref3.displayText,
      image = _ref3.image,
      imageAlt = _ref3.imageAlt,
      text = _ref3.text,
      type = _ref3.type,
      value = _ref3.value;

  var _useSuggestedActions = (0, _useSuggestedActions3.default)(),
      _useSuggestedActions2 = _slicedToArray(_useSuggestedActions, 2),
      _ = _useSuggestedActions2[0],
      setSuggestedActions = _useSuggestedActions2[1];

  var _useStyleSet = (0, _useStyleSet3.default)(),
      _useStyleSet2 = _slicedToArray(_useStyleSet, 1),
      suggestedActionStyleSet = _useStyleSet2[0].suggestedAction;

  var _useSuggestedActionsA = (0, _useSuggestedActionsAccessKey.default)(),
      _useSuggestedActionsA2 = _slicedToArray(_useSuggestedActionsA, 1),
      accessKey = _useSuggestedActionsA2[0];

  var _useDirection = (0, _useDirection3.default)(),
      _useDirection2 = _slicedToArray(_useDirection, 1),
      direction = _useDirection2[0];

  var _useDisabled = (0, _useDisabled3.default)(),
      _useDisabled2 = _slicedToArray(_useDisabled, 1),
      disabled = _useDisabled2[0];

  var focus = (0, _useFocus.default)();
  var focusRef = (0, _react.useRef)();
  var localizeAccessKey = (0, _useLocalizeAccessKey.default)();
  var performCardAction = (0, _usePerformCardAction.default)();
  var scrollToEnd = (0, _useScrollToEnd.default)();
  var handleClick = (0, _react.useCallback)(function (_ref4) {
    var target = _ref4.target;
    performCardAction({
      displayText: displayText,
      text: text,
      type: type,
      value: value
    }, {
      target: target
    }); // Since "openUrl" action do not submit, the suggested action buttons do not hide after click.

    type === 'openUrl' && setSuggestedActions([]);
    focus('sendBoxWithoutKeyboard');
    scrollToEnd();
  }, [displayText, focus, performCardAction, scrollToEnd, setSuggestedActions, text, type, value]);
  (0, _useFocusAccessKeyEffect.default)(accessKey, focusRef);
  return /*#__PURE__*/_react.default.createElement("div", {
    "aria-hidden": ariaHidden,
    className: (0, _classnames.default)(suggestedActionStyleSet + '', SUGGESTED_ACTION_CSS + '', 'webchat__suggested-action')
  }, /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, _extends({}, accessKey ? {
    'aria-keyshortcuts': localizeAccessKey(accessKey)
  } : {}, {
    className: "webchat__suggested-action__button",
    disabled: disabled,
    onClick: handleClick,
    ref: focusRef,
    type: "button"
  }), image && /*#__PURE__*/_react.default.createElement("img", {
    alt: imageAlt,
    className: (0, _classnames.default)('webchat__suggested-action__image', direction === 'rtl' && 'webchat__suggested-action__image--rtl'),
    src: image
  }), /*#__PURE__*/_react.default.createElement("nobr", {
    className: "webchat__suggested-action__button-text"
  }, buttonText)));
};

SuggestedAction.defaultProps = {
  'aria-hidden': false,
  displayText: '',
  image: '',
  imageAlt: undefined,
  text: '',
  type: '',
  value: undefined
};
SuggestedAction.propTypes = {
  'aria-hidden': _propTypes.default.bool,
  buttonText: _propTypes.default.string.isRequired,
  displayText: _propTypes.default.string,
  image: _propTypes.default.string,
  imageAlt: _propTypes.default.string,
  text: _propTypes.default.string,
  type: _propTypes.default.string,
  value: _propTypes.default.any
};
var _default = SuggestedAction;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9TZW5kQm94L1N1Z2dlc3RlZEFjdGlvbi5qcyJdLCJuYW1lcyI6WyJTVUdHRVNURURfQUNUSU9OX0NTUyIsImRpc3BsYXkiLCJmbGV4RGlyZWN0aW9uIiwid2hpdGVTcGFjZSIsIm92ZXJmbG93IiwiY29ubmVjdFN1Z2dlc3RlZEFjdGlvbiIsInNlbGVjdG9ycyIsImNvbm5lY3RUb1dlYkNoYXQiLCJjbGVhclN1Z2dlc3RlZEFjdGlvbnMiLCJkaXNhYmxlZCIsImxhbmd1YWdlIiwib25DYXJkQWN0aW9uIiwiZGlzcGxheVRleHQiLCJ0ZXh0IiwidHlwZSIsInZhbHVlIiwiY2xpY2siLCJTdWdnZXN0ZWRBY3Rpb24iLCJhcmlhSGlkZGVuIiwiYnV0dG9uVGV4dCIsImltYWdlIiwiaW1hZ2VBbHQiLCJfIiwic2V0U3VnZ2VzdGVkQWN0aW9ucyIsInN1Z2dlc3RlZEFjdGlvblN0eWxlU2V0Iiwic3VnZ2VzdGVkQWN0aW9uIiwiYWNjZXNzS2V5IiwiZGlyZWN0aW9uIiwiZm9jdXMiLCJmb2N1c1JlZiIsImxvY2FsaXplQWNjZXNzS2V5IiwicGVyZm9ybUNhcmRBY3Rpb24iLCJzY3JvbGxUb0VuZCIsImhhbmRsZUNsaWNrIiwidGFyZ2V0IiwiZGVmYXVsdFByb3BzIiwidW5kZWZpbmVkIiwicHJvcFR5cGVzIiwiUHJvcFR5cGVzIiwiYm9vbCIsInN0cmluZyIsImlzUmVxdWlyZWQiLCJhbnkiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRUEsSUFBTUEsb0JBQW9CLEdBQUcsaUJBQUk7QUFDL0IsaUNBQStCO0FBQzdCQyxJQUFBQSxPQUFPLEVBQUUsTUFEb0I7QUFFN0JDLElBQUFBLGFBQWEsRUFBRSxRQUZjO0FBRzdCQyxJQUFBQSxVQUFV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QkMsRUFBQUEsSUFBSSxFQUFFLEVBTnVCO0FBTzdCQyxFQUFBQSxLQUFLLEVBQUVxQjtBQVBzQixDQUEvQjtBQVVBbkIsZUFBZSxDQUFDb0IsU0FBaEIsR0FBNEI7QUFDMUIsaUJBQWVDLG1CQUFVQyxJQURDO0FBRTFCcEIsRUFBQUEsVUFBVSxFQUFFbUIsbUJBQVVFLE1BQVYsQ0FBaUJDLFVBRkg7QUFHMUI3QixFQUFBQSxXQUFXLEVBQUUwQixtQkFBVUUsTUFIRztBQUkxQnBCLEVBQUFBLEtBQUssRUFBRWtCLG1CQUFVRSxNQUpTO0FBSzFCbkIsRUFBQUEsUUFBUSxFQUFFaUIsbUJBQVVFLE1BTE07QUFNMUIzQixFQUFBQSxJQUFJLEVBQUV5QixtQkFBVUUsTUFOVTtBQU8xQjFCLEVBQUFBLElBQUksRUFBRXdCLG1CQUFVRSxNQVBVO0FBUTFCekIsRUFBQUEsS0FBSyxFQUFFdUIsbUJBQVVJO0FBUlMsQ0FBNUI7ZUFXZXpCLGUiLCJzb3VyY2VSb290IjoiY29tcG9uZW50Oi8vLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNzcyB9IGZyb20gJ2dsYW1vcic7XG5pbXBvcnQgY2xhc3NOYW1lcyBmcm9tICdjbGFzc25hbWVzJztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgUmVhY3QsIHsgdXNlQ2FsbGJhY2ssIHVzZVJlZiB9IGZyb20gJ3JlYWN0JztcblxuaW1wb3J0IEFjY2Vzc2libGVCdXR0b24gZnJvbSAnLi4vVXRpbHMvQWNjZXNzaWJsZUJ1dHRvbic7XG5pbXBvcnQgY29ubmVjdFRvV2ViQ2hhdCBmcm9tICcuLi9jb25uZWN0VG9XZWJDaGF0JztcbmltcG9ydCB1c2VEaXJlY3Rpb24gZnJvbSAnLi4vaG9va3MvdXNlRGlyZWN0aW9uJztcbmltcG9ydCB1c2VEaXNhYmxlZCBmcm9tICcuLi9ob29rcy91c2VEaXNhYmxlZCc7XG5pbXBvcnQgdXNlRm9jdXMgZnJvbSAnLi4vaG9va3MvdXNlRm9jdXMnO1xuaW1wb3J0IHVzZUZvY3VzQWNjZXNzS2V5RWZmZWN0IGZyb20gJy4uL1V0aWxzL0FjY2Vzc0tleVNpbmsvdXNlRm9jdXNBY2Nlc3NLZXlFZmZlY3QnO1xuaW1wb3J0IHVzZUxvY2FsaXplQWNjZXNzS2V5IGZyb20gJy4uL2hvb2tzL2ludGVybmFsL3VzZUxvY2FsaXplQWNjZXNzS2V5JztcbmltcG9ydCB1c2VQZXJmb3JtQ2FyZEFjdGlvbiBmcm9tICcuLi9ob29rcy91c2VQZXJmb3JtQ2FyZEFjdGlvbic7XG5pbXBvcnQgdXNlU2Nyb2xsVG9FbmQgZnJvbSAnLi4vaG9va3MvdXNlU2Nyb2xsVG9FbmQnO1xuaW1wb3J0IHVzZVN0eWxlU2V0IGZyb20gJy4uL2hvb2tzL3VzZVN0eWxlU2V0JztcbmltcG9ydCB1c2VTdWdnZXN0ZWRBY3Rpb25zIGZyb20gJy4uL2hvb2tzL3VzZVN1Z2dlc3RlZEFjdGlvbnMnO1xuaW1wb3J0IHVzZVN1Z2dlc3RlZEFjdGlvbnNBY2Nlc3NLZXkgZnJvbSAnLi4vaG9va3MvaW50ZXJuYWwvdXNlU3VnZ2VzdGVkQWN0aW9uc0FjY2Vzc0tleSc7XG5cbmNvbnN0IFNVR0dFU1RFRF9BQ1RJT05fQ1NTID0gY3NzKHtcbiAgJyYud2ViY2hhdF9fc3VnZ2VzdGVkLWFjdGlvbic6IHtcbiAgICBkaXNwbGF5OiAnZmxleCcsXG4gICAgZmxleERpcmVjdGlvbjogJ2NvbHVtbicsXG4gICAgd2hpdGVTcGFjZTogJ2luaXRpYWwnLFxuXG4gICAgJyYgLndlYmNoYXRfX3N1Z2dlc3RlZC1hY3Rpb25fX2J1dHRvbic6IHtcbiAgICAgIGRpc3BsYXk6ICdmbGV4JyxcbiAgICAgIG92ZXJmbG93OiAnaGlkZGVuJ1xuICAgIH1cbiAgfVxufSk7XG5cbmNvbnN0IGNvbm5lY3RTdWdnZXN0ZWRBY3Rpb24gPSAoLi4uc2VsZWN0b3JzKSA9PlxuICBjb25uZWN0VG9XZWJDaGF0KFxuICAgICh7IGNsZWFyU3VnZ2VzdGVkQWN0aW9ucywgZGlzYWJsZWQsIGxhbmd1YWdlLCBvbkNhcmRBY3Rpb24gfSwgeyBkaXNwbGF5VGV4dCwgdGV4dCwgdHlwZSwgdmFsdWUgfSkgPT4gKHtcbiAgICAgIGNsaWNrOiAoKSA9PiB7XG4gICAgICAgIG9uQ2FyZEFjdGlvbih7IGRpc3BsYXlUZXh0LCB0ZXh0LCB0eXBlLCB2YWx1ZSB9KTtcbiAgICAgICAgdHlwZSA9PT0gJ29wZW5VcmwnICYmIGNsZWFyU3VnZ2VzdGVkQWN0aW9ucygpO1xuICAgICAgfSxcbiAgICAgIGRpc2FibGVkLFxuICAgICAgbGFuZ3VhZ2VcbiAgICB9KSxcbiAgICAuLi5zZWxlY3RvcnNcbiAgKTtcblxuY29uc3QgU3VnZ2VzdGVkQWN0aW9uID0gKHtcbiAgJ2FyaWEtaGlkZGVuJzogYXJpYUhpZGRlbixcbiAgYnV0dG9uVGV4dCxcbiAgZGlzcGxheVRleHQsXG4gIGltYWdlLFxuICBpbWFnZUFsdCxcbiAgdGV4dCxcbiAgdHlwZSxcbiAgdmFsdWVcbn0pID0+IHtcbiAgY29uc3QgW18sIHNldFN1Z2dlc3RlZEFjdGlvbnNdID0gdXNlU3VnZ2VzdGVkQWN0aW9ucygpO1xuICBjb25zdCBbeyBzdWdnZXN0ZWRBY3Rpb246IHN1Z2dlc3RlZEFjdGlvblN0eWxlU2V0IH1dID0gdXNlU3R5bGVTZXQoKTtcbiAgY29uc3QgW2FjY2Vzc0tleV0gPSB1c2VTdWdnZXN0ZWRBY3Rpb25zQWNjZXNzS2V5KCk7XG4gIGNvbnN0IFtkaXJlY3Rpb25dID0gdXNlRGlyZWN0aW9uKCk7XG4gIGNvbnN0IFtkaXNhYmxlZF0gPSB1c2VEaXNhYmxlZCgpO1xuICBjb25zdCBmb2N1cyA9IHVzZUZvY3VzKCk7XG4gIGNvbnN0IGZvY3VzUmVmID0gdXNlUmVmKCk7XG4gIGNvbnN0IGxvY2FsaXplQWNjZXNzS2V5ID0gdXNlTG9jYWxpemVBY2Nlc3NLZXkoKTtcbiAgY29uc3QgcGVyZm9ybUNhcmRBY3Rpb24gPSB1c2VQZXJmb3JtQ2FyZEFjdGlvbigpO1xuICBjb25zdCBzY3JvbGxUb0VuZCA9IHVzZVNjcm9sbFRvRW5kKCk7XG5cbiAgY29uc3QgaGFuZGxlQ2xpY2sgPSB1c2VDYWxsYmFjayhcbiAgICAoeyB0YXJnZXQgfSkgPT4ge1xuICAgICAgcGVyZm9ybUNhcmRBY3Rpb24oeyBkaXNwbGF5VGV4dCwgdGV4dCwgdHlwZSwgdmFsdWUgfSwgeyB0YXJnZXQgfSk7XG5cbiAgICAgIC8vIFNpbmNlIFwib3BlblVybFwiIGFjdGlvbiBkbyBub3Qgc3VibWl0LCB0aGUgc3VnZ2VzdGVkIGFjdGlvbiBidXR0b25zIGRvIG5vdCBoaWRlIGFmdGVyIGNsaWNrLlxuICAgICAgdHlwZSA9PT0gJ29wZW5VcmwnICYmIHNldFN1Z2dlc3RlZEFjdGlvbnMoW10pO1xuXG4gICAgICBmb2N1cygnc2VuZEJveFdpdGhvdXRLZXlib2FyZCcpO1xuICAgICAgc2Nyb2xsVG9FbmQoKTtcbiAgICB9LFxuICAgIFtkaXNwbGF5VGV4dCwgZm9jdXMsIHBlcmZvcm1DYXJkQWN0aW9uLCBzY3JvbGxUb0VuZCwgc2V0U3VnZ2VzdGVkQWN0aW9ucywgdGV4dCwgdHlwZSwgdmFsdWVdXG4gICk7XG5cbiAgdXNlRm9jdXNBY2Nlc3NLZXlFZmZlY3QoYWNjZXNzS2V5LCBmb2N1c1JlZik7XG5cbiAgcmV0dXJuIChcbiAgICA8ZGl2XG4gICAgICBhcmlhLWhpZGRlbj17YXJpYUhpZGRlbn1cbiAgICAgIGNsYXNzTmFtZT17Y2xhc3NOYW1lcyhzdWdnZXN0ZWRBY3Rpb25TdHlsZVNldCArICcnLCBTVUdHRVNURURfQUNUSU9OX0NTUyArICcnLCAnd2ViY2hhdF9fc3VnZ2VzdGVkLWFjdGlvbicpfVxuICAgID5cbiAgICAgIDxBY2Nlc3NpYmxlQnV0dG9uXG4gICAgICAgIHsuLi4oYWNjZXNzS2V5ID8geyAnYXJpYS1rZXlzaG9ydGN1dHMnOiBsb2NhbGl6ZUFjY2Vzc0tleShhY2Nlc3NLZXkpIH0gOiB7fSl9XG4gICAgICAgIGNsYXNzTmFtZT1cIndlYmNoYXRfX3N1Z2dlc3RlZC1hY3Rpb25fX2J1dHRvblwiXG4gICAgICAgIGRpc2FibGVkPXtkaXNhYmxlZH1cbiAgICAgICAgb25DbGljaz17aGFuZGxlQ2xpY2t9XG4gICAgICAgIHJlZj17Zm9jdXNSZWZ9XG4gICAgICAgIHR5cGU9XCJidXR0b25cIlxuICAgICAgPlxuICAgICAgICB7aW1hZ2UgJiYgKFxuICAgICAgICAgIDxpbWdcbiAgICAgICAgICAgIGFsdD17aW1hZ2VBbHR9XG4gICAgICAgICAgICBjbGFzc05hbWU9e2NsYXNzTmFtZXMoXG4gICAgICAgICAgICAgICd3ZWJjaGF0X19zdWdnZXN0ZWQtYWN0aW9uX19pbWFnZScsXG4gICAgICAgICAgICAgIGRpcmVjdGlvbiA9PT0gJ3J0bCcgJiYgJ3dlYmNoYXRfX3N1Z2dlc3RlZC1hY3Rpb25fX2ltYWdlLS1ydGwnXG4gICAgICAgICAgICApfVxuICAgICAgICAgICAgc3JjPXtpbWFnZX1cbiAgICAgICAgICAvPlxuICAgICAgICApfVxuICAgICAgICA8bm9iciBjbGFzc05hbWU9XCJ3ZWJjaGF0X19zdWdnZXN0ZWQtYWN0aW9uX19idXR0b24tdGV4dFwiPntidXR0b25UZXh0fTwvbm9icj5cbiAgICAgIDwvQWNjZXNzaWJsZUJ1dHRvbj5cbiAgICA8L2Rpdj5cbiAgKTtcbn07XG5cblN1Z2dlc3RlZEFjdGlvbi5kZWZhdWx0UHJvcHMgPSB7XG4gICdhcmlhLWhpZGRlbic6IGZhbHNlLFxuICBkaXNwbGF5VGV4dDogJycsXG4gIGltYWdlOiAnJyxcbiAgaW1hZ2VBbHQ6IHVuZGVmaW5lZCxcbiAgdGV4dDogJycsXG4gIHR5cGU6ICcnLFxuICB2YWx1ZTogdW5kZWZpbmVkXG59O1xuXG5TdWdnZXN0ZWRBY3Rpb24ucHJvcFR5cGVzID0ge1xuICAnYXJpYS1oaWRkZW4nOiBQcm9wVHlwZXMuYm9vbCxcbiAgYnV0dG9uVGV4dDogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICBkaXNwbGF5VGV4dDogUHJvcFR5cGVzLnN0cmluZyxcbiAgaW1hZ2U6IFByb3BUeXBlcy5zdHJpbmcsXG4gIGltYWdlQWx0OiBQcm9wVHlwZXMuc3RyaW5nLFxuICB0ZXh0OiBQcm9wVHlwZXMuc3RyaW5nLFxuICB0eXBlOiBQcm9wVHlwZXMuc3RyaW5nLFxuICB2YWx1ZTogUHJvcFR5cGVzLmFueVxufTtcblxuZXhwb3J0IGRlZmF1bHQgU3VnZ2VzdGVkQWN0aW9uO1xuXG5leHBvcnQgeyBjb25uZWN0U3VnZ2VzdGVkQWN0aW9uIH07XG4iXX0=