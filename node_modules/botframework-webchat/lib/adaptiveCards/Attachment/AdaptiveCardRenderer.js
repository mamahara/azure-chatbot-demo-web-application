"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _botframeworkWebchatComponent = require("botframework-webchat-component");

var _classnames = _interopRequireDefault(require("classnames"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _react = _interopRequireWildcard(require("react"));

var _useAdaptiveCardsHostConfig = _interopRequireDefault(require("../hooks/useAdaptiveCardsHostConfig"));

var _useAdaptiveCardsPackage = _interopRequireDefault(require("../hooks/useAdaptiveCardsPackage"));

/* eslint no-magic-numbers: ["error", { "ignore": [-1, 0, 2] }] */
var ErrorBox = _botframeworkWebchatComponent.Components.ErrorBox;
var useDisabled = _botframeworkWebchatComponent.hooks.useDisabled,
    useLocalizer = _botframeworkWebchatComponent.hooks.useLocalizer,
    usePerformCardAction = _botframeworkWebchatComponent.hooks.usePerformCardAction,
    useRenderMarkdownAsHTML = _botframeworkWebchatComponent.hooks.useRenderMarkdownAsHTML,
    useScrollToEnd = _botframeworkWebchatComponent.hooks.useScrollToEnd,
    useStyleSet = _botframeworkWebchatComponent.hooks.useStyleSet;

function addClass(element, className) {
  var classNames = new Set(element.className.split(' '));

  if (!classNames.has(className)) {
    classNames.add(className);
    element.className = Array.from(classNames).join(' ');
    return true;
  }

  return false;
}

function addPersistentClassWithUndo(element, className) {
  if (addClass(element, className)) {
    // After we add the class, keep observing the element to make sure the class is not removed.
    var observer = new MutationObserver(function () {
      return addClass(element, className);
    });
    observer.observe(element, {
      attributes: true,
      attributeFilter: ['class']
    });
    return function () {
      var classNames = new Set(element.className.split(' '));
      classNames.delete(className);
      element.className = Array.from(classNames).join(' ');
      observer.disconnect();
    };
  }
}

function isPlainObject(obj) {
  return Object.getPrototypeOf(obj) === Object.prototype;
}

function setAttributeWithUndo(element, qualifiedName, nextValue) {
  var value = element.getAttribute(qualifiedName);

  if (value !== nextValue) {
    element.setAttribute(qualifiedName, nextValue);
    return function () {
      return value ? element.setAttribute(qualifiedName, value) : element.removeAttribute(qualifiedName);
    };
  }
}

var disabledHandler = function disabledHandler(event) {
  event.preventDefault();
  event.stopImmediatePropagation();
  event.stopPropagation();
};

function addEventListenerOnceWithUndo(element, name, handler) {
  /* eslint-disable-next-line prefer-const */
  var detach;

  var detachingHandler = function detachingHandler(event) {
    try {
      handler(event);
    } finally {
      // IE11 does not support { once: true }, so we need to detach manually.
      detach();
    }
  };

  detach = function detach() {
    return element.removeEventListener(name, detachingHandler);
  };

  element.addEventListener(name, detachingHandler, {
    once: true
  });
  return detach;
}

function disableElementWithUndo(element) {
  var undoStack = [];
  var isActive = element === document.activeElement;
  var tag = element.nodeName.toLowerCase();
  /* eslint-disable-next-line default-case */

  switch (tag) {
    // Should we not disable <a>? Will some of the <a> are styled as button?
    case 'a':
      undoStack.push(addEventListenerOnceWithUndo(element, 'click', disabledHandler));
      break;

    case 'button':
    case 'input':
    case 'select':
    case 'textarea':
      undoStack.push(setAttributeWithUndo(element, 'aria-disabled', 'true'));

      if (isActive) {
        undoStack.push(addEventListenerOnceWithUndo(element, 'blur', function () {
          return undoStack.push(setAttributeWithUndo(element, 'disabled', 'disabled'));
        }));
      } else {
        undoStack.push(setAttributeWithUndo(element, 'disabled', 'disabled'));
      }

      if (tag === 'input' || tag === 'textarea') {
        undoStack.push(addEventListenerOnceWithUndo(element, 'click', disabledHandler));
        undoStack.push(setAttributeWithUndo(element, 'readonly', 'readonly'));
      } else if (tag === 'select') {
        undoStack.push.apply(undoStack, (0, _toConsumableArray2.default)([].map.call(element.querySelectorAll('option'), function (option) {
          return setAttributeWithUndo(option, 'disabled', 'disabled');
        })));
      }

      break;
  }

  return function () {
    return undoStack.forEach(function (undo) {
      return undo && undo();
    });
  };
}

function disableInputElementsWithUndo(element) {
  var observeSubtree = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;
  var undoStack = [].map.call(element.querySelectorAll('a, button, input, select, textarea'), function (element) {
    return disableElementWithUndo(element);
  });
  var tag = element.nodeName.toLowerCase(); // Only set tabindex="-1" on focusable element. Otherwise, we will make <div> focusable by mouse.

  (tag === 'a' || tag === 'button' || tag === 'input' || tag === 'select' || tag === 'textarea') && undoStack.push(setAttributeWithUndo(element, 'tabindex', '-1'));

  if (observeSubtree) {
    var observer = new MutationObserver(function (mutations) {
      return mutations.forEach(function (_ref) {
        var addedNodes = _ref.addedNodes;
        return undoStack.push.apply(undoStack, (0, _toConsumableArray2.default)(addedNodes.map(function (addedNode) {
          return disableInputElementsWithUndo(addedNode, false);
        })));
      });
    });
    observer.observe(element, {
      childList: true,
      subtree: true
    });
    undoStack.push(function () {
      return observer.disconnect();
    });
  }

  return function () {
    return undoStack.forEach(function (undo) {
      return undo && undo();
    });
  };
}

function getFocusableElements(element) {
  return [].filter.call(element.querySelectorAll(['a', 'body', 'button', 'frame', 'iframe', 'img', 'input', 'isindex', 'object', 'select', 'textarea', '[tabindex]'].join(', ')), function (element) {
    var tabIndex = (0, _botframeworkWebchatComponent.getTabIndex)(element);
    return typeof tabIndex === 'number' && tabIndex >= 0;
  });
}

function restoreActiveElementIndex(element, activeElementIndex) {
  var focusable = getFocusableElements(element)[activeElementIndex];
  focusable && focusable.focus();
}

function saveActiveElementIndex(element) {
  return getFocusableElements(element).indexOf(document.activeElement);
}

function restoreInputValues(element, inputValues) {
  var inputs = element.querySelectorAll('input, select, textarea');
  [].forEach.call(inputs, function (input, index) {
    var value = inputValues[index];

    if (typeof value !== 'undefined') {
      var tagName = input.tagName,
          type = input.type;

      if (tagName === 'INPUT' && (type === 'checkbox' || type === 'radio')) {
        input.checked = value;
      } else {
        input.value = value;
      }
    }
  });
}

function saveInputValues(element) {
  var inputs = element.querySelectorAll('input, select, textarea');
  return [].map.call(inputs, function (_ref2) {
    var checked = _ref2.checked,
        tagName = _ref2.tagName,
        type = _ref2.type,
        value = _ref2.value;

    if (tagName === 'INPUT' && (type === 'checkbox' || type === 'radio')) {
      return checked;
    }

    return value;
  });
}

var AdaptiveCardRenderer = function AdaptiveCardRenderer(_ref3) {
  var actionPerformedClassName = _ref3.actionPerformedClassName,
      adaptiveCard = _ref3.adaptiveCard,
      disabledFromProps = _ref3.disabled,
      tapAction = _ref3.tapAction;

  var _useStyleSet = useStyleSet(),
      _useStyleSet2 = (0, _slicedToArray2.default)(_useStyleSet, 1),
      adaptiveCardRendererStyleSet = _useStyleSet2[0].adaptiveCardRenderer;

  var _useAdaptiveCardsPack = (0, _useAdaptiveCardsPackage.default)(),
      _useAdaptiveCardsPack2 = (0, _slicedToArray2.default)(_useAdaptiveCardsPack, 1),
      _useAdaptiveCardsPack3 = _useAdaptiveCardsPack2[0],
      GlobalSettings = _useAdaptiveCardsPack3.GlobalSettings,
      HostConfig = _useAdaptiveCardsPack3.HostConfig;

  var _useState = (0, _react.useState)([]),
      _useState2 = (0, _slicedToArray2.default)(_useState, 2),
      actionsPerformed = _useState2[0],
      setActionsPerformed = _useState2[1];

  var _useAdaptiveCardsHost = (0, _useAdaptiveCardsHostConfig.default)(),
      _useAdaptiveCardsHost2 = (0, _slicedToArray2.default)(_useAdaptiveCardsHost, 1),
      adaptiveCardsHostConfig = _useAdaptiveCardsHost2[0];

  var _useDisabled = useDisabled(),
      _useDisabled2 = (0, _slicedToArray2.default)(_useDisabled, 1),
      disabledFromComposer = _useDisabled2[0];

  var _useState3 = (0, _react.useState)([]),
      _useState4 = (0, _slicedToArray2.default)(_useState3, 2),
      errors = _useState4[0],
      setErrors = _useState4[1];

  var _useState5 = (0, _react.useState)(0),
      _useState6 = (0, _slicedToArray2.default)(_useState5, 2),
      lastRender = _useState6[0],
      setLastRender = _useState6[1];

  var activeElementIndexRef = (0, _react.useRef)(-1);
  var adaptiveCardElementRef = (0, _react.useRef)();
  var contentRef = (0, _react.useRef)();
  var inputValuesRef = (0, _react.useRef)([]);
  var localize = useLocalizer();
  var performCardAction = usePerformCardAction();
  var renderMarkdownAsHTML = useRenderMarkdownAsHTML();
  var scrollToEnd = useScrollToEnd();
  var disabled = disabledFromComposer || disabledFromProps; // TODO: [P2] #3199 We should consider using `adaptiveCard.selectAction` instead.
  // The null check for "tapAction" is in "handleClickAndKeyPressForTapAction".

  var handleClickAndKeyPress = (0, _react.useCallback)(function (event) {
    var key = event.key,
        target = event.target,
        type = event.type; // Some items, e.g. tappable text, cannot be disabled thru DOM attributes

    var current = contentRef.current;
    var adaptiveCardRoot = current.querySelector('.ac-adaptiveCard[tabindex="0"]');

    if (!adaptiveCardRoot) {
      return console.warn('botframework-webchat: No Adaptive Card root container can be found, probably on an unsupported Adaptive Card version.');
    } // For "keypress" event, we only listen to ENTER and SPACEBAR key.


    if (type === 'keypress') {
      if (key !== 'Enter' && key !== ' ') {
        return;
      }

      event.preventDefault();
    } // We will call performCardAction if either:
    // 1. We are on the target, or
    // 2. The event-dispatching element is not interactive


    if (target !== adaptiveCardRoot) {
      var tabIndex = (0, _botframeworkWebchatComponent.getTabIndex)(target); // If the user is clicking on something that is already clickable, do not allow them to click the card.
      // E.g. a hero card can be tappable, and image and buttons inside the hero card can also be tappable.

      if (typeof tabIndex === 'number' && tabIndex >= 0) {
        return;
      }
    }

    performCardAction(tapAction);
    scrollToEnd();
  }, [contentRef, performCardAction, scrollToEnd, tapAction]); // Only listen to event if it is not disabled and have "tapAction" prop.

  var handleClickAndKeyPressForTapAction = !disabled && tapAction ? handleClickAndKeyPress : undefined;
  var addActionsPerformed = (0, _react.useCallback)(function (action) {
    return !~actionsPerformed.indexOf(action) && setActionsPerformed([].concat((0, _toConsumableArray2.default)(actionsPerformed), [action]));
  }, [actionsPerformed, setActionsPerformed]);
  var handleExecuteAction = (0, _react.useCallback)(function (action) {
    // Some items, e.g. tappable image, cannot be disabled thru DOM attributes
    if (disabled) {
      return;
    }

    addActionsPerformed(action);
    var actionTypeName = action.getJsonTypeName();

    if (actionTypeName === 'Action.OpenUrl') {
      performCardAction({
        type: 'openUrl',
        value: action.url
      });
    } else if (actionTypeName === 'Action.Submit') {
      if (typeof action.data !== 'undefined') {
        var actionData = action.data;

        if (actionData && actionData.__isBotFrameworkCardAction) {
          var cardAction = actionData.cardAction;
          var displayText = cardAction.displayText,
              text = cardAction.text,
              type = cardAction.type,
              value = cardAction.value;
          performCardAction({
            displayText: displayText,
            text: text,
            type: type,
            value: value
          });
        } else {
          performCardAction({
            type: typeof action.data === 'string' ? 'imBack' : 'postBack',
            value: action.data
          });
        }
      }

      scrollToEnd();
    } else {
      console.error("Web Chat: received unknown action from Adaptive Cards");
      console.error(action);
    }
  }, [addActionsPerformed, disabled, performCardAction, scrollToEnd]);
  (0, _react.useLayoutEffect)(function () {
    var current = contentRef.current;

    if (!current || !adaptiveCard) {
      activeElementIndexRef.current = -1;
      inputValuesRef.current = [];
    } // Currently, the only way to set the Markdown engine is to set it thru static member of AdaptiveCard class
    // TODO: [P3] Checks if we could make the "renderMarkdownAsHTML" per card
    //       This could be limitations from Adaptive Cards package (not supported as of 1.2.5)
    //       Because there could be timing difference between .parse and .render, we could be using wrong Markdown engine


    adaptiveCard.constructor.onProcessMarkdown = function (text, result) {
      if (renderMarkdownAsHTML) {
        result.outputHtml = renderMarkdownAsHTML(text);
        result.didProcess = true;
      }
    };

    if (adaptiveCardsHostConfig) {
      adaptiveCard.hostConfig = isPlainObject(adaptiveCardsHostConfig) ? new HostConfig(adaptiveCardsHostConfig) : adaptiveCardsHostConfig;
    } // For accessibility issue #1340, `tabindex="0"` must not be set for the root container if it is not interactive.


    GlobalSettings.setTabIndexAtCardRoot = !!tapAction;

    var _adaptiveCard$validat = adaptiveCard.validateProperties(),
        failures = _adaptiveCard$validat.failures;

    if (failures.length) {
      return setErrors(failures.reduce(function (items, _ref4) {
        var errors = _ref4.errors;
        return [].concat((0, _toConsumableArray2.default)(items), (0, _toConsumableArray2.default)(errors.map(function (_ref5) {
          var message = _ref5.message;
          return new Error(message);
        })));
      }, []));
    }

    var element;

    try {
      element = adaptiveCard.render();
    } catch (error) {
      return setErrors([error]);
    }

    if (!element) {
      return setErrors([new Error('Adaptive Card rendered as empty element')]);
    } // Clear errors on next render


    setErrors([]);
    restoreInputValues(element, inputValuesRef.current);
    current.appendChild(element);
    adaptiveCardElementRef.current = element; // Focus can only be restored after the DOM is attached.

    restoreActiveElementIndex(element, activeElementIndexRef.current);
    setLastRender(Date.now());
    return function () {
      activeElementIndexRef.current = saveActiveElementIndex(element);
      inputValuesRef.current = saveInputValues(element);
      current.removeChild(adaptiveCardElementRef.current);
      adaptiveCardElementRef.current = undefined;
    };
  }, [adaptiveCard, adaptiveCardsHostConfig, contentRef, GlobalSettings, HostConfig, renderMarkdownAsHTML, setErrors, tapAction]);
  (0, _react.useEffect)(function () {
    // Set onExecuteAction without causing unnecessary re-render.
    adaptiveCard.onExecuteAction = disabled ? undefined : handleExecuteAction;
  }, [adaptiveCard, disabled, handleExecuteAction]);
  (0, _react.useEffect)(function () {
    // If the Adaptive Card get re-rendered, re-disable elements as needed.
    if (disabled) {
      return disableInputElementsWithUndo(adaptiveCardElementRef.current);
    }
  }, [disabled, lastRender]);
  (0, _react.useEffect)(function () {
    // If the Adaptive Card changed, reset all actions performed.
    setActionsPerformed([]);
  }, [adaptiveCard]);
  (0, _react.useEffect)(function () {
    // Add developers to highlight actions when they have been clicked.
    if (!actionPerformedClassName) {
      return;
    }

    var undoStack = actionsPerformed.map(function (_ref6) {
      var renderedElement = _ref6.renderedElement;
      return renderedElement && adaptiveCardElementRef.current.contains(renderedElement) && addPersistentClassWithUndo(renderedElement, actionPerformedClassName);
    });
    return function () {
      return undoStack.forEach(function (undo) {
        return undo && undo();
      });
    };
  }, [actionsPerformed, actionPerformedClassName, lastRender]);
  return errors.length ? /*#__PURE__*/_react.default.createElement(ErrorBox, {
    message: localize('ADAPTIVE_CARD_ERROR_BOX_TITLE_RENDER')
  }, errors.map(function (_ref7, index) {
    var error = _ref7.error,
        message = _ref7.message;
    return (
      /*#__PURE__*/

      /* eslint-disable-next-line react/no-array-index-key */
      _react.default.createElement("pre", {
        key: index
      }, JSON.stringify({
        error: error,
        message: message
      }, null, 2))
    );
  })) : /*#__PURE__*/_react.default.createElement("div", {
    className: (0, _classnames.default)(adaptiveCardRendererStyleSet + '', 'webchat__adaptive-card-renderer'),
    onClick: handleClickAndKeyPressForTapAction,
    onKeyPress: handleClickAndKeyPressForTapAction,
    ref: contentRef
  });
};

AdaptiveCardRenderer.defaultProps = {
  actionPerformedClassName: '',
  disabled: undefined,
  tapAction: undefined
};
AdaptiveCardRenderer.propTypes = {
  actionPerformedClassName: _propTypes.default.string,
  adaptiveCard: _propTypes.default.any.isRequired,
  disabled: _propTypes.default.bool,
  tapAction: _propTypes.default.shape({
    type: _propTypes.default.string.isRequired,
    value: _propTypes.default.string
  })
};
var _default = AdaptiveCardRenderer;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9hZGFwdGl2ZUNhcmRzL0F0dGFjaG1lbnQvQWRhcHRpdmVDYXJkUmVuZGVyZXIuanMiXSwibmFtZXMiOlsiRXJyb3JCb3giLCJDb21wb25lbnRzIiwidXNlRGlzYWJsZWQiLCJob29rcyIsInVzZUxvY2FsaXplciIsInVzZVBlcmZvcm1DYXJkQWN0aW9uIiwidXNlUmVuZGVyTWFya2Rvd25Bc0hUTUwiLCJ1c2VTY3JvbGxUb0VuZCIsInVzZVN0eWxlU2V0IiwiYWRkQ2xhc3MiLCJlbGVtZW50IiwiY2xhc3NOYW1lIiwiY2xhc3NOYW1lcyIsIlNldCIsInNwbGl0IiwiaGFzIiwiYWRkIiwiQXJyYXkiLCJmcm9tIiwiam9pbiIsImFkZFBlcnNpc3RlbnRDbGFzc1dpdGhVbmRvIiwib2JzZXJ2ZXIiLCJNdXRhdGlvbk9ic2VydmVyIiwib2JzZXJ2ZSIsImF0dHJpYnV0ZXMiLCJhdHRyaWJ1dGVGaWx0ZXIiLCJkZWxldGUiLCJkaXNjb25uZWN0IiwiaXNQbGFpbk9iamVjdCIsIm9iaiIsIk9iamVjdCIsImdldFByb3RvdHlwZU9mIiwicHJvdG90eXBlIiwic2V0QXR0cmlidXRlV2l0aFVuZG8iLCJxdWFsaWZpZWROYW1lIiwibmV4dFZhbHVlIiwidmFsdWUiLCJnZXRBdHRyaWJ1dGUiLCJzZXRBdHRyaWJ1dGUiLCJyZW1vdmVBdHRyaWJ1dGUiLCJkaXNhYmxlZEhhbmRsZXIiLCJldmVudCIsInByZXZlbnREZWZhdWx0Iiwic3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uIiwic3RvcFByb3BhZ2F0aW9uIiwiYWRkRXZlbnRMaXN0ZW5lck9uY2VXaXRoVW5kbyIsIm5hbWUiLCJoYW5kbGVyIiwiZGV0YWNoIiwiZGV0YWNoaW5nSGFuZGxlciIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJhZGRFdmVudExpc3RlbmVyIiwib25jZSIsImRpc2FibGVFbGVtZW50V2l0aFVuZG8iLCJ1bmRvU3RhY2siLCJpc0FjdGl2ZSIsImRvY3VtZW50IiwiYWN0aXZlRWxlbWVudCIsInRhZyIsIm5vZGVOYW1lIiwidG9Mb3dlckNhc2UiLCJwdXNoIiwibWFwIiwiY2FsbCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJvcHRpb24iLCJmb3JFYWNoIiwidW5kbyIsImRpc2FibGVJbnB1dEVsZW1lbnRzV2l0aFVuZG8iLCJvYnNlcnZlU3VidHJlZSIsIm11dGF0aW9ucyIsImFkZGVkTm9kZXMiLCJhZGRlZE5vZGUiLCJjaGlsZExpc3QiLCJzdWJ0cmVlIiwiZ2V0Rm9jdXNhYmxlRWxlbWVudHMiLCJmaWx0ZXIiLCJ0YWJJbmRleCIsInJlc3RvcmVBY3RpdmVFbGVtZW50SW5kZXgiLCJhY3RpdmVFbGVtZW50SW5kZXgiLCJmb2N1c2FibGUiLCJmb2N1cyIsInNhdmVBY3RpdmVFbGVtZW50SW5kZXgiLCJpbmRleE9mIiwicmVzdG9yZUlucHV0VmFsdWVzIiwiaW5wdXRWYWx1ZXMiLCJpbnB1dHMiLCJpbnB1dCIsImluZGV4IiwidGFnTmFtZSIsInR5cGUiLCJjaGVja2VkIiwic2F2ZUlucHV0VmFsdWVzIiwiQWRhcHRpdmVDYXJkUmVuZGVyZXIiLCJhY3Rpb25QZXJmb3JtZWRDbGFzc05hbWUiLCJhZGFwdGl2ZUNhcmQiLCJkaXNhYmxlZEZyb21Qcm9wcyIsImRpc2FibGVkIiwidGFwQWN0aW9uIiwiYWRhcHRpdmVDYXJkUmVuZGVyZXJTdHlsZVNldCIsImFkYXB0aXZlQ2FyZFJlbmRlcmVyIiwiR2xvYmFsU2V0dGluZ3MiLCJIb3N0Q29uZmlnIiwiYWN0aW9uc1BlcmZvcm1lZCIsInNldEFjdGlvbnNQZXJmb3JtZWQiLCJhZGFwdGl2ZUNhcmRzSG9zdENvbmZpZyIsImRpc2FibGVkRnJvbUNvbXBvc2VyIiwiZXJyb3JzIiwic2V0RXJyb3JzIiwibGFzdFJlbmRlciIsInNldExhc3RSZW5kZXIiLCJhY3RpdmVFbGVtZW50SW5kZXhSZWYiLCJhZGFwdGl2ZUNhcmRFbGVtZW50UmVmIiwiY29udGVudFJlZiIsImlucHV0VmFsdWVzUmVmIiwibG9jYWxpemUiLCJwZXJmb3JtQ2FyZEFjdGlvbiIsInJlbmRlck1hcmtkb3duQXNIVE1MIiwic2Nyb2xsVG9FbmQiLCJoYW5kbGVDbGlja0FuZEtleVByZXNzIiwia2V5IiwidGFyZ2V0IiwiY3VycmVudCIsImFkYXB0aXZlQ2FyZFJvb3QiLCJxdWVyeVNlbGVjdG9yIiwiY29uc29sZSIsIndhcm4iLCJoYW5kbGVDbGlja0FuZEtleVByZXNzRm9yVGFwQWN0aW9uIiwidW5kZWZpbmVkIiwiYWRkQWN0aW9uc1BlcmZvcm1lZCIsImFjdGlvbiIsImhhbmRsZUV4ZWN1dGVBY3Rpb24iLCJhY3Rpb25UeXBlTmFtZSIsImdldEpzb25UeXBlTmFtZSIsInVybCIsImRhdGEiLCJhY3Rpb25EYXRhIiwiX19pc0JvdEZyYW1ld29ya0NhcmRBY3Rpb24iLCJjYXJkQWN0aW9uIiwiZGlzcGxheVRleHQiLCJ0ZXh0IiwiZXJyb3IiLCJjb25zdHJ1Y3RvciIsIm9uUHJvY2Vzc01hcmtkb3duIiwicmVzdWx0Iiwib3V0cHV0SHRtbCIsImRpZFByb2Nlc3MiLCJob3N0Q29uZmlnIiwic2V0VGFiSW5kZXhBdENhcmRSb290IiwidmFsaWRhdGVQcm9wZXJ0aWVzIiwiZmFpbHVyZXMiLCJsZW5ndGgiLCJyZWR1Y2UiLCJpdGVtcyIsIm1lc3NhZ2UiLCJFcnJvciIsInJlbmRlciIsImFwcGVuZENoaWxkIiwiRGF0ZSIsIm5vdyIsInJlbW92ZUNoaWxkIiwib25FeGVjdXRlQWN0aW9uIiwicmVuZGVyZWRFbGVtZW50IiwiY29udGFpbnMiLCJKU09OIiwic3RyaW5naWZ5IiwiZGVmYXVsdFByb3BzIiwicHJvcFR5cGVzIiwiUHJvcFR5cGVzIiwic3RyaW5nIiwiYW55IiwiaXNSZXF1aXJlZCIsImJvb2wiLCJzaGFwZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBQ0E7O0FBUkE7SUFVUUEsUSxHQUFhQyx3QyxDQUFiRCxRO0lBQ0FFLFcsR0FBMEdDLG1DLENBQTFHRCxXO0lBQWFFLFksR0FBNkZELG1DLENBQTdGQyxZO0lBQWNDLG9CLEdBQStFRixtQyxDQUEvRUUsb0I7SUFBc0JDLHVCLEdBQXlESCxtQyxDQUF6REcsdUI7SUFBeUJDLGMsR0FBZ0NKLG1DLENBQWhDSSxjO0lBQWdCQyxXLEdBQWdCTCxtQyxDQUFoQkssVzs7QUFFbEcsU0FBU0MsUUFBVCxDQUFrQkMsT0FBbEIsRUFBMkJDLFNBQTNCLEVBQXNDO0FBQ3BDLE1BQU1DLFVBQVUsR0FBRyxJQUFJQyxHQUFKLENBQVFILE9BQU8sQ0FBQ0MsU0FBUixDQUFrQkcsS0FBbEIsQ0FBd0IsR0FBeEIsQ0FBUixDQUFuQjs7QUFFQSxNQUFJLENBQUNGLFVBQVUsQ0FBQ0csR0FBWCxDQUFlSixTQUFmLENBQUwsRUFBZ0M7QUFDOUJDLElBQUFBLFVBQVUsQ0FBQ0ksR0FBWCxDQUFlTCxTQUFmO0FBRUFELElBQUFBLE9BQU8sQ0FBQ0MsU0FBUixHQUFvQk0sS0FBSyxDQUFDQyxJQUFOLENBQVdOLFVBQVgsRUFBdUJPLElBQXZCLENBQTRCLEdBQTVCLENBQXBCO0FBRUEsV0FBTyxJQUFQO0FBQ0Q7O0FBRUQsU0FBTyxLQUFQO0FBQ0Q7O0FBRUQsU0FBU0MsMEJBQVQsQ0FBb0NWLE9BQXBDLEVBQTZDQyxTQUE3QyxFQUF3RDtBQUN0RCxNQUFJRixRQUFRLENBQUNDLE9BQUQsRUFBVUMsU0FBVixDQUFaLEVBQWtDO0FBQ2hDO0FBQ0EsUUFBTVUsUUFBUSxHQUFHLElBQUlDLGdCQUFKLENBQXFCO0FBQUEsYUFBTWIsUUFBUSxDQUFDQyxPQUFELEVBQVVDLFNBQVYsQ0FBZDtBQUFBLEtBQXJCLENBQWpCO0FBRUFVLElBQUFBLFFBQVEsQ0FBQ0UsT0FBVCxDQUFpQmIsT0FBakIsRUFBMEI7QUFBRWMsTUFBQUEsVUFBVSxFQUFFLElBQWQ7QUFBb0JDLE1BQUFBLGVBQWUsRUFBRSxDQUFDLE9BQUQ7QUFBckMsS0FBMUI7QUFFQSxXQUFPLFlBQU07QUFDWCxVQUFNYixVQUFVLEdBQUcsSUFBSUMsR0FBSixDQUFRSCxPQUFPLENBQUNDLFNBQVIsQ0FBa0JHLEtBQWxCLENBQXdCLEdBQXhCLENBQVIsQ0FBbkI7QUFFQUYsTUFBQUEsVUFBVSxDQUFDYyxNQUFYLENBQWtCZixTQUFsQjtBQUVBRCxNQUFBQSxPQUFPLENBQUNDLFNBQVIsR0FBb0JNLEtBQUssQ0FBQ0MsSUFBTixDQUFXTixVQUFYLEVBQXVCTyxJQUF2QixDQUE0QixHQUE1QixDQUFwQjtBQUNBRSxNQUFBQSxRQUFRLENBQUNNLFVBQVQ7QUFDRCxLQVBEO0FBUUQ7QUFDRjs7QUFFRCxTQUFTQyxhQUFULENBQXVCQyxHQUF2QixFQUE0QjtBQUMxQixTQUFPQyxNQUFNLENBQUNDLGNBQVAsQ0FBc0JGLEdBQXRCLE1BQStCQyxNQUFNLENBQUNFLFNBQTdDO0FBQ0Q7O0FBRUQsU0FBU0Msb0JBQVQsQ0FBOEJ2QixPQUE5QixFQUF1Q3dCLGFBQXZDLEVBQXNEQyxTQUF0RCxFQUFpRTtBQUMvRCxNQUFNQyxLQUFLLEdBQUcxQixPQUFPLENBQUMyQixZQUFSLENBQXFCSCxhQUFyQixDQUFkOztBQUVBLE1BQUlFLEtBQUssS0FBS0QsU0FBZCxFQUF5QjtBQUN2QnpCLElBQUFBLE9BQU8sQ0FBQzRCLFlBQVIsQ0FBcUJKLGFBQXJCLEVBQW9DQyxTQUFwQztBQUVBLFdBQU87QUFBQSxhQUFPQyxLQUFLLEdBQUcxQixPQUFPLENBQUM0QixZQUFSLENBQXFCSixhQUFyQixFQUFvQ0UsS0FBcEMsQ0FBSCxHQUFnRDFCLE9BQU8sQ0FBQzZCLGVBQVIsQ0FBd0JMLGFBQXhCLENBQTVEO0FBQUEsS0FBUDtBQUNEO0FBQ0Y7O0FBRUQsSUFBTU0sZUFBZSxHQUFHLFNBQWxCQSxlQUFrQixDQUFBQyxLQUFLLEVBQUk7QUFDL0JBLEVBQUFBLEtBQUssQ0FBQ0MsY0FBTjtBQUNBRCxFQUFBQSxLQUFLLENBQUNFLHdCQUFOO0FBQ0FGLEVBQUFBLEtBQUssQ0FBQ0csZUFBTjtBQUNELENBSkQ7O0FBTUEsU0FBU0MsNEJBQVQsQ0FBc0NuQyxPQUF0QyxFQUErQ29DLElBQS9DLEVBQXFEQyxPQUFyRCxFQUE4RDtBQUM1RDtBQUNBLE1BQUlDLE1BQUo7O0FBQ0EsTUFBTUMsZ0JBQWdCLEdBQUcsU0FBbkJBLGdCQUFtQixDQUFBUixLQUFLLEVBQUk7QUFDaEMsUUFBSTtBQUNGTSxNQUFBQSxPQUFPLENBQUNOLEtBQUQsQ0FBUDtBQUNELEtBRkQsU0FFVTtBQUNSO0FBQ0FPLE1BQUFBLE1BQU07QUFDUDtBQUNGLEdBUEQ7O0FBU0FBLEVBQUFBLE1BQU0sR0FBRztBQUFBLFdBQU10QyxPQUFPLENBQUN3QyxtQkFBUixDQUE0QkosSUFBNUIsRUFBa0NHLGdCQUFsQyxDQUFOO0FBQUEsR0FBVDs7QUFFQXZDLEVBQUFBLE9BQU8sQ0FBQ3lDLGdCQUFSLENBQXlCTCxJQUF6QixFQUErQkcsZ0JBQS9CLEVBQWlEO0FBQUVHLElBQUFBLElBQUksRUFBRTtBQUFSLEdBQWpEO0FBRUEsU0FBT0osTUFBUDtBQUNEOztBQUVELFNBQVNLLHNCQUFULENBQWdDM0MsT0FBaEMsRUFBeUM7QUFDdkMsTUFBTTRDLFNBQVMsR0FBRyxFQUFsQjtBQUNBLE1BQU1DLFFBQVEsR0FBRzdDLE9BQU8sS0FBSzhDLFFBQVEsQ0FBQ0MsYUFBdEM7QUFDQSxNQUFNQyxHQUFHLEdBQUdoRCxPQUFPLENBQUNpRCxRQUFSLENBQWlCQyxXQUFqQixFQUFaO0FBRUE7O0FBQ0EsVUFBUUYsR0FBUjtBQUNFO0FBQ0EsU0FBSyxHQUFMO0FBQ0VKLE1BQUFBLFNBQVMsQ0FBQ08sSUFBVixDQUFlaEIsNEJBQTRCLENBQUNuQyxPQUFELEVBQVUsT0FBVixFQUFtQjhCLGVBQW5CLENBQTNDO0FBRUE7O0FBRUYsU0FBSyxRQUFMO0FBQ0EsU0FBSyxPQUFMO0FBQ0EsU0FBSyxRQUFMO0FBQ0EsU0FBSyxVQUFMO0FBQ0VjLE1BQUFBLFNBQVMsQ0FBQ08sSUFBVixDQUFlNUIsb0JBQW9CLENBQUN2QixPQUFELEVBQVUsZUFBVixFQUEyQixNQUEzQixDQUFuQzs7QUFFQSxVQUFJNkMsUUFBSixFQUFjO0FBQ1pELFFBQUFBLFNBQVMsQ0FBQ08sSUFBVixDQUNFaEIsNEJBQTRCLENBQUNuQyxPQUFELEVBQVUsTUFBVixFQUFrQjtBQUFBLGlCQUM1QzRDLFNBQVMsQ0FBQ08sSUFBVixDQUFlNUIsb0JBQW9CLENBQUN2QixPQUFELEVBQVUsVUFBVixFQUFzQixVQUF0QixDQUFuQyxDQUQ0QztBQUFBLFNBQWxCLENBRDlCO0FBS0QsT0FORCxNQU1PO0FBQ0w0QyxRQUFBQSxTQUFTLENBQUNPLElBQVYsQ0FBZTVCLG9CQUFvQixDQUFDdkIsT0FBRCxFQUFVLFVBQVYsRUFBc0IsVUFBdEIsQ0FBbkM7QUFDRDs7QUFFRCxVQUFJZ0QsR0FBRyxLQUFLLE9BQVIsSUFBbUJBLEdBQUcsS0FBSyxVQUEvQixFQUEyQztBQUN6Q0osUUFBQUEsU0FBUyxDQUFDTyxJQUFWLENBQWVoQiw0QkFBNEIsQ0FBQ25DLE9BQUQsRUFBVSxPQUFWLEVBQW1COEIsZUFBbkIsQ0FBM0M7QUFDQWMsUUFBQUEsU0FBUyxDQUFDTyxJQUFWLENBQWU1QixvQkFBb0IsQ0FBQ3ZCLE9BQUQsRUFBVSxVQUFWLEVBQXNCLFVBQXRCLENBQW5DO0FBQ0QsT0FIRCxNQUdPLElBQUlnRCxHQUFHLEtBQUssUUFBWixFQUFzQjtBQUMzQkosUUFBQUEsU0FBUyxDQUFDTyxJQUFWLE9BQUFQLFNBQVMsbUNBQ0osR0FBR1EsR0FBSCxDQUFPQyxJQUFQLENBQVlyRCxPQUFPLENBQUNzRCxnQkFBUixDQUF5QixRQUF6QixDQUFaLEVBQWdELFVBQUFDLE1BQU07QUFBQSxpQkFDdkRoQyxvQkFBb0IsQ0FBQ2dDLE1BQUQsRUFBUyxVQUFULEVBQXFCLFVBQXJCLENBRG1DO0FBQUEsU0FBdEQsQ0FESSxFQUFUO0FBS0Q7O0FBRUQ7QUFsQ0o7O0FBcUNBLFNBQU87QUFBQSxXQUFNWCxTQUFTLENBQUNZLE9BQVYsQ0FBa0IsVUFBQUMsSUFBSTtBQUFBLGFBQUlBLElBQUksSUFBSUEsSUFBSSxFQUFoQjtBQUFBLEtBQXRCLENBQU47QUFBQSxHQUFQO0FBQ0Q7O0FBRUQsU0FBU0MsNEJBQVQsQ0FBc0MxRCxPQUF0QyxFQUFzRTtBQUFBLE1BQXZCMkQsY0FBdUIsdUVBQU4sSUFBTTtBQUNwRSxNQUFNZixTQUFTLEdBQUcsR0FBR1EsR0FBSCxDQUFPQyxJQUFQLENBQVlyRCxPQUFPLENBQUNzRCxnQkFBUixDQUF5QixvQ0FBekIsQ0FBWixFQUE0RSxVQUFBdEQsT0FBTztBQUFBLFdBQ25HMkMsc0JBQXNCLENBQUMzQyxPQUFELENBRDZFO0FBQUEsR0FBbkYsQ0FBbEI7QUFJQSxNQUFNZ0QsR0FBRyxHQUFHaEQsT0FBTyxDQUFDaUQsUUFBUixDQUFpQkMsV0FBakIsRUFBWixDQUxvRSxDQU9wRTs7QUFDQSxHQUFDRixHQUFHLEtBQUssR0FBUixJQUFlQSxHQUFHLEtBQUssUUFBdkIsSUFBbUNBLEdBQUcsS0FBSyxPQUEzQyxJQUFzREEsR0FBRyxLQUFLLFFBQTlELElBQTBFQSxHQUFHLEtBQUssVUFBbkYsS0FDRUosU0FBUyxDQUFDTyxJQUFWLENBQWU1QixvQkFBb0IsQ0FBQ3ZCLE9BQUQsRUFBVSxVQUFWLEVBQXNCLElBQXRCLENBQW5DLENBREY7O0FBR0EsTUFBSTJELGNBQUosRUFBb0I7QUFDbEIsUUFBTWhELFFBQVEsR0FBRyxJQUFJQyxnQkFBSixDQUFxQixVQUFBZ0QsU0FBUztBQUFBLGFBQzdDQSxTQUFTLENBQUNKLE9BQVYsQ0FBa0I7QUFBQSxZQUFHSyxVQUFILFFBQUdBLFVBQUg7QUFBQSxlQUNoQmpCLFNBQVMsQ0FBQ08sSUFBVixPQUFBUCxTQUFTLG1DQUFTaUIsVUFBVSxDQUFDVCxHQUFYLENBQWUsVUFBQVUsU0FBUztBQUFBLGlCQUFJSiw0QkFBNEIsQ0FBQ0ksU0FBRCxFQUFZLEtBQVosQ0FBaEM7QUFBQSxTQUF4QixDQUFULEVBRE87QUFBQSxPQUFsQixDQUQ2QztBQUFBLEtBQTlCLENBQWpCO0FBTUFuRCxJQUFBQSxRQUFRLENBQUNFLE9BQVQsQ0FBaUJiLE9BQWpCLEVBQTBCO0FBQUUrRCxNQUFBQSxTQUFTLEVBQUUsSUFBYjtBQUFtQkMsTUFBQUEsT0FBTyxFQUFFO0FBQTVCLEtBQTFCO0FBRUFwQixJQUFBQSxTQUFTLENBQUNPLElBQVYsQ0FBZTtBQUFBLGFBQU14QyxRQUFRLENBQUNNLFVBQVQsRUFBTjtBQUFBLEtBQWY7QUFDRDs7QUFFRCxTQUFPO0FBQUEsV0FBTTJCLFNBQVMsQ0FBQ1ksT0FBVixDQUFrQixVQUFBQyxJQUFJO0FBQUEsYUFBSUEsSUFBSSxJQUFJQSxJQUFJLEVBQWhCO0FBQUEsS0FBdEIsQ0FBTjtBQUFBLEdBQVA7QUFDRDs7QUFFRCxTQUFTUSxvQkFBVCxDQUE4QmpFLE9BQTlCLEVBQXVDO0FBQ3JDLFNBQU8sR0FBR2tFLE1BQUgsQ0FBVWIsSUFBVixDQUNMckQsT0FBTyxDQUFDc0QsZ0JBQVIsQ0FDRSxDQUNFLEdBREYsRUFFRSxNQUZGLEVBR0UsUUFIRixFQUlFLE9BSkYsRUFLRSxRQUxGLEVBTUUsS0FORixFQU9FLE9BUEYsRUFRRSxTQVJGLEVBU0UsUUFURixFQVVFLFFBVkYsRUFXRSxVQVhGLEVBWUUsWUFaRixFQWFFN0MsSUFiRixDQWFPLElBYlAsQ0FERixDQURLLEVBaUJMLFVBQUFULE9BQU8sRUFBSTtBQUNULFFBQU1tRSxRQUFRLEdBQUcsK0NBQVluRSxPQUFaLENBQWpCO0FBRUEsV0FBTyxPQUFPbUUsUUFBUCxLQUFvQixRQUFwQixJQUFnQ0EsUUFBUSxJQUFJLENBQW5EO0FBQ0QsR0FyQkksQ0FBUDtBQXVCRDs7QUFFRCxTQUFTQyx5QkFBVCxDQUFtQ3BFLE9BQW5DLEVBQTRDcUUsa0JBQTVDLEVBQWdFO0FBQzlELE1BQU1DLFNBQVMsR0FBR0wsb0JBQW9CLENBQUNqRSxPQUFELENBQXBCLENBQThCcUUsa0JBQTlCLENBQWxCO0FBRUFDLEVBQUFBLFNBQVMsSUFBSUEsU0FBUyxDQUFDQyxLQUFWLEVBQWI7QUFDRDs7QUFFRCxTQUFTQyxzQkFBVCxDQUFnQ3hFLE9BQWhDLEVBQXlDO0FBQ3ZDLFNBQU9pRSxvQkFBb0IsQ0FBQ2pFLE9BQUQsQ0FBcEIsQ0FBOEJ5RSxPQUE5QixDQUFzQzNCLFFBQVEsQ0FBQ0MsYUFBL0MsQ0FBUDtBQUNEOztBQUVELFNBQVMyQixrQkFBVCxDQUE0QjFFLE9BQTVCLEVBQXFDMkUsV0FBckMsRUFBa0Q7QUFDaEQsTUFBTUMsTUFBTSxHQUFHNUUsT0FBTyxDQUFDc0QsZ0JBQVIsQ0FBeUIseUJBQXpCLENBQWY7QUFFQSxLQUFHRSxPQUFILENBQVdILElBQVgsQ0FBZ0J1QixNQUFoQixFQUF3QixVQUFDQyxLQUFELEVBQVFDLEtBQVIsRUFBa0I7QUFDeEMsUUFBTXBELEtBQUssR0FBR2lELFdBQVcsQ0FBQ0csS0FBRCxDQUF6Qjs7QUFFQSxRQUFJLE9BQU9wRCxLQUFQLEtBQWlCLFdBQXJCLEVBQWtDO0FBQUEsVUFDeEJxRCxPQUR3QixHQUNORixLQURNLENBQ3hCRSxPQUR3QjtBQUFBLFVBQ2ZDLElBRGUsR0FDTkgsS0FETSxDQUNmRyxJQURlOztBQUdoQyxVQUFJRCxPQUFPLEtBQUssT0FBWixLQUF3QkMsSUFBSSxLQUFLLFVBQVQsSUFBdUJBLElBQUksS0FBSyxPQUF4RCxDQUFKLEVBQXNFO0FBQ3BFSCxRQUFBQSxLQUFLLENBQUNJLE9BQU4sR0FBZ0J2RCxLQUFoQjtBQUNELE9BRkQsTUFFTztBQUNMbUQsUUFBQUEsS0FBSyxDQUFDbkQsS0FBTixHQUFjQSxLQUFkO0FBQ0Q7QUFDRjtBQUNGLEdBWkQ7QUFhRDs7QUFFRCxTQUFTd0QsZUFBVCxDQUF5QmxGLE9BQXpCLEVBQWtDO0FBQ2hDLE1BQU00RSxNQUFNLEdBQUc1RSxPQUFPLENBQUNzRCxnQkFBUixDQUF5Qix5QkFBekIsQ0FBZjtBQUVBLFNBQU8sR0FBR0YsR0FBSCxDQUFPQyxJQUFQLENBQVl1QixNQUFaLEVBQW9CLGlCQUF1QztBQUFBLFFBQXBDSyxPQUFvQyxTQUFwQ0EsT0FBb0M7QUFBQSxRQUEzQkYsT0FBMkIsU0FBM0JBLE9BQTJCO0FBQUEsUUFBbEJDLElBQWtCLFNBQWxCQSxJQUFrQjtBQUFBLFFBQVp0RCxLQUFZLFNBQVpBLEtBQVk7O0FBQ2hFLFFBQUlxRCxPQUFPLEtBQUssT0FBWixLQUF3QkMsSUFBSSxLQUFLLFVBQVQsSUFBdUJBLElBQUksS0FBSyxPQUF4RCxDQUFKLEVBQXNFO0FBQ3BFLGFBQU9DLE9BQVA7QUFDRDs7QUFFRCxXQUFPdkQsS0FBUDtBQUNELEdBTk0sQ0FBUDtBQU9EOztBQUVELElBQU15RCxvQkFBb0IsR0FBRyxTQUF2QkEsb0JBQXVCLFFBQXdGO0FBQUEsTUFBckZDLHdCQUFxRixTQUFyRkEsd0JBQXFGO0FBQUEsTUFBM0RDLFlBQTJELFNBQTNEQSxZQUEyRDtBQUFBLE1BQW5DQyxpQkFBbUMsU0FBN0NDLFFBQTZDO0FBQUEsTUFBaEJDLFNBQWdCLFNBQWhCQSxTQUFnQjs7QUFBQSxxQkFDbEQxRixXQUFXLEVBRHVDO0FBQUE7QUFBQSxNQUNwRjJGLDRCQURvRixvQkFDMUdDLG9CQUQwRzs7QUFBQSw4QkFFMUUsdUNBRjBFO0FBQUE7QUFBQTtBQUFBLE1BRTFHQyxjQUYwRywwQkFFMUdBLGNBRjBHO0FBQUEsTUFFMUZDLFVBRjBGLDBCQUUxRkEsVUFGMEY7O0FBQUEsa0JBR25FLHFCQUFTLEVBQVQsQ0FIbUU7QUFBQTtBQUFBLE1BRzVHQyxnQkFINEc7QUFBQSxNQUcxRkMsbUJBSDBGOztBQUFBLDhCQUlqRiwwQ0FKaUY7QUFBQTtBQUFBLE1BSTVHQyx1QkFKNEc7O0FBQUEscUJBS3BGdkcsV0FBVyxFQUx5RTtBQUFBO0FBQUEsTUFLNUd3RyxvQkFMNEc7O0FBQUEsbUJBTXZGLHFCQUFTLEVBQVQsQ0FOdUY7QUFBQTtBQUFBLE1BTTVHQyxNQU40RztBQUFBLE1BTXBHQyxTQU5vRzs7QUFBQSxtQkFPL0UscUJBQVMsQ0FBVCxDQVArRTtBQUFBO0FBQUEsTUFPNUdDLFVBUDRHO0FBQUEsTUFPaEdDLGFBUGdHOztBQVFuSCxNQUFNQyxxQkFBcUIsR0FBRyxtQkFBTyxDQUFDLENBQVIsQ0FBOUI7QUFDQSxNQUFNQyxzQkFBc0IsR0FBRyxvQkFBL0I7QUFDQSxNQUFNQyxVQUFVLEdBQUcsb0JBQW5CO0FBQ0EsTUFBTUMsY0FBYyxHQUFHLG1CQUFPLEVBQVAsQ0FBdkI7QUFDQSxNQUFNQyxRQUFRLEdBQUcvRyxZQUFZLEVBQTdCO0FBQ0EsTUFBTWdILGlCQUFpQixHQUFHL0csb0JBQW9CLEVBQTlDO0FBQ0EsTUFBTWdILG9CQUFvQixHQUFHL0csdUJBQXVCLEVBQXBEO0FBQ0EsTUFBTWdILFdBQVcsR0FBRy9HLGNBQWMsRUFBbEM7QUFFQSxNQUFNMEYsUUFBUSxHQUFHUyxvQkFBb0IsSUFBSVYsaUJBQXpDLENBakJtSCxDQW1Cbkg7QUFDQTs7QUFDQSxNQUFNdUIsc0JBQXNCLEdBQUcsd0JBQzdCLFVBQUE5RSxLQUFLLEVBQUk7QUFBQSxRQUNDK0UsR0FERCxHQUN1Qi9FLEtBRHZCLENBQ0MrRSxHQUREO0FBQUEsUUFDTUMsTUFETixHQUN1QmhGLEtBRHZCLENBQ01nRixNQUROO0FBQUEsUUFDYy9CLElBRGQsR0FDdUJqRCxLQUR2QixDQUNjaUQsSUFEZCxFQUdQOztBQUhPLFFBSUNnQyxPQUpELEdBSWFULFVBSmIsQ0FJQ1MsT0FKRDtBQUtQLFFBQU1DLGdCQUFnQixHQUFHRCxPQUFPLENBQUNFLGFBQVIsQ0FBc0IsZ0NBQXRCLENBQXpCOztBQUVBLFFBQUksQ0FBQ0QsZ0JBQUwsRUFBdUI7QUFDckIsYUFBT0UsT0FBTyxDQUFDQyxJQUFSLENBQ0wsdUhBREssQ0FBUDtBQUdELEtBWE0sQ0FhUDs7O0FBQ0EsUUFBSXBDLElBQUksS0FBSyxVQUFiLEVBQXlCO0FBQ3ZCLFVBQUk4QixHQUFHLEtBQUssT0FBUixJQUFtQkEsR0FBRyxLQUFLLEdBQS9CLEVBQW9DO0FBQ2xDO0FBQ0Q7O0FBRUQvRSxNQUFBQSxLQUFLLENBQUNDLGNBQU47QUFDRCxLQXBCTSxDQXNCUDtBQUNBO0FBQ0E7OztBQUNBLFFBQUkrRSxNQUFNLEtBQUtFLGdCQUFmLEVBQWlDO0FBQy9CLFVBQU05QyxRQUFRLEdBQUcsK0NBQVk0QyxNQUFaLENBQWpCLENBRCtCLENBRy9CO0FBQ0E7O0FBQ0EsVUFBSSxPQUFPNUMsUUFBUCxLQUFvQixRQUFwQixJQUFnQ0EsUUFBUSxJQUFJLENBQWhELEVBQW1EO0FBQ2pEO0FBQ0Q7QUFDRjs7QUFFRHVDLElBQUFBLGlCQUFpQixDQUFDbEIsU0FBRCxDQUFqQjtBQUNBb0IsSUFBQUEsV0FBVztBQUNaLEdBdEM0QixFQXVDN0IsQ0FBQ0wsVUFBRCxFQUFhRyxpQkFBYixFQUFnQ0UsV0FBaEMsRUFBNkNwQixTQUE3QyxDQXZDNkIsQ0FBL0IsQ0FyQm1ILENBK0RuSDs7QUFDQSxNQUFNNkIsa0NBQWtDLEdBQUcsQ0FBQzlCLFFBQUQsSUFBYUMsU0FBYixHQUF5QnFCLHNCQUF6QixHQUFrRFMsU0FBN0Y7QUFFQSxNQUFNQyxtQkFBbUIsR0FBRyx3QkFDMUIsVUFBQUMsTUFBTTtBQUFBLFdBQUksQ0FBQyxDQUFDM0IsZ0JBQWdCLENBQUNwQixPQUFqQixDQUF5QitDLE1BQXpCLENBQUYsSUFBc0MxQixtQkFBbUIsNENBQUtELGdCQUFMLElBQXVCMkIsTUFBdkIsR0FBN0Q7QUFBQSxHQURvQixFQUUxQixDQUFDM0IsZ0JBQUQsRUFBbUJDLG1CQUFuQixDQUYwQixDQUE1QjtBQUtBLE1BQU0yQixtQkFBbUIsR0FBRyx3QkFDMUIsVUFBQUQsTUFBTSxFQUFJO0FBQ1I7QUFDQSxRQUFJakMsUUFBSixFQUFjO0FBQ1o7QUFDRDs7QUFFRGdDLElBQUFBLG1CQUFtQixDQUFDQyxNQUFELENBQW5CO0FBRUEsUUFBTUUsY0FBYyxHQUFHRixNQUFNLENBQUNHLGVBQVAsRUFBdkI7O0FBRUEsUUFBSUQsY0FBYyxLQUFLLGdCQUF2QixFQUF5QztBQUN2Q2hCLE1BQUFBLGlCQUFpQixDQUFDO0FBQ2hCMUIsUUFBQUEsSUFBSSxFQUFFLFNBRFU7QUFFaEJ0RCxRQUFBQSxLQUFLLEVBQUU4RixNQUFNLENBQUNJO0FBRkUsT0FBRCxDQUFqQjtBQUlELEtBTEQsTUFLTyxJQUFJRixjQUFjLEtBQUssZUFBdkIsRUFBd0M7QUFDN0MsVUFBSSxPQUFPRixNQUFNLENBQUNLLElBQWQsS0FBdUIsV0FBM0IsRUFBd0M7QUFBQSxZQUN4QkMsVUFEd0IsR0FDVE4sTUFEUyxDQUM5QkssSUFEOEI7O0FBR3RDLFlBQUlDLFVBQVUsSUFBSUEsVUFBVSxDQUFDQywwQkFBN0IsRUFBeUQ7QUFBQSxjQUMvQ0MsVUFEK0MsR0FDaENGLFVBRGdDLENBQy9DRSxVQUQrQztBQUFBLGNBRS9DQyxXQUYrQyxHQUVaRCxVQUZZLENBRS9DQyxXQUYrQztBQUFBLGNBRWxDQyxJQUZrQyxHQUVaRixVQUZZLENBRWxDRSxJQUZrQztBQUFBLGNBRTVCbEQsSUFGNEIsR0FFWmdELFVBRlksQ0FFNUJoRCxJQUY0QjtBQUFBLGNBRXRCdEQsS0FGc0IsR0FFWnNHLFVBRlksQ0FFdEJ0RyxLQUZzQjtBQUl2RGdGLFVBQUFBLGlCQUFpQixDQUFDO0FBQUV1QixZQUFBQSxXQUFXLEVBQVhBLFdBQUY7QUFBZUMsWUFBQUEsSUFBSSxFQUFKQSxJQUFmO0FBQXFCbEQsWUFBQUEsSUFBSSxFQUFKQSxJQUFyQjtBQUEyQnRELFlBQUFBLEtBQUssRUFBTEE7QUFBM0IsV0FBRCxDQUFqQjtBQUNELFNBTEQsTUFLTztBQUNMZ0YsVUFBQUEsaUJBQWlCLENBQUM7QUFDaEIxQixZQUFBQSxJQUFJLEVBQUUsT0FBT3dDLE1BQU0sQ0FBQ0ssSUFBZCxLQUF1QixRQUF2QixHQUFrQyxRQUFsQyxHQUE2QyxVQURuQztBQUVoQm5HLFlBQUFBLEtBQUssRUFBRThGLE1BQU0sQ0FBQ0s7QUFGRSxXQUFELENBQWpCO0FBSUQ7QUFDRjs7QUFFRGpCLE1BQUFBLFdBQVc7QUFDWixLQWxCTSxNQWtCQTtBQUNMTyxNQUFBQSxPQUFPLENBQUNnQixLQUFSO0FBQ0FoQixNQUFBQSxPQUFPLENBQUNnQixLQUFSLENBQWNYLE1BQWQ7QUFDRDtBQUNGLEdBdEN5QixFQXVDMUIsQ0FBQ0QsbUJBQUQsRUFBc0JoQyxRQUF0QixFQUFnQ21CLGlCQUFoQyxFQUFtREUsV0FBbkQsQ0F2QzBCLENBQTVCO0FBMENBLDhCQUFnQixZQUFNO0FBQUEsUUFDWkksT0FEWSxHQUNBVCxVQURBLENBQ1pTLE9BRFk7O0FBR3BCLFFBQUksQ0FBQ0EsT0FBRCxJQUFZLENBQUMzQixZQUFqQixFQUErQjtBQUM3QmdCLE1BQUFBLHFCQUFxQixDQUFDVyxPQUF0QixHQUFnQyxDQUFDLENBQWpDO0FBQ0FSLE1BQUFBLGNBQWMsQ0FBQ1EsT0FBZixHQUF5QixFQUF6QjtBQUNELEtBTm1CLENBUXBCO0FBRUE7QUFDQTtBQUNBOzs7QUFFQTNCLElBQUFBLFlBQVksQ0FBQytDLFdBQWIsQ0FBeUJDLGlCQUF6QixHQUE2QyxVQUFDSCxJQUFELEVBQU9JLE1BQVAsRUFBa0I7QUFDN0QsVUFBSTNCLG9CQUFKLEVBQTBCO0FBQ3hCMkIsUUFBQUEsTUFBTSxDQUFDQyxVQUFQLEdBQW9CNUIsb0JBQW9CLENBQUN1QixJQUFELENBQXhDO0FBQ0FJLFFBQUFBLE1BQU0sQ0FBQ0UsVUFBUCxHQUFvQixJQUFwQjtBQUNEO0FBQ0YsS0FMRDs7QUFPQSxRQUFJekMsdUJBQUosRUFBNkI7QUFDM0JWLE1BQUFBLFlBQVksQ0FBQ29ELFVBQWIsR0FBMEJ2SCxhQUFhLENBQUM2RSx1QkFBRCxDQUFiLEdBQ3RCLElBQUlILFVBQUosQ0FBZUcsdUJBQWYsQ0FEc0IsR0FFdEJBLHVCQUZKO0FBR0QsS0F6Qm1CLENBMkJwQjs7O0FBQ0FKLElBQUFBLGNBQWMsQ0FBQytDLHFCQUFmLEdBQXVDLENBQUMsQ0FBQ2xELFNBQXpDOztBQTVCb0IsZ0NBOEJDSCxZQUFZLENBQUNzRCxrQkFBYixFQTlCRDtBQUFBLFFBOEJaQyxRQTlCWSx5QkE4QlpBLFFBOUJZOztBQWdDcEIsUUFBSUEsUUFBUSxDQUFDQyxNQUFiLEVBQXFCO0FBQ25CLGFBQU8zQyxTQUFTLENBQ2QwQyxRQUFRLENBQUNFLE1BQVQsQ0FBZ0IsVUFBQ0MsS0FBRDtBQUFBLFlBQVU5QyxNQUFWLFNBQVVBLE1BQVY7QUFBQSwwREFBMkI4QyxLQUEzQixvQ0FBcUM5QyxNQUFNLENBQUM3QyxHQUFQLENBQVc7QUFBQSxjQUFHNEYsT0FBSCxTQUFHQSxPQUFIO0FBQUEsaUJBQWlCLElBQUlDLEtBQUosQ0FBVUQsT0FBVixDQUFqQjtBQUFBLFNBQVgsQ0FBckM7QUFBQSxPQUFoQixFQUF1RyxFQUF2RyxDQURjLENBQWhCO0FBR0Q7O0FBRUQsUUFBSWhKLE9BQUo7O0FBRUEsUUFBSTtBQUNGQSxNQUFBQSxPQUFPLEdBQUdxRixZQUFZLENBQUM2RCxNQUFiLEVBQVY7QUFDRCxLQUZELENBRUUsT0FBT2YsS0FBUCxFQUFjO0FBQ2QsYUFBT2pDLFNBQVMsQ0FBQyxDQUFDaUMsS0FBRCxDQUFELENBQWhCO0FBQ0Q7O0FBRUQsUUFBSSxDQUFDbkksT0FBTCxFQUFjO0FBQ1osYUFBT2tHLFNBQVMsQ0FBQyxDQUFDLElBQUkrQyxLQUFKLENBQVUseUNBQVYsQ0FBRCxDQUFELENBQWhCO0FBQ0QsS0FoRG1CLENBa0RwQjs7O0FBQ0EvQyxJQUFBQSxTQUFTLENBQUMsRUFBRCxDQUFUO0FBRUF4QixJQUFBQSxrQkFBa0IsQ0FBQzFFLE9BQUQsRUFBVXdHLGNBQWMsQ0FBQ1EsT0FBekIsQ0FBbEI7QUFFQUEsSUFBQUEsT0FBTyxDQUFDbUMsV0FBUixDQUFvQm5KLE9BQXBCO0FBQ0FzRyxJQUFBQSxzQkFBc0IsQ0FBQ1UsT0FBdkIsR0FBaUNoSCxPQUFqQyxDQXhEb0IsQ0EwRHBCOztBQUNBb0UsSUFBQUEseUJBQXlCLENBQUNwRSxPQUFELEVBQVVxRyxxQkFBcUIsQ0FBQ1csT0FBaEMsQ0FBekI7QUFFQVosSUFBQUEsYUFBYSxDQUFDZ0QsSUFBSSxDQUFDQyxHQUFMLEVBQUQsQ0FBYjtBQUVBLFdBQU8sWUFBTTtBQUNYaEQsTUFBQUEscUJBQXFCLENBQUNXLE9BQXRCLEdBQWdDeEMsc0JBQXNCLENBQUN4RSxPQUFELENBQXREO0FBQ0F3RyxNQUFBQSxjQUFjLENBQUNRLE9BQWYsR0FBeUI5QixlQUFlLENBQUNsRixPQUFELENBQXhDO0FBRUFnSCxNQUFBQSxPQUFPLENBQUNzQyxXQUFSLENBQW9CaEQsc0JBQXNCLENBQUNVLE9BQTNDO0FBRUFWLE1BQUFBLHNCQUFzQixDQUFDVSxPQUF2QixHQUFpQ00sU0FBakM7QUFDRCxLQVBEO0FBUUQsR0F2RUQsRUF1RUcsQ0FDRGpDLFlBREMsRUFFRFUsdUJBRkMsRUFHRFEsVUFIQyxFQUlEWixjQUpDLEVBS0RDLFVBTEMsRUFNRGUsb0JBTkMsRUFPRFQsU0FQQyxFQVFEVixTQVJDLENBdkVIO0FBa0ZBLHdCQUFVLFlBQU07QUFDZDtBQUNBSCxJQUFBQSxZQUFZLENBQUNrRSxlQUFiLEdBQStCaEUsUUFBUSxHQUFHK0IsU0FBSCxHQUFlRyxtQkFBdEQ7QUFDRCxHQUhELEVBR0csQ0FBQ3BDLFlBQUQsRUFBZUUsUUFBZixFQUF5QmtDLG1CQUF6QixDQUhIO0FBS0Esd0JBQVUsWUFBTTtBQUNkO0FBQ0EsUUFBSWxDLFFBQUosRUFBYztBQUNaLGFBQU83Qiw0QkFBNEIsQ0FBQzRDLHNCQUFzQixDQUFDVSxPQUF4QixDQUFuQztBQUNEO0FBQ0YsR0FMRCxFQUtHLENBQUN6QixRQUFELEVBQVdZLFVBQVgsQ0FMSDtBQU9BLHdCQUFVLFlBQU07QUFDZDtBQUNBTCxJQUFBQSxtQkFBbUIsQ0FBQyxFQUFELENBQW5CO0FBQ0QsR0FIRCxFQUdHLENBQUNULFlBQUQsQ0FISDtBQUtBLHdCQUFVLFlBQU07QUFDZDtBQUNBLFFBQUksQ0FBQ0Qsd0JBQUwsRUFBK0I7QUFDN0I7QUFDRDs7QUFFRCxRQUFNeEMsU0FBUyxHQUFHaUQsZ0JBQWdCLENBQUN6QyxHQUFqQixDQUNoQjtBQUFBLFVBQUdvRyxlQUFILFNBQUdBLGVBQUg7QUFBQSxhQUNFQSxlQUFlLElBQ2ZsRCxzQkFBc0IsQ0FBQ1UsT0FBdkIsQ0FBK0J5QyxRQUEvQixDQUF3Q0QsZUFBeEMsQ0FEQSxJQUVBOUksMEJBQTBCLENBQUM4SSxlQUFELEVBQWtCcEUsd0JBQWxCLENBSDVCO0FBQUEsS0FEZ0IsQ0FBbEI7QUFPQSxXQUFPO0FBQUEsYUFBTXhDLFNBQVMsQ0FBQ1ksT0FBVixDQUFrQixVQUFBQyxJQUFJO0FBQUEsZUFBSUEsSUFBSSxJQUFJQSxJQUFJLEVBQWhCO0FBQUEsT0FBdEIsQ0FBTjtBQUFBLEtBQVA7QUFDRCxHQWRELEVBY0csQ0FBQ29DLGdCQUFELEVBQW1CVCx3QkFBbkIsRUFBNkNlLFVBQTdDLENBZEg7QUFnQkEsU0FBT0YsTUFBTSxDQUFDNEMsTUFBUCxnQkFDTCw2QkFBQyxRQUFEO0FBQVUsSUFBQSxPQUFPLEVBQUVwQyxRQUFRLENBQUMsc0NBQUQ7QUFBM0IsS0FDR1IsTUFBTSxDQUFDN0MsR0FBUCxDQUFXLGlCQUFxQjBCLEtBQXJCO0FBQUEsUUFBR3FELEtBQUgsU0FBR0EsS0FBSDtBQUFBLFFBQVVhLE9BQVYsU0FBVUEsT0FBVjtBQUFBO0FBQUE7O0FBQ1Y7QUFDQTtBQUFLLFFBQUEsR0FBRyxFQUFFbEU7QUFBVixTQUFrQjRFLElBQUksQ0FBQ0MsU0FBTCxDQUFlO0FBQUV4QixRQUFBQSxLQUFLLEVBQUxBLEtBQUY7QUFBU2EsUUFBQUEsT0FBTyxFQUFQQTtBQUFULE9BQWYsRUFBbUMsSUFBbkMsRUFBeUMsQ0FBekMsQ0FBbEI7QUFGVTtBQUFBLEdBQVgsQ0FESCxDQURLLGdCQVFMO0FBQ0UsSUFBQSxTQUFTLEVBQUUseUJBQVd2RCw0QkFBNEIsR0FBRyxFQUExQyxFQUE4QyxpQ0FBOUMsQ0FEYjtBQUVFLElBQUEsT0FBTyxFQUFFNEIsa0NBRlg7QUFHRSxJQUFBLFVBQVUsRUFBRUEsa0NBSGQ7QUFJRSxJQUFBLEdBQUcsRUFBRWQ7QUFKUCxJQVJGO0FBZUQsQ0FuUEQ7O0FBcVBBcEIsb0JBQW9CLENBQUN5RSxZQUFyQixHQUFvQztBQUNsQ3hFLEVBQUFBLHdCQUF3QixFQUFFLEVBRFE7QUFFbENHLEVBQUFBLFFBQVEsRUFBRStCLFNBRndCO0FBR2xDOUIsRUFBQUEsU0FBUyxFQUFFOEI7QUFIdUIsQ0FBcEM7QUFNQW5DLG9CQUFvQixDQUFDMEUsU0FBckIsR0FBaUM7QUFDL0J6RSxFQUFBQSx3QkFBd0IsRUFBRTBFLG1CQUFVQyxNQURMO0FBRS9CMUUsRUFBQUEsWUFBWSxFQUFFeUUsbUJBQVVFLEdBQVYsQ0FBY0MsVUFGRztBQUcvQjFFLEVBQUFBLFFBQVEsRUFBRXVFLG1CQUFVSSxJQUhXO0FBSS9CMUUsRUFBQUEsU0FBUyxFQUFFc0UsbUJBQVVLLEtBQVYsQ0FBZ0I7QUFDekJuRixJQUFBQSxJQUFJLEVBQUU4RSxtQkFBVUMsTUFBVixDQUFpQkUsVUFERTtBQUV6QnZJLElBQUFBLEtBQUssRUFBRW9JLG1CQUFVQztBQUZRLEdBQWhCO0FBSm9CLENBQWpDO2VBVWU1RSxvQiIsInNvdXJjZVJvb3QiOiJidW5kbGU6Ly8vIiwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50IG5vLW1hZ2ljLW51bWJlcnM6IFtcImVycm9yXCIsIHsgXCJpZ25vcmVcIjogWy0xLCAwLCAyXSB9XSAqL1xuXG5pbXBvcnQgeyBDb21wb25lbnRzLCBnZXRUYWJJbmRleCwgaG9va3MgfSBmcm9tICdib3RmcmFtZXdvcmstd2ViY2hhdC1jb21wb25lbnQnO1xuaW1wb3J0IGNsYXNzTmFtZXMgZnJvbSAnY2xhc3NuYW1lcyc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IFJlYWN0LCB7IHVzZUNhbGxiYWNrLCB1c2VFZmZlY3QsIHVzZUxheW91dEVmZmVjdCwgdXNlUmVmLCB1c2VTdGF0ZSB9IGZyb20gJ3JlYWN0JztcblxuaW1wb3J0IHVzZUFkYXB0aXZlQ2FyZHNIb3N0Q29uZmlnIGZyb20gJy4uL2hvb2tzL3VzZUFkYXB0aXZlQ2FyZHNIb3N0Q29uZmlnJztcbmltcG9ydCB1c2VBZGFwdGl2ZUNhcmRzUGFja2FnZSBmcm9tICcuLi9ob29rcy91c2VBZGFwdGl2ZUNhcmRzUGFja2FnZSc7XG5cbmNvbnN0IHsgRXJyb3JCb3ggfSA9IENvbXBvbmVudHM7XG5jb25zdCB7IHVzZURpc2FibGVkLCB1c2VMb2NhbGl6ZXIsIHVzZVBlcmZvcm1DYXJkQWN0aW9uLCB1c2VSZW5kZXJNYXJrZG93bkFzSFRNTCwgdXNlU2Nyb2xsVG9FbmQsIHVzZVN0eWxlU2V0IH0gPSBob29rcztcblxuZnVuY3Rpb24gYWRkQ2xhc3MoZWxlbWVudCwgY2xhc3NOYW1lKSB7XG4gIGNvbnN0IGNsYXNzTmFtZXMgPSBuZXcgU2V0KGVsZW1lbnQuY2xhc3NOYW1lLnNwbGl0KCcgJykpO1xuXG4gIGlmICghY2xhc3NOYW1lcy5oYXMoY2xhc3NOYW1lKSkge1xuICAgIGNsYXNzTmFtZXMuYWRkKGNsYXNzTmFtZSk7XG5cbiAgICBlbGVtZW50LmNsYXNzTmFtZSA9IEFycmF5LmZyb20oY2xhc3NOYW1lcykuam9pbignICcpO1xuXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICByZXR1cm4gZmFsc2U7XG59XG5cbmZ1bmN0aW9uIGFkZFBlcnNpc3RlbnRDbGFzc1dpdGhVbmRvKGVsZW1lbnQsIGNsYXNzTmFtZSkge1xuICBpZiAoYWRkQ2xhc3MoZWxlbWVudCwgY2xhc3NOYW1lKSkge1xuICAgIC8vIEFmdGVyIHdlIGFkZCB0aGUgY2xhc3MsIGtlZXAgb2JzZXJ2aW5nIHRoZSBlbGVtZW50IHRvIG1ha2Ugc3VyZSB0aGUgY2xhc3MgaXMgbm90IHJlbW92ZWQuXG4gICAgY29uc3Qgb2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcigoKSA9PiBhZGRDbGFzcyhlbGVtZW50LCBjbGFzc05hbWUpKTtcblxuICAgIG9ic2VydmVyLm9ic2VydmUoZWxlbWVudCwgeyBhdHRyaWJ1dGVzOiB0cnVlLCBhdHRyaWJ1dGVGaWx0ZXI6IFsnY2xhc3MnXSB9KTtcblxuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBjb25zdCBjbGFzc05hbWVzID0gbmV3IFNldChlbGVtZW50LmNsYXNzTmFtZS5zcGxpdCgnICcpKTtcblxuICAgICAgY2xhc3NOYW1lcy5kZWxldGUoY2xhc3NOYW1lKTtcblxuICAgICAgZWxlbWVudC5jbGFzc05hbWUgPSBBcnJheS5mcm9tKGNsYXNzTmFtZXMpLmpvaW4oJyAnKTtcbiAgICAgIG9ic2VydmVyLmRpc2Nvbm5lY3QoKTtcbiAgICB9O1xuICB9XG59XG5cbmZ1bmN0aW9uIGlzUGxhaW5PYmplY3Qob2JqKSB7XG4gIHJldHVybiBPYmplY3QuZ2V0UHJvdG90eXBlT2Yob2JqKSA9PT0gT2JqZWN0LnByb3RvdHlwZTtcbn1cblxuZnVuY3Rpb24gc2V0QXR0cmlidXRlV2l0aFVuZG8oZWxlbWVudCwgcXVhbGlmaWVkTmFtZSwgbmV4dFZhbHVlKSB7XG4gIGNvbnN0IHZhbHVlID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUocXVhbGlmaWVkTmFtZSk7XG5cbiAgaWYgKHZhbHVlICE9PSBuZXh0VmFsdWUpIHtcbiAgICBlbGVtZW50LnNldEF0dHJpYnV0ZShxdWFsaWZpZWROYW1lLCBuZXh0VmFsdWUpO1xuXG4gICAgcmV0dXJuICgpID0+ICh2YWx1ZSA/IGVsZW1lbnQuc2V0QXR0cmlidXRlKHF1YWxpZmllZE5hbWUsIHZhbHVlKSA6IGVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKHF1YWxpZmllZE5hbWUpKTtcbiAgfVxufVxuXG5jb25zdCBkaXNhYmxlZEhhbmRsZXIgPSBldmVudCA9PiB7XG4gIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gIGV2ZW50LnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbn07XG5cbmZ1bmN0aW9uIGFkZEV2ZW50TGlzdGVuZXJPbmNlV2l0aFVuZG8oZWxlbWVudCwgbmFtZSwgaGFuZGxlcikge1xuICAvKiBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcHJlZmVyLWNvbnN0ICovXG4gIGxldCBkZXRhY2g7XG4gIGNvbnN0IGRldGFjaGluZ0hhbmRsZXIgPSBldmVudCA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGhhbmRsZXIoZXZlbnQpO1xuICAgIH0gZmluYWxseSB7XG4gICAgICAvLyBJRTExIGRvZXMgbm90IHN1cHBvcnQgeyBvbmNlOiB0cnVlIH0sIHNvIHdlIG5lZWQgdG8gZGV0YWNoIG1hbnVhbGx5LlxuICAgICAgZGV0YWNoKCk7XG4gICAgfVxuICB9O1xuXG4gIGRldGFjaCA9ICgpID0+IGVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihuYW1lLCBkZXRhY2hpbmdIYW5kbGVyKTtcblxuICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIobmFtZSwgZGV0YWNoaW5nSGFuZGxlciwgeyBvbmNlOiB0cnVlIH0pO1xuXG4gIHJldHVybiBkZXRhY2g7XG59XG5cbmZ1bmN0aW9uIGRpc2FibGVFbGVtZW50V2l0aFVuZG8oZWxlbWVudCkge1xuICBjb25zdCB1bmRvU3RhY2sgPSBbXTtcbiAgY29uc3QgaXNBY3RpdmUgPSBlbGVtZW50ID09PSBkb2N1bWVudC5hY3RpdmVFbGVtZW50O1xuICBjb25zdCB0YWcgPSBlbGVtZW50Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7XG5cbiAgLyogZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGRlZmF1bHQtY2FzZSAqL1xuICBzd2l0Y2ggKHRhZykge1xuICAgIC8vIFNob3VsZCB3ZSBub3QgZGlzYWJsZSA8YT4/IFdpbGwgc29tZSBvZiB0aGUgPGE+IGFyZSBzdHlsZWQgYXMgYnV0dG9uP1xuICAgIGNhc2UgJ2EnOlxuICAgICAgdW5kb1N0YWNrLnB1c2goYWRkRXZlbnRMaXN0ZW5lck9uY2VXaXRoVW5kbyhlbGVtZW50LCAnY2xpY2snLCBkaXNhYmxlZEhhbmRsZXIpKTtcblxuICAgICAgYnJlYWs7XG5cbiAgICBjYXNlICdidXR0b24nOlxuICAgIGNhc2UgJ2lucHV0JzpcbiAgICBjYXNlICdzZWxlY3QnOlxuICAgIGNhc2UgJ3RleHRhcmVhJzpcbiAgICAgIHVuZG9TdGFjay5wdXNoKHNldEF0dHJpYnV0ZVdpdGhVbmRvKGVsZW1lbnQsICdhcmlhLWRpc2FibGVkJywgJ3RydWUnKSk7XG5cbiAgICAgIGlmIChpc0FjdGl2ZSkge1xuICAgICAgICB1bmRvU3RhY2sucHVzaChcbiAgICAgICAgICBhZGRFdmVudExpc3RlbmVyT25jZVdpdGhVbmRvKGVsZW1lbnQsICdibHVyJywgKCkgPT5cbiAgICAgICAgICAgIHVuZG9TdGFjay5wdXNoKHNldEF0dHJpYnV0ZVdpdGhVbmRvKGVsZW1lbnQsICdkaXNhYmxlZCcsICdkaXNhYmxlZCcpKVxuICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHVuZG9TdGFjay5wdXNoKHNldEF0dHJpYnV0ZVdpdGhVbmRvKGVsZW1lbnQsICdkaXNhYmxlZCcsICdkaXNhYmxlZCcpKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRhZyA9PT0gJ2lucHV0JyB8fCB0YWcgPT09ICd0ZXh0YXJlYScpIHtcbiAgICAgICAgdW5kb1N0YWNrLnB1c2goYWRkRXZlbnRMaXN0ZW5lck9uY2VXaXRoVW5kbyhlbGVtZW50LCAnY2xpY2snLCBkaXNhYmxlZEhhbmRsZXIpKTtcbiAgICAgICAgdW5kb1N0YWNrLnB1c2goc2V0QXR0cmlidXRlV2l0aFVuZG8oZWxlbWVudCwgJ3JlYWRvbmx5JywgJ3JlYWRvbmx5JykpO1xuICAgICAgfSBlbHNlIGlmICh0YWcgPT09ICdzZWxlY3QnKSB7XG4gICAgICAgIHVuZG9TdGFjay5wdXNoKFxuICAgICAgICAgIC4uLltdLm1hcC5jYWxsKGVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCgnb3B0aW9uJyksIG9wdGlvbiA9PlxuICAgICAgICAgICAgc2V0QXR0cmlidXRlV2l0aFVuZG8ob3B0aW9uLCAnZGlzYWJsZWQnLCAnZGlzYWJsZWQnKVxuICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgYnJlYWs7XG4gIH1cblxuICByZXR1cm4gKCkgPT4gdW5kb1N0YWNrLmZvckVhY2godW5kbyA9PiB1bmRvICYmIHVuZG8oKSk7XG59XG5cbmZ1bmN0aW9uIGRpc2FibGVJbnB1dEVsZW1lbnRzV2l0aFVuZG8oZWxlbWVudCwgb2JzZXJ2ZVN1YnRyZWUgPSB0cnVlKSB7XG4gIGNvbnN0IHVuZG9TdGFjayA9IFtdLm1hcC5jYWxsKGVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCgnYSwgYnV0dG9uLCBpbnB1dCwgc2VsZWN0LCB0ZXh0YXJlYScpLCBlbGVtZW50ID0+XG4gICAgZGlzYWJsZUVsZW1lbnRXaXRoVW5kbyhlbGVtZW50KVxuICApO1xuXG4gIGNvbnN0IHRhZyA9IGVsZW1lbnQubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtcblxuICAvLyBPbmx5IHNldCB0YWJpbmRleD1cIi0xXCIgb24gZm9jdXNhYmxlIGVsZW1lbnQuIE90aGVyd2lzZSwgd2Ugd2lsbCBtYWtlIDxkaXY+IGZvY3VzYWJsZSBieSBtb3VzZS5cbiAgKHRhZyA9PT0gJ2EnIHx8IHRhZyA9PT0gJ2J1dHRvbicgfHwgdGFnID09PSAnaW5wdXQnIHx8IHRhZyA9PT0gJ3NlbGVjdCcgfHwgdGFnID09PSAndGV4dGFyZWEnKSAmJlxuICAgIHVuZG9TdGFjay5wdXNoKHNldEF0dHJpYnV0ZVdpdGhVbmRvKGVsZW1lbnQsICd0YWJpbmRleCcsICctMScpKTtcblxuICBpZiAob2JzZXJ2ZVN1YnRyZWUpIHtcbiAgICBjb25zdCBvYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKG11dGF0aW9ucyA9PlxuICAgICAgbXV0YXRpb25zLmZvckVhY2goKHsgYWRkZWROb2RlcyB9KSA9PlxuICAgICAgICB1bmRvU3RhY2sucHVzaCguLi5hZGRlZE5vZGVzLm1hcChhZGRlZE5vZGUgPT4gZGlzYWJsZUlucHV0RWxlbWVudHNXaXRoVW5kbyhhZGRlZE5vZGUsIGZhbHNlKSkpXG4gICAgICApXG4gICAgKTtcblxuICAgIG9ic2VydmVyLm9ic2VydmUoZWxlbWVudCwgeyBjaGlsZExpc3Q6IHRydWUsIHN1YnRyZWU6IHRydWUgfSk7XG5cbiAgICB1bmRvU3RhY2sucHVzaCgoKSA9PiBvYnNlcnZlci5kaXNjb25uZWN0KCkpO1xuICB9XG5cbiAgcmV0dXJuICgpID0+IHVuZG9TdGFjay5mb3JFYWNoKHVuZG8gPT4gdW5kbyAmJiB1bmRvKCkpO1xufVxuXG5mdW5jdGlvbiBnZXRGb2N1c2FibGVFbGVtZW50cyhlbGVtZW50KSB7XG4gIHJldHVybiBbXS5maWx0ZXIuY2FsbChcbiAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXG4gICAgICBbXG4gICAgICAgICdhJyxcbiAgICAgICAgJ2JvZHknLFxuICAgICAgICAnYnV0dG9uJyxcbiAgICAgICAgJ2ZyYW1lJyxcbiAgICAgICAgJ2lmcmFtZScsXG4gICAgICAgICdpbWcnLFxuICAgICAgICAnaW5wdXQnLFxuICAgICAgICAnaXNpbmRleCcsXG4gICAgICAgICdvYmplY3QnLFxuICAgICAgICAnc2VsZWN0JyxcbiAgICAgICAgJ3RleHRhcmVhJyxcbiAgICAgICAgJ1t0YWJpbmRleF0nXG4gICAgICBdLmpvaW4oJywgJylcbiAgICApLFxuICAgIGVsZW1lbnQgPT4ge1xuICAgICAgY29uc3QgdGFiSW5kZXggPSBnZXRUYWJJbmRleChlbGVtZW50KTtcblxuICAgICAgcmV0dXJuIHR5cGVvZiB0YWJJbmRleCA9PT0gJ251bWJlcicgJiYgdGFiSW5kZXggPj0gMDtcbiAgICB9XG4gICk7XG59XG5cbmZ1bmN0aW9uIHJlc3RvcmVBY3RpdmVFbGVtZW50SW5kZXgoZWxlbWVudCwgYWN0aXZlRWxlbWVudEluZGV4KSB7XG4gIGNvbnN0IGZvY3VzYWJsZSA9IGdldEZvY3VzYWJsZUVsZW1lbnRzKGVsZW1lbnQpW2FjdGl2ZUVsZW1lbnRJbmRleF07XG5cbiAgZm9jdXNhYmxlICYmIGZvY3VzYWJsZS5mb2N1cygpO1xufVxuXG5mdW5jdGlvbiBzYXZlQWN0aXZlRWxlbWVudEluZGV4KGVsZW1lbnQpIHtcbiAgcmV0dXJuIGdldEZvY3VzYWJsZUVsZW1lbnRzKGVsZW1lbnQpLmluZGV4T2YoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCk7XG59XG5cbmZ1bmN0aW9uIHJlc3RvcmVJbnB1dFZhbHVlcyhlbGVtZW50LCBpbnB1dFZhbHVlcykge1xuICBjb25zdCBpbnB1dHMgPSBlbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0LCBzZWxlY3QsIHRleHRhcmVhJyk7XG5cbiAgW10uZm9yRWFjaC5jYWxsKGlucHV0cywgKGlucHV0LCBpbmRleCkgPT4ge1xuICAgIGNvbnN0IHZhbHVlID0gaW5wdXRWYWx1ZXNbaW5kZXhdO1xuXG4gICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIGNvbnN0IHsgdGFnTmFtZSwgdHlwZSB9ID0gaW5wdXQ7XG5cbiAgICAgIGlmICh0YWdOYW1lID09PSAnSU5QVVQnICYmICh0eXBlID09PSAnY2hlY2tib3gnIHx8IHR5cGUgPT09ICdyYWRpbycpKSB7XG4gICAgICAgIGlucHV0LmNoZWNrZWQgPSB2YWx1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlucHV0LnZhbHVlID0gdmFsdWU7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn1cblxuZnVuY3Rpb24gc2F2ZUlucHV0VmFsdWVzKGVsZW1lbnQpIHtcbiAgY29uc3QgaW5wdXRzID0gZWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dCwgc2VsZWN0LCB0ZXh0YXJlYScpO1xuXG4gIHJldHVybiBbXS5tYXAuY2FsbChpbnB1dHMsICh7IGNoZWNrZWQsIHRhZ05hbWUsIHR5cGUsIHZhbHVlIH0pID0+IHtcbiAgICBpZiAodGFnTmFtZSA9PT0gJ0lOUFVUJyAmJiAodHlwZSA9PT0gJ2NoZWNrYm94JyB8fCB0eXBlID09PSAncmFkaW8nKSkge1xuICAgICAgcmV0dXJuIGNoZWNrZWQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIHZhbHVlO1xuICB9KTtcbn1cblxuY29uc3QgQWRhcHRpdmVDYXJkUmVuZGVyZXIgPSAoeyBhY3Rpb25QZXJmb3JtZWRDbGFzc05hbWUsIGFkYXB0aXZlQ2FyZCwgZGlzYWJsZWQ6IGRpc2FibGVkRnJvbVByb3BzLCB0YXBBY3Rpb24gfSkgPT4ge1xuICBjb25zdCBbeyBhZGFwdGl2ZUNhcmRSZW5kZXJlcjogYWRhcHRpdmVDYXJkUmVuZGVyZXJTdHlsZVNldCB9XSA9IHVzZVN0eWxlU2V0KCk7XG4gIGNvbnN0IFt7IEdsb2JhbFNldHRpbmdzLCBIb3N0Q29uZmlnIH1dID0gdXNlQWRhcHRpdmVDYXJkc1BhY2thZ2UoKTtcbiAgY29uc3QgW2FjdGlvbnNQZXJmb3JtZWQsIHNldEFjdGlvbnNQZXJmb3JtZWRdID0gdXNlU3RhdGUoW10pO1xuICBjb25zdCBbYWRhcHRpdmVDYXJkc0hvc3RDb25maWddID0gdXNlQWRhcHRpdmVDYXJkc0hvc3RDb25maWcoKTtcbiAgY29uc3QgW2Rpc2FibGVkRnJvbUNvbXBvc2VyXSA9IHVzZURpc2FibGVkKCk7XG4gIGNvbnN0IFtlcnJvcnMsIHNldEVycm9yc10gPSB1c2VTdGF0ZShbXSk7XG4gIGNvbnN0IFtsYXN0UmVuZGVyLCBzZXRMYXN0UmVuZGVyXSA9IHVzZVN0YXRlKDApO1xuICBjb25zdCBhY3RpdmVFbGVtZW50SW5kZXhSZWYgPSB1c2VSZWYoLTEpO1xuICBjb25zdCBhZGFwdGl2ZUNhcmRFbGVtZW50UmVmID0gdXNlUmVmKCk7XG4gIGNvbnN0IGNvbnRlbnRSZWYgPSB1c2VSZWYoKTtcbiAgY29uc3QgaW5wdXRWYWx1ZXNSZWYgPSB1c2VSZWYoW10pO1xuICBjb25zdCBsb2NhbGl6ZSA9IHVzZUxvY2FsaXplcigpO1xuICBjb25zdCBwZXJmb3JtQ2FyZEFjdGlvbiA9IHVzZVBlcmZvcm1DYXJkQWN0aW9uKCk7XG4gIGNvbnN0IHJlbmRlck1hcmtkb3duQXNIVE1MID0gdXNlUmVuZGVyTWFya2Rvd25Bc0hUTUwoKTtcbiAgY29uc3Qgc2Nyb2xsVG9FbmQgPSB1c2VTY3JvbGxUb0VuZCgpO1xuXG4gIGNvbnN0IGRpc2FibGVkID0gZGlzYWJsZWRGcm9tQ29tcG9zZXIgfHwgZGlzYWJsZWRGcm9tUHJvcHM7XG5cbiAgLy8gVE9ETzogW1AyXSAjMzE5OSBXZSBzaG91bGQgY29uc2lkZXIgdXNpbmcgYGFkYXB0aXZlQ2FyZC5zZWxlY3RBY3Rpb25gIGluc3RlYWQuXG4gIC8vIFRoZSBudWxsIGNoZWNrIGZvciBcInRhcEFjdGlvblwiIGlzIGluIFwiaGFuZGxlQ2xpY2tBbmRLZXlQcmVzc0ZvclRhcEFjdGlvblwiLlxuICBjb25zdCBoYW5kbGVDbGlja0FuZEtleVByZXNzID0gdXNlQ2FsbGJhY2soXG4gICAgZXZlbnQgPT4ge1xuICAgICAgY29uc3QgeyBrZXksIHRhcmdldCwgdHlwZSB9ID0gZXZlbnQ7XG5cbiAgICAgIC8vIFNvbWUgaXRlbXMsIGUuZy4gdGFwcGFibGUgdGV4dCwgY2Fubm90IGJlIGRpc2FibGVkIHRocnUgRE9NIGF0dHJpYnV0ZXNcbiAgICAgIGNvbnN0IHsgY3VycmVudCB9ID0gY29udGVudFJlZjtcbiAgICAgIGNvbnN0IGFkYXB0aXZlQ2FyZFJvb3QgPSBjdXJyZW50LnF1ZXJ5U2VsZWN0b3IoJy5hYy1hZGFwdGl2ZUNhcmRbdGFiaW5kZXg9XCIwXCJdJyk7XG5cbiAgICAgIGlmICghYWRhcHRpdmVDYXJkUm9vdCkge1xuICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKFxuICAgICAgICAgICdib3RmcmFtZXdvcmstd2ViY2hhdDogTm8gQWRhcHRpdmUgQ2FyZCByb290IGNvbnRhaW5lciBjYW4gYmUgZm91bmQsIHByb2JhYmx5IG9uIGFuIHVuc3VwcG9ydGVkIEFkYXB0aXZlIENhcmQgdmVyc2lvbi4nXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIC8vIEZvciBcImtleXByZXNzXCIgZXZlbnQsIHdlIG9ubHkgbGlzdGVuIHRvIEVOVEVSIGFuZCBTUEFDRUJBUiBrZXkuXG4gICAgICBpZiAodHlwZSA9PT0gJ2tleXByZXNzJykge1xuICAgICAgICBpZiAoa2V5ICE9PSAnRW50ZXInICYmIGtleSAhPT0gJyAnKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIH1cblxuICAgICAgLy8gV2Ugd2lsbCBjYWxsIHBlcmZvcm1DYXJkQWN0aW9uIGlmIGVpdGhlcjpcbiAgICAgIC8vIDEuIFdlIGFyZSBvbiB0aGUgdGFyZ2V0LCBvclxuICAgICAgLy8gMi4gVGhlIGV2ZW50LWRpc3BhdGNoaW5nIGVsZW1lbnQgaXMgbm90IGludGVyYWN0aXZlXG4gICAgICBpZiAodGFyZ2V0ICE9PSBhZGFwdGl2ZUNhcmRSb290KSB7XG4gICAgICAgIGNvbnN0IHRhYkluZGV4ID0gZ2V0VGFiSW5kZXgodGFyZ2V0KTtcblxuICAgICAgICAvLyBJZiB0aGUgdXNlciBpcyBjbGlja2luZyBvbiBzb21ldGhpbmcgdGhhdCBpcyBhbHJlYWR5IGNsaWNrYWJsZSwgZG8gbm90IGFsbG93IHRoZW0gdG8gY2xpY2sgdGhlIGNhcmQuXG4gICAgICAgIC8vIEUuZy4gYSBoZXJvIGNhcmQgY2FuIGJlIHRhcHBhYmxlLCBhbmQgaW1hZ2UgYW5kIGJ1dHRvbnMgaW5zaWRlIHRoZSBoZXJvIGNhcmQgY2FuIGFsc28gYmUgdGFwcGFibGUuXG4gICAgICAgIGlmICh0eXBlb2YgdGFiSW5kZXggPT09ICdudW1iZXInICYmIHRhYkluZGV4ID49IDApIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcGVyZm9ybUNhcmRBY3Rpb24odGFwQWN0aW9uKTtcbiAgICAgIHNjcm9sbFRvRW5kKCk7XG4gICAgfSxcbiAgICBbY29udGVudFJlZiwgcGVyZm9ybUNhcmRBY3Rpb24sIHNjcm9sbFRvRW5kLCB0YXBBY3Rpb25dXG4gICk7XG5cbiAgLy8gT25seSBsaXN0ZW4gdG8gZXZlbnQgaWYgaXQgaXMgbm90IGRpc2FibGVkIGFuZCBoYXZlIFwidGFwQWN0aW9uXCIgcHJvcC5cbiAgY29uc3QgaGFuZGxlQ2xpY2tBbmRLZXlQcmVzc0ZvclRhcEFjdGlvbiA9ICFkaXNhYmxlZCAmJiB0YXBBY3Rpb24gPyBoYW5kbGVDbGlja0FuZEtleVByZXNzIDogdW5kZWZpbmVkO1xuXG4gIGNvbnN0IGFkZEFjdGlvbnNQZXJmb3JtZWQgPSB1c2VDYWxsYmFjayhcbiAgICBhY3Rpb24gPT4gIX5hY3Rpb25zUGVyZm9ybWVkLmluZGV4T2YoYWN0aW9uKSAmJiBzZXRBY3Rpb25zUGVyZm9ybWVkKFsuLi5hY3Rpb25zUGVyZm9ybWVkLCBhY3Rpb25dKSxcbiAgICBbYWN0aW9uc1BlcmZvcm1lZCwgc2V0QWN0aW9uc1BlcmZvcm1lZF1cbiAgKTtcblxuICBjb25zdCBoYW5kbGVFeGVjdXRlQWN0aW9uID0gdXNlQ2FsbGJhY2soXG4gICAgYWN0aW9uID0+IHtcbiAgICAgIC8vIFNvbWUgaXRlbXMsIGUuZy4gdGFwcGFibGUgaW1hZ2UsIGNhbm5vdCBiZSBkaXNhYmxlZCB0aHJ1IERPTSBhdHRyaWJ1dGVzXG4gICAgICBpZiAoZGlzYWJsZWQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBhZGRBY3Rpb25zUGVyZm9ybWVkKGFjdGlvbik7XG5cbiAgICAgIGNvbnN0IGFjdGlvblR5cGVOYW1lID0gYWN0aW9uLmdldEpzb25UeXBlTmFtZSgpO1xuXG4gICAgICBpZiAoYWN0aW9uVHlwZU5hbWUgPT09ICdBY3Rpb24uT3BlblVybCcpIHtcbiAgICAgICAgcGVyZm9ybUNhcmRBY3Rpb24oe1xuICAgICAgICAgIHR5cGU6ICdvcGVuVXJsJyxcbiAgICAgICAgICB2YWx1ZTogYWN0aW9uLnVybFxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSBpZiAoYWN0aW9uVHlwZU5hbWUgPT09ICdBY3Rpb24uU3VibWl0Jykge1xuICAgICAgICBpZiAodHlwZW9mIGFjdGlvbi5kYXRhICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgIGNvbnN0IHsgZGF0YTogYWN0aW9uRGF0YSB9ID0gYWN0aW9uO1xuXG4gICAgICAgICAgaWYgKGFjdGlvbkRhdGEgJiYgYWN0aW9uRGF0YS5fX2lzQm90RnJhbWV3b3JrQ2FyZEFjdGlvbikge1xuICAgICAgICAgICAgY29uc3QgeyBjYXJkQWN0aW9uIH0gPSBhY3Rpb25EYXRhO1xuICAgICAgICAgICAgY29uc3QgeyBkaXNwbGF5VGV4dCwgdGV4dCwgdHlwZSwgdmFsdWUgfSA9IGNhcmRBY3Rpb247XG5cbiAgICAgICAgICAgIHBlcmZvcm1DYXJkQWN0aW9uKHsgZGlzcGxheVRleHQsIHRleHQsIHR5cGUsIHZhbHVlIH0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBwZXJmb3JtQ2FyZEFjdGlvbih7XG4gICAgICAgICAgICAgIHR5cGU6IHR5cGVvZiBhY3Rpb24uZGF0YSA9PT0gJ3N0cmluZycgPyAnaW1CYWNrJyA6ICdwb3N0QmFjaycsXG4gICAgICAgICAgICAgIHZhbHVlOiBhY3Rpb24uZGF0YVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgc2Nyb2xsVG9FbmQoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYFdlYiBDaGF0OiByZWNlaXZlZCB1bmtub3duIGFjdGlvbiBmcm9tIEFkYXB0aXZlIENhcmRzYCk7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYWN0aW9uKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIFthZGRBY3Rpb25zUGVyZm9ybWVkLCBkaXNhYmxlZCwgcGVyZm9ybUNhcmRBY3Rpb24sIHNjcm9sbFRvRW5kXVxuICApO1xuXG4gIHVzZUxheW91dEVmZmVjdCgoKSA9PiB7XG4gICAgY29uc3QgeyBjdXJyZW50IH0gPSBjb250ZW50UmVmO1xuXG4gICAgaWYgKCFjdXJyZW50IHx8ICFhZGFwdGl2ZUNhcmQpIHtcbiAgICAgIGFjdGl2ZUVsZW1lbnRJbmRleFJlZi5jdXJyZW50ID0gLTE7XG4gICAgICBpbnB1dFZhbHVlc1JlZi5jdXJyZW50ID0gW107XG4gICAgfVxuXG4gICAgLy8gQ3VycmVudGx5LCB0aGUgb25seSB3YXkgdG8gc2V0IHRoZSBNYXJrZG93biBlbmdpbmUgaXMgdG8gc2V0IGl0IHRocnUgc3RhdGljIG1lbWJlciBvZiBBZGFwdGl2ZUNhcmQgY2xhc3NcblxuICAgIC8vIFRPRE86IFtQM10gQ2hlY2tzIGlmIHdlIGNvdWxkIG1ha2UgdGhlIFwicmVuZGVyTWFya2Rvd25Bc0hUTUxcIiBwZXIgY2FyZFxuICAgIC8vICAgICAgIFRoaXMgY291bGQgYmUgbGltaXRhdGlvbnMgZnJvbSBBZGFwdGl2ZSBDYXJkcyBwYWNrYWdlIChub3Qgc3VwcG9ydGVkIGFzIG9mIDEuMi41KVxuICAgIC8vICAgICAgIEJlY2F1c2UgdGhlcmUgY291bGQgYmUgdGltaW5nIGRpZmZlcmVuY2UgYmV0d2VlbiAucGFyc2UgYW5kIC5yZW5kZXIsIHdlIGNvdWxkIGJlIHVzaW5nIHdyb25nIE1hcmtkb3duIGVuZ2luZVxuXG4gICAgYWRhcHRpdmVDYXJkLmNvbnN0cnVjdG9yLm9uUHJvY2Vzc01hcmtkb3duID0gKHRleHQsIHJlc3VsdCkgPT4ge1xuICAgICAgaWYgKHJlbmRlck1hcmtkb3duQXNIVE1MKSB7XG4gICAgICAgIHJlc3VsdC5vdXRwdXRIdG1sID0gcmVuZGVyTWFya2Rvd25Bc0hUTUwodGV4dCk7XG4gICAgICAgIHJlc3VsdC5kaWRQcm9jZXNzID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgaWYgKGFkYXB0aXZlQ2FyZHNIb3N0Q29uZmlnKSB7XG4gICAgICBhZGFwdGl2ZUNhcmQuaG9zdENvbmZpZyA9IGlzUGxhaW5PYmplY3QoYWRhcHRpdmVDYXJkc0hvc3RDb25maWcpXG4gICAgICAgID8gbmV3IEhvc3RDb25maWcoYWRhcHRpdmVDYXJkc0hvc3RDb25maWcpXG4gICAgICAgIDogYWRhcHRpdmVDYXJkc0hvc3RDb25maWc7XG4gICAgfVxuXG4gICAgLy8gRm9yIGFjY2Vzc2liaWxpdHkgaXNzdWUgIzEzNDAsIGB0YWJpbmRleD1cIjBcImAgbXVzdCBub3QgYmUgc2V0IGZvciB0aGUgcm9vdCBjb250YWluZXIgaWYgaXQgaXMgbm90IGludGVyYWN0aXZlLlxuICAgIEdsb2JhbFNldHRpbmdzLnNldFRhYkluZGV4QXRDYXJkUm9vdCA9ICEhdGFwQWN0aW9uO1xuXG4gICAgY29uc3QgeyBmYWlsdXJlcyB9ID0gYWRhcHRpdmVDYXJkLnZhbGlkYXRlUHJvcGVydGllcygpO1xuXG4gICAgaWYgKGZhaWx1cmVzLmxlbmd0aCkge1xuICAgICAgcmV0dXJuIHNldEVycm9ycyhcbiAgICAgICAgZmFpbHVyZXMucmVkdWNlKChpdGVtcywgeyBlcnJvcnMgfSkgPT4gWy4uLml0ZW1zLCAuLi5lcnJvcnMubWFwKCh7IG1lc3NhZ2UgfSkgPT4gbmV3IEVycm9yKG1lc3NhZ2UpKV0sIFtdKVxuICAgICAgKTtcbiAgICB9XG5cbiAgICBsZXQgZWxlbWVudDtcblxuICAgIHRyeSB7XG4gICAgICBlbGVtZW50ID0gYWRhcHRpdmVDYXJkLnJlbmRlcigpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4gc2V0RXJyb3JzKFtlcnJvcl0pO1xuICAgIH1cblxuICAgIGlmICghZWxlbWVudCkge1xuICAgICAgcmV0dXJuIHNldEVycm9ycyhbbmV3IEVycm9yKCdBZGFwdGl2ZSBDYXJkIHJlbmRlcmVkIGFzIGVtcHR5IGVsZW1lbnQnKV0pO1xuICAgIH1cblxuICAgIC8vIENsZWFyIGVycm9ycyBvbiBuZXh0IHJlbmRlclxuICAgIHNldEVycm9ycyhbXSk7XG5cbiAgICByZXN0b3JlSW5wdXRWYWx1ZXMoZWxlbWVudCwgaW5wdXRWYWx1ZXNSZWYuY3VycmVudCk7XG5cbiAgICBjdXJyZW50LmFwcGVuZENoaWxkKGVsZW1lbnQpO1xuICAgIGFkYXB0aXZlQ2FyZEVsZW1lbnRSZWYuY3VycmVudCA9IGVsZW1lbnQ7XG5cbiAgICAvLyBGb2N1cyBjYW4gb25seSBiZSByZXN0b3JlZCBhZnRlciB0aGUgRE9NIGlzIGF0dGFjaGVkLlxuICAgIHJlc3RvcmVBY3RpdmVFbGVtZW50SW5kZXgoZWxlbWVudCwgYWN0aXZlRWxlbWVudEluZGV4UmVmLmN1cnJlbnQpO1xuXG4gICAgc2V0TGFzdFJlbmRlcihEYXRlLm5vdygpKTtcblxuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBhY3RpdmVFbGVtZW50SW5kZXhSZWYuY3VycmVudCA9IHNhdmVBY3RpdmVFbGVtZW50SW5kZXgoZWxlbWVudCk7XG4gICAgICBpbnB1dFZhbHVlc1JlZi5jdXJyZW50ID0gc2F2ZUlucHV0VmFsdWVzKGVsZW1lbnQpO1xuXG4gICAgICBjdXJyZW50LnJlbW92ZUNoaWxkKGFkYXB0aXZlQ2FyZEVsZW1lbnRSZWYuY3VycmVudCk7XG5cbiAgICAgIGFkYXB0aXZlQ2FyZEVsZW1lbnRSZWYuY3VycmVudCA9IHVuZGVmaW5lZDtcbiAgICB9O1xuICB9LCBbXG4gICAgYWRhcHRpdmVDYXJkLFxuICAgIGFkYXB0aXZlQ2FyZHNIb3N0Q29uZmlnLFxuICAgIGNvbnRlbnRSZWYsXG4gICAgR2xvYmFsU2V0dGluZ3MsXG4gICAgSG9zdENvbmZpZyxcbiAgICByZW5kZXJNYXJrZG93bkFzSFRNTCxcbiAgICBzZXRFcnJvcnMsXG4gICAgdGFwQWN0aW9uXG4gIF0pO1xuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgLy8gU2V0IG9uRXhlY3V0ZUFjdGlvbiB3aXRob3V0IGNhdXNpbmcgdW5uZWNlc3NhcnkgcmUtcmVuZGVyLlxuICAgIGFkYXB0aXZlQ2FyZC5vbkV4ZWN1dGVBY3Rpb24gPSBkaXNhYmxlZCA/IHVuZGVmaW5lZCA6IGhhbmRsZUV4ZWN1dGVBY3Rpb247XG4gIH0sIFthZGFwdGl2ZUNhcmQsIGRpc2FibGVkLCBoYW5kbGVFeGVjdXRlQWN0aW9uXSk7XG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAvLyBJZiB0aGUgQWRhcHRpdmUgQ2FyZCBnZXQgcmUtcmVuZGVyZWQsIHJlLWRpc2FibGUgZWxlbWVudHMgYXMgbmVlZGVkLlxuICAgIGlmIChkaXNhYmxlZCkge1xuICAgICAgcmV0dXJuIGRpc2FibGVJbnB1dEVsZW1lbnRzV2l0aFVuZG8oYWRhcHRpdmVDYXJkRWxlbWVudFJlZi5jdXJyZW50KTtcbiAgICB9XG4gIH0sIFtkaXNhYmxlZCwgbGFzdFJlbmRlcl0pO1xuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgLy8gSWYgdGhlIEFkYXB0aXZlIENhcmQgY2hhbmdlZCwgcmVzZXQgYWxsIGFjdGlvbnMgcGVyZm9ybWVkLlxuICAgIHNldEFjdGlvbnNQZXJmb3JtZWQoW10pO1xuICB9LCBbYWRhcHRpdmVDYXJkXSk7XG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAvLyBBZGQgZGV2ZWxvcGVycyB0byBoaWdobGlnaHQgYWN0aW9ucyB3aGVuIHRoZXkgaGF2ZSBiZWVuIGNsaWNrZWQuXG4gICAgaWYgKCFhY3Rpb25QZXJmb3JtZWRDbGFzc05hbWUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCB1bmRvU3RhY2sgPSBhY3Rpb25zUGVyZm9ybWVkLm1hcChcbiAgICAgICh7IHJlbmRlcmVkRWxlbWVudCB9KSA9PlxuICAgICAgICByZW5kZXJlZEVsZW1lbnQgJiZcbiAgICAgICAgYWRhcHRpdmVDYXJkRWxlbWVudFJlZi5jdXJyZW50LmNvbnRhaW5zKHJlbmRlcmVkRWxlbWVudCkgJiZcbiAgICAgICAgYWRkUGVyc2lzdGVudENsYXNzV2l0aFVuZG8ocmVuZGVyZWRFbGVtZW50LCBhY3Rpb25QZXJmb3JtZWRDbGFzc05hbWUpXG4gICAgKTtcblxuICAgIHJldHVybiAoKSA9PiB1bmRvU3RhY2suZm9yRWFjaCh1bmRvID0+IHVuZG8gJiYgdW5kbygpKTtcbiAgfSwgW2FjdGlvbnNQZXJmb3JtZWQsIGFjdGlvblBlcmZvcm1lZENsYXNzTmFtZSwgbGFzdFJlbmRlcl0pO1xuXG4gIHJldHVybiBlcnJvcnMubGVuZ3RoID8gKFxuICAgIDxFcnJvckJveCBtZXNzYWdlPXtsb2NhbGl6ZSgnQURBUFRJVkVfQ0FSRF9FUlJPUl9CT1hfVElUTEVfUkVOREVSJyl9PlxuICAgICAge2Vycm9ycy5tYXAoKHsgZXJyb3IsIG1lc3NhZ2UgfSwgaW5kZXgpID0+IChcbiAgICAgICAgLyogZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0L25vLWFycmF5LWluZGV4LWtleSAqL1xuICAgICAgICA8cHJlIGtleT17aW5kZXh9PntKU09OLnN0cmluZ2lmeSh7IGVycm9yLCBtZXNzYWdlIH0sIG51bGwsIDIpfTwvcHJlPlxuICAgICAgKSl9XG4gICAgPC9FcnJvckJveD5cbiAgKSA6IChcbiAgICA8ZGl2XG4gICAgICBjbGFzc05hbWU9e2NsYXNzTmFtZXMoYWRhcHRpdmVDYXJkUmVuZGVyZXJTdHlsZVNldCArICcnLCAnd2ViY2hhdF9fYWRhcHRpdmUtY2FyZC1yZW5kZXJlcicpfVxuICAgICAgb25DbGljaz17aGFuZGxlQ2xpY2tBbmRLZXlQcmVzc0ZvclRhcEFjdGlvbn1cbiAgICAgIG9uS2V5UHJlc3M9e2hhbmRsZUNsaWNrQW5kS2V5UHJlc3NGb3JUYXBBY3Rpb259XG4gICAgICByZWY9e2NvbnRlbnRSZWZ9XG4gICAgLz5cbiAgKTtcbn07XG5cbkFkYXB0aXZlQ2FyZFJlbmRlcmVyLmRlZmF1bHRQcm9wcyA9IHtcbiAgYWN0aW9uUGVyZm9ybWVkQ2xhc3NOYW1lOiAnJyxcbiAgZGlzYWJsZWQ6IHVuZGVmaW5lZCxcbiAgdGFwQWN0aW9uOiB1bmRlZmluZWRcbn07XG5cbkFkYXB0aXZlQ2FyZFJlbmRlcmVyLnByb3BUeXBlcyA9IHtcbiAgYWN0aW9uUGVyZm9ybWVkQ2xhc3NOYW1lOiBQcm9wVHlwZXMuc3RyaW5nLFxuICBhZGFwdGl2ZUNhcmQ6IFByb3BUeXBlcy5hbnkuaXNSZXF1aXJlZCxcbiAgZGlzYWJsZWQ6IFByb3BUeXBlcy5ib29sLFxuICB0YXBBY3Rpb246IFByb3BUeXBlcy5zaGFwZSh7XG4gICAgdHlwZTogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgIHZhbHVlOiBQcm9wVHlwZXMuc3RyaW5nXG4gIH0pXG59O1xuXG5leHBvcnQgZGVmYXVsdCBBZGFwdGl2ZUNhcmRSZW5kZXJlcjtcbiJdfQ==