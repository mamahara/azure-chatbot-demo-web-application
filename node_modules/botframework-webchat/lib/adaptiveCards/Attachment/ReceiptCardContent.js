"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _toArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toArray"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _botframeworkWebchatComponent = require("botframework-webchat-component");

var _propTypes = _interopRequireDefault(require("prop-types"));

var _react = _interopRequireWildcard(require("react"));

var _AdaptiveCardBuilder = _interopRequireDefault(require("./AdaptiveCardBuilder"));

var _AdaptiveCardRenderer = _interopRequireDefault(require("./AdaptiveCardRenderer"));

var _useAdaptiveCardsPackage = _interopRequireDefault(require("../hooks/useAdaptiveCardsPackage"));

/* eslint no-magic-numbers: ["error", { "ignore": [0, 1, 10, 15, 25, 75] }] */
var useDirection = _botframeworkWebchatComponent.hooks.useDirection,
    useLocalizer = _botframeworkWebchatComponent.hooks.useLocalizer,
    useStyleOptions = _botframeworkWebchatComponent.hooks.useStyleOptions;

function nullOrUndefined(obj) {
  return obj === null || typeof obj === 'undefined';
}

var ReceiptCardContent = function ReceiptCardContent(_ref) {
  var actionPerformedClassName = _ref.actionPerformedClassName,
      content = _ref.content,
      disabled = _ref.disabled;

  var _useAdaptiveCardsPack = (0, _useAdaptiveCardsPackage.default)(),
      _useAdaptiveCardsPack2 = (0, _slicedToArray2.default)(_useAdaptiveCardsPack, 1),
      adaptiveCardsPackage = _useAdaptiveCardsPack2[0];

  var _useDirection = useDirection(),
      _useDirection2 = (0, _slicedToArray2.default)(_useDirection, 1),
      direction = _useDirection2[0];

  var _useStyleOptions = useStyleOptions(),
      _useStyleOptions2 = (0, _slicedToArray2.default)(_useStyleOptions, 1),
      styleOptions = _useStyleOptions2[0];

  var localize = useLocalizer();
  var taxText = localize('RECEIPT_CARD_TAX');
  var totalText = localize('RECEIPT_CARD_TOTAL');
  var vatText = localize('RECEIPT_CARD_VAT');
  var builtCard = (0, _react.useMemo)(function () {
    var builder = new _AdaptiveCardBuilder.default(adaptiveCardsPackage, styleOptions, direction);
    var HorizontalAlignment = adaptiveCardsPackage.HorizontalAlignment,
        TextSize = adaptiveCardsPackage.TextSize,
        TextWeight = adaptiveCardsPackage.TextWeight;
    var buttons = content.buttons,
        facts = content.facts,
        items = content.items,
        tax = content.tax,
        title = content.title,
        total = content.total,
        vat = content.vat;
    var richCardWrapTitle = styleOptions.richCardWrapTitle;

    if (content) {
      builder.addTextBlock(title, {
        size: TextSize.Medium,
        weight: TextWeight.Bolder,
        wrap: richCardWrapTitle
      });

      if (facts) {
        var _builder$addColumnSet = builder.addColumnSet([75, 25]),
            _builder$addColumnSet2 = (0, _slicedToArray2.default)(_builder$addColumnSet, 2),
            firstFactColumn = _builder$addColumnSet2[0],
            lastFactColumn = _builder$addColumnSet2[1];

        facts.map(function (_ref2) {
          var key = _ref2.key,
              value = _ref2.value;
          builder.addTextBlock(key, {
            size: TextSize.Medium
          }, firstFactColumn);
          builder.addTextBlock(value, {
            size: TextSize.Medium,
            horizontalAlignment: HorizontalAlignment.Right
          }, lastFactColumn);
        });
      }

      items && items.map(function (_ref3) {
        var _ref3$image = _ref3.image;
        _ref3$image = _ref3$image === void 0 ? {} : _ref3$image;
        var tap = _ref3$image.tap,
            url = _ref3$image.url,
            price = _ref3.price,
            subtitle = _ref3.subtitle,
            title = _ref3.title;
        var itemColumns;

        if (url) {
          var _builder$addColumnSet3 = builder.addColumnSet([15, 75, 10]),
              _builder$addColumnSet4 = (0, _toArray2.default)(_builder$addColumnSet3),
              itemImageColumn = _builder$addColumnSet4[0],
              columns = _builder$addColumnSet4.slice(1);

          itemColumns = columns;
          builder.addImage(url, itemImageColumn, tap);
        } else {
          itemColumns = builder.addColumnSet([75, 25]);
        }

        var _itemColumns = itemColumns,
            _itemColumns2 = (0, _slicedToArray2.default)(_itemColumns, 2),
            itemTitleColumn = _itemColumns2[0],
            itemPriceColumn = _itemColumns2[1];

        builder.addTextBlock(title, {
          size: TextSize.Medium,
          weight: TextWeight.Bolder,
          wrap: richCardWrapTitle
        }, itemTitleColumn);
        builder.addTextBlock(subtitle, {
          size: TextSize.Medium,
          wrap: richCardWrapTitle
        }, itemTitleColumn);
        builder.addTextBlock(price, {
          horizontalAlignment: HorizontalAlignment.Right
        }, itemPriceColumn);
      });

      if (!nullOrUndefined(vat)) {
        var vatCol = builder.addColumnSet([75, 25]);
        builder.addTextBlock(vatText, {
          size: TextSize.Medium,
          weight: TextWeight.Bolder
        }, vatCol[0]);
        builder.addTextBlock(vat, {
          horizontalAlignment: HorizontalAlignment.Right
        }, vatCol[1]);
      }

      if (!nullOrUndefined(tax)) {
        var taxCol = builder.addColumnSet([75, 25]);
        builder.addTextBlock(taxText, {
          size: TextSize.Medium,
          weight: TextWeight.Bolder
        }, taxCol[0]);
        builder.addTextBlock(tax, {
          horizontalAlignment: HorizontalAlignment.Right
        }, taxCol[1]);
      }

      if (!nullOrUndefined(total)) {
        var totalCol = builder.addColumnSet([75, 25]);
        builder.addTextBlock(totalText, {
          size: TextSize.Medium,
          weight: TextWeight.Bolder
        }, totalCol[0]);
        builder.addTextBlock(total, {
          horizontalAlignment: HorizontalAlignment.Right,
          size: TextSize.Medium,
          weight: TextWeight.Bolder
        }, totalCol[1]);
      }

      builder.addButtons(buttons);
      return builder.card;
    }
  }, [adaptiveCardsPackage, content, direction, styleOptions, taxText, totalText, vatText]);
  return /*#__PURE__*/_react.default.createElement(_AdaptiveCardRenderer.default, {
    actionPerformedClassName: actionPerformedClassName,
    adaptiveCard: builtCard,
    disabled: disabled,
    tapAction: content && content.tap
  });
};

ReceiptCardContent.defaultProps = {
  actionPerformedClassName: '',
  disabled: undefined
};
ReceiptCardContent.propTypes = {
  actionPerformedClassName: _propTypes.default.string,
  content: _propTypes.default.shape({
    buttons: _propTypes.default.array,
    facts: _propTypes.default.arrayOf(_propTypes.default.shape({
      key: _propTypes.default.string,
      value: _propTypes.default.string
    })),
    items: _propTypes.default.arrayOf(_propTypes.default.shape({
      image: _propTypes.default.shape({
        tap: _propTypes.default.any,
        url: _propTypes.default.string.isRequired
      }),
      price: _propTypes.default.string.isRequired,
      subtitle: _propTypes.default.string,
      title: _propTypes.default.string.isRequired
    })),
    tap: _propTypes.default.any,
    tax: _propTypes.default.string,
    title: _propTypes.default.string,
    total: _propTypes.default.string,
    vat: _propTypes.default.string
  }).isRequired,
  disabled: _propTypes.default.bool
};
var _default = ReceiptCardContent;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9hZGFwdGl2ZUNhcmRzL0F0dGFjaG1lbnQvUmVjZWlwdENhcmRDb250ZW50LmpzIl0sIm5hbWVzIjpbInVzZURpcmVjdGlvbiIsImhvb2tzIiwidXNlTG9jYWxpemVyIiwidXNlU3R5bGVPcHRpb25zIiwibnVsbE9yVW5kZWZpbmVkIiwib2JqIiwiUmVjZWlwdENhcmRDb250ZW50IiwiYWN0aW9uUGVyZm9ybWVkQ2xhc3NOYW1lIiwiY29udGVudCIsImRpc2FibGVkIiwiYWRhcHRpdmVDYXJkc1BhY2thZ2UiLCJkaXJlY3Rpb24iLCJzdHlsZU9wdGlvbnMiLCJsb2NhbGl6ZSIsInRheFRleHQiLCJ0b3RhbFRleHQiLCJ2YXRUZXh0IiwiYnVpbHRDYXJkIiwiYnVpbGRlciIsIkFkYXB0aXZlQ2FyZEJ1aWxkZXIiLCJIb3Jpem9udGFsQWxpZ25tZW50IiwiVGV4dFNpemUiLCJUZXh0V2VpZ2h0IiwiYnV0dG9ucyIsImZhY3RzIiwiaXRlbXMiLCJ0YXgiLCJ0aXRsZSIsInRvdGFsIiwidmF0IiwicmljaENhcmRXcmFwVGl0bGUiLCJhZGRUZXh0QmxvY2siLCJzaXplIiwiTWVkaXVtIiwid2VpZ2h0IiwiQm9sZGVyIiwid3JhcCIsImFkZENvbHVtblNldCIsImZpcnN0RmFjdENvbHVtbiIsImxhc3RGYWN0Q29sdW1uIiwibWFwIiwia2V5IiwidmFsdWUiLCJob3Jpem9udGFsQWxpZ25tZW50IiwiUmlnaHQiLCJpbWFnZSIsInRhcCIsInVybCIsInByaWNlIiwic3VidGl0bGUiLCJpdGVtQ29sdW1ucyIsIml0ZW1JbWFnZUNvbHVtbiIsImNvbHVtbnMiLCJhZGRJbWFnZSIsIml0ZW1UaXRsZUNvbHVtbiIsIml0ZW1QcmljZUNvbHVtbiIsInZhdENvbCIsInRheENvbCIsInRvdGFsQ29sIiwiYWRkQnV0dG9ucyIsImNhcmQiLCJkZWZhdWx0UHJvcHMiLCJ1bmRlZmluZWQiLCJwcm9wVHlwZXMiLCJQcm9wVHlwZXMiLCJzdHJpbmciLCJzaGFw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UUFBQUEsR0FBRyxFQUFFaUIsbUJBQVVDLE1BQVYsQ0FBaUJLO0FBRkQsT0FBaEIsQ0FETztBQUtkdEIsTUFBQUEsS0FBSyxFQUFFZ0IsbUJBQVVDLE1BQVYsQ0FBaUJLLFVBTFY7QUFNZHJCLE1BQUFBLFFBQVEsRUFBRWUsbUJBQVVDLE1BTk47QUFPZHRDLE1BQUFBLEtBQUssRUFBRXFDLG1CQUFVQyxNQUFWLENBQWlCSztBQVBWLEtBQWhCLENBREssQ0FSZ0I7QUFtQnZCeEIsSUFBQUEsR0FBRyxFQUFFa0IsbUJBQVVLLEdBbkJRO0FBb0J2QjNDLElBQUFBLEdBQUcsRUFBRXNDLG1CQUFVQyxNQXBCUTtBQXFCdkJ0QyxJQUFBQSxLQUFLLEVBQUVxQyxtQkFBVUMsTUFyQk07QUFzQnZCckMsSUFBQUEsS0FBSyxFQUFFb0MsbUJBQVVDLE1BdEJNO0FBdUJ2QnBDLElBQUFBLEdBQUcsRUFBRW1DLG1CQUFVQztBQXZCUSxHQUFoQixFQXdCTkssVUExQjBCO0FBMkI3QjdELEVBQUFBLFFBQVEsRUFBRXVELG1CQUFVTztBQTNCUyxDQUEvQjtlQThCZWpFLGtCIiwic291cmNlUm9vdCI6ImJ1bmRsZTovLy8iLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQgbm8tbWFnaWMtbnVtYmVyczogW1wiZXJyb3JcIiwgeyBcImlnbm9yZVwiOiBbMCwgMSwgMTAsIDE1LCAyNSwgNzVdIH1dICovXG5cbmltcG9ydCB7IGhvb2tzIH0gZnJvbSAnYm90ZnJhbWV3b3JrLXdlYmNoYXQtY29tcG9uZW50JztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgUmVhY3QsIHsgdXNlTWVtbyB9IGZyb20gJ3JlYWN0JztcblxuaW1wb3J0IEFkYXB0aXZlQ2FyZEJ1aWxkZXIgZnJvbSAnLi9BZGFwdGl2ZUNhcmRCdWlsZGVyJztcbmltcG9ydCBBZGFwdGl2ZUNhcmRSZW5kZXJlciBmcm9tICcuL0FkYXB0aXZlQ2FyZFJlbmRlcmVyJztcbmltcG9ydCB1c2VBZGFwdGl2ZUNhcmRzUGFja2FnZSBmcm9tICcuLi9ob29rcy91c2VBZGFwdGl2ZUNhcmRzUGFja2FnZSc7XG5cbmNvbnN0IHsgdXNlRGlyZWN0aW9uLCB1c2VMb2NhbGl6ZXIsIHVzZVN0eWxlT3B0aW9ucyB9ID0gaG9va3M7XG5cbmZ1bmN0aW9uIG51bGxPclVuZGVmaW5lZChvYmopIHtcbiAgcmV0dXJuIG9iaiA9PT0gbnVsbCB8fCB0eXBlb2Ygb2JqID09PSAndW5kZWZpbmVkJztcbn1cblxuY29uc3QgUmVjZWlwdENhcmRDb250ZW50ID0gKHsgYWN0aW9uUGVyZm9ybWVkQ2xhc3NOYW1lLCBjb250ZW50LCBkaXNhYmxlZCB9KSA9PiB7XG4gIGNvbnN0IFthZGFwdGl2ZUNhcmRzUGFja2FnZV0gPSB1c2VBZGFwdGl2ZUNhcmRzUGFja2FnZSgpO1xuICBjb25zdCBbZGlyZWN0aW9uXSA9IHVzZURpcmVjdGlvbigpO1xuICBjb25zdCBbc3R5bGVPcHRpb25zXSA9IHVzZVN0eWxlT3B0aW9ucygpO1xuICBjb25zdCBsb2NhbGl6ZSA9IHVzZUxvY2FsaXplcigpO1xuXG4gIGNvbnN0IHRheFRleHQgPSBsb2NhbGl6ZSgnUkVDRUlQVF9DQVJEX1RBWCcpO1xuICBjb25zdCB0b3RhbFRleHQgPSBsb2NhbGl6ZSgnUkVDRUlQVF9DQVJEX1RPVEFMJyk7XG4gIGNvbnN0IHZhdFRleHQgPSBsb2NhbGl6ZSgnUkVDRUlQVF9DQVJEX1ZBVCcpO1xuXG4gIGNvbnN0IGJ1aWx0Q2FyZCA9IHVzZU1lbW8oKCkgPT4ge1xuICAgIGNvbnN0IGJ1aWxkZXIgPSBuZXcgQWRhcHRpdmVDYXJkQnVpbGRlcihhZGFwdGl2ZUNhcmRzUGFja2FnZSwgc3R5bGVPcHRpb25zLCBkaXJlY3Rpb24pO1xuICAgIGNvbnN0IHsgSG9yaXpvbnRhbEFsaWdubWVudCwgVGV4dFNpemUsIFRleHRXZWlnaHQgfSA9IGFkYXB0aXZlQ2FyZHNQYWNrYWdlO1xuICAgIGNvbnN0IHsgYnV0dG9ucywgZmFjdHMsIGl0ZW1zLCB0YXgsIHRpdGxlLCB0b3RhbCwgdmF0IH0gPSBjb250ZW50O1xuICAgIGNvbnN0IHsgcmljaENhcmRXcmFwVGl0bGUgfSA9IHN0eWxlT3B0aW9ucztcblxuICAgIGlmIChjb250ZW50KSB7XG4gICAgICBidWlsZGVyLmFkZFRleHRCbG9jayh0aXRsZSwgeyBzaXplOiBUZXh0U2l6ZS5NZWRpdW0sIHdlaWdodDogVGV4dFdlaWdodC5Cb2xkZXIsIHdyYXA6IHJpY2hDYXJkV3JhcFRpdGxlIH0pO1xuXG4gICAgICBpZiAoZmFjdHMpIHtcbiAgICAgICAgY29uc3QgW2ZpcnN0RmFjdENvbHVtbiwgbGFzdEZhY3RDb2x1bW5dID0gYnVpbGRlci5hZGRDb2x1bW5TZXQoWzc1LCAyNV0pO1xuXG4gICAgICAgIGZhY3RzLm1hcCgoeyBrZXksIHZhbHVlIH0pID0+IHtcbiAgICAgICAgICBidWlsZGVyLmFkZFRleHRCbG9jayhrZXksIHsgc2l6ZTogVGV4dFNpemUuTWVkaXVtIH0sIGZpcnN0RmFjdENvbHVtbik7XG4gICAgICAgICAgYnVpbGRlci5hZGRUZXh0QmxvY2soXG4gICAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICAgIHsgc2l6ZTogVGV4dFNpemUuTWVkaXVtLCBob3Jpem9udGFsQWxpZ25tZW50OiBIb3Jpem9udGFsQWxpZ25tZW50LlJpZ2h0IH0sXG4gICAgICAgICAgICBsYXN0RmFjdENvbHVtblxuICAgICAgICAgICk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBpdGVtcyAmJlxuICAgICAgICBpdGVtcy5tYXAoKHsgaW1hZ2U6IHsgdGFwLCB1cmwgfSA9IHt9LCBwcmljZSwgc3VidGl0bGUsIHRpdGxlIH0pID0+IHtcbiAgICAgICAgICBsZXQgaXRlbUNvbHVtbnM7XG5cbiAgICAgICAgICBpZiAodXJsKSB7XG4gICAgICAgICAgICBjb25zdCBbaXRlbUltYWdlQ29sdW1uLCAuLi5jb2x1bW5zXSA9IGJ1aWxkZXIuYWRkQ29sdW1uU2V0KFsxNSwgNzUsIDEwXSk7XG5cbiAgICAgICAgICAgIGl0ZW1Db2x1bW5zID0gY29sdW1ucztcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkSW1hZ2UodXJsLCBpdGVtSW1hZ2VDb2x1bW4sIHRhcCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGl0ZW1Db2x1bW5zID0gYnVpbGRlci5hZGRDb2x1bW5TZXQoWzc1LCAyNV0pO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnN0IFtpdGVtVGl0bGVDb2x1bW4sIGl0ZW1QcmljZUNvbHVtbl0gPSBpdGVtQ29sdW1ucztcblxuICAgICAgICAgIGJ1aWxkZXIuYWRkVGV4dEJsb2NrKFxuICAgICAgICAgICAgdGl0bGUsXG4gICAgICAgICAgICB7IHNpemU6IFRleHRTaXplLk1lZGl1bSwgd2VpZ2h0OiBUZXh0V2VpZ2h0LkJvbGRlciwgd3JhcDogcmljaENhcmRXcmFwVGl0bGUgfSxcbiAgICAgICAgICAgIGl0ZW1UaXRsZUNvbHVtblxuICAgICAgICAgICk7XG4gICAgICAgICAgYnVpbGRlci5hZGRUZXh0QmxvY2soc3VidGl0bGUsIHsgc2l6ZTogVGV4dFNpemUuTWVkaXVtLCB3cmFwOiByaWNoQ2FyZFdyYXBUaXRsZSB9LCBpdGVtVGl0bGVDb2x1bW4pO1xuICAgICAgICAgIGJ1aWxkZXIuYWRkVGV4dEJsb2NrKHByaWNlLCB7IGhvcml6b250YWxBbGlnbm1lbnQ6IEhvcml6b250YWxBbGlnbm1lbnQuUmlnaHQgfSwgaXRlbVByaWNlQ29sdW1uKTtcbiAgICAgICAgfSk7XG5cbiAgICAgIGlmICghbnVsbE9yVW5kZWZpbmVkKHZhdCkpIHtcbiAgICAgICAgY29uc3QgdmF0Q29sID0gYnVpbGRlci5hZGRDb2x1bW5TZXQoWzc1LCAyNV0pO1xuXG4gICAgICAgIGJ1aWxkZXIuYWRkVGV4dEJsb2NrKHZhdFRleHQsIHsgc2l6ZTogVGV4dFNpemUuTWVkaXVtLCB3ZWlnaHQ6IFRleHRXZWlnaHQuQm9sZGVyIH0sIHZhdENvbFswXSk7XG4gICAgICAgIGJ1aWxkZXIuYWRkVGV4dEJsb2NrKHZhdCwgeyBob3Jpem9udGFsQWxpZ25tZW50OiBIb3Jpem9udGFsQWxpZ25tZW50LlJpZ2h0IH0sIHZhdENvbFsxXSk7XG4gICAgICB9XG5cbiAgICAgIGlmICghbnVsbE9yVW5kZWZpbmVkKHRheCkpIHtcbiAgICAgICAgY29uc3QgdGF4Q29sID0gYnVpbGRlci5hZGRDb2x1bW5TZXQoWzc1LCAyNV0pO1xuXG4gICAgICAgIGJ1aWxkZXIuYWRkVGV4dEJsb2NrKHRheFRleHQsIHsgc2l6ZTogVGV4dFNpemUuTWVkaXVtLCB3ZWlnaHQ6IFRleHRXZWlnaHQuQm9sZGVyIH0sIHRheENvbFswXSk7XG4gICAgICAgIGJ1aWxkZXIuYWRkVGV4dEJsb2NrKHRheCwgeyBob3Jpem9udGFsQWxpZ25tZW50OiBIb3Jpem9udGFsQWxpZ25tZW50LlJpZ2h0IH0sIHRheENvbFsxXSk7XG4gICAgICB9XG5cbiAgICAgIGlmICghbnVsbE9yVW5kZWZpbmVkKHRvdGFsKSkge1xuICAgICAgICBjb25zdCB0b3RhbENvbCA9IGJ1aWxkZXIuYWRkQ29sdW1uU2V0KFs3NSwgMjVdKTtcblxuICAgICAgICBidWlsZGVyLmFkZFRleHRCbG9jayh0b3RhbFRleHQsIHsgc2l6ZTogVGV4dFNpemUuTWVkaXVtLCB3ZWlnaHQ6IFRleHRXZWlnaHQuQm9sZGVyIH0sIHRvdGFsQ29sWzBdKTtcbiAgICAgICAgYnVpbGRlci5hZGRUZXh0QmxvY2soXG4gICAgICAgICAgdG90YWwsXG4gICAgICAgICAgeyBob3Jpem9udGFsQWxpZ25tZW50OiBIb3Jpem9udGFsQWxpZ25tZW50LlJpZ2h0LCBzaXplOiBUZXh0U2l6ZS5NZWRpdW0sIHdlaWdodDogVGV4dFdlaWdodC5Cb2xkZXIgfSxcbiAgICAgICAgICB0b3RhbENvbFsxXVxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICBidWlsZGVyLmFkZEJ1dHRvbnMoYnV0dG9ucyk7XG5cbiAgICAgIHJldHVybiBidWlsZGVyLmNhcmQ7XG4gICAgfVxuICB9LCBbYWRhcHRpdmVDYXJkc1BhY2thZ2UsIGNvbnRlbnQsIGRpcmVjdGlvbiwgc3R5bGVPcHRpb25zLCB0YXhUZXh0LCB0b3RhbFRleHQsIHZhdFRleHRdKTtcblxuICByZXR1cm4gKFxuICAgIDxBZGFwdGl2ZUNhcmRSZW5kZXJlclxuICAgICAgYWN0aW9uUGVyZm9ybWVkQ2xhc3NOYW1lPXthY3Rpb25QZXJmb3JtZWRDbGFzc05hbWV9XG4gICAgICBhZGFwdGl2ZUNhcmQ9e2J1aWx0Q2FyZH1cbiAgICAgIGRpc2FibGVkPXtkaXNhYmxlZH1cbiAgICAgIHRhcEFjdGlvbj17Y29udGVudCAmJiBjb250ZW50LnRhcH1cbiAgICAvPlxuICApO1xufTtcblxuUmVjZWlwdENhcmRDb250ZW50LmRlZmF1bHRQcm9wcyA9IHtcbiAgYWN0aW9uUGVyZm9ybWVkQ2xhc3NOYW1lOiAnJyxcbiAgZGlzYWJsZWQ6IHVuZGVmaW5lZFxufTtcblxuUmVjZWlwdENhcmRDb250ZW50LnByb3BUeXBlcyA9IHtcbiAgYWN0aW9uUGVyZm9ybWVkQ2xhc3NOYW1lOiBQcm9wVHlwZXMuc3RyaW5nLFxuICBjb250ZW50OiBQcm9wVHlwZXMuc2hhcGUoe1xuICAgIGJ1dHRvbnM6IFByb3BUeXBlcy5hcnJheSxcbiAgICBmYWN0czogUHJvcFR5cGVzLmFycmF5T2YoXG4gICAgICBQcm9wVHlwZXMuc2hhcGUoe1xuICAgICAgICBrZXk6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgICAgIHZhbHVlOiBQcm9wVHlwZXMuc3RyaW5nXG4gICAgICB9KVxuICAgICksXG4gICAgaXRlbXM6IFByb3BUeXBlcy5hcnJheU9mKFxuICAgICAgUHJvcFR5cGVzLnNoYXBlKHtcbiAgICAgICAgaW1hZ2U6IFByb3BUeXBlcy5zaGFwZSh7XG4gICAgICAgICAgdGFwOiBQcm9wVHlwZXMuYW55LFxuICAgICAgICAgIHVybDogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkXG4gICAgICAgIH0pLFxuICAgICAgICBwcmljZTogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgICAgICBzdWJ0aXRsZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgICAgICAgdGl0bGU6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZFxuICAgICAgfSlcbiAgICApLFxuICAgIHRhcDogUHJvcFR5cGVzLmFueSxcbiAgICB0YXg6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgdGl0bGU6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgdG90YWw6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgdmF0OiBQcm9wVHlwZXMuc3RyaW5nXG4gIH0pLmlzUmVxdWlyZWQsXG4gIGRpc2FibGVkOiBQcm9wVHlwZXMuYm9vbFxufTtcblxuZXhwb3J0IGRlZmF1bHQgUmVjZWlwdENhcmRDb250ZW50O1xuIl19