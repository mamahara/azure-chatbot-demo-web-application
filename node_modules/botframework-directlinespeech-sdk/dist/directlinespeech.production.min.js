window.DirectLineSpeech=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=129)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(81);t.AudioConfig=n.AudioConfig;var i=r(30);t.AudioStreamFormat=i.AudioStreamFormat;var o=r(86);t.AudioInputStream=o.AudioInputStream,t.PullAudioInputStream=o.PullAudioInputStream,t.PushAudioInputStream=o.PushAudioInputStream;var s=r(87);t.AudioOutputStream=s.AudioOutputStream,t.PullAudioOutputStream=s.PullAudioOutputStream;var a=r(160);t.CancellationReason=a.CancellationReason;var c=r(161);t.PullAudioInputStreamCallback=c.PullAudioInputStreamCallback;var p=r(162);t.KeywordRecognitionModel=p.KeywordRecognitionModel;var u=r(163);t.SessionEventArgs=u.SessionEventArgs;var h=r(164);t.RecognitionEventArgs=h.RecognitionEventArgs;var v=r(165);t.OutputFormat=v.OutputFormat;var l=r(166);t.IntentRecognitionEventArgs=l.IntentRecognitionEventArgs;var d=r(167);t.RecognitionResult=d.RecognitionResult;var f=r(168);t.SpeechRecognitionResult=f.SpeechRecognitionResult;var g=r(169);t.IntentRecognitionResult=g.IntentRecognitionResult;var y=r(170);t.LanguageUnderstandingModel=y.LanguageUnderstandingModel;var m=r(171);t.SpeechRecognitionEventArgs=m.SpeechRecognitionEventArgs;var S=r(172);t.SpeechRecognitionCanceledEventArgs=S.SpeechRecognitionCanceledEventArgs;var C=r(173);t.TranslationRecognitionEventArgs=C.TranslationRecognitionEventArgs;var b=r(174);t.TranslationSynthesisEventArgs=b.TranslationSynthesisEventArgs;var P=r(88);t.TranslationRecognitionResult=P.TranslationRecognitionResult;var R=r(175);t.TranslationSynthesisResult=R.TranslationSynthesisResult;var I=r(176);t.ResultReason=I.ResultReason;var w=r(177);t.SpeechConfig=w.SpeechConfig,t.SpeechConfigImpl=w.SpeechConfigImpl;var E=r(178);t.SpeechTranslationConfig=E.SpeechTranslationConfig;var T=r(179);t.PropertyCollection=T.PropertyCollection;var O=r(89);t.PropertyId=O.PropertyId;var A=r(180);t.Recognizer=A.Recognizer;var _=r(181);t.SpeechRecognizer=_.SpeechRecognizer;var D=r(182);t.IntentRecognizer=D.IntentRecognizer;var x=r(183);t.TranslationRecognizer=x.TranslationRecognizer;var k=r(184);t.Translations=k.Translations;var M=r(185);t.NoMatchReason=M.NoMatchReason;var N=r(186);t.NoMatchDetails=N.NoMatchDetails;var j=r(187);t.TranslationRecognitionCanceledEventArgs=j.TranslationRecognitionCanceledEventArgs;var z=r(188);t.IntentRecognitionCanceledEventArgs=z.IntentRecognitionCanceledEventArgs;var L=r(189);t.CancellationDetails=L.CancellationDetails;var q=r(190);t.CancellationErrorCode=q.CancellationErrorCode;var B=r(191);t.ConnectionEventArgs=B.ConnectionEventArgs;var U=r(192);t.ServiceEventArgs=U.ServiceEventArgs;var F=r(193);t.Connection=F.Connection;var W=r(194);t.PhraseListGrammar=W.PhraseListGrammar;var H=r(53);t.DialogServiceConfig=H.DialogServiceConfig;var V=r(195);t.BotFrameworkConfig=V.BotFrameworkConfig;var J=r(196);t.CustomCommandsConfig=J.CustomCommandsConfig;var G=r(197);t.DialogServiceConnector=G.DialogServiceConnector;var K=r(199);t.ActivityReceivedEventArgs=K.ActivityReceivedEventArgs;var Q=r(200);t.ServicePropertyChannel=Q.ServicePropertyChannel;var Y=r(201);t.ProfanityOption=Y.ProfanityOption;var $=r(202);t.BaseAudioPlayer=$.BaseAudioPlayer;var X=r(91);t.Conversation=X.Conversation,t.ConversationExpirationEventArgs=X.ConversationExpirationEventArgs,t.ConversationParticipantsChangedEventArgs=X.ConversationParticipantsChangedEventArgs,t.ConversationTranslationCanceledEventArgs=X.ConversationTranslationCanceledEventArgs,t.ConversationTranslationEventArgs=X.ConversationTranslationEventArgs,t.ConversationTranslationResult=X.ConversationTranslationResult,t.ConversationTranslator=X.ConversationTranslator,t.Participant=X.Participant,t.ParticipantChangedReason=X.ParticipantChangedReason,t.User=X.User},function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return i})),r.d(t,"c",(function(){return o}));class n extends Error{constructor(e){super(e),this.name="ArgumentNull",this.message=e}}class i extends Error{constructor(e){super(e),this.name="InvalidOperation",this.message=e}}class o extends Error{constructor(e,t){super(t),this.name=e+"ObjectDisposed",this.message=t}}},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(157)),n(r(158)),n(r(52)),n(r(159)),n(r(54)),n(r(211)),n(r(212)),n(r(213)),n(r(90)),n(r(214)),n(r(215)),n(r(216)),n(r(217)),n(r(218)),n(r(219)),n(r(220)),n(r(221)),n(r(222)),n(r(223)),n(r(224)),n(r(225)),n(r(226)),n(r(227)),n(r(228)),n(r(229)),n(r(231)),n(r(232)),n(r(233)),n(r(236)),n(r(237)),t.OutputFormatPropertyName="OutputFormat",t.CancellationErrorCodePropertyName="CancellationErrorCode",t.ServicePropertiesPropertyName="ServiceProperties",t.ForceDictationPropertyName="ForceDication"},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(147)),n(r(148)),n(r(82)),n(r(149)),n(r(12)),n(r(150)),n(r(83)),n(r(21)),n(r(151)),n(r(84)),n(r(49)),n(r(50)),n(r(85)),n(r(152)),n(r(153)),n(r(154));var i=r(51);t.TranslationStatus=i.TranslationStatus,n(r(155))},,function(e,t,r){"use strict";r.d(t,"d",(function(){return n})),r.d(t,"c",(function(){return a})),r.d(t,"b",(function(){return c})),r.d(t,"a",(function(){return p})),r.d(t,"e",(function(){return u}));var n,i=r(1);!function(e){e[e.None=0]="None",e[e.Resolved=1]="Resolved",e[e.Rejected=2]="Rejected"}(n||(n={}));class o{constructor(e){this.throwIfError=()=>{if(this.isError)throw this.error},e.on(e=>{this.privIsCompleted||(this.privIsCompleted=!0,this.privIsError=!1,this.privResult=e)},e=>{this.privIsCompleted||(this.privIsCompleted=!0,this.privIsError=!0,this.privError=e)})}get isCompleted(){return this.privIsCompleted}get isError(){return this.privIsError}get error(){return this.privError}get result(){return this.privResult}}class s{constructor(){this.setResult=e=>{this.privOnSetResult(e)},this.setError=e=>{this.privOnSetError(e)},this.on=(e,t)=>{this.privOnSetResult=e,this.privOnSetError=t}}}class a{}a.whenAll=e=>{if(!e||0===e.length)throw new i.a("promises");const t=new p,r=[];let n=0;const o=()=>{n++,n===e.length&&(0===r.length?t.resolve(!0):t.reject(r.join(", ")))};for(const t of e)t.on(e=>{o()},e=>{r.push(e),o()});return t.promise()},a.fromResult=e=>{const t=new p;return t.resolve(e),t.promise()},a.fromError=e=>{const t=new p;return t.reject(e),t.promise()};class c{constructor(e){this.result=()=>this.privSink.result,this.continueWith=e=>{if(!e)throw new i.a("continuationCallback");const t=new p;return this.privSink.on(r=>{try{const r=e(this.privSink.result);t.resolve(r)}catch(e){t.reject(e)}},r=>{try{const r=e(this.privSink.result);t.resolve(r)}catch(e){t.reject(`'Error handler for error ${r} threw error ${e}'`)}}),t.promise()},this.onSuccessContinueWith=e=>{if(!e)throw new i.a("continuationCallback");const t=new p;return this.privSink.on(r=>{try{const n=e(r);t.resolve(n)}catch(e){t.reject(e)}},e=>{t.reject(e)}),t.promise()},this.continueWithPromise=e=>{if(!e)throw new i.a("continuationCallback");const t=new p;return this.privSink.on(r=>{try{const r=e(this.privSink.result);if(!r)throw new Error("'Continuation callback did not return promise'");r.on(e=>{t.resolve(e)},e=>{t.reject(e)})}catch(e){t.reject(e)}},r=>{try{const r=e(this.privSink.result);if(!r)throw new Error("Continuation callback did not return promise");r.on(e=>{t.resolve(e)},e=>{t.reject(e)})}catch(e){t.reject(`'Error handler for error ${r} threw error ${e}'`)}}),t.promise()},this.onSuccessContinueWithPromise=e=>{if(!e)throw new i.a("continuationCallback");const t=new p;return this.privSink.on(r=>{try{const n=e(r);if(!n)throw new Error("Continuation callback did not return promise");n.on(e=>{t.resolve(e)},e=>{t.reject(e)})}catch(e){t.reject(e)}},e=>{t.reject(e)}),t.promise()},this.on=(e,t)=>{if(!e)throw new i.a("successCallback");if(!t)throw new i.a("errorCallback");return this.privSink.on(e,t),this},this.finally=e=>{if(!e)throw new i.a("callback");const t=t=>{e()};return this.on(t,t)},this.privSink=e}}class p{constructor(){this.state=()=>this.privSink.state,this.promise=()=>this.privPromise,this.resolve=e=>(this.privSink.resolve(e),this),this.reject=e=>(this.privSink.reject(e),this),this.privSink=new u,this.privPromise=new c(this.privSink)}}class u{constructor(){this.privState=n.None,this.privPromiseResult=null,this.privPromiseResultEvents=null,this.privSuccessHandlers=[],this.privErrorHandlers=[],this.resolve=e=>{if(this.privState!==n.None)throw new Error("'Cannot resolve a completed promise'");this.privState=n.Resolved,this.privPromiseResultEvents.setResult(e);for(let t=0;t<this.privSuccessHandlers.length;t++)this.executeSuccessCallback(e,this.privSuccessHandlers[t],this.privErrorHandlers[t]);this.detachHandlers()},this.reject=e=>{if(this.privState!==n.None)throw new Error("'Cannot reject a completed promise'");this.privState=n.Rejected,this.privPromiseResultEvents.setError(e);for(const t of this.privErrorHandlers)this.executeErrorCallback(e,t);this.detachHandlers()},this.on=(e,t)=>{null==e&&(e=e=>{}),this.privState===n.None?(this.privSuccessHandlers.push(e),this.privErrorHandlers.push(t)):(this.privState===n.Resolved?this.executeSuccessCallback(this.privPromiseResult.result,e,t):this.privState===n.Rejected&&this.executeErrorCallback(this.privPromiseResult.error,t),this.detachHandlers())},this.executeSuccessCallback=(e,t,r)=>{try{t(e)}catch(e){this.executeErrorCallback(`'Unhandled callback error: ${e}'`,r)}},this.executeErrorCallback=(e,t)=>{if(!t)throw new Error(`'Unhandled error: ${e}'`);try{t(e)}catch(t){throw new Error(`'Unhandled callback error: ${t}. InnerError: ${e}'`)}},this.detachHandlers=()=>{this.privErrorHandlers=[],this.privSuccessHandlers=[]},this.privPromiseResultEvents=new s,this.privPromiseResult=new o(this.privPromiseResultEvents)}get state(){return this.privState}get result(){return this.privPromiseResult}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.throwIfNullOrUndefined=function(e,t){if(null==e)throw new Error("throwIfNullOrUndefined:"+t)},e.throwIfNull=function(e,t){if(null===e)throw new Error("throwIfNull:"+t)},e.throwIfNullOrWhitespace=function(t,r){if(e.throwIfNullOrUndefined(t,r),(""+t).trim().length<1)throw new Error("throwIfNullOrWhitespace:"+r)},e.throwIfDisposed=function(e){if(e)throw new Error("the object is already disposed")},e.throwIfArrayEmptyOrWhitespace=function(t,r){if(e.throwIfNullOrUndefined(t,r),0===t.length)throw new Error("throwIfArrayEmptyOrWhitespace:"+r);for(var n=0,i=t;n<i.length;n++){var o=i[n];e.throwIfNullOrWhitespace(o,r)}},e.throwIfFileDoesNotExist=function(t,r){e.throwIfNullOrWhitespace(t,r)},e}();t.Contracts=n},function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return i}));const n=()=>{let e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?r:3&r|8).toString(16)})},i=()=>n().replace(new RegExp("-","g"),"").toUpperCase()},function(e,t){e.exports=function(e){return e&&e.__esModule?e:{default:e}}},function(e,t,r){(function(t){var r=function(e){return e&&e.Math==Math&&e};e.exports=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof t&&t)||Function("return this")()}).call(this,r(66))},function(e,t,r){var n=r(9),i=r(75),o=r(14),s=r(76),a=r(117),c=r(302),p=i("wks"),u=n.Symbol,h=c?u:u&&u.withoutSetter||s;e.exports=function(e){return o(p,e)||(a&&o(u,e)?p[e]=u[e]:p[e]=h("Symbol."+e)),p[e]}},function(e,t,r){"use strict";var n;r.d(t,"a",(function(){return n})),function(e){e[e.None=0]="None",e[e.Connected=1]="Connected",e[e.Connecting=2]="Connecting",e[e.Disconnected=3]="Disconnected"}(n||(n={}))},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){var r=e.call(this,t)||this;return r.name="ArgumentNull",r.message=t,r}return i(t,e),t}(Error);t.ArgumentNullError=o;var s=function(e){function t(t){var r=e.call(this,t)||this;return r.name="InvalidOperation",r.message=t,r}return i(t,e),t}(Error);t.InvalidOperationError=s;var a=function(e){function t(t,r){var n=e.call(this,r)||this;return n.name=t+"ObjectDisposed",n.message=r,n}return i(t,e),t}(Error);t.ObjectDisposedError=a},function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return o}));var n,i=r(7);!function(e){e[e.Debug=0]="Debug",e[e.Info=1]="Info",e[e.Warning=2]="Warning",e[e.Error=3]="Error"}(n||(n={}));class o{constructor(e,t){this.privName=e,this.privEventId=Object(i.b)(),this.privEventTime=(new Date).toISOString(),this.privEventType=t,this.privMetadata={}}get name(){return this.privName}get eventId(){return this.privEventId}get eventTime(){return this.privEventTime}get eventType(){return this.privEventType}get metadata(){return this.privMetadata}}},function(e,t){var r={}.hasOwnProperty;e.exports=function(e,t){return r.call(e,t)}},function(e,t,r){var n=r(26);e.exports=function(e){if(!n(e))throw TypeError(String(e)+" is not an object");return e}},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(146)),n(r(156)),n(r(248)),n(r(249)),n(r(250)),n(r(97)),n(r(257)),n(r(258))},,function(e,t,r){var n=r(25);e.exports=!n((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},function(e,t,r){var n=r(18),i=r(20),o=r(40);e.exports=n?function(e,t,r){return i.f(e,t,o(1,r))}:function(e,t,r){return e[t]=r,e}},function(e,t,r){var n=r(18),i=r(71),o=r(15),s=r(70),a=Object.defineProperty;t.f=n?a:function(e,t,r){if(o(e),t=s(t,!0),o(r),i)try{return a(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?r:3&r|8).toString(16)}))};t.createGuid=n;t.createNoDashGuid=function(){return n().replace(new RegExp("-","g"),"").toUpperCase()}},function(e,t,r){e.exports=r(80)},function(e,t){function r(e,t,r,n,i,o,s){try{var a=e[o](s),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(n,i)}e.exports=function(e){return function(){var t=this,n=arguments;return new Promise((function(i,o){var s=e.apply(t,n);function a(e){r(s,i,o,a,c,"next",e)}function c(e){r(s,i,o,a,c,"throw",e)}a(void 0)}))}}},function(e,t,r){"use strict";r.d(t,"b",(function(){return n})),r.d(t,"a",(function(){return s}));var n,i=r(1),o=r(7);!function(e){e[e.Text=0]="Text",e[e.Binary=1]="Binary"}(n||(n={}));class s{constructor(e,t,r,s){if(this.privBody=null,e===n.Text&&t&&"string"!=typeof t)throw new i.b("Payload must be a string");if(e===n.Binary&&t&&!(t instanceof ArrayBuffer))throw new i.b("Payload must be ArrayBuffer");switch(this.privMessageType=e,this.privBody=t,this.privHeaders=r||{},this.privId=s||Object(o.b)(),this.messageType){case n.Binary:this.privSize=null!==this.binaryBody?this.binaryBody.byteLength:0;break;case n.Text:this.privSize=this.textBody.length}}get messageType(){return this.privMessageType}get headers(){return this.privHeaders}get body(){return this.privBody}get textBody(){if(this.privMessageType===n.Binary)throw new i.b("Not supported for binary message");return this.privBody}get binaryBody(){if(this.privMessageType===n.Text)throw new i.b("Not supported for text message");return this.privBody}get id(){return this.privId}}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t){e.exports=function(e){return e&&e.__esModule?e:{default:e}}},function(e,t,r){"use strict";r.d(t,"g",(function(){return i})),r.d(t,"f",(function(){return s})),r.d(t,"c",(function(){return a})),r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return p})),r.d(t,"d",(function(){return u})),r.d(t,"e",(function(){return h}));var n=r(13);class i extends n.b{constructor(e,t,r=n.a.Info){super(e,r),this.privJsonResult=t}get jsonString(){return this.privJsonResult}}class o extends n.b{constructor(e,t,r=n.a.Info){super(e,r),this.privConnectionId=t}get connectionId(){return this.privConnectionId}}class s extends o{constructor(e,t,r){super("ConnectionStartEvent",e),this.privUri=t,this.privHeaders=r}get uri(){return this.privUri}get headers(){return this.privHeaders}}class a extends o{constructor(e,t){super("ConnectionEstablishedEvent",e)}}class c extends o{constructor(e,t,r){super("ConnectionClosedEvent",e,n.a.Debug),this.privRreason=r,this.privStatusCode=t}get reason(){return this.privRreason}get statusCode(){return this.privStatusCode}}class p extends o{constructor(e,t,r){super("ConnectionEstablishErrorEvent",e,n.a.Error),this.privStatusCode=t,this.privReason=r}get reason(){return this.privReason}get statusCode(){return this.privStatusCode}}class u extends o{constructor(e,t,r){super("ConnectionMessageReceivedEvent",e),this.privNetworkReceivedTime=t,this.privMessage=r}get networkReceivedTime(){return this.privNetworkReceivedTime}get message(){return this.privMessage}}class h extends o{constructor(e,t,r){super("ConnectionMessageSentEvent",e),this.privNetworkSentTime=t,this.privMessage=r}get networkSentTime(){return this.privNetworkSentTime}get message(){return this.privMessage}}},function(e,t,r){var n=r(135),i=r(41);e.exports=function(e){return n(i(e))}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.getDefaultInputFormat=function(){return s.getDefaultInputFormat()},e.getWaveFormatPCM=function(e,t,r){return new s(e,t,r)},e}();t.AudioStreamFormat=o;var s=function(e){function t(t,r,n){void 0===t&&(t=16e3),void 0===r&&(r=16),void 0===n&&(n=1);var i=e.call(this)||this;i.setString=function(e,t,r){for(var n=0;n<r.length;n++)e.setUint8(t+n,r.charCodeAt(n))},i.formatTag=1,i.bitsPerSample=r,i.samplesPerSec=t,i.channels=n,i.avgBytesPerSec=i.samplesPerSec*i.channels*(i.bitsPerSample/8),i.blockAlign=i.channels*Math.max(i.bitsPerSample,8),i.privHeader=new ArrayBuffer(44);var o=new DataView(i.privHeader);return i.setString(o,0,"RIFF"),o.setUint32(4,0,!0),i.setString(o,8,"WAVEfmt "),o.setUint32(16,16,!0),o.setUint16(20,1,!0),o.setUint16(22,i.channels,!0),o.setUint32(24,i.samplesPerSec,!0),o.setUint32(28,i.avgBytesPerSec,!0),o.setUint16(32,i.channels*(i.bitsPerSample/8),!0),o.setUint16(34,i.bitsPerSample,!0),i.setString(o,36,"data"),o.setUint32(40,0,!0),i}return i(t,e),t.getDefaultInputFormat=function(){return new t},t.prototype.close=function(){},Object.defineProperty(t.prototype,"header",{get:function(){return this.privHeader},enumerable:!0,configurable:!0}),t}(o);t.AudioStreamFormatImpl=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),i=r(0),o=r(36),s=function(){function e(){}return e.prototype.setCommonUrlParams=function(e,t,r){this.setUrlParameter(i.PropertyId.SpeechServiceConnection_EnableAudioLogging,o.QueryParameterNames.EnableAudioLogging,e,t,r),this.setUrlParameter(i.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,o.QueryParameterNames.EnableWordLevelTimestamps,e,t,r),this.setUrlParameter(i.PropertyId.SpeechServiceResponse_ProfanityOption,o.QueryParameterNames.Profanify,e,t,r),this.setUrlParameter(i.PropertyId.SpeechServiceConnection_InitialSilenceTimeoutMs,o.QueryParameterNames.InitialSilenceTimeoutMs,e,t,r),this.setUrlParameter(i.PropertyId.SpeechServiceConnection_EndSilenceTimeoutMs,o.QueryParameterNames.EndSilenceTimeoutMs,e,t,r),this.setUrlParameter(i.PropertyId.SpeechServiceResponse_StablePartialResultThreshold,o.QueryParameterNames.StableIntermediateThreshold,e,t,r);var s=JSON.parse(e.parameters.getProperty(n.ServicePropertiesPropertyName,"{}"));Object.keys(s).forEach((function(e,r,n){t[e]=s[e]}))},e.prototype.setUrlParameter=function(e,t,r,n,i){var o=r.parameters.getProperty(e,void 0);!o||i&&-1!==i.search(t)||(n[t]=o.toLocaleLowerCase())},e}();t.ConnectionFactoryBase=s},function(e,t){e.exports={}},function(e,t,r){var n=r(9),i=r(19),o=r(14),s=r(42),a=r(73),c=r(34),p=c.get,u=c.enforce,h=String(String).split("String");(e.exports=function(e,t,r,a){var c=!!a&&!!a.unsafe,p=!!a&&!!a.enumerable,v=!!a&&!!a.noTargetGet;"function"==typeof r&&("string"!=typeof t||o(r,"name")||i(r,"name",t),u(r).source=h.join("string"==typeof t?t:"")),e!==n?(c?!v&&e[t]&&(p=!0):delete e[t],p?e[t]=r:i(e,t,r)):p?e[t]=r:s(t,r)})(Function.prototype,"toString",(function(){return"function"==typeof this&&p(this).source||a(this)}))},function(e,t,r){var n,i,o,s=r(136),a=r(9),c=r(26),p=r(19),u=r(14),h=r(43),v=r(45),l=a.WeakMap;if(s){var d=new l,f=d.get,g=d.has,y=d.set;n=function(e,t){return y.call(d,e,t),t},i=function(e){return f.call(d,e)||{}},o=function(e){return g.call(d,e)}}else{var m=h("state");v[m]=!0,n=function(e,t){return p(e,m,t),t},i=function(e){return u(e,m)?e[m]:{}},o=function(e){return u(e,m)}}e.exports={set:n,get:i,has:o,enforce:function(e){return o(e)?i(e):n(e,{})},getterFor:function(e){return function(t){var r;if(!c(t)||(r=i(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return r}}}},function(e,t,r){var n=r(9);e.exports=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return Object.defineProperty(e,"TestHooksParamName",{get:function(){return"testhooks"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ConnectionIdHeader",{get:function(){return"X-ConnectionId"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"DeploymentIdParamName",{get:function(){return"cid"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"FormatParamName",{get:function(){return"format"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"LanguageParamName",{get:function(){return"language"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"TranslationFromParamName",{get:function(){return"from"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"TranslationToParamName",{get:function(){return"to"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"Profanify",{get:function(){return"profanity"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"EnableAudioLogging",{get:function(){return"storeAudio"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"EnableWordLevelTimestamps",{get:function(){return"wordLevelTimestamps"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"InitialSilenceTimeoutMs",{get:function(){return"initialSilenceTimeoutMs"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"EndSilenceTimeoutMs",{get:function(){return"endSilenceTimeoutMs"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"StableIntermediateThreshold",{get:function(){return"stableIntermediateThreshold"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"StableTranslation",{get:function(){return"stableTranslation"},enumerable:!0,configurable:!0}),e}();t.QueryParameterNames=n},function(e,t,r){"use strict";function n(e,t){void 0===t&&(t={});var r=function(e){return void 0===e&&(e={}),Object.keys(e).map((function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])})).join("&")}(t);return r?e+(-1===e.indexOf("?")?"?":"&")+r:e}function i(e,t){return void 0===t&&(t=null),{data:t||e.statusText,headers:e.getAllResponseHeaders(),json:function(){return JSON.parse(t||'"'+e.statusText+'"')},ok:!1,status:e.status,statusText:e.statusText}}Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationTranslatorConfig={apiVersion:"2.0",auth:{placeholderRegion:"westus",placeholderSubscriptionKey:"abcdefghijklmnopqrstuvwxyz012345"},clientAppId:"FC539C22-1767-4F1F-84BC-B4D811114F15",defaultLanguageCode:"en-US",defaultRequestOptions:{headers:{Accept:"application/json"},ignoreCache:!1,timeout:5e3},host:"dev.microsofttranslator.com",params:{apiVersion:"api-version",authorization:"Authorization",clientAppId:"X-ClientAppId",correlationId:"X-CorrelationId",languageCode:"language",nickname:"nickname",profanity:"profanity",requestId:"X-RequestId",roomId:"roomid",sessionToken:"token",subscriptionKey:"Ocp-Apim-Subscription-Key",subscriptionRegion:"Ocp-Apim-Subscription-Region",token:"X-CapitoToken"},restPath:"/capito/room",speechHost:"{region}.s2s.speech.microsoft.com",speechPath:"/speech/translation/cognitiveservices/v1",strings:{authInvalidSubscriptionKey:"You must specify either an authentication token to use, or a Cognitive Speech subscription key.",authInvalidSubscriptionRegion:"You must specify the Cognitive Speech region to use.",invalidArgs:"Required input not found: {arg}.",invalidCreateJoinConversationResponse:"Creating/Joining conversation failed with HTTP {status}.",invalidParticipantRequest:"The requested participant was not found.",permissionDeniedConnect:"Required credentials not found.",permissionDeniedConversation:"Invalid operation: only the host can {command} the conversation.",permissionDeniedParticipant:"Invalid operation: only the host can {command} a participant.",permissionDeniedSend:"Invalid operation: the conversation is not in a connected state.",permissionDeniedStart:"Invalid operation: there is already an active conversation."},textMessageMaxLength:1e3,webSocketPath:"/capito/translate"},t.extractHeaderValue=function(e,t){var r="";try{var n=t.trim().split(/[\r\n]+/),i={};n.forEach((function(e){var t=e.split(": "),r=t.shift().toLowerCase(),n=t.join(": ");i[r]=n})),r=i[e.toLowerCase()]}catch(e){}return r},t.request=function(e,r,o,s,a,c){void 0===o&&(o={}),void 0===s&&(s=null),void 0===a&&(a=t.ConversationTranslatorConfig.defaultRequestOptions);var p=a.ignoreCache||t.ConversationTranslatorConfig.defaultRequestOptions.ignoreCache,u=a.headers||t.ConversationTranslatorConfig.defaultRequestOptions.headers,h=a.timeout||t.ConversationTranslatorConfig.defaultRequestOptions.timeout,v=new XMLHttpRequest;v.open(e,n(r,o),!0),u&&Object.keys(u).forEach((function(e){return v.setRequestHeader(e,u[e])})),p&&v.setRequestHeader("Cache-Control","no-cache"),v.timeout=h,v.onload=function(e){c(function(e){return{data:e.responseText,headers:e.getAllResponseHeaders(),json:function(){return JSON.parse(e.responseText)},ok:e.status>=200&&e.status<300,status:e.status,statusText:e.statusText}}(v))},v.onerror=function(e){c(i(v,"Failed to make request."))},v.ontimeout=function(e){c(i(v,"Request took longer than expected."))},"post"===e&&s?(v.setRequestHeader("Content-Type","application/json"),v.send(JSON.stringify(s))):v.send()},t.PromiseToEmptyCallback=function(e,t,r){e?e.continueWith((function(e){try{e.isError?r&&r(e.error):t&&t()}catch(t){r&&r("'Unhandled error on promise callback: "+t+". InnerError: "+e.error+"'")}})):r&&r("Null promise")}},function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(1);class i{constructor(e){if(this.privSubscriptionIdCounter=0,this.privAddSubscriptions={},this.privRemoveSubscriptions={},this.privDisposedSubscriptions={},this.privDisposeReason=null,this.get=e=>(this.throwIfDisposed(),this.privList[e]),this.first=()=>this.get(0),this.last=()=>this.get(this.length()-1),this.add=e=>{this.throwIfDisposed(),this.insertAt(this.privList.length,e)},this.insertAt=(e,t)=>{this.throwIfDisposed(),0===e?this.privList.unshift(t):e===this.privList.length?this.privList.push(t):this.privList.splice(e,0,t),this.triggerSubscriptions(this.privAddSubscriptions)},this.removeFirst=()=>(this.throwIfDisposed(),this.removeAt(0)),this.removeLast=()=>(this.throwIfDisposed(),this.removeAt(this.length()-1)),this.removeAt=e=>(this.throwIfDisposed(),this.remove(e,1)[0]),this.remove=(e,t)=>{this.throwIfDisposed();const r=this.privList.splice(e,t);return this.triggerSubscriptions(this.privRemoveSubscriptions),r},this.clear=()=>{this.throwIfDisposed(),this.remove(0,this.length())},this.length=()=>(this.throwIfDisposed(),this.privList.length),this.onAdded=e=>{this.throwIfDisposed();const t=this.privSubscriptionIdCounter++;return this.privAddSubscriptions[t]=e,{detach:()=>{delete this.privAddSubscriptions[t]}}},this.onRemoved=e=>{this.throwIfDisposed();const t=this.privSubscriptionIdCounter++;return this.privRemoveSubscriptions[t]=e,{detach:()=>{delete this.privRemoveSubscriptions[t]}}},this.onDisposed=e=>{this.throwIfDisposed();const t=this.privSubscriptionIdCounter++;return this.privDisposedSubscriptions[t]=e,{detach:()=>{delete this.privDisposedSubscriptions[t]}}},this.join=e=>(this.throwIfDisposed(),this.privList.join(e)),this.toArray=()=>{const e=Array();return this.privList.forEach(t=>{e.push(t)}),e},this.any=e=>(this.throwIfDisposed(),e?this.where(e).length()>0:this.length()>0),this.all=e=>(this.throwIfDisposed(),this.where(e).length()===this.length()),this.forEach=e=>{this.throwIfDisposed();for(let t=0;t<this.length();t++)e(this.privList[t],t)},this.select=e=>{this.throwIfDisposed();const t=[];for(let r=0;r<this.privList.length;r++)t.push(e(this.privList[r],r));return new i(t)},this.where=e=>{this.throwIfDisposed();const t=new i;for(let r=0;r<this.privList.length;r++)e(this.privList[r],r)&&t.add(this.privList[r]);return t},this.orderBy=e=>{this.throwIfDisposed();const t=this.toArray().sort(e);return new i(t)},this.orderByDesc=e=>(this.throwIfDisposed(),this.orderBy((t,r)=>e(r,t))),this.clone=()=>(this.throwIfDisposed(),new i(this.toArray())),this.concat=e=>(this.throwIfDisposed(),new i(this.privList.concat(e.toArray()))),this.concatArray=e=>(this.throwIfDisposed(),new i(this.privList.concat(e))),this.isDisposed=()=>null==this.privList,this.dispose=e=>{this.isDisposed()||(this.privDisposeReason=e,this.privList=null,this.privAddSubscriptions=null,this.privRemoveSubscriptions=null,this.triggerSubscriptions(this.privDisposedSubscriptions))},this.throwIfDisposed=()=>{if(this.isDisposed())throw new n.c("List",this.privDisposeReason)},this.triggerSubscriptions=e=>{if(e)for(const t in e)t&&e[t]()},this.privList=[],e)for(const t of e)this.privList.push(t)}}var o,s=r(5);!function(e){e[e.Dequeue=0]="Dequeue",e[e.Peek=1]="Peek"}(o||(o={}));class a{constructor(e){this.privPromiseStore=new i,this.privIsDrainInProgress=!1,this.privIsDisposing=!1,this.privDisposeReason=null,this.enqueue=e=>{this.throwIfDispose(),this.enqueueFromPromise(s.c.fromResult(e))},this.enqueueFromPromise=e=>{this.throwIfDispose(),this.privPromiseStore.add(e),e.finally(()=>{for(;this.privPromiseStore.length()>0&&this.privPromiseStore.first().result().isCompleted;){const e=this.privPromiseStore.removeFirst();e.result().isError||this.privList.add(e.result().result)}})},this.dequeue=()=>{this.throwIfDispose();const e=new s.a;return this.privSubscribers&&(this.privSubscribers.add({deferral:e,type:o.Dequeue}),this.drain()),e.promise()},this.peek=()=>{this.throwIfDispose();const e=new s.a;return this.privSubscribers&&(this.privSubscribers.add({deferral:e,type:o.Peek}),this.drain()),e.promise()},this.length=()=>(this.throwIfDispose(),this.privList.length()),this.isDisposed=()=>null==this.privSubscribers,this.drainAndDispose=(e,t)=>{if(!this.isDisposed()&&!this.privIsDisposing){this.privDisposeReason=t,this.privIsDisposing=!0;const r=this.privSubscribers;if(r){for(;r.length()>0;){r.removeFirst().deferral.resolve(void 0)}this.privSubscribers===r&&(this.privSubscribers=r)}for(const e of this.privDetachables)e.detach();if(this.privPromiseStore.length()>0&&e)return s.c.whenAll(this.privPromiseStore.toArray()).continueWith(()=>(this.privSubscribers=null,this.privList.forEach((t,r)=>{e(t)}),this.privList=null,!0));this.privSubscribers=null,this.privList=null}return s.c.fromResult(!0)},this.dispose=e=>{this.drainAndDispose(null,e)},this.drain=()=>{if(!this.privIsDrainInProgress&&!this.privIsDisposing){this.privIsDrainInProgress=!0;const e=this.privSubscribers,t=this.privList;if(e&&t){for(;t.length()>0&&e.length()>0&&!this.privIsDisposing;){const r=e.removeFirst();if(r.type===o.Peek)r.deferral.resolve(t.first());else{const e=t.removeFirst();r.deferral.resolve(e)}}this.privSubscribers===e&&(this.privSubscribers=e),this.privList===t&&(this.privList=t)}this.privIsDrainInProgress=!1}},this.throwIfDispose=()=>{if(this.isDisposed()){if(this.privDisposeReason)throw new n.b(this.privDisposeReason);throw new n.c("Queue")}if(this.privIsDisposing)throw new n.b("Queue disposing")},this.privList=e||new i,this.privDetachables=[],this.privSubscribers=new i,this.privDetachables.push(this.privList.onAdded(this.drain))}}},function(e,t,r){var n=r(9),i=r(67).f,o=r(19),s=r(33),a=r(42),c=r(137),p=r(143);e.exports=function(e,t){var r,u,h,v,l,d=e.target,f=e.global,g=e.stat;if(r=f?n:g?n[d]||a(d,{}):(n[d]||{}).prototype)for(u in t){if(v=t[u],h=e.noTargetGet?(l=i(r,u))&&l.value:r[u],!p(f?u:d+(g?".":"#")+u,e.forced)&&void 0!==h){if(typeof v==typeof h)continue;c(v,h)}(e.sham||h&&h.sham)&&o(v,"sham",!0),s(r,u,v,e)}}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e}},function(e,t,r){var n=r(9),i=r(19);e.exports=function(e,t){try{i(n,e,t)}catch(r){n[e]=t}return t}},function(e,t,r){var n=r(75),i=r(76),o=n("keys");e.exports=function(e){return o[e]||(o[e]=i(e))}},function(e,t){e.exports=!1},function(e,t){e.exports={}},function(e,t,r){var n=r(35),i=r(9),o=function(e){return"function"==typeof e?e:void 0};e.exports=function(e,t){return arguments.length<2?o(n[e])||o(i[e]):n[e]&&n[e][t]||i[e]&&i[e][t]}},function(e,t){var r=Math.ceil,n=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?n:r)(e)}},function(e,t){e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(21);!function(e){e[e.Debug=0]="Debug",e[e.Info=1]="Info",e[e.Warning=2]="Warning",e[e.Error=3]="Error"}(t.EventType||(t.EventType={}));var i=function(){function e(e,t){this.privName=e,this.privEventId=n.createNoDashGuid(),this.privEventTime=(new Date).toISOString(),this.privEventType=t,this.privMetadata={}}return Object.defineProperty(e.prototype,"name",{get:function(){return this.privName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"eventId",{get:function(){return this.privEventId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"eventTime",{get:function(){return this.privEventTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"eventType",{get:function(){return this.privEventType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return this.privMetadata},enumerable:!0,configurable:!0}),e}();t.PlatformEvent=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=r(12);!function(e){e[e.None=0]="None",e[e.Resolved=1]="Resolved",e[e.Rejected=2]="Rejected"}(n=t.PromiseState||(t.PromiseState={}));var o=function(){function e(e){var t=this;this.throwIfError=function(){if(t.isError)throw t.error},e.on((function(e){t.privIsCompleted||(t.privIsCompleted=!0,t.privIsError=!1,t.privResult=e)}),(function(e){t.privIsCompleted||(t.privIsCompleted=!0,t.privIsError=!0,t.privError=e)}))}return Object.defineProperty(e.prototype,"isCompleted",{get:function(){return this.privIsCompleted},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isError",{get:function(){return this.privIsError},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"error",{get:function(){return this.privError},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"result",{get:function(){return this.privResult},enumerable:!0,configurable:!0}),e}();t.PromiseResult=o;var s=function(){var e=this;this.setResult=function(t){e.privOnSetResult(t)},this.setError=function(t){e.privOnSetError(t)},this.on=function(t,r){e.privOnSetResult=t,e.privOnSetError=r}};t.PromiseResultEventSource=s;var a=function(){function e(){}return e.whenAll=function(e){if(!e||0===e.length)throw new i.ArgumentNullError("promises");for(var t=new p,r=[],n=0,o=function(){++n===e.length&&(0===r.length?t.resolve(!0):t.reject(r.join(", ")))},s=0,a=e;s<a.length;s++){a[s].on((function(e){o()}),(function(e){r.push(e),o()}))}return t.promise()},e.fromResult=function(e){var t=new p;return t.resolve(e),t.promise()},e.fromError=function(e){var t=new p;return t.reject(e),t.promise()},e}();t.PromiseHelper=a;var c=function(e){var t=this;this.result=function(){return t.privSink.result},this.continueWith=function(e){if(!e)throw new i.ArgumentNullError("continuationCallback");var r=new p;return t.privSink.on((function(n){try{var i=e(t.privSink.result);r.resolve(i)}catch(e){r.reject(e)}}),(function(n){try{var i=e(t.privSink.result);r.resolve(i)}catch(e){r.reject("'Error handler for error "+n+" threw error "+e+"'")}})),r.promise()},this.onSuccessContinueWith=function(e){if(!e)throw new i.ArgumentNullError("continuationCallback");var r=new p;return t.privSink.on((function(t){try{var n=e(t);r.resolve(n)}catch(e){r.reject(e)}}),(function(e){r.reject(e)})),r.promise()},this.continueWithPromise=function(e){if(!e)throw new i.ArgumentNullError("continuationCallback");var r=new p;return t.privSink.on((function(n){try{var i=e(t.privSink.result);if(!i)throw new Error("'Continuation callback did not return promise'");i.on((function(e){r.resolve(e)}),(function(e){r.reject(e)}))}catch(e){r.reject(e)}}),(function(n){try{var i=e(t.privSink.result);if(!i)throw new Error("Continuation callback did not return promise");i.on((function(e){r.resolve(e)}),(function(e){r.reject(e)}))}catch(e){r.reject("'Error handler for error "+n+" threw error "+e+"'")}})),r.promise()},this.onSuccessContinueWithPromise=function(e){if(!e)throw new i.ArgumentNullError("continuationCallback");var r=new p;return t.privSink.on((function(t){try{var n=e(t);if(!n)throw new Error("Continuation callback did not return promise");n.on((function(e){r.resolve(e)}),(function(e){r.reject(e)}))}catch(e){r.reject(e)}}),(function(e){r.reject(e)})),r.promise()},this.on=function(e,r){if(!e)throw new i.ArgumentNullError("successCallback");if(!r)throw new i.ArgumentNullError("errorCallback");return t.privSink.on(e,r),t},this.finally=function(e){if(!e)throw new i.ArgumentNullError("callback");var r=function(t){e()};return t.on(r,r)},this.privSink=e};t.Promise=c;var p=function(){var e=this;this.state=function(){return e.privSink.state},this.promise=function(){return e.privPromise},this.resolve=function(t){return e.privSink.resolve(t),e},this.reject=function(t){return e.privSink.reject(t),e},this.privSink=new u,this.privPromise=new c(this.privSink)};t.Deferred=p;var u=function(){function e(){var e=this;this.privState=n.None,this.privPromiseResult=null,this.privPromiseResultEvents=null,this.privSuccessHandlers=[],this.privErrorHandlers=[],this.resolve=function(t){if(e.privState!==n.None)throw new Error("'Cannot resolve a completed promise'");e.privState=n.Resolved,e.privPromiseResultEvents.setResult(t);for(var r=0;r<e.privSuccessHandlers.length;r++)e.executeSuccessCallback(t,e.privSuccessHandlers[r],e.privErrorHandlers[r]);e.detachHandlers()},this.reject=function(t){if(e.privState!==n.None)throw new Error("'Cannot reject a completed promise'");e.privState=n.Rejected,e.privPromiseResultEvents.setError(t);for(var r=0,i=e.privErrorHandlers;r<i.length;r++){var o=i[r];e.executeErrorCallback(t,o)}e.detachHandlers()},this.on=function(t,r){null==t&&(t=function(e){}),e.privState===n.None?(e.privSuccessHandlers.push(t),e.privErrorHandlers.push(r)):(e.privState===n.Resolved?e.executeSuccessCallback(e.privPromiseResult.result,t,r):e.privState===n.Rejected&&e.executeErrorCallback(e.privPromiseResult.error,r),e.detachHandlers())},this.executeSuccessCallback=function(t,r,n){try{r(t)}catch(t){e.executeErrorCallback("'Unhandled callback error: "+t+"'",n)}},this.executeErrorCallback=function(e,t){if(!t)throw new Error("'Unhandled error: "+e+"'");try{t(e)}catch(t){throw new Error("'Unhandled callback error: "+t+". InnerError: "+e+"'")}},this.detachHandlers=function(){e.privErrorHandlers=[],e.privSuccessHandlers=[]},this.privPromiseResultEvents=new s,this.privPromiseResult=new o(this.privPromiseResultEvents)}return Object.defineProperty(e.prototype,"state",{get:function(){return this.privState},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"result",{get:function(){return this.privPromiseResult},enumerable:!0,configurable:!0}),e}();t.Sink=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Success=0]="Success",e[e.Error=1]="Error"}(t.TranslationStatus||(t.TranslationStatus={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this.privHeaderName=e,this.privToken=t}return Object.defineProperty(e.prototype,"headerName",{get:function(){return this.privHeaderName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"token",{get:function(){return this.privToken},enumerable:!0,configurable:!0}),e}();t.AuthInfo=n},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(6),s=r(0),a=function(){};t.DialogServiceConfig=a;var c=function(e){function t(){var t=e.call(this)||this;return t.privSpeechConfig=new s.SpeechConfigImpl,t}return i(t,e),Object.defineProperty(t.prototype,"properties",{get:function(){return this.privSpeechConfig.properties},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"speechRecognitionLanguage",{get:function(){return this.privSpeechConfig.speechRecognitionLanguage},set:function(e){o.Contracts.throwIfNullOrWhitespace(e,"value"),this.privSpeechConfig.speechRecognitionLanguage=e},enumerable:!0,configurable:!0}),t.prototype.setProperty=function(e,t){this.privSpeechConfig.setProperty(e,t)},t.prototype.getProperty=function(e,t){return this.privSpeechConfig.getProperty(e)},t.prototype.setProxy=function(e,t,r,n){this.setProperty(s.PropertyId.SpeechServiceConnection_ProxyHostName,e),this.setProperty(s.PropertyId.SpeechServiceConnection_ProxyPort,""+t),r&&this.setProperty(s.PropertyId.SpeechServiceConnection_ProxyUserName,r),n&&this.setProperty(s.PropertyId.SpeechServiceConnection_ProxyPassword,n)},t.prototype.setServiceProperty=function(e,t,r){this.privSpeechConfig.setServiceProperty(e,t,r)},t.prototype.close=function(){},t}(a);t.DialogServiceConfigImpl=c},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(3),s=function(e){function t(t,r,n,i){void 0===i&&(i=o.EventType.Info);var s=e.call(this,t,i)||this;return s.privRequestId=r,s.privSessionId=n,s}return i(t,e),Object.defineProperty(t.prototype,"requestId",{get:function(){return this.privRequestId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sessionId",{get:function(){return this.privSessionId},enumerable:!0,configurable:!0}),t}(o.PlatformEvent);t.SpeechRecognitionEvent=s;var a=function(e){function t(t,r,n,i){var o=e.call(this,"RecognitionTriggeredEvent",t,r)||this;return o.privAudioSourceId=n,o.privAudioNodeId=i,o}return i(t,e),Object.defineProperty(t.prototype,"audioSourceId",{get:function(){return this.privAudioSourceId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"audioNodeId",{get:function(){return this.privAudioNodeId},enumerable:!0,configurable:!0}),t}(s);t.RecognitionTriggeredEvent=a;var c=function(e){function t(t,r,n,i){var o=e.call(this,"ListeningStartedEvent",t,r)||this;return o.privAudioSourceId=n,o.privAudioNodeId=i,o}return i(t,e),Object.defineProperty(t.prototype,"audioSourceId",{get:function(){return this.privAudioSourceId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"audioNodeId",{get:function(){return this.privAudioNodeId},enumerable:!0,configurable:!0}),t}(s);t.ListeningStartedEvent=c;var p=function(e){function t(t,r,n){var i=e.call(this,"ConnectingToServiceEvent",t,n)||this;return i.privAuthFetchEventid=r,i}return i(t,e),Object.defineProperty(t.prototype,"authFetchEventid",{get:function(){return this.privAuthFetchEventid},enumerable:!0,configurable:!0}),t}(s);t.ConnectingToServiceEvent=p;var u,h=function(e){function t(t,r,n,i,o){var s=e.call(this,"RecognitionStartedEvent",t,o)||this;return s.privAudioSourceId=r,s.privAudioNodeId=n,s.privAuthFetchEventId=i,s}return i(t,e),Object.defineProperty(t.prototype,"audioSourceId",{get:function(){return this.privAudioSourceId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"audioNodeId",{get:function(){return this.privAudioNodeId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"authFetchEventId",{get:function(){return this.privAuthFetchEventId},enumerable:!0,configurable:!0}),t}(s);t.RecognitionStartedEvent=h,function(e){e[e.Success=0]="Success",e[e.AudioSourceError=1]="AudioSourceError",e[e.AudioSourceTimeout=2]="AudioSourceTimeout",e[e.AuthTokenFetchError=3]="AuthTokenFetchError",e[e.AuthTokenFetchTimeout=4]="AuthTokenFetchTimeout",e[e.UnAuthorized=5]="UnAuthorized",e[e.ConnectTimeout=6]="ConnectTimeout",e[e.ConnectError=7]="ConnectError",e[e.ClientRecognitionActivityTimeout=8]="ClientRecognitionActivityTimeout",e[e.UnknownError=9]="UnknownError"}(u=t.RecognitionCompletionStatus||(t.RecognitionCompletionStatus={}));var v=function(e){function t(t,r,n,i,s,a,c,p){var h=e.call(this,"RecognitionEndedEvent",t,s,c===u.Success?o.EventType.Info:o.EventType.Error)||this;return h.privAudioSourceId=r,h.privAudioNodeId=n,h.privAuthFetchEventId=i,h.privStatus=c,h.privError=p,h.privServiceTag=a,h}return i(t,e),Object.defineProperty(t.prototype,"audioSourceId",{get:function(){return this.privAudioSourceId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"audioNodeId",{get:function(){return this.privAudioNodeId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"authFetchEventId",{get:function(){return this.privAuthFetchEventId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"serviceTag",{get:function(){return this.privServiceTag},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"status",{get:function(){return this.privStatus},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"error",{get:function(){return this.privError},enumerable:!0,configurable:!0}),t}(s);t.RecognitionEndedEvent=v},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){void 0===e&&(e=[]),this.participants=e,this.meId=t}return e.prototype.addOrUpdateParticipant=function(e){if(void 0!==e){var t=this.getParticipantIndex(e.id);return t>-1?this.participants.splice(t,1,e):this.participants.push(e),this.getParticipant(e.id)}},e.prototype.getParticipantIndex=function(e){return this.participants.findIndex((function(t){return t.id===e}))},e.prototype.getParticipant=function(e){return this.participants.find((function(t){return t.id===e}))},e.prototype.deleteParticipant=function(e){this.participants=this.participants.filter((function(t){return t.id!==e}))},Object.defineProperty(e.prototype,"host",{get:function(){return this.participants.find((function(e){return!0===e.isHost}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"me",{get:function(){return this.getParticipant(this.meId)},enumerable:!0,configurable:!0}),e}();t.InternalParticipants=n,t.ConversationTranslatorMessageTypes={command:"command",final:"final",info:"info",instantMessage:"instant_message",partial:"partial",participantCommand:"participant_command",translatedMessage:"translated_message"},t.ConversationTranslatorCommandTypes={changeNickname:"ChangeNickname",disconnectSession:"DisconnectSession",ejectParticipant:"EjectParticipant",instant_message:"instant_message",joinSession:"JoinSession",leaveSession:"LeaveSession",participantList:"ParticipantList",roomExpirationWarning:"RoomExpirationWarning",setLockState:"SetLockState",setMute:"SetMute",setMuteAll:"SetMuteAll",setProfanityFiltering:"SetProfanityFiltering",setTranslateToLanguages:"SetTranslateToLanguages",setUseTTS:"SetUseTTS"}},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){e.exports=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}},function(e,t){e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}r.r(t),r.d(t,"defineEventAttribute",(function(){return y})),r.d(t,"EventTarget",(function(){return C}));var i=new WeakMap,o=new WeakMap;function s(e){var t=i.get(e);return console.assert(null!=t,"'this' is expected an Event object, but got",e),t}function a(e){null==e.passiveListener?e.event.cancelable&&(e.canceled=!0,"function"==typeof e.event.preventDefault&&e.event.preventDefault()):"undefined"!=typeof console&&"function"==typeof console.error&&console.error("Unable to preventDefault inside passive event listener invocation.",e.passiveListener)}function c(e,t){i.set(this,{eventTarget:e,event:t,eventPhase:2,currentTarget:e,canceled:!1,stopped:!1,immediateStopped:!1,passiveListener:null,timeStamp:t.timeStamp||Date.now()}),Object.defineProperty(this,"isTrusted",{value:!1,enumerable:!0});for(var r=Object.keys(t),n=0;n<r.length;++n){var o=r[n];o in this||Object.defineProperty(this,o,p(o))}}function p(e){return{get:function(){return s(this).event[e]},set:function(t){s(this).event[e]=t},configurable:!0,enumerable:!0}}function u(e){return{value:function(){var t=s(this).event;return t[e].apply(t,arguments)},configurable:!0,enumerable:!0}}function h(e){if(null==e||e===Object.prototype)return c;var t=o.get(e);return null==t&&(t=function(e,t){var r=Object.keys(t);if(0===r.length)return e;function n(t,r){e.call(this,t,r)}n.prototype=Object.create(e.prototype,{constructor:{value:n,configurable:!0,writable:!0}});for(var i=0;i<r.length;++i){var o=r[i];if(!(o in e.prototype)){var s="function"==typeof Object.getOwnPropertyDescriptor(t,o).value;Object.defineProperty(n.prototype,o,s?u(o):p(o))}}return n}(h(Object.getPrototypeOf(e)),e),o.set(e,t)),t}function v(e){return s(e).immediateStopped}function l(e,t){s(e).passiveListener=t}c.prototype={get type(){return s(this).event.type},get target(){return s(this).eventTarget},get currentTarget(){return s(this).currentTarget},composedPath:function(){var e=s(this).currentTarget;return null==e?[]:[e]},get NONE(){return 0},get CAPTURING_PHASE(){return 1},get AT_TARGET(){return 2},get BUBBLING_PHASE(){return 3},get eventPhase(){return s(this).eventPhase},stopPropagation:function(){var e=s(this);e.stopped=!0,"function"==typeof e.event.stopPropagation&&e.event.stopPropagation()},stopImmediatePropagation:function(){var e=s(this);e.stopped=!0,e.immediateStopped=!0,"function"==typeof e.event.stopImmediatePropagation&&e.event.stopImmediatePropagation()},get bubbles(){return Boolean(s(this).event.bubbles)},get cancelable(){return Boolean(s(this).event.cancelable)},preventDefault:function(){a(s(this))},get defaultPrevented(){return s(this).canceled},get composed(){return Boolean(s(this).event.composed)},get timeStamp(){return s(this).timeStamp},get srcElement(){return s(this).eventTarget},get cancelBubble(){return s(this).stopped},set cancelBubble(e){if(e){var t=s(this);t.stopped=!0,"boolean"==typeof t.event.cancelBubble&&(t.event.cancelBubble=!0)}},get returnValue(){return!s(this).canceled},set returnValue(e){e||a(s(this))},initEvent:function(){}},Object.defineProperty(c.prototype,"constructor",{value:c,configurable:!0,writable:!0}),"undefined"!=typeof window&&void 0!==window.Event&&(Object.setPrototypeOf(c.prototype,window.Event.prototype),o.set(window.Event.prototype,c));var d=new WeakMap;function f(e){return null!==e&&"object"===n(e)}function g(e){var t=d.get(e);if(null==t)throw new TypeError("'this' is expected an EventTarget object, but got another value.");return t}function y(e,t){Object.defineProperty(e,"on".concat(t),function(e){return{get:function(){for(var t=g(this).get(e);null!=t;){if(3===t.listenerType)return t.listener;t=t.next}return null},set:function(t){"function"==typeof t||f(t)||(t=null);for(var r=g(this),n=null,i=r.get(e);null!=i;)3===i.listenerType?null!==n?n.next=i.next:null!==i.next?r.set(e,i.next):r.delete(e):n=i,i=i.next;if(null!==t){var o={listener:t,listenerType:3,passive:!1,once:!1,next:null};null===n?r.set(e,o):n.next=o}},configurable:!0,enumerable:!0}}(t))}function m(e){function t(){S.call(this)}t.prototype=Object.create(S.prototype,{constructor:{value:t,configurable:!0,writable:!0}});for(var r=0;r<e.length;++r)y(t.prototype,e[r]);return t}function S(){if(!(this instanceof S)){if(1===arguments.length&&Array.isArray(arguments[0]))return m(arguments[0]);if(arguments.length>0){for(var e=new Array(arguments.length),t=0;t<arguments.length;++t)e[t]=arguments[t];return m(e)}throw new TypeError("Cannot call a class as a function")}d.set(this,new Map)}S.prototype={addEventListener:function(e,t,r){if(null!=t){if("function"!=typeof t&&!f(t))throw new TypeError("'listener' should be a function or an object.");var n=g(this),i=f(r),o=(i?Boolean(r.capture):Boolean(r))?1:2,s={listener:t,listenerType:o,passive:i&&Boolean(r.passive),once:i&&Boolean(r.once),next:null},a=n.get(e);if(void 0!==a){for(var c=null;null!=a;){if(a.listener===t&&a.listenerType===o)return;c=a,a=a.next}c.next=s}else n.set(e,s)}},removeEventListener:function(e,t,r){if(null!=t)for(var n=g(this),i=(f(r)?Boolean(r.capture):Boolean(r))?1:2,o=null,s=n.get(e);null!=s;){if(s.listener===t&&s.listenerType===i)return void(null!==o?o.next=s.next:null!==s.next?n.set(e,s.next):n.delete(e));o=s,s=s.next}},dispatchEvent:function(e){if(null==e||"string"!=typeof e.type)throw new TypeError('"event.type" should be a string.');var t=g(this),r=e.type,n=t.get(r);if(null==n)return!0;for(var i=function(e,t){return new(h(Object.getPrototypeOf(t)))(e,t)}(this,e),o=null;null!=n;){if(n.once?null!==o?o.next=n.next:null!==n.next?t.set(r,n.next):t.delete(r):o=n,l(i,n.passive?n.listener:null),"function"==typeof n.listener)try{n.listener.call(this,i)}catch(e){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(e)}else 3!==n.listenerType&&"function"==typeof n.listener.handleEvent&&n.listener.handleEvent(i);if(v(i))break;n=n.next}return l(i,null),function(e,t){s(e).eventPhase=t}(i,0),function(e,t){s(e).currentTarget=t}(i,null),!i.defaultPrevented}},Object.defineProperty(S.prototype,"constructor",{value:S,configurable:!0,writable:!0}),"undefined"!=typeof window&&void 0!==window.EventTarget&&Object.setPrototypeOf(S.prototype,window.EventTarget.prototype);var C=S;t.default=C}])},function(e,t){e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t,r){"use strict";e.exports=function(){var e={};return e.promise=new Promise((function(t,r){e.resolve=t,e.reject=r})),e}},function(e,t,r){"use strict";r.r(t);var n=r(0),i=r.n(n);t.default=i.a}])},function(e,t){e.exports=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}},function(e,t,r){var n={};n[r(10)("toStringTag")]="z",e.exports="[object z]"===String(n)},function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r(1),i=r(7);class o{constructor(e){this.privEventListeners={},this.privIsDisposed=!1,this.onEvent=e=>{if(this.isDisposed())throw new n.c("EventSource");if(this.metadata)for(const t in this.metadata)t&&e.metadata&&(e.metadata[t]||(e.metadata[t]=this.metadata[t]));for(const t in this.privEventListeners)t&&this.privEventListeners[t]&&this.privEventListeners[t](e)},this.attach=e=>{const t=Object(i.b)();return this.privEventListeners[t]=e,{detach:()=>{delete this.privEventListeners[t]}}},this.attachListener=e=>this.attach(e.onEvent),this.isDisposed=()=>this.privIsDisposed,this.dispose=()=>{this.privEventListeners=null,this.privIsDisposed=!0},this.privMetadata=e}get metadata(){return this.privMetadata}}},function(e,t){},function(e,t){},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));class n{constructor(e,t){this.privStatusCode=e,this.privReason=t}get statusCode(){return this.privStatusCode}get reason(){return this.privReason}}},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){var n=r(18),i=r(68),o=r(40),s=r(29),a=r(70),c=r(14),p=r(71),u=Object.getOwnPropertyDescriptor;t.f=n?u:function(e,t){if(e=s(e),t=a(t,!0),p)try{return u(e,t)}catch(e){}if(c(e,t))return o(!i.f.call(e,t),e[t])}},function(e,t,r){"use strict";var n={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,o=i&&!n.call({1:2},1);t.f=o?function(e){var t=i(this,e);return!!t&&t.enumerable}:n},function(e,t){var r={}.toString;e.exports=function(e){return r.call(e).slice(8,-1)}},function(e,t,r){var n=r(26);e.exports=function(e,t){if(!n(e))return e;var r,i;if(t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;if("function"==typeof(r=e.valueOf)&&!n(i=r.call(e)))return i;if(!t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t,r){var n=r(18),i=r(25),o=r(72);e.exports=!n&&!i((function(){return 7!=Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a}))},function(e,t,r){var n=r(9),i=r(26),o=n.document,s=i(o)&&i(o.createElement);e.exports=function(e){return s?o.createElement(e):{}}},function(e,t,r){var n=r(74),i=Function.toString;"function"!=typeof n.inspectSource&&(n.inspectSource=function(e){return i.call(e)}),e.exports=n.inspectSource},function(e,t,r){var n=r(9),i=r(42),o=n["__core-js_shared__"]||i("__core-js_shared__",{});e.exports=o},function(e,t,r){var n=r(44),i=r(74);(e.exports=function(e,t){return i[e]||(i[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.6.5",mode:n?"pure":"global",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"})},function(e,t){var r=0,n=Math.random();e.exports=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++r+n).toString(36)}},function(e,t,r){var n=r(14),i=r(29),o=r(140).indexOf,s=r(45);e.exports=function(e,t){var r,a=i(e),c=0,p=[];for(r in a)!n(s,r)&&n(a,r)&&p.push(r);for(;t.length>c;)n(a,r=t[c++])&&(~o(p,r)||p.push(r));return p}},function(e,t,r){var n=r(47),i=Math.min;e.exports=function(e){return e>0?i(n(e),9007199254740991):0}},function(e,t,r){var n=r(77),i=r(48);e.exports=Object.keys||function(e){return n(e,i)}},function(e,t,r){var n=function(e){"use strict";var t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",s=n.toStringTag||"@@toStringTag";function a(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{a({},"")}catch(e){a=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var i=t&&t.prototype instanceof h?t:h,o=Object.create(i.prototype),s=new R(n||[]);return o._invoke=function(e,t,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return w()}for(r.method=i,r.arg=o;;){var s=r.delegate;if(s){var a=C(s,r);if(a){if(a===u)continue;return a}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=p(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(e,r,s),o}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var u={};function h(){}function v(){}function l(){}var d={};d[i]=function(){return this};var f=Object.getPrototypeOf,g=f&&f(f(I([])));g&&g!==t&&r.call(g,i)&&(d=g);var y=l.prototype=h.prototype=Object.create(d);function m(e){["next","throw","return"].forEach((function(t){a(e,t,(function(e){return this._invoke(t,e)}))}))}function S(e,t){var n;this._invoke=function(i,o){function s(){return new t((function(n,s){!function n(i,o,s,a){var c=p(e[i],e,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==typeof h&&r.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,s,a)}),(function(e){n("throw",e,s,a)})):t.resolve(h).then((function(e){u.value=e,s(u)}),(function(e){return n("throw",e,s,a)}))}a(c.arg)}(i,o,n,s)}))}return n=n?n.then(s,s):s()}}function C(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,C(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var n=p(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,u;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function b(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function R(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(b,this),this.reset(!0)}function I(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:w}}function w(){return{value:void 0,done:!0}}return v.prototype=y.constructor=l,l.constructor=v,v.displayName=a(l,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,a(e,s,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},m(S.prototype),S.prototype[o]=function(){return this},e.AsyncIterator=S,e.async=function(t,r,n,i,o){void 0===o&&(o=Promise);var s=new S(c(t,r,n,i),o);return e.isGeneratorFunction(r)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},m(y),a(y,s,"Generator"),y[i]=function(){return this},y.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=I,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(P),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return s.type="throw",s.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],s=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var a=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(a&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),P(r),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;P(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:I(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),u}},e}(e.exports);try{regeneratorRuntime=n}catch(e){Function("r","regeneratorRuntime = r")(n)}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(16),s=r(6),a=r(0),c=r(86),p=function(){function e(){}return e.fromDefaultMicrophoneInput=function(){var e=new o.PcmRecorder;return new u(new o.MicAudioSource(e))},e.fromMicrophoneInput=function(e){var t=new o.PcmRecorder;return new u(new o.MicAudioSource(t,e))},e.fromWavFileInput=function(e){return new u(new o.FileAudioSource(e))},e.fromStreamInput=function(e){if(e instanceof a.PullAudioInputStreamCallback)return new u(new c.PullAudioInputStreamImpl(e));if(e instanceof a.AudioInputStream)return new u(e);throw new Error("Not Supported Type")},e}();t.AudioConfig=p;var u=function(e){function t(t){var r=e.call(this)||this;return r.privSource=t,r}return i(t,e),Object.defineProperty(t.prototype,"format",{get:function(){return this.privSource.format},enumerable:!0,configurable:!0}),t.prototype.close=function(){this.privSource.turnOff()},t.prototype.id=function(){return this.privSource.id()},t.prototype.turnOn=function(){return this.privSource.turnOn()},t.prototype.attach=function(e){return this.privSource.attach(e)},t.prototype.detach=function(e){return this.privSource.detach(e)},t.prototype.turnOff=function(){return this.privSource.turnOff()},Object.defineProperty(t.prototype,"events",{get:function(){return this.privSource.events},enumerable:!0,configurable:!0}),t.prototype.setProperty=function(e,t){if(s.Contracts.throwIfNull(t,"value"),void 0===this.privSource.setProperty)throw new Error("This AudioConfig instance does not support setting properties.");this.privSource.setProperty(e,t)},t.prototype.getProperty=function(e,t){if(void 0!==this.privSource.getProperty)return this.privSource.getProperty(e,t);throw new Error("This AudioConfig instance does not support getting properties.")},Object.defineProperty(t.prototype,"deviceInfo",{get:function(){return this.privSource.deviceInfo},enumerable:!0,configurable:!0}),t}(p);t.AudioConfigImpl=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=r(12),o=r(21);!function(e){e[e.Text=0]="Text",e[e.Binary=1]="Binary"}(n=t.MessageType||(t.MessageType={}));var s=function(){function e(e,t,r,s){if(this.privBody=null,e===n.Text&&t&&"string"!=typeof t)throw new i.InvalidOperationError("Payload must be a string");if(e===n.Binary&&t&&!(t instanceof ArrayBuffer))throw new i.InvalidOperationError("Payload must be ArrayBuffer");switch(this.privMessageType=e,this.privBody=t,this.privHeaders=r||{},this.privId=s||o.createNoDashGuid(),this.messageType){case n.Binary:this.privSize=null!==this.binaryBody?this.binaryBody.byteLength:0;break;case n.Text:this.privSize=this.textBody.length}}return Object.defineProperty(e.prototype,"messageType",{get:function(){return this.privMessageType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"headers",{get:function(){return this.privHeaders},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"body",{get:function(){return this.privBody},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textBody",{get:function(){if(this.privMessageType===n.Binary)throw new i.InvalidOperationError("Not supported for binary message");return this.privBody},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"binaryBody",{get:function(){if(this.privMessageType===n.Text)throw new i.InvalidOperationError("Not supported for text message");return this.privBody},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.privId},enumerable:!0,configurable:!0}),e}();t.ConnectionMessage=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(12),i=r(21),o=function(){function e(e){var t=this;this.privEventListeners={},this.privIsDisposed=!1,this.onEvent=function(e){if(t.isDisposed())throw new n.ObjectDisposedError("EventSource");if(t.metadata)for(var r in t.metadata)r&&e.metadata&&(e.metadata[r]||(e.metadata[r]=t.metadata[r]));for(var i in t.privEventListeners)i&&t.privEventListeners[i]&&t.privEventListeners[i](e)},this.attach=function(e){var r=i.createNoDashGuid();return t.privEventListeners[r]=e,{detach:function(){delete t.privEventListeners[r]}}},this.attachListener=function(e){return t.attach(e.onEvent)},this.isDisposed=function(){return t.privIsDisposed},this.dispose=function(){t.privEventListeners=null,t.privIsDisposed=!0},this.privMetadata=e}return Object.defineProperty(e.prototype,"metadata",{get:function(){return this.privMetadata},enumerable:!0,configurable:!0}),e}();t.EventSource=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(12),i=function e(t){var r=this;if(this.privSubscriptionIdCounter=0,this.privAddSubscriptions={},this.privRemoveSubscriptions={},this.privDisposedSubscriptions={},this.privDisposeReason=null,this.get=function(e){return r.throwIfDisposed(),r.privList[e]},this.first=function(){return r.get(0)},this.last=function(){return r.get(r.length()-1)},this.add=function(e){r.throwIfDisposed(),r.insertAt(r.privList.length,e)},this.insertAt=function(e,t){r.throwIfDisposed(),0===e?r.privList.unshift(t):e===r.privList.length?r.privList.push(t):r.privList.splice(e,0,t),r.triggerSubscriptions(r.privAddSubscriptions)},this.removeFirst=function(){return r.throwIfDisposed(),r.removeAt(0)},this.removeLast=function(){return r.throwIfDisposed(),r.removeAt(r.length()-1)},this.removeAt=function(e){return r.throwIfDisposed(),r.remove(e,1)[0]},this.remove=function(e,t){r.throwIfDisposed();var n=r.privList.splice(e,t);return r.triggerSubscriptions(r.privRemoveSubscriptions),n},this.clear=function(){r.throwIfDisposed(),r.remove(0,r.length())},this.length=function(){return r.throwIfDisposed(),r.privList.length},this.onAdded=function(e){r.throwIfDisposed();var t=r.privSubscriptionIdCounter++;return r.privAddSubscriptions[t]=e,{detach:function(){delete r.privAddSubscriptions[t]}}},this.onRemoved=function(e){r.throwIfDisposed();var t=r.privSubscriptionIdCounter++;return r.privRemoveSubscriptions[t]=e,{detach:function(){delete r.privRemoveSubscriptions[t]}}},this.onDisposed=function(e){r.throwIfDisposed();var t=r.privSubscriptionIdCounter++;return r.privDisposedSubscriptions[t]=e,{detach:function(){delete r.privDisposedSubscriptions[t]}}},this.join=function(e){return r.throwIfDisposed(),r.privList.join(e)},this.toArray=function(){var e=Array();return r.privList.forEach((function(t){e.push(t)})),e},this.any=function(e){return r.throwIfDisposed(),e?r.where(e).length()>0:r.length()>0},this.all=function(e){return r.throwIfDisposed(),r.where(e).length()===r.length()},this.forEach=function(e){r.throwIfDisposed();for(var t=0;t<r.length();t++)e(r.privList[t],t)},this.select=function(t){r.throwIfDisposed();for(var n=[],i=0;i<r.privList.length;i++)n.push(t(r.privList[i],i));return new e(n)},this.where=function(t){r.throwIfDisposed();for(var n=new e,i=0;i<r.privList.length;i++)t(r.privList[i],i)&&n.add(r.privList[i]);return n},this.orderBy=function(t){return r.throwIfDisposed(),new e(r.toArray().sort(t))},this.orderByDesc=function(e){return r.throwIfDisposed(),r.orderBy((function(t,r){return e(r,t)}))},this.clone=function(){return r.throwIfDisposed(),new e(r.toArray())},this.concat=function(t){return r.throwIfDisposed(),new e(r.privList.concat(t.toArray()))},this.concatArray=function(t){return r.throwIfDisposed(),new e(r.privList.concat(t))},this.isDisposed=function(){return null==r.privList},this.dispose=function(e){r.isDisposed()||(r.privDisposeReason=e,r.privList=null,r.privAddSubscriptions=null,r.privRemoveSubscriptions=null,r.triggerSubscriptions(r.privDisposedSubscriptions))},this.throwIfDisposed=function(){if(r.isDisposed())throw new n.ObjectDisposedError("List",r.privDisposeReason)},this.triggerSubscriptions=function(e){if(e)for(var t in e)t&&e[t]()},this.privList=[],t)for(var i=0,o=t;i<o.length;i++){var s=o[i];this.privList.push(s)}};t.List=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=r(12),o=r(84),s=r(50);!function(e){e[e.Dequeue=0]="Dequeue",e[e.Peek=1]="Peek"}(n||(n={}));var a=function(e){var t=this;this.privPromiseStore=new o.List,this.privIsDrainInProgress=!1,this.privIsDisposing=!1,this.privDisposeReason=null,this.enqueue=function(e){t.throwIfDispose(),t.enqueueFromPromise(s.PromiseHelper.fromResult(e))},this.enqueueFromPromise=function(e){t.throwIfDispose(),t.privPromiseStore.add(e),e.finally((function(){for(;t.privPromiseStore.length()>0&&t.privPromiseStore.first().result().isCompleted;){var e=t.privPromiseStore.removeFirst();e.result().isError||t.privList.add(e.result().result)}}))},this.dequeue=function(){t.throwIfDispose();var e=new s.Deferred;return t.privSubscribers&&(t.privSubscribers.add({deferral:e,type:n.Dequeue}),t.drain()),e.promise()},this.peek=function(){t.throwIfDispose();var e=new s.Deferred;return t.privSubscribers&&(t.privSubscribers.add({deferral:e,type:n.Peek}),t.drain()),e.promise()},this.length=function(){return t.throwIfDispose(),t.privList.length()},this.isDisposed=function(){return null==t.privSubscribers},this.drainAndDispose=function(e,r){if(!t.isDisposed()&&!t.privIsDisposing){t.privDisposeReason=r,t.privIsDisposing=!0;var n=t.privSubscribers;if(n){for(;n.length()>0;)n.removeFirst().deferral.resolve(void 0);t.privSubscribers===n&&(t.privSubscribers=n)}for(var i=0,o=t.privDetachables;i<o.length;i++)o[i].detach();if(t.privPromiseStore.length()>0&&e)return s.PromiseHelper.whenAll(t.privPromiseStore.toArray()).continueWith((function(){return t.privSubscribers=null,t.privList.forEach((function(t,r){e(t)})),t.privList=null,!0}));t.privSubscribers=null,t.privList=null}return s.PromiseHelper.fromResult(!0)},this.dispose=function(e){t.drainAndDispose(null,e)},this.drain=function(){if(!t.privIsDrainInProgress&&!t.privIsDisposing){t.privIsDrainInProgress=!0;var e=t.privSubscribers,r=t.privList;if(e&&r){for(;r.length()>0&&e.length()>0&&!t.privIsDisposing;){var i=e.removeFirst();if(i.type===n.Peek)i.deferral.resolve(r.first());else{var o=r.removeFirst();i.deferral.resolve(o)}}t.privSubscribers===e&&(t.privSubscribers=e),t.privList===r&&(t.privList=r)}t.privIsDrainInProgress=!1}},this.throwIfDispose=function(){if(t.isDisposed()){if(t.privDisposeReason)throw new i.InvalidOperationError(t.privDisposeReason);throw new i.ObjectDisposedError("Queue")}if(t.privIsDisposing)throw new i.InvalidOperationError("Queue disposing")},this.privList=e||new o.List,this.privDetachables=[],this.privSubscribers=new o.List,this.privDetachables.push(this.privList.onAdded(this.drain))};t.Queue=a},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(21),s=r(2),a=r(3),c=r(0),p=r(30),u=function(){function e(){}return e.createPushStream=function(e){return h.create(e)},e.createPullStream=function(e,t){return l.create(e,t)},e}();t.AudioInputStream=u;var h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.create=function(e){return new v(e)},t}(u);t.PushAudioInputStream=h;var v=function(e){function t(t){var r=e.call(this)||this;return r.onEvent=function(e){r.privEvents.onEvent(e),a.Events.instance.onEvent(e)},r.privFormat=void 0===t?p.AudioStreamFormatImpl.getDefaultInputFormat():t,r.privEvents=new a.EventSource,r.privId=o.createNoDashGuid(),r.privStream=new a.ChunkedArrayBufferStream(r.privFormat.avgBytesPerSec/10),r}return i(t,e),Object.defineProperty(t.prototype,"format",{get:function(){return a.PromiseHelper.fromResult(this.privFormat)},enumerable:!0,configurable:!0}),t.prototype.write=function(e){this.privStream.writeStreamChunk({buffer:e,isEnd:!1,timeReceived:Date.now()})},t.prototype.close=function(){this.privStream.close()},t.prototype.id=function(){return this.privId},t.prototype.turnOn=function(){return this.onEvent(new a.AudioSourceInitializingEvent(this.privId)),this.onEvent(new a.AudioSourceReadyEvent(this.privId)),a.PromiseHelper.fromResult(!0)},t.prototype.attach=function(e){var t=this;return this.onEvent(new a.AudioStreamNodeAttachingEvent(this.privId,e)),this.turnOn().onSuccessContinueWith((function(e){return t.privStream.getReader()})).onSuccessContinueWith((function(r){return t.onEvent(new a.AudioStreamNodeAttachedEvent(t.privId,e)),{detach:function(){r.close(),t.onEvent(new a.AudioStreamNodeDetachedEvent(t.privId,e)),t.turnOff()},id:function(){return e},read:function(){return r.read()}}}))},t.prototype.detach=function(e){this.onEvent(new a.AudioStreamNodeDetachedEvent(this.privId,e))},t.prototype.turnOff=function(){return a.PromiseHelper.fromResult(!1)},Object.defineProperty(t.prototype,"events",{get:function(){return this.privEvents},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"deviceInfo",{get:function(){return a.PromiseHelper.fromResult({bitspersample:this.privFormat.bitsPerSample,channelcount:this.privFormat.channels,connectivity:s.connectivity.Unknown,manufacturer:"Speech SDK",model:"PushStream",samplerate:this.privFormat.samplesPerSec,type:s.type.Stream})},enumerable:!0,configurable:!0}),t}(h);t.PushAudioInputStreamImpl=v;var l=function(e){function t(){return e.call(this)||this}return i(t,e),t.create=function(e,t){return new d(e,t)},t}(u);t.PullAudioInputStream=l;var d=function(e){function t(t,r){var n=e.call(this)||this;return n.onEvent=function(e){n.privEvents.onEvent(e),a.Events.instance.onEvent(e)},n.privFormat=void 0===r?c.AudioStreamFormat.getDefaultInputFormat():r,n.privEvents=new a.EventSource,n.privId=o.createNoDashGuid(),n.privCallback=t,n.privIsClosed=!1,n.privBufferSize=n.privFormat.avgBytesPerSec/10,n}return i(t,e),Object.defineProperty(t.prototype,"format",{get:function(){return a.PromiseHelper.fromResult(this.privFormat)},enumerable:!0,configurable:!0}),t.prototype.close=function(){this.privIsClosed=!0,this.privCallback.close()},t.prototype.id=function(){return this.privId},t.prototype.turnOn=function(){return this.onEvent(new a.AudioSourceInitializingEvent(this.privId)),this.onEvent(new a.AudioSourceReadyEvent(this.privId)),a.PromiseHelper.fromResult(!0)},t.prototype.attach=function(e){var t=this;return this.onEvent(new a.AudioStreamNodeAttachingEvent(this.privId,e)),this.turnOn().onSuccessContinueWith((function(r){return t.onEvent(new a.AudioStreamNodeAttachedEvent(t.privId,e)),{detach:function(){t.privCallback.close(),t.onEvent(new a.AudioStreamNodeDetachedEvent(t.privId,e)),t.turnOff()},id:function(){return e},read:function(){for(var e,r=0;r<t.privBufferSize;){var n=new ArrayBuffer(t.privBufferSize-r),i=t.privCallback.read(n);if(void 0===e)e=n;else new Int8Array(e).set(new Int8Array(n),r);if(0===i)break;r+=i}return a.PromiseHelper.fromResult({buffer:e.slice(0,r),isEnd:t.privIsClosed||0===r,timeReceived:Date.now()})}}}))},t.prototype.detach=function(e){this.onEvent(new a.AudioStreamNodeDetachedEvent(this.privId,e))},t.prototype.turnOff=function(){return a.PromiseHelper.fromResult(!1)},Object.defineProperty(t.prototype,"events",{get:function(){return this.privEvents},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"deviceInfo",{get:function(){return a.PromiseHelper.fromResult({bitspersample:this.privFormat.bitsPerSample,channelcount:this.privFormat.channels,connectivity:s.connectivity.Unknown,manufacturer:"Speech SDK",model:"PullStream",samplerate:this.privFormat.samplesPerSec,type:s.type.Stream})},enumerable:!0,configurable:!0}),t}(l);t.PullAudioInputStreamImpl=d},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(21),s=r(3),a=r(30);t.bufferSize=4096;var c=function(){function e(){}return e.createPullStream=function(e){return p.create(e)},e}();t.AudioOutputStream=c;var p=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return i(r,e),r.create=function(e){return new u(t.bufferSize,e)},r}(c);t.PullAudioOutputStream=p;var u=function(e){function t(t,r){var n=e.call(this)||this;return n.privFormat=void 0===r?a.AudioStreamFormatImpl.getDefaultInputFormat():r,n.privId=o.createNoDashGuid(),n.privStream=new s.ChunkedArrayBufferStream(t),n.streamReader=n.privStream.getReader(),n}return i(t,e),Object.defineProperty(t.prototype,"format",{get:function(){return this.privFormat},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isClosed",{get:function(){return this.privStream.isClosed},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this.privId},enumerable:!0,configurable:!0}),t.prototype.read=function(){return this.streamReader.read().onSuccessContinueWithPromise((function(e){return s.PromiseHelper.fromResult(e.buffer)}))},t.prototype.write=function(e){this.privStream.writeStreamChunk({buffer:e,isEnd:!1,timeReceived:Date.now()})},t.prototype.close=function(){this.privStream.close()},t}(p);t.PullAudioOutputStreamImpl=u},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,r,n,i,o,s,a,c,p){var u=e.call(this,r,n,i,o,s,a,c,p)||this;return u.privTranslations=t,u}return i(t,e),Object.defineProperty(t.prototype,"translations",{get:function(){return this.privTranslations},enumerable:!0,configurable:!0}),t}(r(0).SpeechRecognitionResult);t.TranslationRecognitionResult=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.SpeechServiceConnection_Key=0]="SpeechServiceConnection_Key",e[e.SpeechServiceConnection_Endpoint=1]="SpeechServiceConnection_Endpoint",e[e.SpeechServiceConnection_Region=2]="SpeechServiceConnection_Region",e[e.SpeechServiceAuthorization_Token=3]="SpeechServiceAuthorization_Token",e[e.SpeechServiceAuthorization_Type=4]="SpeechServiceAuthorization_Type",e[e.SpeechServiceConnection_EndpointId=5]="SpeechServiceConnection_EndpointId",e[e.SpeechServiceConnection_TranslationToLanguages=6]="SpeechServiceConnection_TranslationToLanguages",e[e.SpeechServiceConnection_TranslationVoice=7]="SpeechServiceConnection_TranslationVoice",e[e.SpeechServiceConnection_TranslationFeatures=8]="SpeechServiceConnection_TranslationFeatures",e[e.SpeechServiceConnection_IntentRegion=9]="SpeechServiceConnection_IntentRegion",e[e.SpeechServiceConnection_ProxyHostName=10]="SpeechServiceConnection_ProxyHostName",e[e.SpeechServiceConnection_ProxyPort=11]="SpeechServiceConnection_ProxyPort",e[e.SpeechServiceConnection_ProxyUserName=12]="SpeechServiceConnection_ProxyUserName",e[e.SpeechServiceConnection_ProxyPassword=13]="SpeechServiceConnection_ProxyPassword",e[e.SpeechServiceConnection_RecoMode=14]="SpeechServiceConnection_RecoMode",e[e.SpeechServiceConnection_RecoLanguage=15]="SpeechServiceConnection_RecoLanguage",e[e.Speech_SessionId=16]="Speech_SessionId",e[e.SpeechServiceResponse_RequestDetailedResultTrueFalse=17]="SpeechServiceResponse_RequestDetailedResultTrueFalse",e[e.SpeechServiceResponse_RequestProfanityFilterTrueFalse=18]="SpeechServiceResponse_RequestProfanityFilterTrueFalse",e[e.SpeechServiceResponse_JsonResult=19]="SpeechServiceResponse_JsonResult",e[e.SpeechServiceResponse_JsonErrorDetails=20]="SpeechServiceResponse_JsonErrorDetails",e[e.CancellationDetails_Reason=21]="CancellationDetails_Reason",e[e.CancellationDetails_ReasonText=22]="CancellationDetails_ReasonText",e[e.CancellationDetails_ReasonDetailedText=23]="CancellationDetails_ReasonDetailedText",e[e.LanguageUnderstandingServiceResponse_JsonResult=24]="LanguageUnderstandingServiceResponse_JsonResult",e[e.SpeechServiceConnection_Url=25]="SpeechServiceConnection_Url",e[e.SpeechServiceConnection_InitialSilenceTimeoutMs=26]="SpeechServiceConnection_InitialSilenceTimeoutMs",e[e.SpeechServiceConnection_EndSilenceTimeoutMs=27]="SpeechServiceConnection_EndSilenceTimeoutMs",e[e.SpeechServiceConnection_EnableAudioLogging=28]="SpeechServiceConnection_EnableAudioLogging",e[e.SpeechServiceResponse_ProfanityOption=29]="SpeechServiceResponse_ProfanityOption",e[e.SpeechServiceResponse_PostProcessingOption=30]="SpeechServiceResponse_PostProcessingOption",e[e.SpeechServiceResponse_RequestWordLevelTimestamps=31]="SpeechServiceResponse_RequestWordLevelTimestamps",e[e.SpeechServiceResponse_StablePartialResultThreshold=32]="SpeechServiceResponse_StablePartialResultThreshold",e[e.SpeechServiceResponse_OutputFormatOption=33]="SpeechServiceResponse_OutputFormatOption",e[e.SpeechServiceResponse_TranslationRequestStablePartialResult=34]="SpeechServiceResponse_TranslationRequestStablePartialResult",e[e.Conversation_ApplicationId=35]="Conversation_ApplicationId",e[e.Conversation_DialogType=36]="Conversation_DialogType",e[e.Conversation_Initial_Silence_Timeout=37]="Conversation_Initial_Silence_Timeout",e[e.Conversation_From_Id=38]="Conversation_From_Id",e[e.Conversation_Speech_Activity_Template=39]="Conversation_Speech_Activity_Template",e[e.SpeechServiceConnection_Host=40]="SpeechServiceConnection_Host",e[e.ConversationTranslator_Host=41]="ConversationTranslator_Host",e[e.ConversationTranslator_Name=42]="ConversationTranslator_Name",e[e.ConversationTranslator_CorrelationId=43]="ConversationTranslator_CorrelationId",e[e.ConversationTranslator_Token=44]="ConversationTranslator_Token"}(t.PropertyId||(t.PropertyId={}))},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(16),s=r(2),a=r(0),c=r(31),p=r(2),u=r(36),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.interactiveRelativeUri="/speech/recognition/interactive/cognitiveservices/v1",t.conversationRelativeUri="/speech/recognition/conversation/cognitiveservices/v1",t.dictationRelativeUri="/speech/recognition/dictation/cognitiveservices/v1",t.create=function(e,r,n){var i=e.parameters.getProperty(a.PropertyId.SpeechServiceConnection_Endpoint,void 0),c=e.parameters.getProperty(a.PropertyId.SpeechServiceConnection_Region,void 0),h=e.parameters.getProperty(a.PropertyId.SpeechServiceConnection_Host,"wss://"+c+".stt.speech.microsoft.com"),v={},l=e.parameters.getProperty(a.PropertyId.SpeechServiceConnection_EndpointId,void 0),d=e.parameters.getProperty(a.PropertyId.SpeechServiceConnection_RecoLanguage,void 0);if(l?i&&-1!==i.search(u.QueryParameterNames.DeploymentIdParamName)||(v[u.QueryParameterNames.DeploymentIdParamName]=l):d&&(i&&-1!==i.search(u.QueryParameterNames.LanguageParamName)||(v[u.QueryParameterNames.LanguageParamName]=d)),i&&-1!==i.search(u.QueryParameterNames.FormatParamName)||(v[u.QueryParameterNames.FormatParamName]=e.parameters.getProperty(s.OutputFormatPropertyName,a.OutputFormat[a.OutputFormat.Simple]).toLowerCase()),t.setCommonUrlParams(e,v,i),!i)switch(e.recognitionMode){case p.RecognitionMode.Conversation:i="true"===e.parameters.getProperty(s.ForceDictationPropertyName,"false")?h+t.dictationRelativeUri:h+t.conversationRelativeUri;break;case p.RecognitionMode.Dictation:i=h+t.dictationRelativeUri;break;default:i=h+t.interactiveRelativeUri}var f={};return void 0!==r.token&&""!==r.token&&(f[r.headerName]=r.token),f[u.QueryParameterNames.ConnectionIdHeader]=n,e.parameters.setProperty(a.PropertyId.SpeechServiceConnection_Url,i),new o.WebsocketConnection(i,v,f,new p.WebsocketMessageFormatter,o.ProxyInfo.fromRecognizerConfig(e),n)},t}return i(t,e),t}(c.ConnectionFactoryBase);t.SpeechConnectionFactory=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(92);t.Conversation=n.Conversation;var i=r(203);t.ConversationExpirationEventArgs=i.ConversationExpirationEventArgs;var o=r(204);t.ConversationParticipantsChangedEventArgs=o.ConversationParticipantsChangedEventArgs;var s=r(205);t.ConversationTranslationCanceledEventArgs=s.ConversationTranslationCanceledEventArgs;var a=r(206);t.ConversationTranslationEventArgs=a.ConversationTranslationEventArgs;var c=r(207);t.ConversationTranslationResult=c.ConversationTranslationResult;var p=r(208);t.ConversationTranslator=p.ConversationTranslator;var u=r(209);t.Participant=u.Participant,t.User=u.User;var h=r(210);t.ParticipantChangedReason=h.ParticipantChangedReason},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),i=0;for(t=0;t<r;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,i++)n[i]=o[s];return n};Object.defineProperty(t,"__esModule",{value:!0});var s=r(2),a=r(6),c=r(0),p=function(){function e(){}return e.createConversationAsync=function(e,t,r){a.Contracts.throwIfNullOrUndefined(e,s.ConversationTranslatorConfig.strings.invalidArgs.replace("{arg}","config")),a.Contracts.throwIfNullOrUndefined(e.region,s.ConversationTranslatorConfig.strings.invalidArgs.replace("{arg}","SpeechServiceConnection_Region")),e.subscriptionKey||e.getProperty(c.PropertyId[c.PropertyId.SpeechServiceAuthorization_Token])||a.Contracts.throwIfNullOrUndefined(e.subscriptionKey,s.ConversationTranslatorConfig.strings.invalidArgs.replace("{arg}","SpeechServiceConnection_Key"));var n=new u(e);return n.createConversationAsync((function(){t&&t()}),(function(e){r&&r(e)})),n},e}();t.Conversation=p;var u=function(e){function t(t){var r=e.call(this)||this;r.privIsDisposed=!1,r.privIsConnected=!1,r.onConnected=function(e){r.privIsConnected=!0;try{r.privConversationTranslator.sessionStarted&&r.privConversationTranslator.sessionStarted(r.privConversationTranslator,e)}catch(e){}},r.onDisconnected=function(e){r.close(!1);try{r.privConversationTranslator.sessionStopped&&r.privConversationTranslator.sessionStopped(r.privConversationTranslator,e)}catch(e){}},r.onCanceled=function(e,t){r.close(!1);try{r.privConversationTranslator.canceled&&r.privConversationTranslator.canceled(r.privConversationTranslator,t)}catch(t){}},r.onParticipantUpdateCommandReceived=function(e,t){var n,i;try{var o=r.privParticipants.getParticipant(t.id);if(void 0!==o){switch(t.key){case s.ConversationTranslatorCommandTypes.changeNickname:o.displayName=t.value;break;case s.ConversationTranslatorCommandTypes.setUseTTS:o.useTts=t.value;break;case s.ConversationTranslatorCommandTypes.setProfanityFiltering:o.profanity=t.value;break;case s.ConversationTranslatorCommandTypes.setMute:o.isMuted=t.value;break;case s.ConversationTranslatorCommandTypes.setTranslateToLanguages:o.translateToLanguages=t.value}r.privParticipants.addOrUpdateParticipant(o),(null===(n=r.privConversationTranslator)||void 0===n?void 0:n.participantsChanged)&&(null===(i=r.privConversationTranslator)||void 0===i||i.participantsChanged(r.privConversationTranslator,new c.ConversationParticipantsChangedEventArgs(c.ParticipantChangedReason.Updated,[r.toParticipant(o)],t.sessionId)))}}catch(t){}},r.onLockRoomCommandReceived=function(e,t){},r.onMuteAllCommandReceived=function(e,t){var n,i;try{r.privParticipants.participants.forEach((function(e){return e.isMuted=!e.isHost&&t.isMuted})),(null===(n=r.privConversationTranslator)||void 0===n?void 0:n.participantsChanged)&&(null===(i=r.privConversationTranslator)||void 0===i||i.participantsChanged(r.privConversationTranslator,new c.ConversationParticipantsChangedEventArgs(c.ParticipantChangedReason.Updated,r.toParticipants(!1),t.sessionId)))}catch(t){}},r.onParticipantJoinCommandReceived=function(e,t){var n,i;try{var o=r.privParticipants.addOrUpdateParticipant(t.participant);void 0!==o&&(null===(n=r.privConversationTranslator)||void 0===n?void 0:n.participantsChanged)&&(null===(i=r.privConversationTranslator)||void 0===i||i.participantsChanged(r.privConversationTranslator,new c.ConversationParticipantsChangedEventArgs(c.ParticipantChangedReason.JoinedConversation,[r.toParticipant(o)],t.sessionId)))}catch(t){}},r.onParticipantLeaveCommandReceived=function(e,t){var n,i;try{var o=r.privParticipants.getParticipant(t.participant.id);void 0!==o&&(r.privParticipants.deleteParticipant(t.participant.id),(null===(n=r.privConversationTranslator)||void 0===n?void 0:n.participantsChanged)&&(null===(i=r.privConversationTranslator)||void 0===i||i.participantsChanged(r.privConversationTranslator,new c.ConversationParticipantsChangedEventArgs(c.ParticipantChangedReason.LeftConversation,[r.toParticipant(o)],t.sessionId))))}catch(t){}},r.onTranslationReceived=function(e,t){var n,i,o,a,p,u;try{switch(t.command){case s.ConversationTranslatorMessageTypes.final:(null===(n=r.privConversationTranslator)||void 0===n?void 0:n.transcribed)&&(null===(i=r.privConversationTranslator)||void 0===i||i.transcribed(r.privConversationTranslator,new c.ConversationTranslationEventArgs(t.payload,void 0,t.sessionId)));break;case s.ConversationTranslatorMessageTypes.partial:(null===(o=r.privConversationTranslator)||void 0===o?void 0:o.transcribing)&&(null===(a=r.privConversationTranslator)||void 0===a||a.transcribing(r.privConversationTranslator,new c.ConversationTranslationEventArgs(t.payload,void 0,t.sessionId)));break;case s.ConversationTranslatorMessageTypes.instantMessage:(null===(p=r.privConversationTranslator)||void 0===p?void 0:p.textMessageReceived)&&(null===(u=r.privConversationTranslator)||void 0===u||u.textMessageReceived(r.privConversationTranslator,new c.ConversationTranslationEventArgs(t.payload,void 0,t.sessionId)))}}catch(t){}},r.onParticipantsListReceived=function(e,t){var n,i;try{if(void 0!==t.sessionToken&&null!==t.sessionToken&&(r.privRoom.token=t.sessionToken),r.privParticipants.participants=o(t.participants),void 0!==r.privParticipants.me&&(r.privIsReady=!0),(null===(n=r.privConversationTranslator)||void 0===n?void 0:n.participantsChanged)&&(null===(i=r.privConversationTranslator)||void 0===i||i.participantsChanged(r.privConversationTranslator,new c.ConversationParticipantsChangedEventArgs(c.ParticipantChangedReason.JoinedConversation,r.toParticipants(!0),t.sessionId))),r.me.isHost){var s=r.privConversationTranslator.properties.getProperty(c.PropertyId.ConversationTranslator_Name);void 0!==s&&s.length>0&&s!==r.me.displayName&&r.changeNicknameAsync(s)}}catch(t){}},r.onConversationExpiration=function(e,t){var n,i;try{(null===(n=r.privConversationTranslator)||void 0===n?void 0:n.conversationExpiration)&&(null===(i=r.privConversationTranslator)||void 0===i||i.conversationExpiration(r.privConversationTranslator,t))}catch(t){}},r.privProperties=new c.PropertyCollection,r.privManager=new s.ConversationManager,t.getProperty(c.PropertyId[c.PropertyId.SpeechServiceConnection_RecoLanguage])||t.setProperty(c.PropertyId[c.PropertyId.SpeechServiceConnection_RecoLanguage],s.ConversationTranslatorConfig.defaultLanguageCode),r.privLanguage=t.getProperty(c.PropertyId[c.PropertyId.SpeechServiceConnection_RecoLanguage]),0===t.targetLanguages.length&&t.addTargetLanguage(r.privLanguage),t.getProperty(c.PropertyId[c.PropertyId.SpeechServiceResponse_ProfanityOption])||t.setProfanity(c.ProfanityOption.Masked);var n=t.getProperty(c.PropertyId[c.PropertyId.ConversationTranslator_Name]);(null==n||n.length<=1||n.length>50)&&(n="Host"),t.setProperty(c.PropertyId[c.PropertyId.ConversationTranslator_Name],n),r.privConfig=t;var i=t;return a.Contracts.throwIfNull(i,"speechConfig"),r.privProperties=i.properties.clone(),r.privIsConnected=!1,r.privParticipants=new s.InternalParticipants,r.privIsReady=!1,r}return i(t,e),Object.defineProperty(t.prototype,"conversationTranslator",{set:function(e){this.privConversationTranslator=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"room",{get:function(){return this.privRoom},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"connection",{get:function(){return this.privConversationRecognizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"authorizationToken",{get:function(){return this.privToken},set:function(e){a.Contracts.throwIfNullOrWhitespace(e,"authorizationToken"),this.privToken=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"config",{get:function(){return this.privConfig},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"conversationId",{get:function(){return this.privRoom?this.privRoom.roomId:""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"properties",{get:function(){return this.privProperties},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"speechRecognitionLanguage",{get:function(){return this.privLanguage},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isMutedByHost",{get:function(){var e,t;return!(null===(e=this.privParticipants.me)||void 0===e?void 0:e.isHost)&&(null===(t=this.privParticipants.me)||void 0===t?void 0:t.isMuted)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isConnected",{get:function(){return this.privIsConnected&&this.privIsReady},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"participants",{get:function(){return this.toParticipants(!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"me",{get:function(){return this.toParticipant(this.privParticipants.me)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"host",{get:function(){return this.toParticipant(this.privParticipants.host)},enumerable:!0,configurable:!0}),t.prototype.createConversationAsync=function(e,t){var r=this;try{this.privConversationRecognizer&&this.handleError(new Error(s.ConversationTranslatorConfig.strings.permissionDeniedStart),t),this.privManager.createOrJoin(this.privProperties,void 0,(function(n){n||r.handleError(new Error(s.ConversationTranslatorConfig.strings.permissionDeniedConnect),t),r.privRoom=n,r.handleCallback(e,t)}),(function(e){r.handleError(e,t)}))}catch(e){this.handleError(e,t)}},t.prototype.startConversationAsync=function(e,t){var r=this;try{this.privConversationRecognizer&&this.handleError(new Error(s.ConversationTranslatorConfig.strings.permissionDeniedStart),t),a.Contracts.throwIfNullOrUndefined(this.privRoom,s.ConversationTranslatorConfig.strings.permissionDeniedConnect),this.privParticipants.meId=this.privRoom.participantId,this.privConversationRecognizer=new s.ConversationTranslatorRecognizer(this.privConfig),this.privConversationRecognizer.conversation=this.privRoom,this.privConversationRecognizerConnection=c.Connection.fromRecognizer(this.privConversationRecognizer),this.privConversationRecognizerConnection.connected=this.onConnected,this.privConversationRecognizerConnection.disconnected=this.onDisconnected,this.privConversationRecognizer.canceled=this.onCanceled,this.privConversationRecognizer.participantUpdateCommandReceived=this.onParticipantUpdateCommandReceived,this.privConversationRecognizer.lockRoomCommandReceived=this.onLockRoomCommandReceived,this.privConversationRecognizer.muteAllCommandReceived=this.onMuteAllCommandReceived,this.privConversationRecognizer.participantJoinCommandReceived=this.onParticipantJoinCommandReceived,this.privConversationRecognizer.participantLeaveCommandReceived=this.onParticipantLeaveCommandReceived,this.privConversationRecognizer.translationReceived=this.onTranslationReceived,this.privConversationRecognizer.participantsListReceived=this.onParticipantsListReceived,this.privConversationRecognizer.conversationExpiration=this.onConversationExpiration,this.privConversationRecognizer.connect(this.privRoom.token,(function(){r.handleCallback(e,t)}),(function(e){r.handleError(e,t)}))}catch(e){this.handleError(e,t)}},t.prototype.joinConversationAsync=function(e,t,r,n,i){var o=this;try{a.Contracts.throwIfNullOrWhitespace(e,s.ConversationTranslatorConfig.strings.invalidArgs.replace("{arg}","conversationId")),a.Contracts.throwIfNullOrWhitespace(t,s.ConversationTranslatorConfig.strings.invalidArgs.replace("{arg}","nickname")),a.Contracts.throwIfNullOrWhitespace(r,s.ConversationTranslatorConfig.strings.invalidArgs.replace("{arg}","language")),this.privManager.createOrJoin(this.privProperties,e,(function(e){a.Contracts.throwIfNullOrUndefined(e,s.ConversationTranslatorConfig.strings.permissionDeniedConnect),o.privRoom=e,o.privConfig.authorizationToken=e.cognitiveSpeechAuthToken,n&&n(e.cognitiveSpeechAuthToken)}),(function(e){o.handleError(e,i)}))}catch(e){this.handleError(e,i)}},t.prototype.deleteConversationAsync=function(e,t){var r=this;try{a.Contracts.throwIfNullOrUndefined(this.privProperties,s.ConversationTranslatorConfig.strings.permissionDeniedConnect),a.Contracts.throwIfNullOrWhitespace(this.privRoom.token,s.ConversationTranslatorConfig.strings.permissionDeniedConnect),this.privManager.leave(this.privProperties,this.privRoom.token,(function(){r.handleCallback(e,t)}),(function(e){r.handleError(e,t)})),this.dispose()}catch(e){this.handleError(e,t)}},t.prototype.endConversationAsync=function(e,t){try{this.close(!0),this.handleCallback(e,t)}catch(e){this.handleError(e,t)}},t.prototype.lockConversationAsync=function(e,t){var r,n=this;try{a.Contracts.throwIfDisposed(this.privIsDisposed),a.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),a.Contracts.throwIfNullOrUndefined(this.privRoom,s.ConversationTranslatorConfig.strings.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(s.ConversationTranslatorConfig.strings.permissionDeniedConversation.replace("{command}","lock")),t),null===(r=this.privConversationRecognizer)||void 0===r||r.sendLockRequest(!0,(function(){n.handleCallback(e,t)}),(function(e){n.handleError(e,t)}))}catch(e){this.handleError(e,t)}},t.prototype.muteAllParticipantsAsync=function(e,t){var r,n=this;try{a.Contracts.throwIfDisposed(this.privIsDisposed),a.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),a.Contracts.throwIfNullOrUndefined(this.privConversationRecognizer,s.ConversationTranslatorConfig.strings.permissionDeniedSend),a.Contracts.throwIfNullOrUndefined(this.privRoom,s.ConversationTranslatorConfig.strings.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(s.ConversationTranslatorConfig.strings.permissionDeniedConversation.replace("{command}","mute")),t),null===(r=this.privConversationRecognizer)||void 0===r||r.sendMuteAllRequest(!0,(function(){n.handleCallback(e,t)}),(function(e){n.handleError(e,t)}))}catch(e){this.handleError(e,t)}},t.prototype.muteParticipantAsync=function(e,t,r){var n,i=this;try{a.Contracts.throwIfDisposed(this.privIsDisposed),a.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),a.Contracts.throwIfNullOrWhitespace(e,s.ConversationTranslatorConfig.strings.invalidArgs.replace("{arg}","userId")),a.Contracts.throwIfNullOrUndefined(this.privRoom,s.ConversationTranslatorConfig.strings.permissionDeniedSend),this.canSend||this.handleError(new Error(s.ConversationTranslatorConfig.strings.permissionDeniedSend),r),this.me.isHost||this.me.id===e||this.handleError(new Error(s.ConversationTranslatorConfig.strings.permissionDeniedParticipant.replace("{command}","mute")),r),-1===this.privParticipants.getParticipantIndex(e)&&this.handleError(new Error(s.ConversationTranslatorConfig.strings.invalidParticipantRequest),r),null===(n=this.privConversationRecognizer)||void 0===n||n.sendMuteRequest(e,!0,(function(){i.handleCallback(t,r)}),(function(e){i.handleError(e,r)}))}catch(e){this.handleError(e,r)}},t.prototype.removeParticipantAsync=function(e,t,r){var n,i=this;try{a.Contracts.throwIfDisposed(this.privIsDisposed),a.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),a.Contracts.throwIfNullOrUndefined(this.privRoom,s.ConversationTranslatorConfig.strings.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(s.ConversationTranslatorConfig.strings.permissionDeniedParticipant.replace("{command}","remove")),r);var o="";if("string"==typeof e)o=e;else if(e.hasOwnProperty("id")){o=e.id}else if(e.hasOwnProperty("userId")){o=e.userId}a.Contracts.throwIfNullOrWhitespace(o,s.ConversationTranslatorConfig.strings.invalidArgs.replace("{arg}","userId")),-1===this.participants.findIndex((function(e){return e.id===o}))&&this.handleError(new Error(s.ConversationTranslatorConfig.strings.invalidParticipantRequest),r),null===(n=this.privConversationRecognizer)||void 0===n||n.sendEjectRequest(o,(function(){i.handleCallback(t,r)}),(function(e){i.handleError(e,r)}))}catch(e){this.handleError(e,r)}},t.prototype.unlockConversationAsync=function(e,t){var r,n=this;try{a.Contracts.throwIfDisposed(this.privIsDisposed),a.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),a.Contracts.throwIfNullOrUndefined(this.privRoom,s.ConversationTranslatorConfig.strings.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(s.ConversationTranslatorConfig.strings.permissionDeniedConversation.replace("{command}","unlock")),t),null===(r=this.privConversationRecognizer)||void 0===r||r.sendLockRequest(!1,(function(){n.handleCallback(e,t)}),(function(e){n.handleError(e,t)}))}catch(e){this.handleError(e,t)}},t.prototype.unmuteAllParticipantsAsync=function(e,t){var r,n=this;try{a.Contracts.throwIfDisposed(this.privIsDisposed),a.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),a.Contracts.throwIfNullOrUndefined(this.privRoom,s.ConversationTranslatorConfig.strings.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(s.ConversationTranslatorConfig.strings.permissionDeniedConversation.replace("{command}","unmute all")),t),null===(r=this.privConversationRecognizer)||void 0===r||r.sendMuteAllRequest(!1,(function(){n.handleCallback(e,t)}),(function(e){n.handleError(e,t)}))}catch(e){this.handleError(e,t)}},t.prototype.unmuteParticipantAsync=function(e,t,r){var n,i=this;try{a.Contracts.throwIfDisposed(this.privIsDisposed),a.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),a.Contracts.throwIfNullOrWhitespace(e,s.ConversationTranslatorConfig.strings.invalidArgs.replace("{arg}","userId")),a.Contracts.throwIfNullOrUndefined(this.privRoom,s.ConversationTranslatorConfig.strings.permissionDeniedSend),this.canSend||this.handleError(new Error(s.ConversationTranslatorConfig.strings.permissionDeniedSend),r),this.me.isHost||this.me.id===e||this.handleError(new Error(s.ConversationTranslatorConfig.strings.permissionDeniedParticipant.replace("{command}","mute")),r),-1===this.privParticipants.getParticipantIndex(e)&&this.handleError(new Error(s.ConversationTranslatorConfig.strings.invalidParticipantRequest),r),null===(n=this.privConversationRecognizer)||void 0===n||n.sendMuteRequest(e,!1,(function(){i.handleCallback(t,r)}),(function(e){i.handleError(e,r)}))}catch(e){this.handleError(e,r)}},t.prototype.sendTextMessageAsync=function(e,t,r){var n,i=this;try{a.Contracts.throwIfDisposed(this.privIsDisposed),a.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),a.Contracts.throwIfNullOrWhitespace(e,s.ConversationTranslatorConfig.strings.invalidArgs.replace("{arg}","message")),a.Contracts.throwIfNullOrUndefined(this.privRoom,s.ConversationTranslatorConfig.strings.permissionDeniedSend),this.canSend||this.handleError(new Error(s.ConversationTranslatorConfig.strings.permissionDeniedSend),r),e.length>s.ConversationTranslatorConfig.textMessageMaxLength&&this.handleError(new Error(s.ConversationTranslatorConfig.strings.invalidArgs.replace("{arg}","message length")),r),null===(n=this.privConversationRecognizer)||void 0===n||n.sendMessageRequest(e,(function(){i.handleCallback(t,r)}),(function(e){i.handleError(e,r)}))}catch(e){this.handleError(e,r)}},t.prototype.changeNicknameAsync=function(e,t,r){var n,i=this;try{a.Contracts.throwIfDisposed(this.privIsDisposed),a.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),a.Contracts.throwIfNullOrWhitespace(e,s.ConversationTranslatorConfig.strings.invalidArgs.replace("{arg}","nickname")),a.Contracts.throwIfNullOrUndefined(this.privRoom,s.ConversationTranslatorConfig.strings.permissionDeniedSend),this.canSend||this.handleError(new Error(s.ConversationTranslatorConfig.strings.permissionDeniedSend),r),null===(n=this.privConversationRecognizer)||void 0===n||n.sendChangeNicknameRequest(e,(function(){i.handleCallback(t,r)}),(function(e){i.handleError(e,r)}))}catch(e){this.handleError(e,r)}},t.prototype.isDisposed=function(){return this.privIsDisposed},t.prototype.dispose=function(e){var t;this.isDisposed||(this.privIsDisposed=!0,null===(t=this.config)||void 0===t||t.close(),this.privConversationRecognizerConnection&&(this.privConversationRecognizerConnection.closeConnection(),this.privConversationRecognizerConnection.close(),this.privConversationRecognizerConnection=void 0),this.privConfig=void 0,this.privLanguage=void 0,this.privProperties=void 0,this.privRoom=void 0,this.privToken=void 0,this.privManager=void 0,this.privConversationRecognizer=void 0,this.privIsConnected=!1,this.privIsReady=!1,this.privParticipants=void 0,this.privRoom=void 0)},t.prototype.close=function(e){var t,r,n;try{this.privIsConnected=!1,null===(t=this.privConversationRecognizerConnection)||void 0===t||t.closeConnection(),null===(r=this.privConversationRecognizerConnection)||void 0===r||r.close(),this.privConversationRecognizer.close(),this.privConversationRecognizerConnection=void 0,this.privConversationRecognizer=void 0,null===(n=this.privConversationTranslator)||void 0===n||n.dispose()}catch(e){}e&&this.dispose()},Object.defineProperty(t.prototype,"canSend",{get:function(){var e;return this.privIsConnected&&!(null===(e=this.privParticipants.me)||void 0===e?void 0:e.isMuted)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canSendAsHost",{get:function(){var e;return this.privIsConnected&&(null===(e=this.privParticipants.me)||void 0===e?void 0:e.isHost)},enumerable:!0,configurable:!0}),t.prototype.handleCallback=function(e,t){if(e){try{e()}catch(e){t&&t(e)}e=void 0}},t.prototype.handleError=function(e,t){if(t)if(e instanceof Error){var r=e;t(r.name+": "+r.message)}else t(e)},t.prototype.toParticipants=function(e){var t=this,r=this.privParticipants.participants.map((function(e){return t.toParticipant(e)}));return e?r:r.filter((function(e){return!1===e.isHost}))},t.prototype.toParticipant=function(e){return new c.Participant(e.id,e.avatar,e.displayName,e.isHost,e.isMuted,e.isUsingTts,e.preferredLanguage)},t}(p);t.ConversationImpl=u},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(3),s=function(e){function t(t,r,n,i,s,a,c){var p=this;if(!r)throw new o.ArgumentNullError("path");if(!n)throw new o.ArgumentNullError("requestId");var u={};if(u.path=r,u["x-requestid"]=n,u["x-timestamp"]=(new Date).toISOString(),i&&(u["content-type"]=i),a)for(var h in a)h&&(u[h]=a[h]);return(p=c?e.call(this,t,s,u,c)||this:e.call(this,t,s,u)||this).privPath=r,p.privRequestId=n,p.privContentType=i,p.privAdditionalHeaders=a,p}return i(t,e),Object.defineProperty(t.prototype,"path",{get:function(){return this.privPath},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"requestId",{get:function(){return this.privRequestId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"contentType",{get:function(){return this.privContentType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"additionalHeaders",{get:function(){return this.privAdditionalHeaders},enumerable:!0,configurable:!0}),t.fromConnectionMessage=function(e){var r=null,n=null,i=null,o={};if(e.headers)for(var s in e.headers)s&&(s.toLowerCase()==="path".toLowerCase()?r=e.headers[s]:s.toLowerCase()==="x-requestid".toLowerCase()?n=e.headers[s]:s.toLowerCase()==="x-timestamp".toLowerCase()?e.headers[s]:s.toLowerCase()==="content-type".toLowerCase()?i=e.headers[s]:o[s]=e.headers[s]);return new t(e.messageType,r,n,i,e.body,o,e.id)},t}(o.ConnectionMessage);t.SpeechConnectionMessage=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.privActivityResponse=JSON.parse(e)}return e.fromJSON=function(t){return new e(t)},Object.defineProperty(e.prototype,"conversationId",{get:function(){return this.privActivityResponse.conversationId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"messageDataStreamType",{get:function(){return this.privActivityResponse.messageDataStreamType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"messagePayload",{get:function(){return this.privActivityResponse.messagePayload},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"version",{get:function(){return this.privActivityResponse.version},enumerable:!0,configurable:!0}),e}();t.ActivityPayloadResponse=n,function(e){e[e.None=0]="None",e[e.TextToSpeechAudio=1]="TextToSpeechAudio"}(t.MessageDataStreamType||(t.MessageDataStreamType={}))},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,r,n,i){var o=e.call(this,t,r,n,i)||this,s=JSON.parse(o.textBody);return void 0!==s.type&&(o.privConversationMessageType=s.type),o}return i(t,e),Object.defineProperty(t.prototype,"conversationMessageType",{get:function(){return this.privConversationMessageType},enumerable:!0,configurable:!0}),t}(r(3).ConnectionMessage);t.ConversationConnectionMessage=o},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),s=function(e){function t(t,r){var n=e.call(this,r)||this;return n.privIsMuted=t,n}return i(t,e),Object.defineProperty(t.prototype,"isMuted",{get:function(){return this.privIsMuted},enumerable:!0,configurable:!0}),t}(o.SessionEventArgs);t.MuteAllEventArgs=s;var a=function(e){function t(t,r){var n=e.call(this,r)||this;return n.privIsLocked=t,n}return i(t,e),Object.defineProperty(t.prototype,"isMuted",{get:function(){return this.privIsLocked},enumerable:!0,configurable:!0}),t}(o.SessionEventArgs);t.LockRoomEventArgs=a;var c=function(e){function t(t,r){var n=e.call(this,r)||this;return n.privParticipant=t,n}return i(t,e),Object.defineProperty(t.prototype,"participant",{get:function(){return this.privParticipant},enumerable:!0,configurable:!0}),t}(o.SessionEventArgs);t.ParticipantEventArgs=c;var p=function(e){function t(t,r,n,i){var o=e.call(this,i)||this;return o.privKey=r,o.privValue=n,o.privParticipantId=t,o}return i(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.privValue},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"key",{get:function(){return this.privKey},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this.privParticipantId},enumerable:!0,configurable:!0}),t}(o.SessionEventArgs);t.ParticipantAttributeEventArgs=p;var u=function(e){function t(t,r,n,i,o,s,a,c,p){var u=e.call(this,p)||this;return u.privRoomId=t,u.privSessionToken=r,u.privTranslateTo=n,u.privProfanityFilter=i,u.privRoomProfanityFilter=o,u.privIsRoomLocked=s,u.privIsRoomLocked=a,u.privParticipants=c,u}return i(t,e),Object.defineProperty(t.prototype,"sessionToken",{get:function(){return this.privSessionToken},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"conversationId",{get:function(){return this.privRoomId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"translateTo",{get:function(){return this.privTranslateTo},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"profanityFilter",{get:function(){return this.privProfanityFilter},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"roomProfanityFilter",{get:function(){return this.privRoomProfanityFilter},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isRoomLocked",{get:function(){return this.privIsRoomLocked},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isMuteAll",{get:function(){return this.privIsMuteAll},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"participants",{get:function(){return this.privParticipants},enumerable:!0,configurable:!0}),t}(o.SessionEventArgs);t.ParticipantsListEventArgs=u;var h=function(){function e(e,t,r){this.privPayload=t,this.privCommand=e,this.privSessionId=r}return Object.defineProperty(e.prototype,"payload",{get:function(){return this.privPayload},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"command",{get:function(){return this.privCommand},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sessionId",{get:function(){return this.privSessionId},enumerable:!0,configurable:!0}),e}();t.ConversationReceivedTranslationEventArgs=h},function(e,t,r){"use strict";(function(e,n){Object.defineProperty(t,"__esModule",{value:!0});var i=r(3),o=r(254),s=r(255),a=r(256),c=function(){function t(r,c,p,u,h){var v=this;if(this.open=function(){if(v.privConnectionState===i.ConnectionState.Disconnected)return i.PromiseHelper.fromError("Cannot open a connection that is in "+v.privConnectionState+" state");if(v.privConnectionEstablishDeferral)return v.privConnectionEstablishDeferral.promise();v.privConnectionEstablishDeferral=new i.Deferred,v.privCertificateValidatedDeferral=new i.Deferred,v.privConnectionState=i.ConnectionState.Connecting;try{var r=void 0!==e&&"0"!==e.env.NODE_TLS_REJECT_UNAUTHORIZED&&!v.privUri.startsWith("ws:");if("undefined"==typeof WebSocket||t.forceNpmWebSocket)if(void 0!==v.proxyInfo&&void 0!==v.proxyInfo.HostName&&v.proxyInfo.Port>0){var c={host:v.proxyInfo.HostName,port:v.proxyInfo.Port};void 0!==v.proxyInfo.UserName&&(c.headers={"Proxy-Authentication":"Basic "+new n(v.proxyInfo.UserName+":"+(void 0===v.proxyInfo.Password)?"":v.proxyInfo.Password).toString("base64")},r&&(c.headers.requestOCSP="true"));var p={agent:new o(c),headers:v.privHeaders};v.privWebsocketClient=new s(v.privUri,p),r?v.privWebsocketClient.addListener("upgrade",(function(e){var t=e.socket,r=t.getPeerCertificate(!0);t.cork(),a.check({cert:r.raw,httpOptions:p,issuer:r.issuerCertificate.raw},(function(e,r){e?(v.privCertificateValidatedDeferral.reject(e.message),t.destroy(e)):(v.privCertificateValidatedDeferral.resolve(!0),t.uncork())}))})):v.privCertificateValidatedDeferral.resolve(!0)}else{var u={headers:v.privHeaders};v.privCertificateValidatedDeferral.resolve(!0),r&&(u.agent=new a.Agent({})),v.privWebsocketClient=new s(v.privUri,u)}else v.privCertificateValidatedDeferral.resolve(!0),v.privWebsocketClient=new WebSocket(v.privUri);v.privWebsocketClient.binaryType="arraybuffer",v.privReceivingMessageQueue=new i.Queue,v.privDisconnectDeferral=new i.Deferred,v.privSendMessageQueue=new i.Queue,v.processSendQueue()}catch(e){return v.privConnectionEstablishDeferral.resolve(new i.ConnectionOpenResponse(500,e)),v.privConnectionEstablishDeferral.promise()}return v.onEvent(new i.ConnectionStartEvent(v.privConnectionId,v.privUri)),v.privWebsocketClient.onopen=function(e){v.privCertificateValidatedDeferral.promise().on((function(){v.privConnectionState=i.ConnectionState.Connected,v.onEvent(new i.ConnectionEstablishedEvent(v.privConnectionId)),v.privConnectionEstablishDeferral.resolve(new i.ConnectionOpenResponse(200,""))}),(function(e){v.privConnectionEstablishDeferral.reject(e)}))},v.privWebsocketClient.onerror=function(e){v.privConnectionState,i.ConnectionState.Connecting},v.privWebsocketClient.onclose=function(e){v.privConnectionState===i.ConnectionState.Connecting?(v.privConnectionState=i.ConnectionState.Disconnected,v.privConnectionEstablishDeferral.resolve(new i.ConnectionOpenResponse(e.code,e.reason))):v.onEvent(new i.ConnectionClosedEvent(v.privConnectionId,e.code,e.reason)),v.onClose(e.code,e.reason)},v.privWebsocketClient.onmessage=function(e){var t=(new Date).toISOString();if(v.privConnectionState===i.ConnectionState.Connected){var r=new i.Deferred;if(v.privReceivingMessageQueue.enqueueFromPromise(r.promise()),e.data instanceof ArrayBuffer){var n=new i.RawWebsocketMessage(i.MessageType.Binary,e.data);v.privMessageFormatter.toConnectionMessage(n).on((function(e){v.onEvent(new i.ConnectionMessageReceivedEvent(v.privConnectionId,t,e)),r.resolve(e)}),(function(e){r.reject("Invalid binary message format. Error: "+e)}))}else{n=new i.RawWebsocketMessage(i.MessageType.Text,e.data);v.privMessageFormatter.toConnectionMessage(n).on((function(e){v.onEvent(new i.ConnectionMessageReceivedEvent(v.privConnectionId,t,e)),r.resolve(e)}),(function(e){r.reject("Invalid text message format. Error: "+e)}))}}},v.privConnectionEstablishDeferral.promise()},this.send=function(e){if(v.privConnectionState!==i.ConnectionState.Connected)return i.PromiseHelper.fromError("Cannot send on connection that is in "+v.privConnectionState+" state");var t=new i.Deferred,r=new i.Deferred;return v.privSendMessageQueue.enqueueFromPromise(r.promise()),v.privMessageFormatter.fromConnectionMessage(e).on((function(n){r.resolve({Message:e,RawWebsocketMessage:n,sendStatusDeferral:t})}),(function(e){r.reject("Error formatting the message. "+e)})),t.promise()},this.read=function(){return v.privConnectionState!==i.ConnectionState.Connected?i.PromiseHelper.fromError("Cannot read on connection that is in "+v.privConnectionState+" state"):v.privReceivingMessageQueue.dequeue()},this.close=function(e){if(!v.privWebsocketClient){var t=new i.Deferred;return t.resolve(!0),t.promise()}return v.privConnectionState!==i.ConnectionState.Disconnected&&v.privWebsocketClient.close(1e3,e||"Normal closure by client"),v.privDisconnectDeferral.promise()},this.sendRawMessage=function(e){try{return e?(v.onEvent(new i.ConnectionMessageSentEvent(v.privConnectionId,(new Date).toISOString(),e.Message)),v.isWebsocketOpen?(v.privWebsocketClient.send(e.RawWebsocketMessage.payload),i.PromiseHelper.fromResult(!0)):i.PromiseHelper.fromError("websocket send error: Websocket not ready")):i.PromiseHelper.fromResult(!0)}catch(e){return i.PromiseHelper.fromError("websocket send error: "+e)}},this.onClose=function(e,t){var r="Connection closed. "+e+": "+t;v.privConnectionState=i.ConnectionState.Disconnected,v.privDisconnectDeferral.resolve(!0),v.privReceivingMessageQueue.dispose(t),v.privReceivingMessageQueue.drainAndDispose((function(e){}),r),v.privSendMessageQueue.drainAndDispose((function(e){e.sendStatusDeferral.reject(r)}),r)},this.processSendQueue=function(){v.privSendMessageQueue.dequeue().on((function(e){e&&v.sendRawMessage(e).on((function(t){e.sendStatusDeferral.resolve(t),v.processSendQueue()}),(function(t){e.sendStatusDeferral.reject(t),v.processSendQueue()}))}),(function(e){}))},this.onEvent=function(e){v.privConnectionEvents.onEvent(e),i.Events.instance.onEvent(e)},!r)throw new i.ArgumentNullError("uri");if(!p)throw new i.ArgumentNullError("messageFormatter");this.proxyInfo=u,this.privConnectionEvents=new i.EventSource,this.privConnectionId=c,this.privMessageFormatter=p,this.privConnectionState=i.ConnectionState.None,this.privUri=r,this.privHeaders=h}return Object.defineProperty(t.prototype,"state",{get:function(){return this.privConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"events",{get:function(){return this.privConnectionEvents},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isWebsocketOpen",{get:function(){return this.privWebsocketClient&&this.privWebsocketClient.readyState===this.privWebsocketClient.OPEN},enumerable:!0,configurable:!0}),t.forceNpmWebSocket=!1,t}();t.WebsocketMessageAdapter=c}).call(this,r(98),r(99).Buffer)},function(e,t){var r,n,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(r===setTimeout)return setTimeout(e,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(e){r=o}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var c,p=[],u=!1,h=-1;function v(){u&&c&&(u=!1,c.length?p=c.concat(p):h=-1,p.length&&l())}function l(){if(!u){var e=a(v);u=!0;for(var t=p.length;t;){for(c=p,p=[];++h<t;)c&&c[h].run();h=-1,t=p.length}c=null,u=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function d(e,t){this.fun=e,this.array=t}function f(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];p.push(new d(e,t)),1!==p.length||u||a(l)},d.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=f,i.addListener=f,i.once=f,i.off=f,i.removeListener=f,i.removeAllListeners=f,i.emit=f,i.prependListener=f,i.prependOnceListener=f,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,r){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */
var n=r(251),i=r(252),o=r(253);function s(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(s()<t)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=c.prototype:(null===e&&(e=new c(t)),e.length=t),e}function c(e,t,r){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return h(this,e)}return p(this,e,t,r)}function p(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n);c.TYPED_ARRAY_SUPPORT?(e=t).__proto__=c.prototype:e=v(e,t);return e}(e,t,r,n):"string"==typeof t?function(e,t,r){"string"==typeof r&&""!==r||(r="utf8");if(!c.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|d(t,r),i=(e=a(e,n)).write(t,r);i!==n&&(e=e.slice(0,i));return e}(e,t,r):function(e,t){if(c.isBuffer(t)){var r=0|l(t.length);return 0===(e=a(e,r)).length||t.copy(e,0,0,r),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(n=t.length)!=n?a(e,0):v(e,t);if("Buffer"===t.type&&o(t.data))return v(e,t.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function h(e,t){if(u(t),e=a(e,t<0?0:0|l(t)),!c.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function v(e,t){var r=t.length<0?0:0|l(t.length);e=a(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function l(e){if(e>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|e}function d(e,t){if(c.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return B(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return U(e).length;default:if(n)return B(e).length;t=(""+t).toLowerCase(),n=!0}}function f(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return A(this,t,r);case"utf8":case"utf-8":return E(this,t,r);case"ascii":return T(this,t,r);case"latin1":case"binary":return O(this,t,r);case"base64":return w(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function g(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function y(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=c.from(t,n)),c.isBuffer(t))return 0===t.length?-1:m(e,t,r,n,i);if("number"==typeof t)return t&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):m(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function m(e,t,r,n,i){var o,s=1,a=e.length,c=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;s=2,a/=2,c/=2,r/=2}function p(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){var u=-1;for(o=r;o<a;o++)if(p(e,o)===p(t,-1===u?0:o-u)){if(-1===u&&(u=o),o-u+1===c)return u*s}else-1!==u&&(o-=o-u),u=-1}else for(r+c>a&&(r=a-c),o=r;o>=0;o--){for(var h=!0,v=0;v<c;v++)if(p(e,o+v)!==p(t,v)){h=!1;break}if(h)return o}return-1}function S(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var s=0;s<n;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[r+s]=a}return s}function C(e,t,r,n){return F(B(t,e.length-r),e,r,n)}function b(e,t,r,n){return F(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function P(e,t,r,n){return b(e,t,r,n)}function R(e,t,r,n){return F(U(t),e,r,n)}function I(e,t,r,n){return F(function(e,t){for(var r,n,i,o=[],s=0;s<e.length&&!((t-=2)<0);++s)r=e.charCodeAt(s),n=r>>8,i=r%256,o.push(i),o.push(n);return o}(t,e.length-r),e,r,n)}function w(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function E(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var o,s,a,c,p=e[i],u=null,h=p>239?4:p>223?3:p>191?2:1;if(i+h<=r)switch(h){case 1:p<128&&(u=p);break;case 2:128==(192&(o=e[i+1]))&&(c=(31&p)<<6|63&o)>127&&(u=c);break;case 3:o=e[i+1],s=e[i+2],128==(192&o)&&128==(192&s)&&(c=(15&p)<<12|(63&o)<<6|63&s)>2047&&(c<55296||c>57343)&&(u=c);break;case 4:o=e[i+1],s=e[i+2],a=e[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(c=(15&p)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&c<1114112&&(u=c)}null===u?(u=65533,h=1):u>65535&&(u-=65536,n.push(u>>>10&1023|55296),u=56320|1023&u),n.push(u),i+=h}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=4096));return r}(n)}t.Buffer=c,t.SlowBuffer=function(e){+e!=e&&(e=0);return c.alloc(+e)},t.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=s(),c.poolSize=8192,c._augment=function(e){return e.__proto__=c.prototype,e},c.from=function(e,t,r){return p(null,e,t,r)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(e,t,r){return function(e,t,r,n){return u(t),t<=0?a(e,t):void 0!==r?"string"==typeof n?a(e,t).fill(r,n):a(e,t).fill(r):a(e,t)}(null,e,t,r)},c.allocUnsafe=function(e){return h(null,e)},c.allocUnsafeSlow=function(e){return h(null,e)},c.isBuffer=function(e){return!(null==e||!e._isBuffer)},c.compare=function(e,t){if(!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,o=Math.min(r,n);i<o;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!o(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=c.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var s=e[r];if(!c.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(n,i),i+=s.length}return n},c.byteLength=d,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},c.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?E(this,0,e):f.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(e+=" ... ")),"<Buffer "+e+">"},c.prototype.compare=function(e,t,r,n,i){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(n>>>=0),s=(r>>>=0)-(t>>>=0),a=Math.min(o,s),p=this.slice(n,i),u=e.slice(t,r),h=0;h<a;++h)if(p[h]!==u[h]){o=p[h],s=u[h];break}return o<s?-1:s<o?1:0},c.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},c.prototype.indexOf=function(e,t,r){return y(this,e,t,r,!0)},c.prototype.lastIndexOf=function(e,t,r){return y(this,e,t,r,!1)},c.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return S(this,e,t,r);case"utf8":case"utf-8":return C(this,e,t,r);case"ascii":return b(this,e,t,r);case"latin1":case"binary":return P(this,e,t,r);case"base64":return R(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function T(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function O(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function A(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=t;o<r;++o)i+=q(e[o]);return i}function _(e,t,r){for(var n=e.slice(t,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function D(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function x(e,t,r,n,i,o){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function k(e,t,r,n){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-r,2);i<o;++i)e[r+i]=(t&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function M(e,t,r,n){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-r,4);i<o;++i)e[r+i]=t>>>8*(n?i:3-i)&255}function N(e,t,r,n,i,o){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function j(e,t,r,n,o){return o||N(e,0,r,4),i.write(e,t,r,n,23,4),r+4}function z(e,t,r,n,o){return o||N(e,0,r,8),i.write(e,t,r,n,52,8),r+8}c.prototype.slice=function(e,t){var r,n=this.length;if((e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),c.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=c.prototype;else{var i=t-e;r=new c(i,void 0);for(var o=0;o<i;++o)r[o]=this[o+e]}return r},c.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||D(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n},c.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||D(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},c.prototype.readUInt8=function(e,t){return t||D(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return t||D(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return t||D(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return t||D(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return t||D(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||D(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},c.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||D(e,t,this.length);for(var n=t,i=1,o=this[e+--n];n>0&&(i*=256);)o+=this[e+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},c.prototype.readInt8=function(e,t){return t||D(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){t||D(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},c.prototype.readInt16BE=function(e,t){t||D(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},c.prototype.readInt32LE=function(e,t){return t||D(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return t||D(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return t||D(e,4,this.length),i.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return t||D(e,4,this.length),i.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return t||D(e,8,this.length),i.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return t||D(e,8,this.length),i.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||x(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[t]=255&e;++o<r&&(i*=256);)this[t+o]=e/i&255;return t+r},c.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||x(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+r},c.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||x(this,e,t,1,255,0),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||x(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):k(this,e,t,!0),t+2},c.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||x(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):k(this,e,t,!1),t+2},c.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||x(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):M(this,e,t,!0),t+4},c.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||x(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):M(this,e,t,!1),t+4},c.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);x(this,e,t,r,i-1,-i)}var o=0,s=1,a=0;for(this[t]=255&e;++o<r&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+r},c.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);x(this,e,t,r,i-1,-i)}var o=r-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+r},c.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||x(this,e,t,1,127,-128),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||x(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):k(this,e,t,!0),t+2},c.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||x(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):k(this,e,t,!1),t+2},c.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||x(this,e,t,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):M(this,e,t,!0),t+4},c.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||x(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):M(this,e,t,!1),t+4},c.prototype.writeFloatLE=function(e,t,r){return j(this,e,t,!0,r)},c.prototype.writeFloatBE=function(e,t,r){return j(this,e,t,!1,r)},c.prototype.writeDoubleLE=function(e,t,r){return z(this,e,t,!0,r)},c.prototype.writeDoubleBE=function(e,t,r){return z(this,e,t,!1,r)},c.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i,o=n-r;if(this===e&&r<t&&t<n)for(i=o-1;i>=0;--i)e[i+t]=this[i+r];else if(o<1e3||!c.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+o),t);return o},c.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!c.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var o;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(o=t;o<r;++o)this[o]=e;else{var s=c.isBuffer(e)?e:B(new c(e,n).toString()),a=s.length;for(o=0;o<r-t;++o)this[o+t]=s[o%a]}return this};var L=/[^+\/0-9A-Za-z-_]/g;function q(e){return e<16?"0"+e.toString(16):e.toString(16)}function B(e,t){var r;t=t||1/0;for(var n=e.length,i=null,o=[],s=0;s<n;++s){if((r=e.charCodeAt(s))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function U(e){return n.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(L,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function F(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}}).call(this,r(66))},function(e,t,r){var n=r(101);function i(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return i=function(){return e},e}e.exports=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==n(e)&&"function"!=typeof e)return{default:e};var t=i();if(t&&t.has(e))return t.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){var a=o?Object.getOwnPropertyDescriptor(e,s):null;a&&(a.get||a.set)?Object.defineProperty(r,s,a):r[s]=e[s]}return r.default=e,t&&t.set(e,r),r}},function(e,t){function r(t){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=r=function(e){return typeof e}:e.exports=r=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(t)}e.exports=r},function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}e.exports=function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}},function(e,t,r){var n=r(260);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}},function(e,t,r){var n=r(101),i=r(261);e.exports=function(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?i(e):t}},function(e,t){function r(t){return e.exports=r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},r(t)}e.exports=r},function(e,t){function r(t){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=r=function(e){return typeof e}:e.exports=r=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(t)}e.exports=r},function(e,t,r){e.exports=r(80)},function(e,t){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}},function(e,t){function r(e,t,r,n,i,o,s){try{var a=e[o](s),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(n,i)}e.exports=function(e){return function(){var t=this,n=arguments;return new Promise((function(i,o){var s=e.apply(t,n);function a(e){r(s,i,o,a,c,"next",e)}function c(e){r(s,i,o,a,c,"throw",e)}a(void 0)}))}}},function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}e.exports=function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(277),i={AudioConfig:n.AudioConfig,OutputFormat:n.OutputFormat,ResultReason:n.ResultReason,SpeechConfig:n.SpeechConfig,SpeechRecognizer:n.SpeechRecognizer};t.default=i},function(e,t,r){"use strict";var n=r(8);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("error"===e){if("function"==typeof ErrorEvent)return new ErrorEvent(e,t)}else if("function"==typeof CustomEvent)return new CustomEvent(e,t);var r=document.createEvent("Event");return r.initEvent(e,!0,!0),Object.entries(t).forEach((function(e){var t=(0,i.default)(e,2),n=t[0],o=t[1];r[n]=o})),r};var i=n(r(285))},function(e,t,r){var n=r(115);e.exports=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}},function(e,t){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}},function(e,t,r){"use strict";var n=r(100),i=r(8);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(r(56)),s=i(r(103)),a=i(r(104)),c=i(r(105)),p=n(r(58));function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.default)(e);if(t){var i=(0,c.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var h=function(e){(0,s.default)(r,e);var t=u(r);function r(e){var n;if((0,o.default)(this,r),n=t.call(this),e&&(!e.format||!e.streamReader))throw new Error("The first argument must be a Cognitive Services audio stream.");return n.audioStream=e,n}return r}(p.default);(0,p.defineEventAttribute)(h,"boundary"),(0,p.defineEventAttribute)(h,"end"),(0,p.defineEventAttribute)(h,"error"),(0,p.defineEventAttribute)(h,"start");var v=h;t.default=v},function(e,t,r){var n=r(25);e.exports=!!Object.getOwnPropertySymbols&&!n((function(){return!String(Symbol())}))},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e}},function(e,t,r){var n=r(120),i=r(32),o=r(10)("iterator");e.exports=function(e){if(null!=e)return e[o]||e["@@iterator"]||i[n(e)]}},function(e,t,r){var n=r(61),i=r(69),o=r(10)("toStringTag"),s="Arguments"==i(function(){return arguments}());e.exports=n?i:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),o))?r:s?i(t):"Object"==(n=i(t))&&"function"==typeof t.callee?"Arguments":n}},function(e,t,r){"use strict";var n=r(39),i=r(318),o=r(123),s=r(323),a=r(125),c=r(19),p=r(33),u=r(10),h=r(44),v=r(32),l=r(122),d=l.IteratorPrototype,f=l.BUGGY_SAFARI_ITERATORS,g=u("iterator"),y=function(){return this};e.exports=function(e,t,r,u,l,m,S){i(r,t,u);var C,b,P,R=function(e){if(e===l&&O)return O;if(!f&&e in E)return E[e];switch(e){case"keys":case"values":case"entries":return function(){return new r(this,e)}}return function(){return new r(this)}},I=t+" Iterator",w=!1,E=e.prototype,T=E[g]||E["@@iterator"]||l&&E[l],O=!f&&T||R(l),A="Array"==t&&E.entries||T;if(A&&(C=o(A.call(new e)),d!==Object.prototype&&C.next&&(h||o(C)===d||(s?s(C,d):"function"!=typeof C[g]&&c(C,g,y)),a(C,I,!0,!0),h&&(v[I]=y))),"values"==l&&T&&"values"!==T.name&&(w=!0,O=function(){return T.call(this)}),h&&!S||E[g]===O||c(E,g,O),v[t]=O,l)if(b={values:R("values"),keys:m?O:R("keys"),entries:R("entries")},S)for(P in b)(f||w||!(P in E))&&p(E,P,b[P]);else n({target:t,proto:!0,forced:f||w},b);return b}},function(e,t,r){"use strict";var n,i,o,s=r(123),a=r(19),c=r(14),p=r(10),u=r(44),h=p("iterator"),v=!1;[].keys&&("next"in(o=[].keys())?(i=s(s(o)))!==Object.prototype&&(n=i):v=!0),null==n&&(n={}),u||c(n,h)||a(n,h,(function(){return this})),e.exports={IteratorPrototype:n,BUGGY_SAFARI_ITERATORS:v}},function(e,t,r){var n=r(14),i=r(319),o=r(43),s=r(320),a=o("IE_PROTO"),c=Object.prototype;e.exports=s?Object.getPrototypeOf:function(e){return e=i(e),n(e,a)?e[a]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?c:null}},function(e,t,r){var n,i=r(15),o=r(321),s=r(48),a=r(45),c=r(322),p=r(72),u=r(43),h=u("IE_PROTO"),v=function(){},l=function(e){return"<script>"+e+"<\/script>"},d=function(){try{n=document.domain&&new ActiveXObject("htmlfile")}catch(e){}var e,t;d=n?function(e){e.write(l("")),e.close();var t=e.parentWindow.Object;return e=null,t}(n):((t=p("iframe")).style.display="none",c.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(l("document.F=Object")),e.close(),e.F);for(var r=s.length;r--;)delete d.prototype[s[r]];return d()};a[h]=!0,e.exports=Object.create||function(e,t){var r;return null!==e?(v.prototype=i(e),r=new v,v.prototype=null,r[h]=e):r=d(),void 0===t?r:o(r,t)}},function(e,t,r){var n=r(20).f,i=r(14),o=r(10)("toStringTag");e.exports=function(e,t,r){e&&!i(e=r?e:e.prototype,o)&&n(e,o,{configurable:!0,value:t})}},function(e,t,r){"use strict";(function(e,n){r.d(t,"a",(function(){return y}));var i=r(11),o=r(5),s=r(38),a=r(65),c=r(28),p=r(128),u=r(24),h=r(342),v=r(1),l=r(62),d=r(127),f=r(63),g=r(64);class y{constructor(t,r,m,S,C){if(this.open=()=>{if(this.privConnectionState===i.a.Disconnected)return o.c.fromError(`Cannot open a connection that is in ${this.privConnectionState} state`);if(this.privConnectionEstablishDeferral)return this.privConnectionEstablishDeferral.promise();this.privConnectionEstablishDeferral=new o.a,this.privCertificateValidatedDeferral=new o.a,this.privConnectionState=i.a.Connecting;try{const t=void 0!==e&&"0"!==e.env.NODE_TLS_REJECT_UNAUTHORIZED&&!this.privUri.startsWith("ws:");if("undefined"==typeof WebSocket||y.forceNpmWebSocket)if(void 0!==this.proxyInfo&&void 0!==this.proxyInfo.HostName&&this.proxyInfo.Port>0){const e={host:this.proxyInfo.HostName,port:this.proxyInfo.Port};void 0!==this.proxyInfo.UserName&&(e.headers={"Proxy-Authentication":"Basic "+new n(this.proxyInfo.UserName+":"+(void 0===this.proxyInfo.Password)?"":this.proxyInfo.Password).toString("base64")},t&&(e.headers.requestOCSP="true"));const r={agent:new d(e),headers:this.privHeaders};this.privWebsocketClient=new f(this.privUri,r),t?this.privWebsocketClient.addListener("upgrade",e=>{const t=e.socket,n=t.getPeerCertificate(!0);t.cork(),g.check({cert:n.raw,httpOptions:r,issuer:n.issuerCertificate.raw},(e,r)=>{e?(this.privCertificateValidatedDeferral.reject(e.message),t.destroy(e)):(this.privCertificateValidatedDeferral.resolve(!0),t.uncork())})}):this.privCertificateValidatedDeferral.resolve(!0)}else{const e={headers:this.privHeaders};this.privCertificateValidatedDeferral.resolve(!0),t&&(e.agent=new g.Agent({})),this.privWebsocketClient=new f(this.privUri,e)}else this.privCertificateValidatedDeferral.resolve(!0),this.privWebsocketClient=new WebSocket(this.privUri);this.privWebsocketClient.binaryType="arraybuffer",this.privReceivingMessageQueue=new s.a,this.privDisconnectDeferral=new o.a,this.privSendMessageQueue=new s.a,this.processSendQueue()}catch(e){return this.privConnectionEstablishDeferral.resolve(new a.a(500,e)),this.privConnectionEstablishDeferral.promise()}return this.onEvent(new c.f(this.privConnectionId,this.privUri)),this.privWebsocketClient.onopen=e=>{this.privCertificateValidatedDeferral.promise().on(()=>{this.privConnectionState=i.a.Connected,this.onEvent(new c.c(this.privConnectionId)),this.privConnectionEstablishDeferral.resolve(new a.a(200,""))},e=>{this.privConnectionEstablishDeferral.reject(e)})},this.privWebsocketClient.onerror=e=>{this.privConnectionState,i.a.Connecting},this.privWebsocketClient.onclose=e=>{this.privConnectionState===i.a.Connecting?(this.privConnectionState=i.a.Disconnected,this.privConnectionEstablishDeferral.resolve(new a.a(e.code,e.reason))):this.onEvent(new c.a(this.privConnectionId,e.code,e.reason)),this.onClose(e.code,e.reason)},this.privWebsocketClient.onmessage=e=>{const t=(new Date).toISOString();if(this.privConnectionState===i.a.Connected){const r=new o.a;if(this.privReceivingMessageQueue.enqueueFromPromise(r.promise()),e.data instanceof ArrayBuffer){const n=new p.a(u.b.Binary,e.data);this.privMessageFormatter.toConnectionMessage(n).on(e=>{this.onEvent(new c.d(this.privConnectionId,t,e)),r.resolve(e)},e=>{r.reject("Invalid binary message format. Error: "+e)})}else{const n=new p.a(u.b.Text,e.data);this.privMessageFormatter.toConnectionMessage(n).on(e=>{this.onEvent(new c.d(this.privConnectionId,t,e)),r.resolve(e)},e=>{r.reject("Invalid text message format. Error: "+e)})}}},this.privConnectionEstablishDeferral.promise()},this.send=e=>{if(this.privConnectionState!==i.a.Connected)return o.c.fromError(`Cannot send on connection that is in ${this.privConnectionState} state`);const t=new o.a,r=new o.a;return this.privSendMessageQueue.enqueueFromPromise(r.promise()),this.privMessageFormatter.fromConnectionMessage(e).on(n=>{r.resolve({Message:e,RawWebsocketMessage:n,sendStatusDeferral:t})},e=>{r.reject("Error formatting the message. "+e)}),t.promise()},this.read=()=>this.privConnectionState!==i.a.Connected?o.c.fromError(`Cannot read on connection that is in ${this.privConnectionState} state`):this.privReceivingMessageQueue.dequeue(),this.close=e=>{if(!this.privWebsocketClient){const e=new o.a;return e.resolve(!0),e.promise()}return this.privConnectionState!==i.a.Disconnected&&this.privWebsocketClient.close(1e3,e||"Normal closure by client"),this.privDisconnectDeferral.promise()},this.sendRawMessage=e=>{try{return e?(this.onEvent(new c.e(this.privConnectionId,(new Date).toISOString(),e.Message)),this.isWebsocketOpen?(this.privWebsocketClient.send(e.RawWebsocketMessage.payload),o.c.fromResult(!0)):o.c.fromError("websocket send error: Websocket not ready")):o.c.fromResult(!0)}catch(e){return o.c.fromError("websocket send error: "+e)}},this.onClose=(e,t)=>{const r=`Connection closed. ${e}: ${t}`;this.privConnectionState=i.a.Disconnected,this.privDisconnectDeferral.resolve(!0),this.privReceivingMessageQueue.dispose(t),this.privReceivingMessageQueue.drainAndDispose(e=>{},r),this.privSendMessageQueue.drainAndDispose(e=>{e.sendStatusDeferral.reject(r)},r)},this.processSendQueue=()=>{this.privSendMessageQueue.dequeue().on(e=>{e&&this.sendRawMessage(e).on(t=>{e.sendStatusDeferral.resolve(t),this.processSendQueue()},t=>{e.sendStatusDeferral.reject(t),this.processSendQueue()})},e=>{})},this.onEvent=e=>{this.privConnectionEvents.onEvent(e),h.a.instance.onEvent(e)},!t)throw new v.a("uri");if(!m)throw new v.a("messageFormatter");this.proxyInfo=S,this.privConnectionEvents=new l.a,this.privConnectionId=r,this.privMessageFormatter=m,this.privConnectionState=i.a.None,this.privUri=t,this.privHeaders=C}get state(){return this.privConnectionState}get events(){return this.privConnectionEvents}get isWebsocketOpen(){return this.privWebsocketClient&&this.privWebsocketClient.readyState===this.privWebsocketClient.OPEN}}y.forceNpmWebSocket=!1}).call(this,r(98),r(99).Buffer)},function(e,t){},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var n=r(24),i=r(1),o=r(7);class s{constructor(e,t,r){if(this.privPayload=null,!t)throw new i.a("payload");if(e===n.b.Binary&&!(t instanceof ArrayBuffer))throw new i.b("Payload must be ArrayBuffer");if(e===n.b.Text&&"string"!=typeof t)throw new i.b("Payload must be a string");this.privMessageType=e,this.privPayload=t,this.privId=r||Object(o.b)()}get messageType(){return this.privMessageType}get payload(){return this.privPayload}get textContent(){if(this.privMessageType===n.b.Binary)throw new i.b("Not supported for binary message");return this.privPayload}get binaryContent(){if(this.privMessageType===n.b.Text)throw new i.b("Not supported for text message");return this.privPayload}get id(){return this.privId}}},function(e,t,r){"use strict";var n=r(8);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"createAdapters",{enumerable:!0,get:function(){return i.default}}),r(132);var i=n(r(145));if("undefined"!=typeof HTMLDocument&&"undefined"!=typeof document&&document instanceof HTMLDocument){var o=document.createElement("meta");o.setAttribute("name","botframework-directlinespeech:version"),o.setAttribute("content","4.10.0"),document.head.appendChild(o)}},,,function(e,t,r){var n=r(133);e.exports=n},function(e,t,r){r(134);var n=r(35);e.exports=n.Object.entries},function(e,t,r){var n=r(39),i=r(144).entries;n({target:"Object",stat:!0},{entries:function(e){return i(e)}})},function(e,t,r){var n=r(25),i=r(69),o="".split;e.exports=n((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==i(e)?o.call(e,""):Object(e)}:Object},function(e,t,r){var n=r(9),i=r(73),o=n.WeakMap;e.exports="function"==typeof o&&/native code/.test(i(o))},function(e,t,r){var n=r(14),i=r(138),o=r(67),s=r(20);e.exports=function(e,t){for(var r=i(t),a=s.f,c=o.f,p=0;p<r.length;p++){var u=r[p];n(e,u)||a(e,u,c(t,u))}}},function(e,t,r){var n=r(46),i=r(139),o=r(142),s=r(15);e.exports=n("Reflect","ownKeys")||function(e){var t=i.f(s(e)),r=o.f;return r?t.concat(r(e)):t}},function(e,t,r){var n=r(77),i=r(48).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return n(e,i)}},function(e,t,r){var n=r(29),i=r(78),o=r(141),s=function(e){return function(t,r,s){var a,c=n(t),p=i(c.length),u=o(s,p);if(e&&r!=r){for(;p>u;)if((a=c[u++])!=a)return!0}else for(;p>u;u++)if((e||u in c)&&c[u]===r)return e||u||0;return!e&&-1}};e.exports={includes:s(!0),indexOf:s(!1)}},function(e,t,r){var n=r(47),i=Math.max,o=Math.min;e.exports=function(e,t){var r=n(e);return r<0?i(r+t,0):o(r,t)}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,r){var n=r(25),i=/#|\.prototype\./,o=function(e,t){var r=a[s(e)];return r==p||r!=c&&("function"==typeof t?n(t):!!t)},s=o.normalize=function(e){return String(e).replace(i,".").toLowerCase()},a=o.data={},c=o.NATIVE="N",p=o.POLYFILL="P";e.exports=o},function(e,t,r){var n=r(18),i=r(79),o=r(29),s=r(68).f,a=function(e){return function(t){for(var r,a=o(t),c=i(a),p=c.length,u=0,h=[];p>u;)r=c[u++],n&&!s.call(a,r)||h.push(e?[r,a[r]]:a[r]);return h}};e.exports={entries:a(!0),values:a(!1)}},function(e,t,r){"use strict";var n=r(8);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return l.apply(this,arguments)};var i=n(r(22)),o=n(r(23)),s=r(81),a=r(341),c=n(r(259)),p=n(r(298)),u=n(r(332)),h=n(r(337)),v=n(r(340));function l(){return(l=(0,o.default)(i.default.mark((function e(t){var r,n,l,d,f,g,y,m,S,C,b,P,R,I,w,E,T,O,A,_,D,x,k,M,N;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.audioConfig,n=t.audioContext,l=t.audioInputDeviceId,d=t.enableInternalHTTPSupport,f=t.enableTelemetry,g=t.fetchCredentials,y=t.speechRecognitionEndpointId,m=t.speechRecognitionLanguage,S=void 0===m?"undefined"!=typeof window&&void 0!==window.navigator&&window.navigator.language||"en-US":m,C=t.speechSynthesisDeploymentId,b=t.speechSynthesisOutputFormat,P=t.textNormalization,R=t.userID,I=t.username,g){e.next=3;break}throw new Error('"fetchCredentials" must be specified.');case 3:return e.next=5,(0,v.default)(g);case 5:if(w=e.sent,E=w.authorizationToken,T=w.directLineToken,O=w.region,A=w.subscriptionKey,!(!E&&!A||E&&A||E&&"string"!=typeof E||A&&"string"!=typeof A||d&&!T)){e.next=12;break}throw new Error('"fetchCredentials" must return either "authorizationToken" or "subscriptionKey" as a non-empty string only. If enableInternalHTTPSupport is set to true, then it should also return a non-empty "directLineToken"');case 12:if(void 0!==f&&console.warn("botframework-directlinespeech: Telemetry options are not yet supported. Please refer to Cognitive Services documentation for details."),O&&"string"==typeof O){e.next=15;break}throw new Error('"fetchCredentials" must return "region" as a non-empty string.');case 15:return r&&l?console.warn('botframework-directlinespeech-sdk: Only "audioConfig" or "audioInputDeviceId" can be specified, but not both; ignoring "audioInputDeviceId".'):r||(r=l?s.AudioConfig.fromMicrophoneInput(l):s.AudioConfig.fromDefaultMicrophoneInput()),y&&console.warn('botframework-directlinespeech: Custom Speech is currently not supported; ignoring "speechRecognitionEndpointId".'),C&&console.warn('botframework-directlinespeech: Custom Voice is currently not supported; ignoring "speechSynthesisDeploymentId".'),b&&console.warn('botframework-directlinespeech: Synthesis output format is currently not supported; ignoring "speechSynthesisOutputFormat".'),P&&console.warn('botframework-directlinespeech: Text normalization is currently not supported; ignoring "textNormalization".'),(R||I)&&console.warn('botframework-directlinespeech: Custom "userId" and "username" are currently not supported and are ignored.'),_=E?a.BotFrameworkConfig.fromAuthorizationToken(E,O):a.BotFrameworkConfig.fromSubscription(A,O),d&&(_.setProperty(a.PropertyId.SpeechServiceConnection_Endpoint,"wss://".concat(encodeURI(O),".convai.speech.microsoft.com/directline/api/v1")),_.setProperty(a.PropertyId.Conversation_ApplicationId,T)),_.setProperty(a.PropertyId.SpeechServiceConnection_RecoLanguage,S),R&&_.setProperty(a.PropertyId.Conversation_From_Id,R),(D=(0,u.default)(new a.DialogServiceConnector(_,r))).connect(),E&&(x=setInterval((0,o.default)(i.default.mark((function e(){var t,r,n;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return D.privIsDisposed&&clearInterval(x),e.next=3,(0,v.default)(g);case 3:if(t=e.sent,r=t.authorizationToken,n=t.region,r){e.next=8;break}return e.abrupt("return",console.warn('botframework-directlinespeech-sdk: Renew token failed because "fetchCredentials" call returned no authorization token.'));case 8:if(O===n){e.next=10;break}return e.abrupt("return",console.warn("botframework-directlinespeech-sdk: Region change is not supported for renewed token. Authorization token is not renewed."));case 10:D.authorizationToken=r;case 11:case"end":return e.stop()}}),e)}))),12e4)),d&&(k=setInterval((0,o.default)(i.default.mark((function e(){var t;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return D.privIsDisposed&&clearInterval(k),e.next=3,(0,h.default)(T);case 3:if(t=e.sent){e.next=6;break}return e.abrupt("return",console.warn("botframework-directlinespeech-sdk: Renew token failed because call to refresh token Direct Line API did not return a new token."));case 6:_.setProperty(a.PropertyId.Conversation_ApplicationId,t),D.properties.setProperty(a.PropertyId.Conversation_ApplicationId,t),D.connect();case 9:case"end":return e.stop()}}),e)}))),9e5)),M=new p.default({dialogServiceConnector:D}),N=(0,c.default)({audioContext:n,enableTelemetry:f,recognizer:D,textNormalization:P}),e.abrupt("return",{directLine:M,webSpeechPonyfillFactory:N});case 32:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(3),i=function(e){var t=this;void 0===e&&(e=n.EventType.Warning),this.onEvent=function(e){if(e.eventType>=t.privLogLevelFilter){var r=t.toString(e);switch(e.eventType){case n.EventType.Debug:console.debug(r);break;case n.EventType.Info:console.info(r);break;case n.EventType.Warning:console.warn(r);break;case n.EventType.Error:console.error(r);break;default:console.log(r)}}},this.toString=function(e){var t=[""+e.EventTime,""+e.Name];for(var r in e)if(r&&e.hasOwnProperty(r)&&"eventTime"!==r&&"eventType"!==r&&"eventId"!==r&&"name"!==r&&"constructor"!==r){var n=e[r],i="<NULL>";null!=n&&(i="number"==typeof n||"string"==typeof n?n.toString():JSON.stringify(n)),t.push(r+": "+i)}return t.join(" | ")},this.privLogLevelFilter=e};t.ConsoleLoggingListener=i},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(49),s=function(e){function t(t,r,n){void 0===n&&(n=o.EventType.Info);var i=e.call(this,t,n)||this;return i.privAudioSourceId=r,i}return i(t,e),Object.defineProperty(t.prototype,"audioSourceId",{get:function(){return this.privAudioSourceId},enumerable:!0,configurable:!0}),t}(o.PlatformEvent);t.AudioSourceEvent=s;var a=function(e){function t(t){return e.call(this,"AudioSourceInitializingEvent",t)||this}return i(t,e),t}(s);t.AudioSourceInitializingEvent=a;var c=function(e){function t(t){return e.call(this,"AudioSourceReadyEvent",t)||this}return i(t,e),t}(s);t.AudioSourceReadyEvent=c;var p=function(e){function t(t){return e.call(this,"AudioSourceOffEvent",t)||this}return i(t,e),t}(s);t.AudioSourceOffEvent=p;var u=function(e){function t(t,r){var n=e.call(this,"AudioSourceErrorEvent",t,o.EventType.Error)||this;return n.privError=r,n}return i(t,e),Object.defineProperty(t.prototype,"error",{get:function(){return this.privError},enumerable:!0,configurable:!0}),t}(s);t.AudioSourceErrorEvent=u;var h=function(e){function t(t,r,n){var i=e.call(this,t,r)||this;return i.privAudioNodeId=n,i}return i(t,e),Object.defineProperty(t.prototype,"audioNodeId",{get:function(){return this.privAudioNodeId},enumerable:!0,configurable:!0}),t}(s);t.AudioStreamNodeEvent=h;var v=function(e){function t(t,r){return e.call(this,"AudioStreamNodeAttachingEvent",t,r)||this}return i(t,e),t}(h);t.AudioStreamNodeAttachingEvent=v;var l=function(e){function t(t,r){return e.call(this,"AudioStreamNodeAttachedEvent",t,r)||this}return i(t,e),t}(h);t.AudioStreamNodeAttachedEvent=l;var d=function(e){function t(t,r){return e.call(this,"AudioStreamNodeDetachedEvent",t,r)||this}return i(t,e),t}(h);t.AudioStreamNodeDetachedEvent=d;var f=function(e){function t(t,r,n){var i=e.call(this,"AudioStreamNodeErrorEvent",t,r)||this;return i.privError=n,i}return i(t,e),Object.defineProperty(t.prototype,"error",{get:function(){return this.privError},enumerable:!0,configurable:!0}),t}(h);t.AudioStreamNodeErrorEvent=f},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(49),s=function(e){function t(t,r,n){void 0===n&&(n=o.EventType.Info);var i=e.call(this,t,n)||this;return i.privJsonResult=r,i}return i(t,e),Object.defineProperty(t.prototype,"jsonString",{get:function(){return this.privJsonResult},enumerable:!0,configurable:!0}),t}(o.PlatformEvent);t.ServiceEvent=s;var a=function(e){function t(t,r,n){void 0===n&&(n=o.EventType.Info);var i=e.call(this,t,n)||this;return i.privConnectionId=r,i}return i(t,e),Object.defineProperty(t.prototype,"connectionId",{get:function(){return this.privConnectionId},enumerable:!0,configurable:!0}),t}(o.PlatformEvent);t.ConnectionEvent=a;var c=function(e){function t(t,r,n){var i=e.call(this,"ConnectionStartEvent",t)||this;return i.privUri=r,i.privHeaders=n,i}return i(t,e),Object.defineProperty(t.prototype,"uri",{get:function(){return this.privUri},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"headers",{get:function(){return this.privHeaders},enumerable:!0,configurable:!0}),t}(a);t.ConnectionStartEvent=c;var p=function(e){function t(t,r){return e.call(this,"ConnectionEstablishedEvent",t)||this}return i(t,e),t}(a);t.ConnectionEstablishedEvent=p;var u=function(e){function t(t,r,n){var i=e.call(this,"ConnectionClosedEvent",t,o.EventType.Debug)||this;return i.privRreason=n,i.privStatusCode=r,i}return i(t,e),Object.defineProperty(t.prototype,"reason",{get:function(){return this.privRreason},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"statusCode",{get:function(){return this.privStatusCode},enumerable:!0,configurable:!0}),t}(a);t.ConnectionClosedEvent=u;var h=function(e){function t(t,r,n){var i=e.call(this,"ConnectionEstablishErrorEvent",t,o.EventType.Error)||this;return i.privStatusCode=r,i.privReason=n,i}return i(t,e),Object.defineProperty(t.prototype,"reason",{get:function(){return this.privReason},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"statusCode",{get:function(){return this.privStatusCode},enumerable:!0,configurable:!0}),t}(a);t.ConnectionEstablishErrorEvent=h;var v=function(e){function t(t,r,n){var i=e.call(this,"ConnectionMessageReceivedEvent",t)||this;return i.privNetworkReceivedTime=r,i.privMessage=n,i}return i(t,e),Object.defineProperty(t.prototype,"networkReceivedTime",{get:function(){return this.privNetworkReceivedTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"message",{get:function(){return this.privMessage},enumerable:!0,configurable:!0}),t}(a);t.ConnectionMessageReceivedEvent=v;var l=function(e){function t(t,r,n){var i=e.call(this,"ConnectionMessageSentEvent",t)||this;return i.privNetworkSentTime=r,i.privMessage=n,i}return i(t,e),Object.defineProperty(t.prototype,"networkSentTime",{get:function(){return this.privNetworkSentTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"message",{get:function(){return this.privMessage},enumerable:!0,configurable:!0}),t}(a);t.ConnectionMessageSentEvent=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this.privStatusCode=e,this.privReason=t}return Object.defineProperty(e.prototype,"statusCode",{get:function(){return this.privStatusCode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reason",{get:function(){return this.privReason},enumerable:!0,configurable:!0}),e}();t.ConnectionOpenResponse=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(12),i=r(83),o=function(){function e(){}return Object.defineProperty(e,"instance",{get:function(){return e.privInstance},enumerable:!0,configurable:!0}),e.privInstance=new i.EventSource,e.setEventSource=function(t){if(!t)throw new n.ArgumentNullError("eventSource");e.privInstance=t},e}();t.Events=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.None=0]="None",e[e.Connected=1]="Connected",e[e.Connecting=2]="Connecting",e[e.Disconnected=3]="Disconnected"}(t.ConnectionState||(t.ConnectionState={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(82),i=r(12),o=r(21),s=function(){function e(e,t,r){if(this.privPayload=null,!t)throw new i.ArgumentNullError("payload");if(e===n.MessageType.Binary&&!(t instanceof ArrayBuffer))throw new i.InvalidOperationError("Payload must be ArrayBuffer");if(e===n.MessageType.Text&&"string"!=typeof t)throw new i.InvalidOperationError("Payload must be a string");this.privMessageType=e,this.privPayload=t,this.privId=r||o.createNoDashGuid()}return Object.defineProperty(e.prototype,"messageType",{get:function(){return this.privMessageType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"payload",{get:function(){return this.privPayload},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textContent",{get:function(){if(this.privMessageType===n.MessageType.Binary)throw new i.InvalidOperationError("Not supported for binary message");return this.privPayload},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"binaryContent",{get:function(){if(this.privMessageType===n.MessageType.Text)throw new i.InvalidOperationError("Not supported for text message");return this.privPayload},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.privId},enumerable:!0,configurable:!0}),e}();t.RawWebsocketMessage=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t){var r=this;this.encode=function(e){var t=r.downSampleAudioFrame(e,r.privActualSampleRate,r.privDesiredSampleRate);if(!t)return null;var n=2*t.length,i=new ArrayBuffer(n),o=new DataView(i);return r.floatTo16BitPCM(o,0,t),i},this.setString=function(e,t,r){for(var n=0;n<r.length;n++)e.setUint8(t+n,r.charCodeAt(n))},this.floatTo16BitPCM=function(e,t,r){for(var n=0;n<r.length;n++,t+=2){var i=Math.max(-1,Math.min(1,r[n]));e.setInt16(t,i<0?32768*i:32767*i,!0)}},this.downSampleAudioFrame=function(e,t,r){if(r===t||r>t)return e;for(var n=t/r,i=Math.round(e.length/n),o=new Float32Array(i),s=0,a=0;a<i;){for(var c=Math.round((a+1)*n),p=0,u=0;s<c&&s<e.length;)p+=e[s++],u++;o[a++]=p/u}return o},this.privActualSampleRate=e,this.privDesiredSampleRate=t};t.RiffPcmEncoder=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(12),i=r(21),o=r(85),s=function(){function e(e){var t=this;this.privReaderIdCounter=1,this.privIsEnded=!1,this.getReader=function(){var e=t.privReaderIdCounter;t.privReaderIdCounter++;var r=new o.Queue,n=t.privStreambuffer.length;t.privReaderQueues[e]=r;for(var i=0;i<n;i++)r.enqueue(t.privStreambuffer[i]);return new a(t.privId,r,(function(){delete t.privReaderQueues[e]}))},this.throwIfClosed=function(){if(t.privIsEnded)throw new n.InvalidOperationError("Stream closed")},this.privId=e||i.createNoDashGuid(),this.privStreambuffer=[],this.privReaderQueues={}}return Object.defineProperty(e.prototype,"isClosed",{get:function(){return this.privIsEnded},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.privId},enumerable:!0,configurable:!0}),e.prototype.close=function(){this.privIsEnded||(this.writeStreamChunk({buffer:null,isEnd:!0,timeReceived:Date.now()}),this.privIsEnded=!0)},e.prototype.writeStreamChunk=function(e){for(var t in this.throwIfClosed(),this.privStreambuffer.push(e),this.privReaderQueues)if(!this.privReaderQueues[t].isDisposed())try{this.privReaderQueues[t].enqueue(e)}catch(e){}},e}();t.Stream=s;var a=function(){function e(e,t,r){var i=this;this.privIsClosed=!1,this.read=function(){if(i.isClosed)throw new n.InvalidOperationError("StreamReader closed");return i.privReaderQueue.dequeue().onSuccessContinueWith((function(e){return(void 0===e||e.isEnd)&&i.privReaderQueue.dispose("End of stream reached"),e}))},this.close=function(){i.privIsClosed||(i.privIsClosed=!0,i.privReaderQueue.dispose("StreamReader closed"),i.privOnClose())},this.privReaderQueue=t,this.privOnClose=r,this.privStreamId=e}return Object.defineProperty(e.prototype,"isClosed",{get:function(){return this.privIsClosed},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"streamId",{get:function(){return this.privStreamId},enumerable:!0,configurable:!0}),e}();t.StreamReader=a},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,r){var n=e.call(this,r)||this;return n.privTargetChunkSize=t,n.privNextBufferReadyBytes=0,n}return i(t,e),t.prototype.writeStreamChunk=function(t){if(t.isEnd||0===this.privNextBufferReadyBytes&&t.buffer.byteLength===this.privTargetChunkSize)e.prototype.writeStreamChunk.call(this,t);else for(var r=0;r<t.buffer.byteLength;){void 0===this.privNextBufferToWrite&&(this.privNextBufferToWrite=new ArrayBuffer(this.privTargetChunkSize),this.privNextBufferStartTime=t.timeReceived);var n=Math.min(t.buffer.byteLength-r,this.privTargetChunkSize-this.privNextBufferReadyBytes),i=new Uint8Array(this.privNextBufferToWrite),o=new Uint8Array(t.buffer.slice(r,n+r));i.set(o,this.privNextBufferReadyBytes),this.privNextBufferReadyBytes+=n,r+=n,this.privNextBufferReadyBytes===this.privTargetChunkSize&&(e.prototype.writeStreamChunk.call(this,{buffer:this.privNextBufferToWrite,isEnd:!1,timeReceived:this.privNextBufferStartTime}),this.privNextBufferReadyBytes=0,this.privNextBufferToWrite=void 0)}},t.prototype.close=function(){0===this.privNextBufferReadyBytes||this.isClosed||e.prototype.writeStreamChunk.call(this,{buffer:this.privNextBufferToWrite.slice(0,this.privNextBufferReadyBytes),isEnd:!1,timeReceived:this.privNextBufferStartTime}),e.prototype.close.call(this)},t}(r(3).Stream);t.ChunkedArrayBufferStream=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(30),i=r(2),o=r(3);t.AudioWorkletSourceURLPropertyName="MICROPHONE-WorkletSourceUrl";var s=function(){function e(t,r,n){var i=this;this.privRecorder=t,this.deviceId=r,this.privStreams={},this.turnOn=function(){if(i.privInitializeDeferral)return i.privInitializeDeferral.promise();i.privInitializeDeferral=new o.Deferred;try{i.createAudioContext()}catch(t){if(t instanceof Error){var e=t;i.privInitializeDeferral.reject(e.name+": "+e.message)}else i.privInitializeDeferral.reject(t);return i.privInitializeDeferral.promise()}var t=window.navigator,r=t.getUserMedia||t.webkitGetUserMedia||t.mozGetUserMedia||t.msGetUserMedia;if(t.mediaDevices&&(r=function(e,r,n){t.mediaDevices.getUserMedia(e).then(r).catch(n)}),r){var n=function(){i.onEvent(new o.AudioSourceInitializingEvent(i.privId)),r({audio:!i.deviceId||{deviceId:i.deviceId},video:!1},(function(e){i.privMediaStream=e,i.onEvent(new o.AudioSourceReadyEvent(i.privId)),i.privInitializeDeferral.resolve(!0)}),(function(e){var t="Error occurred during microphone initialization: "+e,r=i.privInitializeDeferral;i.privInitializeDeferral=null,r.reject(t),i.onEvent(new o.AudioSourceErrorEvent(i.privId,t))}))};"suspended"===i.privContext.state?i.privContext.resume().then(n,(function(e){i.privInitializeDeferral.reject("Failed to initialize audio context: "+e)})):n()}else{var s="Browser does not support getUserMedia.";i.privInitializeDeferral.reject(s),i.onEvent(new o.AudioSourceErrorEvent(s,""))}return i.privInitializeDeferral.promise()},this.id=function(){return i.privId},this.attach=function(e){return i.onEvent(new o.AudioStreamNodeAttachingEvent(i.privId,e)),i.listen(e).onSuccessContinueWith((function(t){return i.onEvent(new o.AudioStreamNodeAttachedEvent(i.privId,e)),{detach:function(){t.close(),i.turnOff(),delete i.privStreams[e],i.onEvent(new o.AudioStreamNodeDetachedEvent(i.privId,e))},id:function(){return e},read:function(){return t.read()}}}))},this.detach=function(e){e&&i.privStreams[e]&&(i.privStreams[e].close(),delete i.privStreams[e],i.onEvent(new o.AudioStreamNodeDetachedEvent(i.privId,e)))},this.turnOff=function(){for(var e in i.privStreams)if(e){var t=i.privStreams[e];t&&t.close()}return i.onEvent(new o.AudioSourceOffEvent(i.privId)),i.privInitializeDeferral=null,i.destroyAudioContext(),o.PromiseHelper.fromResult(!0)},this.listen=function(e){return i.turnOn().onSuccessContinueWith((function(t){var r=new o.ChunkedArrayBufferStream(i.privOutputChunkSize,e);i.privStreams[e]=r;try{i.privRecorder.record(i.privContext,i.privMediaStream,r)}catch(t){throw i.onEvent(new o.AudioStreamNodeErrorEvent(i.privId,e,t)),t}return r.getReader()}))},this.onEvent=function(e){i.privEvents.onEvent(e),o.Events.instance.onEvent(e)},this.createAudioContext=function(){if(!i.privContext){var e=window.AudioContext||window.webkitAudioContext||!1;if(!e)throw new Error("Browser does not support Web Audio API (AudioContext is not available).");i.privContext=new e}},this.destroyAudioContext=function(){if(i.privContext){i.privRecorder.releaseMediaResources(i.privContext);var e=!1;"close"in i.privContext&&(e=!0),e?(i.privContext.close(),i.privContext=null):null!==i.privContext&&"running"===i.privContext.state&&i.privContext.suspend()}},this.privOutputChunkSize=e.AUDIOFORMAT.avgBytesPerSec/10,this.privId=n||o.createNoDashGuid(),this.privEvents=new o.EventSource}return Object.defineProperty(e.prototype,"format",{get:function(){return o.PromiseHelper.fromResult(e.AUDIOFORMAT)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"events",{get:function(){return this.privEvents},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"deviceInfo",{get:function(){return this.getMicrophoneLabel().onSuccessContinueWith((function(t){return{bitspersample:e.AUDIOFORMAT.bitsPerSample,channelcount:e.AUDIOFORMAT.channels,connectivity:i.connectivity.Unknown,manufacturer:"Speech SDK",model:t,samplerate:e.AUDIOFORMAT.samplesPerSec,type:i.type.Microphones}}))},enumerable:!0,configurable:!0}),e.prototype.setProperty=function(e,r){if(e!==t.AudioWorkletSourceURLPropertyName)throw new Error("Property '"+e+"' is not supported on Microphone.");this.privRecorder.setWorkletUrl(r)},e.prototype.getMicrophoneLabel=function(){var e=this;if(void 0!==this.privMicrophoneLabel)return o.PromiseHelper.fromResult(this.privMicrophoneLabel);if(void 0===this.privMediaStream||!this.privMediaStream.active)return o.PromiseHelper.fromResult("microphone");this.privMicrophoneLabel="microphone";var t=this.privMediaStream.getTracks()[0].getSettings().deviceId;if(void 0===t)return o.PromiseHelper.fromResult(this.privMicrophoneLabel);var r=new o.Deferred;return navigator.mediaDevices.enumerateDevices().then((function(n){for(var i=0,o=n;i<o.length;i++){var s=o[i];if(s.deviceId===t){e.privMicrophoneLabel=s.label;break}}r.resolve(e.privMicrophoneLabel)}),(function(){return r.resolve(e.privMicrophoneLabel)})),r.promise()},e.AUDIOFORMAT=n.AudioStreamFormat.getDefaultInputFormat(),e}();t.MicAudioSource=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(3),i=r(52),o=function(e){var t=this;if(this.fetch=function(e){return n.PromiseHelper.fromResult(t.privAuthInfo)},this.fetchOnExpiry=function(e){return n.PromiseHelper.fromResult(t.privAuthInfo)},!e)throw new n.ArgumentNullError("subscriptionKey");this.privAuthInfo=new i.AuthInfo("Ocp-Apim-Subscription-Key",e)};t.CognitiveSubscriptionKeyAuthentication=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(3),i=r(52),o=function(e,t){var r=this;if(this.fetch=function(e){return r.privFetchCallback(e).onSuccessContinueWith((function(e){return new i.AuthInfo("Authorization",e)}))},this.fetchOnExpiry=function(e){return r.privFetchOnExpiryCallback(e).onSuccessContinueWith((function(e){return new i.AuthInfo("Authorization",e)}))},!e)throw new n.ArgumentNullError("fetchCallback");if(!t)throw new n.ArgumentNullError("fetchOnExpiryCallback");this.privFetchCallback=e,this.privFetchOnExpiryCallback=t};t.CognitiveTokenAuthentication=o},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(16),s=r(0),a=r(31),c=r(2),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.create=function(e,r,n){var i=e.parameters.getProperty(s.PropertyId.SpeechServiceConnection_Endpoint);if(!i){var a=e.parameters.getProperty(s.PropertyId.SpeechServiceConnection_IntentRegion);i=e.parameters.getProperty(s.PropertyId.SpeechServiceConnection_Host,"wss://speech.platform.bing.com")+"/speech/"+t.getSpeechRegionFromIntentRegion(a)+"/recognition/interactive/cognitiveservices/v1"}var p={format:"simple",language:e.parameters.getProperty(s.PropertyId.SpeechServiceConnection_RecoLanguage)};t.setCommonUrlParams(e,p,i);var u={};return void 0!==r.token&&""!==r.token&&(u[r.headerName]=r.token),u["X-ConnectionId"]=n,e.parameters.setProperty(s.PropertyId.SpeechServiceConnection_Url,i),new o.WebsocketConnection(i,p,u,new c.WebsocketMessageFormatter,o.ProxyInfo.fromRecognizerConfig(e),n)},t}return i(t,e),t.prototype.getSpeechRegionFromIntentRegion=function(e){switch(e){case"West US":case"US West":case"westus":return"uswest";case"West US 2":case"US West 2":case"westus2":return"uswest2";case"South Central US":case"US South Central":case"southcentralus":return"ussouthcentral";case"West Central US":case"US West Central":case"westcentralus":return"uswestcentral";case"East US":case"US East":case"eastus":return"useast";case"East US 2":case"US East 2":case"eastus2":return"useast2";case"West Europe":case"Europe West":case"westeurope":return"europewest";case"North Europe":case"Europe North":case"northeurope":return"europenorth";case"Brazil South":case"South Brazil":case"southbrazil":return"brazilsouth";case"Australia East":case"East Australia":case"eastaustralia":return"australiaeast";case"Southeast Asia":case"Asia Southeast":case"southeastasia":return"asiasoutheast";case"East Asia":case"Asia East":case"eastasia":return"asiaeast";default:return e}},t}(a.ConnectionFactoryBase);t.IntentConnectionFactory=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Error=0]="Error",e[e.EndOfStream=1]="EndOfStream"}(t.CancellationReason||(t.CancellationReason={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){};t.PullAudioInputStreamCallback=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(6),i=function(){function e(){this.privDisposed=!1}return e.fromFile=function(e){throw n.Contracts.throwIfFileDoesNotExist(e,"fileName"),new Error("Not yet implemented.")},e.fromStream=function(e){throw n.Contracts.throwIfNull(e,"file"),new Error("Not yet implemented.")},e.prototype.close=function(){this.privDisposed||(this.privDisposed=!0)},e}();t.KeywordRecognitionModel=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.privSessionId=e}return Object.defineProperty(e.prototype,"sessionId",{get:function(){return this.privSessionId},enumerable:!0,configurable:!0}),e}();t.SessionEventArgs=n},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,r){var n=e.call(this,r)||this;return n.privOffset=t,n}return i(t,e),Object.defineProperty(t.prototype,"offset",{get:function(){return this.privOffset},enumerable:!0,configurable:!0}),t}(r(0).SessionEventArgs);t.RecognitionEventArgs=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Simple=0]="Simple",e[e.Detailed=1]="Detailed"}(t.OutputFormat||(t.OutputFormat={}))},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,r,n){var i=e.call(this,r,n)||this;return i.privResult=t,i}return i(t,e),Object.defineProperty(t.prototype,"result",{get:function(){return this.privResult},enumerable:!0,configurable:!0}),t}(r(0).RecognitionEventArgs);t.IntentRecognitionEventArgs=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,r,n,i,o,s,a){this.privResultId=e,this.privReason=t,this.privText=r,this.privDuration=n,this.privOffset=i,this.privErrorDetails=o,this.privJson=s,this.privProperties=a}return Object.defineProperty(e.prototype,"resultId",{get:function(){return this.privResultId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reason",{get:function(){return this.privReason},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this.privText},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return this.privDuration},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"offset",{get:function(){return this.privOffset},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"errorDetails",{get:function(){return this.privErrorDetails},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"json",{get:function(){return this.privJson},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"properties",{get:function(){return this.privProperties},enumerable:!0,configurable:!0}),e}();t.RecognitionResult=n},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,r,n,i,o,s,a,c){return e.call(this,t,r,n,i,o,s,a,c)||this}return i(t,e),t}(r(0).RecognitionResult);t.SpeechRecognitionResult=o},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,r,n,i,o,s,a,c,p){var u=e.call(this,r,n,i,o,s,a,c,p)||this;return u.privIntentId=t,u}return i(t,e),Object.defineProperty(t.prototype,"intentId",{get:function(){return this.privIntentId},enumerable:!0,configurable:!0}),t}(r(0).SpeechRecognitionResult);t.IntentRecognitionResult=o},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(6),s=function(){function e(){}return e.fromEndpoint=function(e){o.Contracts.throwIfNull(e,"uri"),o.Contracts.throwIfNullOrWhitespace(e.hostname,"uri");var t=new a,r=e.host.indexOf(".");if(-1===r)throw new Error("Could not determine region from endpoint");t.region=e.host.substr(0,r);var n=e.pathname.lastIndexOf("/")+1;if(-1===n)throw new Error("Could not determine appId from endpoint");if(t.appId=e.pathname.substr(n),t.subscriptionKey=e.searchParams.get("subscription-key"),void 0===t.subscriptionKey)throw new Error("Could not determine subscription key from endpoint");return t},e.fromAppId=function(e){o.Contracts.throwIfNullOrWhitespace(e,"appId");var t=new a;return t.appId=e,t},e.fromSubscription=function(e,t,r){o.Contracts.throwIfNullOrWhitespace(e,"subscriptionKey"),o.Contracts.throwIfNullOrWhitespace(t,"appId"),o.Contracts.throwIfNullOrWhitespace(r,"region");var n=new a;return n.appId=t,n.region=r,n.subscriptionKey=e,n},e}();t.LanguageUnderstandingModel=s;var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(s);t.LanguageUnderstandingModelImpl=a},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,r,n){var i=e.call(this,r,n)||this;return i.privResult=t,i}return i(t,e),Object.defineProperty(t.prototype,"result",{get:function(){return this.privResult},enumerable:!0,configurable:!0}),t}(r(0).RecognitionEventArgs);t.SpeechRecognitionEventArgs=o},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,r,n,i,o){var s=e.call(this,i,o)||this;return s.privReason=t,s.privErrorDetails=r,s.privErrorCode=n,s}return i(t,e),Object.defineProperty(t.prototype,"reason",{get:function(){return this.privReason},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"errorCode",{get:function(){return this.privErrorCode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"errorDetails",{get:function(){return this.privErrorDetails},enumerable:!0,configurable:!0}),t}(r(0).RecognitionEventArgs);t.SpeechRecognitionCanceledEventArgs=o},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,r,n){var i=e.call(this,r,n)||this;return i.privResult=t,i}return i(t,e),Object.defineProperty(t.prototype,"result",{get:function(){return this.privResult},enumerable:!0,configurable:!0}),t}(r(0).RecognitionEventArgs);t.TranslationRecognitionEventArgs=o},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,r){var n=e.call(this,r)||this;return n.privResult=t,n}return i(t,e),Object.defineProperty(t.prototype,"result",{get:function(){return this.privResult},enumerable:!0,configurable:!0}),t}(r(0).SessionEventArgs);t.TranslationSynthesisEventArgs=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this.privReason=e,this.privAudio=t}return Object.defineProperty(e.prototype,"audio",{get:function(){return this.privAudio},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reason",{get:function(){return this.privReason},enumerable:!0,configurable:!0}),e}();t.TranslationSynthesisResult=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.NoMatch=0]="NoMatch",e[e.Canceled=1]="Canceled",e[e.RecognizingSpeech=2]="RecognizingSpeech",e[e.RecognizedSpeech=3]="RecognizedSpeech",e[e.RecognizingIntent=4]="RecognizingIntent",e[e.RecognizedIntent=5]="RecognizedIntent",e[e.TranslatingSpeech=6]="TranslatingSpeech",e[e.TranslatedSpeech=7]="TranslatedSpeech",e[e.SynthesizingAudio=8]="SynthesizingAudio",e[e.SynthesizingAudioCompleted=9]="SynthesizingAudioCompleted"}(t.ResultReason||(t.ResultReason={}))},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(2),s=r(6),a=r(0),c=function(){function e(){}return e.fromSubscription=function(e,t){s.Contracts.throwIfNullOrWhitespace(e,"subscriptionKey"),s.Contracts.throwIfNullOrWhitespace(t,"region");var r=new p;return r.setProperty(a.PropertyId.SpeechServiceConnection_Region,t),r.setProperty(a.PropertyId.SpeechServiceConnection_IntentRegion,t),r.setProperty(a.PropertyId.SpeechServiceConnection_Key,e),r},e.fromEndpoint=function(e,t){s.Contracts.throwIfNull(e,"endpoint");var r=new p;return r.setProperty(a.PropertyId.SpeechServiceConnection_Endpoint,e.href),void 0!==t&&r.setProperty(a.PropertyId.SpeechServiceConnection_Key,t),r},e.fromHost=function(e,t){s.Contracts.throwIfNull(e,"hostName");var r=new p;return r.setProperty(a.PropertyId.SpeechServiceConnection_Host,e.protocol+"//"+e.hostname+(""===e.port?"":":"+e.port)),void 0!==t&&r.setProperty(a.PropertyId.SpeechServiceConnection_Key,t),r},e.fromAuthorizationToken=function(e,t){s.Contracts.throwIfNull(e,"authorizationToken"),s.Contracts.throwIfNullOrWhitespace(t,"region");var r=new p;return r.setProperty(a.PropertyId.SpeechServiceConnection_Region,t),r.setProperty(a.PropertyId.SpeechServiceConnection_IntentRegion,t),r.authorizationToken=e,r},e.prototype.close=function(){},e}();t.SpeechConfig=c;var p=function(e){function t(){var t=e.call(this)||this;return t.privProperties=new a.PropertyCollection,t.speechRecognitionLanguage="en-US",t.outputFormat=a.OutputFormat.Simple,t}return i(t,e),Object.defineProperty(t.prototype,"properties",{get:function(){return this.privProperties},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"endPoint",{get:function(){return new URL(this.privProperties.getProperty(a.PropertyId.SpeechServiceConnection_Endpoint))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"subscriptionKey",{get:function(){return this.privProperties.getProperty(a.PropertyId.SpeechServiceConnection_Key)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"region",{get:function(){return this.privProperties.getProperty(a.PropertyId.SpeechServiceConnection_Region)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"authorizationToken",{get:function(){return this.privProperties.getProperty(a.PropertyId.SpeechServiceAuthorization_Token)},set:function(e){this.privProperties.setProperty(a.PropertyId.SpeechServiceAuthorization_Token,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"speechRecognitionLanguage",{get:function(){return this.privProperties.getProperty(a.PropertyId.SpeechServiceConnection_RecoLanguage)},set:function(e){this.privProperties.setProperty(a.PropertyId.SpeechServiceConnection_RecoLanguage,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outputFormat",{get:function(){return a.OutputFormat[this.privProperties.getProperty(o.OutputFormatPropertyName,void 0)]},set:function(e){this.privProperties.setProperty(o.OutputFormatPropertyName,a.OutputFormat[e])},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"endpointId",{get:function(){return this.privProperties.getProperty(a.PropertyId.SpeechServiceConnection_EndpointId)},set:function(e){this.privProperties.setProperty(a.PropertyId.SpeechServiceConnection_EndpointId,e)},enumerable:!0,configurable:!0}),t.prototype.setProperty=function(e,t){s.Contracts.throwIfNull(t,"value"),this.privProperties.setProperty(e,t)},t.prototype.getProperty=function(e,t){return this.privProperties.getProperty(e,t)},t.prototype.setProxy=function(e,t,r,n){this.setProperty(a.PropertyId[a.PropertyId.SpeechServiceConnection_ProxyHostName],e),this.setProperty(a.PropertyId[a.PropertyId.SpeechServiceConnection_ProxyPort],t),this.setProperty(a.PropertyId[a.PropertyId.SpeechServiceConnection_ProxyUserName],r),this.setProperty(a.PropertyId[a.PropertyId.SpeechServiceConnection_ProxyPassword],n)},t.prototype.setServiceProperty=function(e,t,r){var n=JSON.parse(this.privProperties.getProperty(o.ServicePropertiesPropertyName,"{}"));n[e]=t,this.privProperties.setProperty(o.ServicePropertiesPropertyName,JSON.stringify(n))},t.prototype.setProfanity=function(e){this.privProperties.setProperty(a.PropertyId.SpeechServiceResponse_ProfanityOption,a.ProfanityOption[e])},t.prototype.enableAudioLogging=function(){this.privProperties.setProperty(a.PropertyId.SpeechServiceConnection_EnableAudioLogging,"true")},t.prototype.requestWordLevelTimestamps=function(){this.privProperties.setProperty(a.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,"true")},t.prototype.enableDictation=function(){this.privProperties.setProperty(o.ForceDictationPropertyName,"true")},t.prototype.clone=function(){var e=new t;return e.privProperties=this.privProperties.clone(),e},t}(c);t.SpeechConfigImpl=p},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(2),s=r(6),a=r(0),c=function(e){function t(){return e.call(this)||this}return i(t,e),t.fromSubscription=function(e,t){s.Contracts.throwIfNullOrWhitespace(e,"subscriptionKey"),s.Contracts.throwIfNullOrWhitespace(t,"region");var r=new p;return r.properties.setProperty(a.PropertyId.SpeechServiceConnection_Key,e),r.properties.setProperty(a.PropertyId.SpeechServiceConnection_Region,t),r},t.fromAuthorizationToken=function(e,t){s.Contracts.throwIfNullOrWhitespace(e,"authorizationToken"),s.Contracts.throwIfNullOrWhitespace(t,"region");var r=new p;return r.properties.setProperty(a.PropertyId.SpeechServiceAuthorization_Token,e),r.properties.setProperty(a.PropertyId.SpeechServiceConnection_Region,t),r},t.fromHost=function(e,t){s.Contracts.throwIfNull(e,"hostName");var r=new p;return r.setProperty(a.PropertyId.SpeechServiceConnection_Host,e.protocol+"//"+e.hostname+(""===e.port?"":":"+e.port)),void 0!==t&&r.setProperty(a.PropertyId.SpeechServiceConnection_Key,t),r},t.fromEndpoint=function(e,t){s.Contracts.throwIfNull(e,"endpoint"),s.Contracts.throwIfNull(t,"subscriptionKey");var r=new p;return r.properties.setProperty(a.PropertyId.SpeechServiceConnection_Endpoint,e.href),r.properties.setProperty(a.PropertyId.SpeechServiceConnection_Key,t),r},t}(a.SpeechConfig);t.SpeechTranslationConfig=c;var p=function(e){function t(){var t=e.call(this)||this;return t.privSpeechProperties=new a.PropertyCollection,t.outputFormat=a.OutputFormat.Simple,t}return i(t,e),Object.defineProperty(t.prototype,"authorizationToken",{set:function(e){s.Contracts.throwIfNullOrWhitespace(e,"value"),this.privSpeechProperties.setProperty(a.PropertyId.SpeechServiceAuthorization_Token,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"speechRecognitionLanguage",{set:function(e){s.Contracts.throwIfNullOrWhitespace(e,"value"),this.privSpeechProperties.setProperty(a.PropertyId.SpeechServiceConnection_RecoLanguage,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"subscriptionKey",{get:function(){return this.privSpeechProperties.getProperty(a.PropertyId[a.PropertyId.SpeechServiceConnection_Key])},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outputFormat",{get:function(){return a.OutputFormat[this.privSpeechProperties.getProperty(o.OutputFormatPropertyName,void 0)]},set:function(e){this.privSpeechProperties.setProperty(o.OutputFormatPropertyName,a.OutputFormat[e])},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"endpointId",{get:function(){return this.privSpeechProperties.getProperty(a.PropertyId.SpeechServiceConnection_EndpointId)},set:function(e){this.privSpeechProperties.setProperty(a.PropertyId.SpeechServiceConnection_EndpointId,e)},enumerable:!0,configurable:!0}),t.prototype.addTargetLanguage=function(e){s.Contracts.throwIfNullOrWhitespace(e,"value");var t=this.targetLanguages;t.push(e),this.privSpeechProperties.setProperty(a.PropertyId.SpeechServiceConnection_TranslationToLanguages,t.join(","))},Object.defineProperty(t.prototype,"targetLanguages",{get:function(){return void 0!==this.privSpeechProperties.getProperty(a.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0)?this.privSpeechProperties.getProperty(a.PropertyId.SpeechServiceConnection_TranslationToLanguages).split(","):[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"voiceName",{get:function(){return this.getProperty(a.PropertyId[a.PropertyId.SpeechServiceConnection_TranslationVoice])},set:function(e){s.Contracts.throwIfNullOrWhitespace(e,"value"),this.privSpeechProperties.setProperty(a.PropertyId.SpeechServiceConnection_TranslationVoice,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"region",{get:function(){return this.privSpeechProperties.getProperty(a.PropertyId.SpeechServiceConnection_Region)},enumerable:!0,configurable:!0}),t.prototype.setProxy=function(e,t,r,n){this.setProperty(a.PropertyId[a.PropertyId.SpeechServiceConnection_ProxyHostName],e),this.setProperty(a.PropertyId[a.PropertyId.SpeechServiceConnection_ProxyPort],t),this.setProperty(a.PropertyId[a.PropertyId.SpeechServiceConnection_ProxyUserName],r),this.setProperty(a.PropertyId[a.PropertyId.SpeechServiceConnection_ProxyPassword],n)},t.prototype.getProperty=function(e,t){return this.privSpeechProperties.getProperty(e,t)},t.prototype.setProperty=function(e,t){this.privSpeechProperties.setProperty(e,t)},Object.defineProperty(t.prototype,"properties",{get:function(){return this.privSpeechProperties},enumerable:!0,configurable:!0}),t.prototype.close=function(){},t.prototype.setServiceProperty=function(e,t,r){var n=JSON.parse(this.privSpeechProperties.getProperty(o.ServicePropertiesPropertyName,"{}"));n[e]=t,this.privSpeechProperties.setProperty(o.ServicePropertiesPropertyName,JSON.stringify(n))},t.prototype.setProfanity=function(e){this.privSpeechProperties.setProperty(a.PropertyId.SpeechServiceResponse_ProfanityOption,a.ProfanityOption[e])},t.prototype.enableAudioLogging=function(){this.privSpeechProperties.setProperty(a.PropertyId.SpeechServiceConnection_EnableAudioLogging,"true")},t.prototype.requestWordLevelTimestamps=function(){this.privSpeechProperties.setProperty(a.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,"true")},t.prototype.enableDictation=function(){this.privSpeechProperties.setProperty(o.ForceDictationPropertyName,"true")},t}(c);t.SpeechTranslationConfigImpl=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=function(){function e(){this.privKeys=[],this.privValues=[]}return e.prototype.getProperty=function(e,t){var r;r="string"==typeof e?e:n.PropertyId[e];for(var i=0;i<this.privKeys.length;i++)if(this.privKeys[i]===r)return this.privValues[i];return t},e.prototype.setProperty=function(e,t){var r;r="string"==typeof e?e:n.PropertyId[e];for(var i=0;i<this.privKeys.length;i++)if(this.privKeys[i]===r)return void(this.privValues[i]=t);this.privKeys.push(r),this.privValues.push(t)},e.prototype.clone=function(){for(var t=new e,r=0;r<this.privKeys.length;r++)t.privKeys.push(this.privKeys[r]),t.privValues.push(this.privValues[r]);return t},e}();t.PropertyCollection=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),i=r(3),o=r(6),s=r(0),a=function(){function e(e,t,r){this.audioConfig=void 0!==e?e:s.AudioConfig.fromDefaultMicrophoneInput(),this.privDisposed=!1,this.privProperties=t.clone(),this.privConnectionFactory=r,this.implCommonRecognizerSetup()}return e.prototype.close=function(){o.Contracts.throwIfDisposed(this.privDisposed),this.dispose(!0)},Object.defineProperty(e.prototype,"internalData",{get:function(){return this.privReco},enumerable:!0,configurable:!0}),e.prototype.dispose=function(e){this.privDisposed||(e&&this.privReco&&(this.privReco.audioSource.turnOff(),this.privReco.dispose()),this.privDisposed=!0)},Object.defineProperty(e,"telemetryEnabled",{get:function(){return n.ServiceRecognizerBase.telemetryDataEnabled},enumerable:!0,configurable:!0}),e.enableTelemetry=function(e){n.ServiceRecognizerBase.telemetryDataEnabled=e},e.prototype.implCommonRecognizerSetup=function(){var e=this,t="undefined"!=typeof window?"Browser":"Node",r="unknown",o="unknown";"undefined"!=typeof navigator&&(t=t+"/"+navigator.platform,r=navigator.userAgent,o=navigator.appVersion);var a=this.createRecognizerConfig(new n.SpeechServiceConfig(new n.Context(new n.OS(t,r,o)))),c=this.privProperties.getProperty(s.PropertyId.SpeechServiceConnection_Key,void 0),p=c&&""!==c?new n.CognitiveSubscriptionKeyAuthentication(c):new n.CognitiveTokenAuthentication((function(t){var r=e.privProperties.getProperty(s.PropertyId.SpeechServiceAuthorization_Token,void 0);return i.PromiseHelper.fromResult(r)}),(function(t){var r=e.privProperties.getProperty(s.PropertyId.SpeechServiceAuthorization_Token,void 0);return i.PromiseHelper.fromResult(r)}));this.privReco=this.createServiceRecognizer(p,this.privConnectionFactory,this.audioConfig,a)},e.prototype.recognizeOnceAsyncImpl=function(e,t,r){var n=this;try{o.Contracts.throwIfDisposed(this.privDisposed),this.implRecognizerStop().on((function(i){try{n.privReco.recognize(e,(function(e){n.implRecognizerStop().on((function(r){t&&t(e)}),(function(e){r&&r(e)}))}),(function(e){n.implRecognizerStop(),r&&r(e)})).on((function(e){}),(function(e){r&&r(e)}))}catch(e){if(r)if(e instanceof Error){var o=e;r(o.name+": "+o.message)}else r(e);n.dispose(!0)}}),(function(e){r&&r(e)}))}catch(e){if(r)if(e instanceof Error){var i=e;r(i.name+": "+i.message)}else r(e);this.dispose(!0)}},e.prototype.startContinuousRecognitionAsyncImpl=function(e,t,r){var n=this;try{o.Contracts.throwIfDisposed(this.privDisposed),this.implRecognizerStop().on((function(i){n.privReco.recognize(e,void 0,void 0).on((function(e){if(t){try{t()}catch(e){r&&r(e)}t=void 0}}),(function(e){r&&r(e),n.dispose(!0)}))}),(function(e){r&&r(e),n.dispose(!0)}))}catch(e){if(r)if(e instanceof Error){var i=e;r(i.name+": "+i.message)}else r(e);this.dispose(!0)}},e.prototype.stopContinuousRecognitionAsyncImpl=function(e,t){try{o.Contracts.throwIfDisposed(this.privDisposed),this.implRecognizerStop().on((function(r){if(e)try{e()}catch(e){t&&t(e)}}),(function(e){t&&t(e)}))}catch(e){if(t)if(e instanceof Error){var r=e;t(r.name+": "+r.message)}else t(e);this.dispose(!0)}},e.prototype.implRecognizerStop=function(){return this.privReco?this.privReco.stopRecognizing():i.PromiseHelper.fromResult(!0)},e}();t.Recognizer=a},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(2),s=r(90),a=r(6),c=r(0),p=function(e){function t(t,r){var n=this,i=t;return a.Contracts.throwIfNull(i,"speechConfig"),a.Contracts.throwIfNullOrWhitespace(i.properties.getProperty(c.PropertyId.SpeechServiceConnection_RecoLanguage),c.PropertyId[c.PropertyId.SpeechServiceConnection_RecoLanguage]),(n=e.call(this,r,i.properties,new s.SpeechConnectionFactory)||this).privDisposedSpeechRecognizer=!1,n}return i(t,e),Object.defineProperty(t.prototype,"endpointId",{get:function(){return a.Contracts.throwIfDisposed(this.privDisposedSpeechRecognizer),this.properties.getProperty(c.PropertyId.SpeechServiceConnection_EndpointId,"00000000-0000-0000-0000-000000000000")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"authorizationToken",{get:function(){return this.properties.getProperty(c.PropertyId.SpeechServiceAuthorization_Token)},set:function(e){a.Contracts.throwIfNullOrWhitespace(e,"token"),this.properties.setProperty(c.PropertyId.SpeechServiceAuthorization_Token,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"speechRecognitionLanguage",{get:function(){return a.Contracts.throwIfDisposed(this.privDisposedSpeechRecognizer),this.properties.getProperty(c.PropertyId.SpeechServiceConnection_RecoLanguage)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outputFormat",{get:function(){return a.Contracts.throwIfDisposed(this.privDisposedSpeechRecognizer),this.properties.getProperty(o.OutputFormatPropertyName,c.OutputFormat[c.OutputFormat.Simple])===c.OutputFormat[c.OutputFormat.Simple]?c.OutputFormat.Simple:c.OutputFormat.Detailed},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"properties",{get:function(){return this.privProperties},enumerable:!0,configurable:!0}),t.prototype.recognizeOnceAsync=function(e,t){this.recognizeOnceAsyncImpl(o.RecognitionMode.Interactive,e,t)},t.prototype.startContinuousRecognitionAsync=function(e,t){this.startContinuousRecognitionAsyncImpl(o.RecognitionMode.Conversation,e,t)},t.prototype.stopContinuousRecognitionAsync=function(e,t){this.stopContinuousRecognitionAsyncImpl(e,t)},t.prototype.startKeywordRecognitionAsync=function(e,t,r){a.Contracts.throwIfNull(e,"model"),r&&r("Not yet implemented.")},t.prototype.stopKeywordRecognitionAsync=function(e,t){e&&e()},t.prototype.close=function(){a.Contracts.throwIfDisposed(this.privDisposedSpeechRecognizer),this.dispose(!0)},t.prototype.dispose=function(t){this.privDisposedSpeechRecognizer||(t&&(this.implRecognizerStop(),this.privDisposedSpeechRecognizer=!0),e.prototype.dispose.call(this,t))},t.prototype.createRecognizerConfig=function(e){return new o.RecognizerConfig(e,this.properties)},t.prototype.createServiceRecognizer=function(e,t,r,n){var i=r;return new o.SpeechServiceRecognizer(e,t,i,n,this)},t}(c.Recognizer);t.SpeechRecognizer=p},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(2),s=r(6),a=r(0),c=function(e){function t(t,r){var n=this;s.Contracts.throwIfNullOrUndefined(t,"speechConfig");var i=t;return s.Contracts.throwIfNullOrUndefined(i,"speechConfig"),(n=e.call(this,r,i.properties,new o.IntentConnectionFactory)||this).privAddedIntents=[],n.privAddedLmIntents={},n.privDisposedIntentRecognizer=!1,n.privProperties=i.properties,s.Contracts.throwIfNullOrWhitespace(n.properties.getProperty(a.PropertyId.SpeechServiceConnection_RecoLanguage),a.PropertyId[a.PropertyId.SpeechServiceConnection_RecoLanguage]),n}return i(t,e),Object.defineProperty(t.prototype,"speechRecognitionLanguage",{get:function(){return s.Contracts.throwIfDisposed(this.privDisposedIntentRecognizer),this.properties.getProperty(a.PropertyId.SpeechServiceConnection_RecoLanguage)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"authorizationToken",{get:function(){return this.properties.getProperty(a.PropertyId.SpeechServiceAuthorization_Token)},set:function(e){this.properties.setProperty(a.PropertyId.SpeechServiceAuthorization_Token,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"properties",{get:function(){return this.privProperties},enumerable:!0,configurable:!0}),t.prototype.recognizeOnceAsync=function(e,t){if(s.Contracts.throwIfDisposed(this.privDisposedIntentRecognizer),0!==Object.keys(this.privAddedLmIntents).length||void 0!==this.privUmbrellaIntent){var r=this.buildSpeechContext();this.privReco.speechContext.setSection("intent",r.Intent),this.privReco.dynamicGrammar.addReferenceGrammar(r.ReferenceGrammars),this.privReco.setIntents(this.privAddedLmIntents,this.privUmbrellaIntent)}this.recognizeOnceAsyncImpl(o.RecognitionMode.Interactive,e,t)},t.prototype.startContinuousRecognitionAsync=function(e,t){if(0!==Object.keys(this.privAddedLmIntents).length){var r=this.buildSpeechContext();this.privReco.speechContext.setSection("intent",r.Intent),this.privReco.dynamicGrammar.addReferenceGrammar(r.ReferenceGrammars),this.privReco.setIntents(this.privAddedLmIntents,this.privUmbrellaIntent)}this.startContinuousRecognitionAsyncImpl(o.RecognitionMode.Conversation,e,t)},t.prototype.stopContinuousRecognitionAsync=function(e,t){this.stopContinuousRecognitionAsyncImpl(e,t)},t.prototype.startKeywordRecognitionAsync=function(e,t,r){s.Contracts.throwIfNull(e,"model"),r&&r("Not yet implemented.")},t.prototype.stopKeywordRecognitionAsync=function(e,t){e&&e()},t.prototype.addIntent=function(e,t){s.Contracts.throwIfDisposed(this.privDisposedIntentRecognizer),s.Contracts.throwIfNullOrWhitespace(t,"intentId"),s.Contracts.throwIfNullOrWhitespace(e,"simplePhrase"),this.privAddedIntents.push([t,e])},t.prototype.addIntentWithLanguageModel=function(e,t,r){s.Contracts.throwIfDisposed(this.privDisposedIntentRecognizer),s.Contracts.throwIfNullOrWhitespace(e,"intentId"),s.Contracts.throwIfNull(t,"model");var n=t;s.Contracts.throwIfNullOrWhitespace(n.appId,"model.appId"),this.privAddedLmIntents[e]=new o.AddedLmIntent(n,r)},t.prototype.addAllIntents=function(e,t){s.Contracts.throwIfNull(e,"model");var r=e;s.Contracts.throwIfNullOrWhitespace(r.appId,"model.appId"),this.privUmbrellaIntent=new o.AddedLmIntent(r,t)},t.prototype.close=function(){s.Contracts.throwIfDisposed(this.privDisposedIntentRecognizer),this.dispose(!0)},t.prototype.createRecognizerConfig=function(e){return new o.RecognizerConfig(e,this.properties)},t.prototype.createServiceRecognizer=function(e,t,r,n){var i=r;return new o.IntentServiceRecognizer(e,t,i,n,this)},t.prototype.dispose=function(t){this.privDisposedIntentRecognizer||t&&(this.privDisposedIntentRecognizer=!0,e.prototype.dispose.call(this,t))},t.prototype.buildSpeechContext=function(){var e,t,r,n=[];void 0!==this.privUmbrellaIntent&&(e=this.privUmbrellaIntent.modelImpl.appId,t=this.privUmbrellaIntent.modelImpl.region,r=this.privUmbrellaIntent.modelImpl.subscriptionKey);for(var i=0,o=Object.keys(this.privAddedLmIntents);i<o.length;i++){var s=o[i],c=this.privAddedLmIntents[s];if(void 0===e)e=c.modelImpl.appId;else if(e!==c.modelImpl.appId)throw new Error("Intents must all be from the same LUIS model");if(void 0===t)t=c.modelImpl.region;else if(t!==c.modelImpl.region)throw new Error("Intents must all be from the same LUIS model in a single region");if(void 0===r)r=c.modelImpl.subscriptionKey;else if(r!==c.modelImpl.subscriptionKey)throw new Error("Intents must all use the same subscription key");var p="luis/"+e+"-PRODUCTION#"+s;n.push(p)}return{Intent:{id:e,key:void 0===r?this.privProperties.getProperty(a.PropertyId[a.PropertyId.SpeechServiceConnection_Key]):r,provider:"LUIS"},ReferenceGrammars:void 0===this.privUmbrellaIntent?n:["luis/"+e+"-PRODUCTION"]}},t}(a.Recognizer);t.IntentRecognizer=c},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(2),s=r(6),a=r(0),c=function(e){function t(t,r){var n=this,i=t;return s.Contracts.throwIfNull(i,"speechConfig"),(n=e.call(this,r,i.properties,new o.TranslationConnectionFactory)||this).privDisposedTranslationRecognizer=!1,n.privProperties=i.properties.clone(),void 0!==n.properties.getProperty(a.PropertyId.SpeechServiceConnection_TranslationVoice,void 0)&&s.Contracts.throwIfNullOrWhitespace(n.properties.getProperty(a.PropertyId.SpeechServiceConnection_TranslationVoice),a.PropertyId[a.PropertyId.SpeechServiceConnection_TranslationVoice]),s.Contracts.throwIfNullOrWhitespace(n.properties.getProperty(a.PropertyId.SpeechServiceConnection_TranslationToLanguages),a.PropertyId[a.PropertyId.SpeechServiceConnection_TranslationToLanguages]),s.Contracts.throwIfNullOrWhitespace(n.properties.getProperty(a.PropertyId.SpeechServiceConnection_RecoLanguage),a.PropertyId[a.PropertyId.SpeechServiceConnection_RecoLanguage]),n}return i(t,e),Object.defineProperty(t.prototype,"speechRecognitionLanguage",{get:function(){return s.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),this.properties.getProperty(a.PropertyId.SpeechServiceConnection_RecoLanguage)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"targetLanguages",{get:function(){return s.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),this.properties.getProperty(a.PropertyId.SpeechServiceConnection_TranslationToLanguages).split(",")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"voiceName",{get:function(){return s.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),this.properties.getProperty(a.PropertyId.SpeechServiceConnection_TranslationVoice,void 0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"authorizationToken",{get:function(){return this.properties.getProperty(a.PropertyId.SpeechServiceAuthorization_Token)},set:function(e){this.properties.setProperty(a.PropertyId.SpeechServiceAuthorization_Token,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"properties",{get:function(){return this.privProperties},enumerable:!0,configurable:!0}),t.prototype.recognizeOnceAsync=function(e,t){s.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),this.recognizeOnceAsyncImpl(o.RecognitionMode.Conversation,e,t)},t.prototype.startContinuousRecognitionAsync=function(e,t){this.startContinuousRecognitionAsyncImpl(o.RecognitionMode.Conversation,e,t)},t.prototype.stopContinuousRecognitionAsync=function(e,t){this.stopContinuousRecognitionAsyncImpl(e,t)},t.prototype.close=function(){s.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),this.dispose(!0)},t.prototype.dispose=function(t){this.privDisposedTranslationRecognizer||t&&(this.implRecognizerStop(),this.privDisposedTranslationRecognizer=!0,e.prototype.dispose.call(this,t))},t.prototype.createRecognizerConfig=function(e){return new o.RecognizerConfig(e,this.properties)},t.prototype.createServiceRecognizer=function(e,t,r,n){var i=r;return new o.TranslationServiceRecognizer(e,t,i,n,this)},t}(a.Recognizer);t.TranslationRecognizer=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=function(){function e(){this.privMap=new n.PropertyCollection}return e.prototype.get=function(e,t){return this.privMap.getProperty(e,t)},e.prototype.set=function(e,t){this.privMap.setProperty(e,t)},e}();t.Translations=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.NotRecognized=0]="NotRecognized",e[e.InitialSilenceTimeout=1]="InitialSilenceTimeout",e[e.InitialBabbleTimeout=2]="InitialBabbleTimeout"}(t.NoMatchReason||(t.NoMatchReason={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),i=r(0),o=function(){function e(e){this.privReason=e}return e.fromResult=function(t){var r=n.SimpleSpeechPhrase.fromJSON(t.json),o=i.NoMatchReason.NotRecognized;switch(r.RecognitionStatus){case n.RecognitionStatus.BabbleTimeout:o=i.NoMatchReason.InitialBabbleTimeout;break;case n.RecognitionStatus.InitialSilenceTimeout:o=i.NoMatchReason.InitialSilenceTimeout;break;default:o=i.NoMatchReason.NotRecognized}return new e(o)},Object.defineProperty(e.prototype,"reason",{get:function(){return this.privReason},enumerable:!0,configurable:!0}),e}();t.NoMatchDetails=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,r,n,i){this.privCancelReason=t,this.privErrorDetails=r,this.privResult=i,this.privSessionId=e,this.privErrorCode=n}return Object.defineProperty(e.prototype,"result",{get:function(){return this.privResult},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sessionId",{get:function(){return this.privSessionId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reason",{get:function(){return this.privCancelReason},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"errorCode",{get:function(){return this.privErrorCode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"errorDetails",{get:function(){return this.privErrorDetails},enumerable:!0,configurable:!0}),e}();t.TranslationRecognitionCanceledEventArgs=n},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,r,n,i,o,s){var a=e.call(this,i,o,s)||this;return a.privReason=t,a.privErrorDetails=r,a.privErrorCode=n,a}return i(t,e),Object.defineProperty(t.prototype,"reason",{get:function(){return this.privReason},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"errorCode",{get:function(){return this.privErrorCode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"errorDetails",{get:function(){return this.privErrorDetails},enumerable:!0,configurable:!0}),t}(r(0).IntentRecognitionEventArgs);t.IntentRecognitionCanceledEventArgs=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),i=r(0),o=function(){function e(e,t,r){this.privReason=e,this.privErrorDetails=t,this.privErrorCode=r}return e.fromResult=function(t){var r=i.CancellationReason.Error,o=i.CancellationErrorCode.NoError;if(t.json){var s=n.SimpleSpeechPhrase.fromJSON(t.json);r=n.EnumTranslation.implTranslateCancelResult(s.RecognitionStatus)}return t.properties&&(o=i.CancellationErrorCode[t.properties.getProperty(n.CancellationErrorCodePropertyName,i.CancellationErrorCode[i.CancellationErrorCode.NoError])]),new e(r,t.errorDetails,o)},Object.defineProperty(e.prototype,"reason",{get:function(){return this.privReason},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"errorDetails",{get:function(){return this.privErrorDetails},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ErrorCode",{get:function(){return this.privErrorCode},enumerable:!0,configurable:!0}),e}();t.CancellationDetails=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.NoError=0]="NoError",e[e.AuthenticationFailure=1]="AuthenticationFailure",e[e.BadRequestParameters=2]="BadRequestParameters",e[e.TooManyRequests=3]="TooManyRequests",e[e.ConnectionFailure=4]="ConnectionFailure",e[e.ServiceTimeout=5]="ServiceTimeout",e[e.ServiceError=6]="ServiceError",e[e.RuntimeError=7]="RuntimeError"}(t.CancellationErrorCode||(t.CancellationErrorCode={}))},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(r(0).SessionEventArgs);t.ConnectionEventArgs=o},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,r,n){var i=e.call(this,n)||this;return i.privJsonResult=t,i.privEventName=r,i}return i(t,e),Object.defineProperty(t.prototype,"jsonString",{get:function(){return this.privJsonResult},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"eventName",{get:function(){return this.privEventName},enumerable:!0,configurable:!0}),t}(r(0).SessionEventArgs);t.ServiceEventArgs=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=function(){function e(){}return e.fromRecognizer=function(t){var r=t.internalData,i=new e;return i.privServiceRecognizer=r,i.privEventListener=i.privServiceRecognizer.connectionEvents.attach((function(e){"ConnectionEstablishedEvent"===e.name?i.connected&&i.connected(new n.ConnectionEventArgs(e.connectionId)):"ConnectionClosedEvent"===e.name&&i.disconnected&&i.disconnected(new n.ConnectionEventArgs(e.connectionId))})),i.privServiceEventListener=i.privServiceRecognizer.serviceEvents.attach((function(e){i.receivedServiceMessage&&i.receivedServiceMessage(new n.ServiceEventArgs(e.jsonString,e.name))})),i},e.prototype.openConnection=function(){this.privServiceRecognizer.connect()},e.prototype.closeConnection=function(){this.privServiceRecognizer.disconnect()},e.prototype.close=function(){},e}();t.Connection=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.privGrammerBuilder=e.dynamicGrammar}return e.fromRecognizer=function(t){return new e(t.internalData)},e.prototype.addPhrase=function(e){this.privGrammerBuilder.addPhrase(e)},e.prototype.addPhrases=function(e){this.privGrammerBuilder.addPhrase(e)},e.prototype.clear=function(){this.privGrammerBuilder.clearPhrases()},e}();t.PhraseListGrammar=n},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(6),s=r(53),a=r(0),c=function(e){function t(){return e.call(this)||this}return i(t,e),t.fromSubscription=function(e,t,r){o.Contracts.throwIfNullOrWhitespace(e,"subscription"),o.Contracts.throwIfNullOrWhitespace(t,"region");var n=new s.DialogServiceConfigImpl;return n.setProperty(a.PropertyId.Conversation_DialogType,"bot_framework"),n.setProperty(a.PropertyId.SpeechServiceConnection_Key,e),n.setProperty(a.PropertyId.SpeechServiceConnection_Region,t),r&&n.setProperty(a.PropertyId.Conversation_ApplicationId,r),n},t.fromAuthorizationToken=function(e,t){o.Contracts.throwIfNullOrWhitespace(e,"authorizationToken"),o.Contracts.throwIfNullOrWhitespace(t,"region");var r=new s.DialogServiceConfigImpl;return r.setProperty(a.PropertyId.Conversation_DialogType,"bot_framework"),r.setProperty(a.PropertyId.SpeechServiceAuthorization_Token,e),r.setProperty(a.PropertyId.SpeechServiceConnection_Region,t),r},t}(s.DialogServiceConfigImpl);t.BotFrameworkConfig=c},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(6),s=r(53),a=r(0),c=function(e){function t(){return e.call(this)||this}return i(t,e),t.fromSubscription=function(e,t,r){o.Contracts.throwIfNullOrWhitespace(e,"applicationId"),o.Contracts.throwIfNullOrWhitespace(t,"subscription"),o.Contracts.throwIfNullOrWhitespace(r,"region");var n=new s.DialogServiceConfigImpl;return n.setProperty(a.PropertyId.Conversation_DialogType,"custom_commands"),n.setProperty(a.PropertyId.Conversation_ApplicationId,e),n.setProperty(a.PropertyId.SpeechServiceConnection_Key,t),n.setProperty(a.PropertyId.SpeechServiceConnection_Region,r),n},t.fromAuthorizationToken=function(e,t,r){o.Contracts.throwIfNullOrWhitespace(e,"applicationId"),o.Contracts.throwIfNullOrWhitespace(t,"authorizationToken"),o.Contracts.throwIfNullOrWhitespace(r,"region");var n=new s.DialogServiceConfigImpl;return n.setProperty(a.PropertyId.Conversation_DialogType,"custom_commands"),n.setProperty(a.PropertyId.Conversation_ApplicationId,e),n.setProperty(a.PropertyId.SpeechServiceAuthorization_Token,t),n.setProperty(a.PropertyId.SpeechServiceConnection_Region,r),n},Object.defineProperty(t.prototype,"applicationId",{get:function(){return this.getProperty(a.PropertyId.Conversation_ApplicationId)},set:function(e){o.Contracts.throwIfNullOrWhitespace(e,"value"),this.setProperty(a.PropertyId.Conversation_ApplicationId,e)},enumerable:!0,configurable:!0}),t}(s.DialogServiceConfigImpl);t.CustomCommandsConfig=c},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(198),s=r(2),a=r(6),c=r(0),p=r(89),u=function(e){function t(t,r){var n=this,i=t;a.Contracts.throwIfNull(t,"dialogConfig"),(n=e.call(this,r,i.properties,new o.DialogConnectionFactory)||this).isTurnComplete=!0,n.privIsDisposed=!1,n.privProperties=i.properties.clone();var s=n.buildAgentConfig();return n.privReco.agentConfig.set(s),n}return i(t,e),t.prototype.connect=function(){this.privReco.connect()},t.prototype.disconnect=function(){this.privReco.disconnect()},Object.defineProperty(t.prototype,"authorizationToken",{get:function(){return this.properties.getProperty(p.PropertyId.SpeechServiceAuthorization_Token)},set:function(e){a.Contracts.throwIfNullOrWhitespace(e,"token"),this.properties.setProperty(p.PropertyId.SpeechServiceAuthorization_Token,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"properties",{get:function(){return this.privProperties},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"speechActivityTemplate",{get:function(){return this.properties.getProperty(p.PropertyId.Conversation_Speech_Activity_Template)},set:function(e){this.properties.setProperty(p.PropertyId.Conversation_Speech_Activity_Template,e)},enumerable:!0,configurable:!0}),t.prototype.listenOnceAsync=function(e,t){var r=this;if(this.isTurnComplete)try{a.Contracts.throwIfDisposed(this.privIsDisposed),this.connect(),this.implRecognizerStop(),this.isTurnComplete=!1,this.privReco.recognize(s.RecognitionMode.Conversation,(function(t){r.implRecognizerStop(),r.isTurnComplete=!0,e&&e(t)}),(function(e){r.implRecognizerStop(),r.isTurnComplete=!0,t&&t(e)})).on((function(e){}),(function(e){t&&t(e)}))}catch(e){if(t)if(e instanceof Error){var n=e;t(n.name+": "+n.message)}else t(e);this.dispose(!0)}},t.prototype.sendActivityAsync=function(e){this.privReco.sendMessage(e)},t.prototype.close=function(){a.Contracts.throwIfDisposed(this.privIsDisposed),this.dispose(!0)},t.prototype.dispose=function(t){this.privIsDisposed||t&&(this.implRecognizerStop(),this.privIsDisposed=!0,e.prototype.dispose.call(this,t))},t.prototype.createRecognizerConfig=function(e){return new s.RecognizerConfig(e,this.privProperties)},t.prototype.createServiceRecognizer=function(e,t,r,n){var i=r;return new s.DialogServiceAdapter(e,t,i,n,this)},t.prototype.buildAgentConfig=function(){return{botInfo:{commType:this.properties.getProperty("Conversation_Communication_Type","Default"),commandsCulture:void 0,connectionId:this.properties.getProperty(p.PropertyId.Conversation_ApplicationId),conversationId:void 0,fromId:this.properties.getProperty(p.PropertyId.Conversation_From_Id,void 0)},version:.2}},t}(c.Recognizer);t.DialogServiceConnector=u},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(16),s=r(0),a=r(31),c=r(2),p=r(36),u="convai.speech.microsoft.com",h={authHeader:"X-DLS-Secret",resourcePath:"",version:"v3"},v={authHeader:"X-CommandsAppId",resourcePath:"commands",version:"v1"};function l(e){switch(e){case"custom_commands":return v;case"bot_framework":return h}throw new Error("Invalid dialog type '"+e+"'")}var d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.create=function(e,r,n){var i=e.parameters.getProperty(s.PropertyId.Conversation_ApplicationId,""),a=e.parameters.getProperty(s.PropertyId.Conversation_DialogType),h=e.parameters.getProperty(s.PropertyId.SpeechServiceConnection_Region),v=e.parameters.getProperty(s.PropertyId.SpeechServiceConnection_RecoLanguage,"en-US"),d={};d[p.QueryParameterNames.LanguageParamName]=v,d[p.QueryParameterNames.FormatParamName]=e.parameters.getProperty(s.PropertyId.SpeechServiceResponse_OutputFormatOption,s.OutputFormat[s.OutputFormat.Simple]).toLowerCase();var f=l(a),g=f.resourcePath,y=f.version,m=f.authHeader,S={};null!=r.token&&""!==r.token&&(S[r.headerName]=r.token),S[p.QueryParameterNames.ConnectionIdHeader]=n,""!==i&&(S[m]=i);var C=e.parameters.getProperty(s.PropertyId.SpeechServiceConnection_Endpoint,"");return""===C&&(C=""===i?"wss://"+h+"."+u+"/api/"+y:"wss://"+h+"."+u+"/"+g+"/api/"+y),t.setCommonUrlParams(e,d,C),new o.WebsocketConnection(C,d,S,new c.WebsocketMessageFormatter,o.ProxyInfo.fromRecognizerConfig(e),n)},t}return i(t,e),t}(a.ConnectionFactoryBase);t.DialogConnectionFactory=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this.privActivity=e,this.privAudioStream=t}return Object.defineProperty(e.prototype,"activity",{get:function(){return this.privActivity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"audioStream",{get:function(){return this.privAudioStream},enumerable:!0,configurable:!0}),e}();t.ActivityReceivedEventArgs=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.UriQueryParameter=0]="UriQueryParameter"}(t.ServicePropertyChannel||(t.ServicePropertyChannel={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Masked=0]="Masked",e[e.Removed=1]="Removed",e[e.Raw=2]="Raw"}(t.ProfanityOption||(t.ProfanityOption={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(12),i=function(){function e(e){this.audioContext=null,this.gainNode=null,this.autoUpdateBufferTimer=0,this.init(e)}return e.prototype.playAudioSample=function(e){this.ensureInitializedContext();var t=this.formatAudioData(e),r=new Float32Array(this.samples.length+t.length);r.set(this.samples,0),r.set(t,this.samples.length),this.samples=r},e.prototype.stopAudio=function(){null!==this.audioContext&&(this.samples=new Float32Array,clearInterval(this.autoUpdateBufferTimer),this.audioContext.close(),this.audioContext=null)},e.prototype.init=function(e){this.audioFormat=e,this.samples=new Float32Array},e.prototype.ensureInitializedContext=function(){var e=this;if(null===this.audioContext){this.createAudioContext();this.autoUpdateBufferTimer=setInterval((function(){e.updateAudioBuffer()}),200)}},e.prototype.createAudioContext=function(){this.audioContext=new AudioContext,this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=1,this.gainNode.connect(this.audioContext.destination),this.startTime=this.audioContext.currentTime},e.prototype.formatAudioData=function(e){switch(this.audioFormat.bitsPerSample){case 8:return this.formatArrayBuffer(new Int8Array(e),128);case 16:return this.formatArrayBuffer(new Int16Array(e),32768);case 32:return this.formatArrayBuffer(new Int32Array(e),2147483648);default:throw new n.InvalidOperationError("Only WAVE_FORMAT_PCM (8/16/32 bps) format supported at this time")}},e.prototype.formatArrayBuffer=function(e,t){for(var r=new Float32Array(e.length),n=0;n<e.length;n++)r[n]=e[n]/t;return r},e.prototype.updateAudioBuffer=function(){if(0!==this.samples.length){for(var e=this.audioFormat.channels,t=this.audioContext.createBufferSource(),r=this.samples.length/e,n=this.audioContext.createBuffer(e,r,this.audioFormat.samplesPerSec),i=0;i<e;i++)for(var o=i,s=n.getChannelData(i),a=0;a<this.samples.length;a++,o+=e)s[a]=this.samples[o];this.startTime<this.audioContext.currentTime&&(this.startTime=this.audioContext.currentTime),t.buffer=n,t.connect(this.gainNode),t.start(this.startTime),this.startTime+=n.duration,this.samples=new Float32Array}},e}();t.BaseAudioPlayer=i},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,r){var n=e.call(this,r)||this;return n.privExpirationTime=t,n}return i(t,e),Object.defineProperty(t.prototype,"expirationTime",{get:function(){return this.privExpirationTime},enumerable:!0,configurable:!0}),t}(r(0).SessionEventArgs);t.ConversationExpirationEventArgs=o},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,r,n){var i=e.call(this,n)||this;return i.privReason=t,i.privParticipant=r,i}return i(t,e),Object.defineProperty(t.prototype,"reason",{get:function(){return this.privReason},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"participants",{get:function(){return this.privParticipant},enumerable:!0,configurable:!0}),t}(r(0).SessionEventArgs);t.ConversationParticipantsChangedEventArgs=o},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,r,n,i,o){var s=e.call(this,i,o)||this;return s.privReason=t,s.privErrorDetails=r,s.privErrorCode=n,s}return i(t,e),Object.defineProperty(t.prototype,"reason",{get:function(){return this.privReason},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"errorCode",{get:function(){return this.privErrorCode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"errorDetails",{get:function(){return this.privErrorDetails},enumerable:!0,configurable:!0}),t}(r(0).RecognitionEventArgs);t.ConversationTranslationCanceledEventArgs=o},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,r,n){var i=e.call(this,r,n)||this;return i.privResult=t,i}return i(t,e),Object.defineProperty(t.prototype,"result",{get:function(){return this.privResult},enumerable:!0,configurable:!0}),t}(r(0).RecognitionEventArgs);t.ConversationTranslationEventArgs=o},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,r,n,i,o,s,a,c,p,u,h){var v=e.call(this,r,i,o,s,a,c,p,u,h)||this;return v.privId=t,v.privOrigLang=n,v}return i(t,e),Object.defineProperty(t.prototype,"participantId",{get:function(){return this.privId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"originalLang",{get:function(){return this.privOrigLang},enumerable:!0,configurable:!0}),t}(r(88).TranslationRecognitionResult);t.ConversationTranslationResult=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=r(2),o=r(6),s=r(0),a=r(92),c=r(91);!function(e){e[e.Inactive=0]="Inactive",e[e.Connecting=1]="Connecting",e[e.Connected=2]="Connected"}(n=t.SpeechState||(t.SpeechState={}));var p=function(){function e(e){var t=this;this.privIsDisposed=!1,this.privIsSpeaking=!1,this.privSpeechState=n.Inactive,this.onSpeechConnected=function(e){t.privSpeechState=n.Connected},this.onSpeechDisconnected=function(e){t.privSpeechState=n.Inactive,t.cancelSpeech()},this.onSpeechRecognized=function(e,r){var n;(null===(n=r.result)||void 0===n?void 0:n.errorDetails)&&(t.cancelSpeech(),t.fireCancelEvent(r.result.errorDetails))},this.onSpeechRecognizing=function(e,t){},this.onSpeechCanceled=function(e,r){if(t.privSpeechState!==n.Inactive)try{t.cancelSpeech()}catch(e){t.privSpeechState=n.Inactive}},this.onSpeechSessionStarted=function(e,r){t.privSpeechState=n.Connected},this.onSpeechSessionStopped=function(e,r){t.privSpeechState=n.Inactive},this.privProperties=new s.PropertyCollection,this.privAudioConfig=e}return Object.defineProperty(e.prototype,"properties",{get:function(){return this.privProperties},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"speechRecognitionLanguage",{get:function(){return this.privSpeechRecognitionLanguage},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"participants",{get:function(){var e;return null===(e=this.privConversation)||void 0===e?void 0:e.participants},enumerable:!0,configurable:!0}),e.prototype.joinConversationAsync=function(e,t,r,n,c){var p=this;try{if("string"==typeof e){o.Contracts.throwIfNullOrUndefined(e,i.ConversationTranslatorConfig.strings.invalidArgs.replace("{arg}","conversation id")),o.Contracts.throwIfNullOrWhitespace(t,i.ConversationTranslatorConfig.strings.invalidArgs.replace("{arg}","nickname")),this.privConversation&&this.handleError(new Error(i.ConversationTranslatorConfig.strings.permissionDeniedStart),c);var u=r;null!=u&&""!==u||(u=i.ConversationTranslatorConfig.defaultLanguageCode),this.privSpeechTranslationConfig=s.SpeechTranslationConfig.fromSubscription(i.ConversationTranslatorConfig.auth.placeholderSubscriptionKey,i.ConversationTranslatorConfig.auth.placeholderRegion),this.privSpeechTranslationConfig.setProfanity(s.ProfanityOption.Masked),this.privSpeechTranslationConfig.addTargetLanguage(u),this.privSpeechTranslationConfig.setProperty(s.PropertyId[s.PropertyId.SpeechServiceConnection_RecoLanguage],u),this.privSpeechTranslationConfig.setProperty(s.PropertyId[s.PropertyId.ConversationTranslator_Name],t);var h=this.privProperties.getProperty(s.PropertyId.ConversationTranslator_Host);h&&this.privSpeechTranslationConfig.setProperty(s.PropertyId[s.PropertyId.ConversationTranslator_Host],h);var v=this.privProperties.getProperty(s.PropertyId.SpeechServiceConnection_Host);v&&this.privSpeechTranslationConfig.setProperty(s.PropertyId[s.PropertyId.SpeechServiceConnection_Host],v),this.privConversation=new a.ConversationImpl(this.privSpeechTranslationConfig),this.privConversation.conversationTranslator=this,this.privConversation.joinConversationAsync(e,t,u,(function(e){e||p.handleError(new Error(i.ConversationTranslatorConfig.strings.permissionDeniedConnect),c),p.privSpeechTranslationConfig.authorizationToken=e,p.privConversation.startConversationAsync((function(){p.handleCallback(n,c)}),(function(e){p.handleError(e,c)}))}),(function(e){p.handleError(e,c)}))}else"object"==typeof e?(o.Contracts.throwIfNullOrUndefined(e,i.ConversationTranslatorConfig.strings.invalidArgs.replace("{arg}","conversation id")),o.Contracts.throwIfNullOrWhitespace(t,i.ConversationTranslatorConfig.strings.invalidArgs.replace("{arg}","nickname")),this.privProperties.setProperty(s.PropertyId.ConversationTranslator_Name,t),this.privConversation=e,this.privConversation.conversationTranslator=this,o.Contracts.throwIfNullOrUndefined(this.privConversation,i.ConversationTranslatorConfig.strings.permissionDeniedConnect),o.Contracts.throwIfNullOrUndefined(this.privConversation.room.token,i.ConversationTranslatorConfig.strings.permissionDeniedConnect),this.privSpeechTranslationConfig=e.config,this.handleCallback(r,n)):this.handleError(new Error(i.ConversationTranslatorConfig.strings.invalidArgs.replace("{arg}","invalid conversation type")),n)}catch(e){this.handleError(e,"string"==typeof r?c:n)}},e.prototype.leaveConversationAsync=function(e,t){var r=this;try{this.cancelSpeech(),this.privConversation.endConversationAsync((function(){r.privConversation.deleteConversationAsync((function(){r.handleCallback(e,t),r.dispose()}),(function(e){r.handleError(e,t)}))}),(function(e){r.handleError(e,t)}))}catch(e){this.handleError(e,t)}},e.prototype.sendTextMessageAsync=function(e,t,r){var n;try{o.Contracts.throwIfNullOrUndefined(this.privConversation,i.ConversationTranslatorConfig.strings.permissionDeniedSend),o.Contracts.throwIfNullOrWhitespace(e,i.ConversationTranslatorConfig.strings.invalidArgs.replace("{arg}",e)),null===(n=this.privConversation)||void 0===n||n.sendTextMessageAsync(e,t,r)}catch(e){this.handleError(e,r)}},e.prototype.startTranscribingAsync=function(e,t){var r=this;try{o.Contracts.throwIfNullOrUndefined(this.privConversation,i.ConversationTranslatorConfig.strings.permissionDeniedSend),o.Contracts.throwIfNullOrUndefined(this.privConversation.room.token,i.ConversationTranslatorConfig.strings.permissionDeniedConnect),this.canSpeak||this.handleError(new Error(i.ConversationTranslatorConfig.strings.permissionDeniedSend),t),void 0===this.privTranslationRecognizer?this.connectTranslatorRecognizer((function(){r.startContinuousRecognition((function(){r.privIsSpeaking=!0,r.handleCallback(e,t)}),(function(e){r.privIsSpeaking=!1,r.cancelSpeech(),r.handleError(e,t)}))}),(function(e){r.handleError(e,t)})):this.startContinuousRecognition((function(){r.privIsSpeaking=!0,r.handleCallback(e,t)}),(function(e){r.privIsSpeaking=!1,r.cancelSpeech(),r.handleError(e,t)}))}catch(e){this.handleError(e,t),this.cancelSpeech()}},e.prototype.stopTranscribingAsync=function(e,t){var r,n=this;try{if(!this.privIsSpeaking)return this.cancelSpeech(),void this.handleCallback(e,t);this.privIsSpeaking=!1,null===(r=this.privTranslationRecognizer)||void 0===r||r.stopContinuousRecognitionAsync((function(){n.handleCallback(e,t)}),(function(e){n.handleError(e,t),n.cancelSpeech()}))}catch(e){this.handleError(e,t),this.cancelSpeech()}},e.prototype.isDisposed=function(){return this.privIsDisposed},e.prototype.dispose=function(e){var t,r;this.isDisposed&&!this.privIsSpeaking||(this.cancelSpeech(),this.privIsDisposed=!0,null===(t=this.privSpeechTranslationConfig)||void 0===t||t.close(),this.privSpeechRecognitionLanguage=void 0,this.privProperties=void 0,this.privAudioConfig=void 0,this.privSpeechTranslationConfig=void 0,null===(r=this.privConversation)||void 0===r||r.dispose(),this.privConversation=void 0)},e.prototype.connectTranslatorRecognizer=function(e,t){try{void 0===this.privAudioConfig&&(this.privAudioConfig=s.AudioConfig.fromDefaultMicrophoneInput()),this.privSpeechTranslationConfig.getProperty(s.PropertyId[s.PropertyId.SpeechServiceConnection_Key])===i.ConversationTranslatorConfig.auth.placeholderSubscriptionKey&&this.privSpeechTranslationConfig.setProperty(s.PropertyId[s.PropertyId.SpeechServiceConnection_Key],"");var r=encodeURIComponent(this.privConversation.room.token),n=this.privSpeechTranslationConfig.getProperty(s.PropertyId[s.PropertyId.SpeechServiceConnection_Host],i.ConversationTranslatorConfig.speechHost),o="wss://"+(n=n.replace("{region}",this.privConversation.room.cognitiveSpeechRegion))+i.ConversationTranslatorConfig.speechPath+"?"+i.ConversationTranslatorConfig.params.token+"="+r;this.privSpeechTranslationConfig.setProperty(s.PropertyId[s.PropertyId.SpeechServiceConnection_Endpoint],o),this.privTranslationRecognizer=new s.TranslationRecognizer(this.privSpeechTranslationConfig,this.privAudioConfig),this.privTranslationRecognizerConnection=s.Connection.fromRecognizer(this.privTranslationRecognizer),this.privTranslationRecognizerConnection.connected=this.onSpeechConnected,this.privTranslationRecognizerConnection.disconnected=this.onSpeechDisconnected,this.privTranslationRecognizer.recognized=this.onSpeechRecognized,this.privTranslationRecognizer.recognizing=this.onSpeechRecognizing,this.privTranslationRecognizer.canceled=this.onSpeechCanceled,this.privTranslationRecognizer.sessionStarted=this.onSpeechSessionStarted,this.privTranslationRecognizer.sessionStopped=this.onSpeechSessionStopped,this.handleCallback(e,t)}catch(e){this.handleError(e,t),this.cancelSpeech()}},e.prototype.startContinuousRecognition=function(e,t){this.privTranslationRecognizer.startContinuousRecognitionAsync(e,t)},e.prototype.fireCancelEvent=function(e){var t,r,n;try{if(this.canceled){var i=new c.ConversationTranslationCanceledEventArgs(null!==(t=null==e?void 0:e.reason)&&void 0!==t?t:s.CancellationReason.Error,null!==(r=null==e?void 0:e.errorDetails)&&void 0!==r?r:e,null!==(n=null==e?void 0:e.errorCode)&&void 0!==n?n:s.CancellationErrorCode.RuntimeError,void 0,null==e?void 0:e.sessionId);this.canceled(this,i)}}catch(e){}},e.prototype.cancelSpeech=function(){var e,t;try{this.privIsSpeaking=!1,null===(e=this.privTranslationRecognizer)||void 0===e||e.stopContinuousRecognitionAsync(),null===(t=this.privTranslationRecognizerConnection)||void 0===t||t.closeConnection(),this.privTranslationRecognizerConnection=void 0,this.privTranslationRecognizer=void 0,this.privSpeechState=n.Inactive}catch(e){}},Object.defineProperty(e.prototype,"canSpeak",{get:function(){return!!this.privConversation.isConnected&&(!this.privIsSpeaking&&this.privSpeechState!==n.Connected&&this.privSpeechState!==n.Connecting&&!this.privConversation.isMutedByHost)},enumerable:!0,configurable:!0}),e.prototype.handleCallback=function(e,t){if(e){try{e()}catch(e){t&&t(e)}e=void 0}},e.prototype.handleError=function(e,t){if(t)if(e instanceof Error){var r=e;t(r.name+": "+r.message)}else t(e)},e}();t.ConversationTranslator=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=function(){function e(e){this.privUserId=e}return Object.defineProperty(e.prototype,"userId",{get:function(){return this.privUserId},enumerable:!0,configurable:!0}),e}();t.User=i;var o=function(){function e(e,t,r,i,o,s,a){this.privId=e,this.privAvatar=t,this.privDisplayName=r,this.privIsHost=i,this.privIsMuted=o,this.privIsUsingTts=s,this.privPreferredLanguage=a,this.privPoperties=new n.PropertyCollection}return Object.defineProperty(e.prototype,"avatar",{get:function(){return this.privAvatar},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayName",{get:function(){return this.privDisplayName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.privId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"preferredLanguage",{get:function(){return this.privPreferredLanguage},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isHost",{get:function(){return this.privIsHost},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isMuted",{get:function(){return this.privIsMuted},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isUsingTts",{get:function(){return this.privIsUsingTts},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"properties",{get:function(){return this.privPoperties},enumerable:!0,configurable:!0}),e}();t.Participant=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.JoinedConversation=0]="JoinedConversation",e[e.LeftConversation=1]="LeftConversation",e[e.Updated=2]="Updated"}(t.ParticipantChangedReason||(t.ParticipantChangedReason={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(16),i=r(3),o=r(0),s=r(2),a=r(93),c=function(){function e(t,r,n,c,p){var u=this;if(this.recognizeOverride=void 0,this.disconnectOverride=void 0,this.sendTelemetryData=function(){var t=u.privRequestSession.getTelemetry();if(!0!==e.telemetryDataEnabled||u.privIsDisposed||null===t)return i.PromiseHelper.fromResult(!0);if(e.telemetryData)try{e.telemetryData(t)}catch(e){}return u.fetchConnection().onSuccessContinueWith((function(e){return e.send(new a.SpeechConnectionMessage(i.MessageType.Text,"telemetry",u.privRequestSession.requestId,"application/json",t))}))},this.receiveMessageOverride=void 0,this.receiveMessage=function(){return u.fetchConnection().on((function(e){return e.read().onSuccessContinueWithPromise((function(e){if(void 0!==u.receiveMessageOverride)return u.receiveMessageOverride();if(u.privIsDisposed)return i.PromiseHelper.fromResult(void 0);if(!e)return u.privRequestSession.isRecognizing?u.receiveMessage():i.PromiseHelper.fromResult(!0);u.privServiceHasSentMessage=!0;var t=a.SpeechConnectionMessage.fromConnectionMessage(e);if(t.requestId.toLowerCase()===u.privRequestSession.requestId.toLowerCase())switch(t.path.toLowerCase()){case"turn.start":u.privMustReportEndOfStream=!0,u.privRequestSession.onServiceTurnStartResponse();break;case"speech.startdetected":var r=s.SpeechDetected.fromJSON(t.textBody),n=new o.RecognitionEventArgs(r.Offset,u.privRequestSession.sessionId);u.privRecognizer.speechStartDetected&&u.privRecognizer.speechStartDetected(u.privRecognizer,n);break;case"speech.enddetected":var c=void 0;c=t.textBody.length>0?t.textBody:"{ Offset: 0 }";var p=s.SpeechDetected.fromJSON(c);u.privRecognizerConfig.isContinuousRecognition&&u.privRequestSession.onServiceRecognized(p.Offset+u.privRequestSession.currentTurnAudioOffset);var h=new o.RecognitionEventArgs(p.Offset+u.privRequestSession.currentTurnAudioOffset,u.privRequestSession.sessionId);u.privRecognizer.speechEndDetected&&u.privRecognizer.speechEndDetected(u.privRecognizer,h);break;case"turn.end":u.sendTelemetryData(),u.privRequestSession.isSpeechEnded&&u.privMustReportEndOfStream&&(u.privMustReportEndOfStream=!1,u.cancelRecognitionLocal(o.CancellationReason.EndOfStream,o.CancellationErrorCode.NoError,void 0));var v=new o.SessionEventArgs(u.privRequestSession.sessionId);if(u.privRequestSession.onServiceTurnEndResponse(u.privRecognizerConfig.isContinuousRecognition),!u.privRecognizerConfig.isContinuousRecognition||u.privRequestSession.isSpeechEnded||!u.privRequestSession.isRecognizing)return u.privRecognizer.sessionStopped&&u.privRecognizer.sessionStopped(u.privRecognizer,v),i.PromiseHelper.fromResult(!0);u.fetchConnection().onSuccessContinueWith((function(e){u.sendSpeechContext(e),u.sendWaveHeader(e)}));break;default:u.processTypeSpecificMessages(t)||u.privServiceEvents&&u.serviceEvents.onEvent(new i.ServiceEvent(t.path.toLowerCase(),t.textBody))}return u.receiveMessage()}))}),(function(e){}))},this.sendSpeechContext=function(e){var t=u.speechContext.toJSON();return t?e.send(new a.SpeechConnectionMessage(i.MessageType.Text,"speech.context",u.privRequestSession.requestId,"application/json",t)):i.PromiseHelper.fromResult(!0)},this.connectImplOverride=void 0,this.configConnectionOverride=void 0,this.fetchConnectionOverride=void 0,this.sendSpeechServiceConfig=function(t,r,n){if(!0!==e.telemetryDataEnabled){var o={context:{system:JSON.parse(n).context.system}};n=JSON.stringify(o)}return n?t.send(new a.SpeechConnectionMessage(i.MessageType.Text,"speech.config",r.requestId,"application/json",n)):i.PromiseHelper.fromResult(!0)},this.sendAudio=function(e){return u.audioSource.format.onSuccessContinueWithPromise((function(t){var r=new i.Deferred,n=Date.now(),o=u.privRecognizerConfig.parameters.getProperty("SPEECH-TransmitLengthBeforThrottleMs","5000"),s=t.avgBytesPerSec/1e3*parseInt(o,10),c=u.privRequestSession.recogNumber,p=function(){u.privIsDisposed||u.privRequestSession.isSpeechEnded||!u.privRequestSession.isRecognizing||u.privRequestSession.recogNumber!==c||u.fetchConnection().on((function(o){e.read().on((function(e){var c,h;u.privRequestSession.isSpeechEnded?r.resolve(!0):(!e||e.isEnd?(c=null,h=0):(c=e.buffer,u.privRequestSession.onAudioSent(c.byteLength),h=s>=u.privRequestSession.bytesSent?0:Math.max(0,n-Date.now())),setTimeout((function(){null!==c&&(n=Date.now()+1e3*c.byteLength/(2*t.avgBytesPerSec));var s=o.send(new a.SpeechConnectionMessage(i.MessageType.Binary,"audio",u.privRequestSession.requestId,null,c));(null==e?void 0:e.isEnd)?(u.privRequestSession.onSpeechEnded(),r.resolve(!0)):s.continueWith((function(e){p()}))}),h))}),(function(e){u.privRequestSession.isSpeechEnded?r.resolve(!0):r.reject(e)}))}),(function(e){r.reject(e)}))};return p(),r.promise()}))},this.fetchConnection=function(){return void 0!==u.fetchConnectionOverride?u.fetchConnectionOverride():u.configureConnection()},!t)throw new i.ArgumentNullError("authentication");if(!r)throw new i.ArgumentNullError("connectionFactory");if(!n)throw new i.ArgumentNullError("audioSource");if(!c)throw new i.ArgumentNullError("recognizerConfig");this.privMustReportEndOfStream=!1,this.privAuthentication=t,this.privConnectionFactory=r,this.privAudioSource=n,this.privRecognizerConfig=c,this.privIsDisposed=!1,this.privRecognizer=p,this.privRequestSession=new s.RequestSession(this.privAudioSource.id()),this.privConnectionEvents=new i.EventSource,this.privServiceEvents=new i.EventSource,this.privDynamicGrammar=new s.DynamicGrammarBuilder,this.privSpeechContext=new s.SpeechContext(this.privDynamicGrammar),this.privAgentConfig=new s.AgentConfig}return Object.defineProperty(e.prototype,"audioSource",{get:function(){return this.privAudioSource},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"speechContext",{get:function(){return this.privSpeechContext},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dynamicGrammar",{get:function(){return this.privDynamicGrammar},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"agentConfig",{get:function(){return this.privAgentConfig},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"conversationTranslatorToken",{set:function(e){this.privRecognizerConfig.parameters.setProperty(o.PropertyId.ConversationTranslator_Token,e)},enumerable:!0,configurable:!0}),e.prototype.isDisposed=function(){return this.privIsDisposed},e.prototype.dispose=function(e){this.privIsDisposed=!0,this.privConnectionConfigurationPromise&&this.privConnectionConfigurationPromise.onSuccessContinueWith((function(t){t.dispose(e)}))},Object.defineProperty(e.prototype,"connectionEvents",{get:function(){return this.privConnectionEvents},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"serviceEvents",{get:function(){return this.privServiceEvents},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recognitionMode",{get:function(){return this.privRecognizerConfig.recognitionMode},enumerable:!0,configurable:!0}),e.prototype.recognize=function(e,t,r){var s=this;return void 0!==this.recognizeOverride?this.recognizeOverride(e,t,r):(this.privConnectionConfigurationPromise=null,this.privRecognizerConfig.recognitionMode=e,this.privSuccessCallback=t,this.privErrorCallback=r,this.privRequestSession.startNewRecognition(),this.privRequestSession.listenForServiceTelemetry(this.privAudioSource.events),this.connectImpl(),this.audioSource.attach(this.privRequestSession.audioNodeId).onSuccessContinueWithPromise((function(e){var t;return s.audioSource.format.onSuccessContinueWithPromise((function(r){return t=new n.ReplayableAudioNode(e,r.avgBytesPerSec),s.privRequestSession.onAudioSourceAttachCompleted(t,!1),s.audioSource.deviceInfo.onSuccessContinueWithPromise((function(e){return s.privRecognizerConfig.SpeechServiceConfig.Context.audio={source:e},s.configureConnection().continueWithPromise((function(e){if(e.isError)return s.cancelRecognitionLocal(o.CancellationReason.Error,o.CancellationErrorCode.ConnectionFailure,e.error),i.PromiseHelper.fromError(e.error);var r=new o.SessionEventArgs(s.privRequestSession.sessionId);s.privRecognizer.sessionStarted&&s.privRecognizer.sessionStarted(s.privRecognizer,r);s.receiveMessage();return s.sendAudio(t).on((function(e){}),(function(e){s.cancelRecognitionLocal(o.CancellationReason.Error,o.CancellationErrorCode.RuntimeError,e)})),i.PromiseHelper.fromResult(!0)}))}))}))})))},e.prototype.stopRecognizing=function(){var e=this;return this.privRequestSession.isRecognizing?(this.audioSource.turnOff(),this.sendFinalAudio().onSuccessContinueWithPromise((function(t){return e.privRequestSession.onStopRecognizing(),e.privRequestSession.turnCompletionPromise.onSuccessContinueWith((function(t){return e.privRequestSession.onStopRecognizing(),e.privRequestSession.dispose(),!0}))}))):i.PromiseHelper.fromResult(!0)},e.prototype.connect=function(){this.connectImpl().result()},e.prototype.connectAsync=function(e,t){this.connectImpl().continueWith((function(r){try{r.isError?t&&t(r.error):r.isCompleted&&e&&e()}catch(e){t&&t(e)}}))},e.prototype.disconnect=function(){void 0===this.disconnectOverride?(this.cancelRecognitionLocal(o.CancellationReason.Error,o.CancellationErrorCode.NoError,"Disconnecting"),this.privConnectionPromise.result().isCompleted?this.privConnectionPromise.result().isError||(this.privConnectionPromise.result().result.dispose(),this.privConnectionPromise=null):this.privConnectionPromise.onSuccessContinueWith((function(e){e.dispose()}))):this.disconnectOverride()},e.prototype.disconnectAsync=function(e,t){try{if(void 0!==this.disconnectOverride)return this.disconnectOverride(),void(e&&e());this.cancelRecognitionLocal(o.CancellationReason.Error,o.CancellationErrorCode.NoError,"Disconnecting"),this.privConnectionPromise.continueWith((function(r){try{r.isError?t&&t(r.error):r.isCompleted&&(r.result.dispose(),e&&e())}catch(e){t&&t(e)}}))}catch(e){t&&t(e)}},e.prototype.sendMessage=function(e){},Object.defineProperty(e.prototype,"activityTemplate",{get:function(){return this.privActivityTemplate},set:function(e){this.privActivityTemplate=e},enumerable:!0,configurable:!0}),e.prototype.cancelRecognitionLocal=function(e,t,r){this.privRequestSession.isRecognizing&&(this.privRequestSession.onStopRecognizing(),this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,e,t,r))},e.prototype.sendWaveHeader=function(e){var t=this;return this.audioSource.format.onSuccessContinueWithPromise((function(r){return e.send(new a.SpeechConnectionMessage(i.MessageType.Binary,"audio",t.privRequestSession.requestId,"audio/x-wav",r.header))}))},e.prototype.connectImpl=function(e){var t=this;if(void 0===e&&(e=!1),void 0!==this.connectImplOverride)return this.connectImplOverride(e);if(this.privConnectionPromise)return this.privConnectionPromise.result().isCompleted&&(this.privConnectionPromise.result().isError||this.privConnectionPromise.result().result.state()===i.ConnectionState.Disconnected)&&!0===this.privServiceHasSentMessage?(this.privConnectionId=null,this.privConnectionPromise=null,this.privServiceHasSentMessage=!1,this.connectImpl()):this.privConnectionPromise;this.privAuthFetchEventId=i.createNoDashGuid(),this.privConnectionId=i.createNoDashGuid(),this.privRequestSession.onPreConnectionStart(this.privAuthFetchEventId,this.privConnectionId);var r=e?this.privAuthentication.fetchOnExpiry(this.privAuthFetchEventId):this.privAuthentication.fetch(this.privAuthFetchEventId);return this.privConnectionPromise=r.continueWithPromise((function(r){if(r.isError)throw t.privRequestSession.onAuthCompleted(!0,r.error),new Error(r.error);t.privRequestSession.onAuthCompleted(!1);var n=t.privConnectionFactory.create(t.privRecognizerConfig,r.result,t.privConnectionId);return t.privRequestSession.listenForServiceTelemetry(n.events),n.events.attach((function(e){t.connectionEvents.onEvent(e)})),n.open().onSuccessContinueWithPromise((function(r){return 200===r.statusCode?(t.privRequestSession.onPreConnectionStart(t.privAuthFetchEventId,t.privConnectionId),t.privRequestSession.onConnectionEstablishCompleted(r.statusCode),i.PromiseHelper.fromResult(n)):403!==r.statusCode||e?(t.privRequestSession.onConnectionEstablishCompleted(r.statusCode,r.reason),i.PromiseHelper.fromError("Unable to contact server. StatusCode: "+r.statusCode+", "+t.privRecognizerConfig.parameters.getProperty(o.PropertyId.SpeechServiceConnection_Endpoint)+" Reason: "+r.reason)):t.connectImpl(!0)}))})),this.privConnectionPromise},e.prototype.writeBufferToConsole=function(e){var t="Buffer Size: ";if(null===e)t+="null";else{var r=new Uint8Array(e);t+=e.byteLength+"\r\n";for(var n=0;n<e.byteLength;n++)t+=r[n].toString(16).padStart(2,"0")+" "}console.info(t)},e.prototype.sendFinalAudio=function(){var e=this,t=new i.Deferred;return this.fetchConnection().on((function(r){r.send(new a.SpeechConnectionMessage(i.MessageType.Binary,"audio",e.privRequestSession.requestId,null,null)).on((function(e){t.resolve(!0)}),(function(e){t.reject(e)}))}),(function(e){t.reject(e)})),t.promise()},e.prototype.configureConnection=function(){var e=this;return void 0!==this.configConnectionOverride?this.configConnectionOverride():this.privConnectionConfigurationPromise?this.privConnectionConfigurationPromise.result().isCompleted&&(this.privConnectionConfigurationPromise.result().isError||this.privConnectionConfigurationPromise.result().result.state()===i.ConnectionState.Disconnected)?(this.privConnectionConfigurationPromise=null,this.configureConnection()):this.privConnectionConfigurationPromise:(this.privConnectionConfigurationPromise=this.connectImpl().onSuccessContinueWithPromise((function(t){return e.sendSpeechServiceConfig(t,e.privRequestSession,e.privRecognizerConfig.SpeechServiceConfig.serialize()).onSuccessContinueWithPromise((function(r){return e.sendSpeechContext(t).onSuccessContinueWithPromise((function(r){return e.sendWaveHeader(t).onSuccessContinueWith((function(e){return t}))}))}))})),this.privConnectionConfigurationPromise)},e.telemetryDataEnabled=!0,e}();t.ServiceRecognizerBase=c},function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Interactive=0]="Interactive",e[e.Conversation=1]="Conversation",e[e.Dictation=2]="Dictation"}(n=t.RecognitionMode||(t.RecognitionMode={})),function(e){e[e.Simple=0]="Simple",e[e.Detailed=1]="Detailed"}(t.SpeechResultFormat||(t.SpeechResultFormat={}));var i=function(){function e(e,t){this.privRecognitionMode=n.Interactive,this.privSpeechServiceConfig=e||new o(new s(null)),this.privParameters=t}return Object.defineProperty(e.prototype,"parameters",{get:function(){return this.privParameters},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recognitionMode",{get:function(){return this.privRecognitionMode},set:function(e){this.privRecognitionMode=e,this.privRecognitionActivityTimeout=e===n.Interactive?8e3:25e3,this.privSpeechServiceConfig.Recognition=n[e]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"SpeechServiceConfig",{get:function(){return this.privSpeechServiceConfig},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recognitionActivityTimeout",{get:function(){return this.privRecognitionActivityTimeout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isContinuousRecognition",{get:function(){return this.privRecognitionMode!==n.Interactive},enumerable:!0,configurable:!0}),e}();t.RecognizerConfig=i;var o=function(){function e(e){var t=this;this.serialize=function(){return JSON.stringify(t,(function(e,t){if(t&&"object"==typeof t){var r={};for(var n in t)Object.hasOwnProperty.call(t,n)&&(r[n&&n.charAt(0).toLowerCase()+n.substring(1)]=t[n]);return r}return t}))},this.context=e}return Object.defineProperty(e.prototype,"Context",{get:function(){return this.context},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Recognition",{get:function(){return this.recognition},set:function(e){this.recognition=e.toLowerCase()},enumerable:!0,configurable:!0}),e}();t.SpeechServiceConfig=o;var s=function(e){this.system=new a,this.os=e};t.Context=s;var a=function(){this.name="SpeechSDK",this.version="1.10.1",this.build="JavaScript",this.lang="JavaScript"};t.System=a;var c=function(e,t,r){this.platform=e,this.name=t,this.version=r};t.OS=c;var p=function(e,t,r){this.manufacturer=e,this.model=t,this.version=r};t.Device=p,function(e){e.Bluetooth="Bluetooth",e.Wired="Wired",e.WiFi="WiFi",e.Cellular="Cellular",e.InBuilt="InBuilt",e.Unknown="Unknown"}(t.connectivity||(t.connectivity={})),function(e){e.Phone="Phone",e.Speaker="Speaker",e.Car="Car",e.Headset="Headset",e.Thermostat="Thermostat",e.Microphones="Microphones",e.Deskphone="Deskphone",e.RemoteControl="RemoteControl",e.Unknown="Unknown",e.File="File",e.Stream="Stream"}(t.type||(t.type={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(3),i=function(){var e=this;this.toConnectionMessage=function(t){var r=new n.Deferred;try{if(t.messageType===n.MessageType.Text){var i=t.textContent,o={},s=null;if(i){var a=i.split("\r\n\r\n");a&&a.length>0&&(o=e.parseHeaders(a[0]),a.length>1&&(s=a[1]))}r.resolve(new n.ConnectionMessage(t.messageType,s,o,t.id))}else if(t.messageType===n.MessageType.Binary){var c=t.binaryContent;if(o={},s=null,!c||c.byteLength<2)throw new Error("Invalid binary message format. Header length missing.");var p=new DataView(c),u=p.getInt16(0);if(c.byteLength<u+2)throw new Error("Invalid binary message format. Header content missing.");for(var h="",v=0;v<u;v++)h+=String.fromCharCode(p.getInt8(v+2));o=e.parseHeaders(h),c.byteLength>u+2&&(s=c.slice(2+u)),r.resolve(new n.ConnectionMessage(t.messageType,s,o,t.id))}}catch(e){r.reject("Error formatting the message. Error: "+e)}return r.promise()},this.fromConnectionMessage=function(t){var r=new n.Deferred;try{if(t.messageType===n.MessageType.Text){var i=e.makeHeaders(t)+"\r\n"+(t.textBody?t.textBody:"");r.resolve(new n.RawWebsocketMessage(n.MessageType.Text,i,t.id))}else if(t.messageType===n.MessageType.Binary){var o=e.makeHeaders(t),s=t.binaryBody,a=new Int8Array(e.stringToArrayBuffer(o)),c=(i=new ArrayBuffer(2+a.byteLength+(s?s.byteLength:0)),new DataView(i));c.setInt16(0,a.length);for(var p=0;p<a.byteLength;p++)c.setInt8(2+p,a[p]);if(s){var u=new Int8Array(s);for(p=0;p<u.byteLength;p++)c.setInt8(2+a.byteLength+p,u[p])}r.resolve(new n.RawWebsocketMessage(n.MessageType.Binary,i,t.id))}}catch(e){r.reject("Error formatting the message. "+e)}return r.promise()},this.makeHeaders=function(e){var t="";if(e.headers)for(var r in e.headers)r&&(t+=r+": "+e.headers[r]+"\r\n");return t},this.parseHeaders=function(e){var t={};if(e){var r=e.match(/[^\r\n]+/g);if(t)for(var n=0,i=r;n<i.length;n++){var o=i[n];if(o){var s=o.indexOf(":"),a=s>0?o.substr(0,s).trim().toLowerCase():o,c=s>0&&o.length>s+1?o.substr(s+1).trim():"";t[a]=c}}}return t},this.stringToArrayBuffer=function(e){for(var t=new ArrayBuffer(e.length),r=new DataView(t),n=0;n<e.length;n++)r.setUint8(n,e.charCodeAt(n));return t}};t.WebsocketMessageFormatter=i},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(16),s=r(0),a=r(31),c=r(2),p=r(36),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.create=function(e,r,n){var i=e.parameters.getProperty(s.PropertyId.SpeechServiceConnection_Endpoint,void 0);if(!i){var a=e.parameters.getProperty(s.PropertyId.SpeechServiceConnection_Region,void 0);i=e.parameters.getProperty(s.PropertyId.SpeechServiceConnection_Host,"wss://"+a+".s2s.speech.microsoft.com")+"/speech/translation/cognitiveservices/v1"}var u={from:e.parameters.getProperty(s.PropertyId.SpeechServiceConnection_RecoLanguage),to:e.parameters.getProperty(s.PropertyId.SpeechServiceConnection_TranslationToLanguages)};t.setCommonUrlParams(e,u,i),t.setUrlParameter(s.PropertyId.SpeechServiceResponse_TranslationRequestStablePartialResult,p.QueryParameterNames.StableTranslation,e,u,i);void 0!==e.parameters.getProperty(s.PropertyId.SpeechServiceConnection_TranslationVoice,void 0)&&(u.voice=e.parameters.getProperty(s.PropertyId.SpeechServiceConnection_TranslationVoice),u.features="texttospeech");var h={};return void 0!==r.token&&""!==r.token&&(h[r.headerName]=r.token),h["X-ConnectionId"]=n,e.parameters.setProperty(s.PropertyId.SpeechServiceConnection_Url,i),new o.WebsocketConnection(i,u,h,new c.WebsocketMessageFormatter,o.ProxyInfo.fromRecognizerConfig(e),n)},t}return i(t,e),t}(a.ConnectionFactoryBase);t.TranslationConnectionFactory=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(2),o=function(){function e(){}return e.implTranslateRecognitionResult=function(e){var t=n.ResultReason.Canceled;switch(e){case i.RecognitionStatus.Success:t=n.ResultReason.RecognizedSpeech;break;case i.RecognitionStatus.NoMatch:case i.RecognitionStatus.InitialSilenceTimeout:case i.RecognitionStatus.BabbleTimeout:case i.RecognitionStatus.EndOfDictation:t=n.ResultReason.NoMatch;break;case i.RecognitionStatus.Error:default:t=n.ResultReason.Canceled}return t},e.implTranslateCancelResult=function(e){var t=n.CancellationReason.EndOfStream;switch(e){case i.RecognitionStatus.Success:case i.RecognitionStatus.EndOfDictation:case i.RecognitionStatus.NoMatch:t=n.CancellationReason.EndOfStream;break;case i.RecognitionStatus.InitialSilenceTimeout:case i.RecognitionStatus.BabbleTimeout:case i.RecognitionStatus.Error:default:t=n.CancellationReason.Error}return t},e.implTranslateCancelErrorCode=function(e){var t=n.CancellationErrorCode.NoError;switch(e){case i.RecognitionStatus.Error:t=n.CancellationErrorCode.ServiceError;break;case i.RecognitionStatus.TooManyRequests:t=n.CancellationErrorCode.TooManyRequests;break;default:t=n.CancellationErrorCode.NoError}return t},e}();t.EnumTranslation=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Success=0]="Success",e[e.SynthesisEnd=1]="SynthesisEnd",e[e.Error=2]="Error"}(t.SynthesisStatus||(t.SynthesisStatus={})),function(e){e[e.Success=0]="Success",e[e.NoMatch=1]="NoMatch",e[e.InitialSilenceTimeout=2]="InitialSilenceTimeout",e[e.BabbleTimeout=3]="BabbleTimeout",e[e.Error=4]="Error",e[e.EndOfDictation=5]="EndOfDictation",e[e.TooManyRequests=6]="TooManyRequests"}(t.RecognitionStatus||(t.RecognitionStatus={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),i=function(){function e(e){this.privSynthesisEnd=JSON.parse(e),this.privSynthesisEnd.SynthesisStatus=n.SynthesisStatus[this.privSynthesisEnd.SynthesisStatus]}return e.fromJSON=function(t){return new e(t)},Object.defineProperty(e.prototype,"SynthesisStatus",{get:function(){return this.privSynthesisEnd.SynthesisStatus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"FailureReason",{get:function(){return this.privSynthesisEnd.FailureReason},enumerable:!0,configurable:!0}),e}();t.TranslationSynthesisEnd=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(51),i=function(){function e(e){this.privTranslationHypothesis=JSON.parse(e),this.privTranslationHypothesis.Translation.TranslationStatus=n.TranslationStatus[this.privTranslationHypothesis.Translation.TranslationStatus]}return e.fromJSON=function(t){return new e(t)},Object.defineProperty(e.prototype,"Duration",{get:function(){return this.privTranslationHypothesis.Duration},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Offset",{get:function(){return this.privTranslationHypothesis.Offset},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Text",{get:function(){return this.privTranslationHypothesis.Text},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Translation",{get:function(){return this.privTranslationHypothesis.Translation},enumerable:!0,configurable:!0}),e}();t.TranslationHypothesis=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),i=r(51),o=function(){function e(e){this.privTranslationPhrase=JSON.parse(e),this.privTranslationPhrase.RecognitionStatus=n.RecognitionStatus[this.privTranslationPhrase.RecognitionStatus],void 0!==this.privTranslationPhrase.Translation&&(this.privTranslationPhrase.Translation.TranslationStatus=i.TranslationStatus[this.privTranslationPhrase.Translation.TranslationStatus])}return e.fromJSON=function(t){return new e(t)},Object.defineProperty(e.prototype,"RecognitionStatus",{get:function(){return this.privTranslationPhrase.RecognitionStatus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Offset",{get:function(){return this.privTranslationPhrase.Offset},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Duration",{get:function(){return this.privTranslationPhrase.Duration},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Text",{get:function(){return this.privTranslationPhrase.Text},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Translation",{get:function(){return this.privTranslationPhrase.Translation},enumerable:!0,configurable:!0}),e}();t.TranslationPhrase=o},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(3),s=r(0),a=r(2),c=function(e){function t(t,r,n,i,o){var s=e.call(this,t,r,n,i,o)||this;return s.privTranslationRecognizer=o,s}return i(t,e),t.prototype.processTypeSpecificMessages=function(e){var t=new s.PropertyCollection,r=!1;switch(e.messageType===o.MessageType.Text&&t.setProperty(s.PropertyId.SpeechServiceResponse_JsonResult,e.textBody),e.path.toLowerCase()){case"translation.hypothesis":var n=this.fireEventForResult(a.TranslationHypothesis.fromJSON(e.textBody),t);if(this.privRequestSession.onHypothesis(this.privRequestSession.currentTurnAudioOffset+n.offset),this.privTranslationRecognizer.recognizing)try{this.privTranslationRecognizer.recognizing(this.privTranslationRecognizer,n)}catch(e){}r=!0;break;case"translation.phrase":var i=a.TranslationPhrase.fromJSON(e.textBody);if(this.privRequestSession.onPhraseRecognized(this.privRequestSession.currentTurnAudioOffset+i.Offset+i.Duration),i.RecognitionStatus===a.RecognitionStatus.Success){var c=this.fireEventForResult(i,t);if(this.privTranslationRecognizer.recognized)try{this.privTranslationRecognizer.recognized(this.privTranslationRecognizer,c)}catch(e){}if(this.privSuccessCallback){try{this.privSuccessCallback(c.result)}catch(e){this.privErrorCallback&&this.privErrorCallback(e)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}break}var p=a.EnumTranslation.implTranslateRecognitionResult(i.RecognitionStatus),u=new s.TranslationRecognitionResult(void 0,this.privRequestSession.requestId,p,i.Text,i.Duration,this.privRequestSession.currentTurnAudioOffset+i.Offset,void 0,e.textBody,t);if(p===s.ResultReason.Canceled){var h=a.EnumTranslation.implTranslateCancelResult(i.RecognitionStatus);this.cancelRecognitionLocal(h,a.EnumTranslation.implTranslateCancelErrorCode(i.RecognitionStatus),void 0)}else{if(!this.privRequestSession.isSpeechEnded||p!==s.ResultReason.NoMatch||i.RecognitionStatus===a.RecognitionStatus.InitialSilenceTimeout){var v=new s.TranslationRecognitionEventArgs(u,u.offset,this.privRequestSession.sessionId);if(this.privTranslationRecognizer.recognized)try{this.privTranslationRecognizer.recognized(this.privTranslationRecognizer,v)}catch(e){}}if(this.privSuccessCallback){try{this.privSuccessCallback(u)}catch(e){this.privErrorCallback&&this.privErrorCallback(e)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}r=!0;break;case"translation.synthesis":this.sendSynthesisAudio(e.binaryBody,this.privRequestSession.sessionId),r=!0;break;case"translation.synthesis.end":var l=a.TranslationSynthesisEnd.fromJSON(e.textBody);switch(l.SynthesisStatus){case a.SynthesisStatus.Error:if(this.privTranslationRecognizer.synthesizing){var d=new s.TranslationSynthesisResult(s.ResultReason.Canceled,void 0),f=new s.TranslationSynthesisEventArgs(d,this.privRequestSession.sessionId);try{this.privTranslationRecognizer.synthesizing(this.privTranslationRecognizer,f)}catch(e){}}if(this.privTranslationRecognizer.canceled){var g=new s.TranslationRecognitionCanceledEventArgs(this.privRequestSession.sessionId,s.CancellationReason.Error,l.FailureReason,s.CancellationErrorCode.ServiceError,null);try{this.privTranslationRecognizer.canceled(this.privTranslationRecognizer,g)}catch(e){}}break;case a.SynthesisStatus.Success:this.sendSynthesisAudio(void 0,this.privRequestSession.sessionId)}r=!0}return r},t.prototype.cancelRecognition=function(e,t,r,n,i){var o=new s.PropertyCollection;if(o.setProperty(a.CancellationErrorCodePropertyName,s.CancellationErrorCode[n]),this.privTranslationRecognizer.canceled){var c=new s.TranslationRecognitionCanceledEventArgs(e,r,i,n,void 0);try{this.privTranslationRecognizer.canceled(this.privTranslationRecognizer,c)}catch(e){}}if(this.privSuccessCallback){var p=new s.TranslationRecognitionResult(void 0,t,s.ResultReason.Canceled,void 0,void 0,void 0,i,void 0,o);try{this.privSuccessCallback(p),this.privSuccessCallback=void 0}catch(e){}}},t.prototype.fireEventForResult=function(e,t){var r,n;if(void 0!==e.Translation.Translations){r=new s.Translations;for(var i=0,c=e.Translation.Translations;i<c.length;i++){var p=c[i];r.set(p.Language,p.Text)}}n=e instanceof a.TranslationPhrase?e.Translation.TranslationStatus===o.TranslationStatus.Success?s.ResultReason.TranslatedSpeech:s.ResultReason.RecognizedSpeech:s.ResultReason.TranslatingSpeech;var u=e.Offset+this.privRequestSession.currentTurnAudioOffset,h=new s.TranslationRecognitionResult(r,this.privRequestSession.requestId,n,e.Text,e.Duration,u,e.Translation.FailureReason,JSON.stringify(e),t);return new s.TranslationRecognitionEventArgs(h,u,this.privRequestSession.sessionId)},t.prototype.sendSynthesisAudio=function(e,t){var r=void 0===e?s.ResultReason.SynthesizingAudioCompleted:s.ResultReason.SynthesizingAudio,n=new s.TranslationSynthesisResult(r,e),i=new s.TranslationSynthesisEventArgs(n,t);if(this.privTranslationRecognizer.synthesizing)try{this.privTranslationRecognizer.synthesizing(this.privTranslationRecognizer,i)}catch(e){}},t}(a.ServiceRecognizerBase);t.TranslationServiceRecognizer=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.privSpeechStartDetected=JSON.parse(e)}return e.fromJSON=function(t){return new e(t)},Object.defineProperty(e.prototype,"Offset",{get:function(){return this.privSpeechStartDetected.Offset},enumerable:!0,configurable:!0}),e}();t.SpeechDetected=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.privSpeechHypothesis=JSON.parse(e)}return e.fromJSON=function(t){return new e(t)},Object.defineProperty(e.prototype,"Text",{get:function(){return this.privSpeechHypothesis.Text},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Offset",{get:function(){return this.privSpeechHypothesis.Offset},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Duration",{get:function(){return this.privSpeechHypothesis.Duration},enumerable:!0,configurable:!0}),e}();t.SpeechHypothesis=n},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),s=r(2),a=function(e){function t(t,r,n,i,o){var s=e.call(this,t,r,n,i,o)||this;return s.privSpeechRecognizer=o,s}return i(t,e),t.prototype.processTypeSpecificMessages=function(e){var t,r=new o.PropertyCollection;r.setProperty(o.PropertyId.SpeechServiceResponse_JsonResult,e.textBody);var n=!1;switch(e.path.toLowerCase()){case"speech.hypothesis":case"speech.fragment":var i=s.SpeechHypothesis.fromJSON(e.textBody),a=i.Offset+this.privRequestSession.currentTurnAudioOffset;t=new o.SpeechRecognitionResult(this.privRequestSession.requestId,o.ResultReason.RecognizingSpeech,i.Text,i.Duration,a,void 0,e.textBody,r),this.privRequestSession.onHypothesis(a);var c=new o.SpeechRecognitionEventArgs(t,i.Duration,this.privRequestSession.sessionId);if(this.privSpeechRecognizer.recognizing)try{this.privSpeechRecognizer.recognizing(this.privSpeechRecognizer,c)}catch(e){}n=!0;break;case"speech.phrase":var p=s.SimpleSpeechPhrase.fromJSON(e.textBody),u=s.EnumTranslation.implTranslateRecognitionResult(p.RecognitionStatus);if(this.privRequestSession.onPhraseRecognized(this.privRequestSession.currentTurnAudioOffset+p.Offset+p.Duration),o.ResultReason.Canceled===u){var h=s.EnumTranslation.implTranslateCancelResult(p.RecognitionStatus);this.cancelRecognitionLocal(h,s.EnumTranslation.implTranslateCancelErrorCode(p.RecognitionStatus),void 0)}else{if(!this.privRequestSession.isSpeechEnded||u!==o.ResultReason.NoMatch||p.RecognitionStatus===s.RecognitionStatus.InitialSilenceTimeout){if(this.privRecognizerConfig.parameters.getProperty(s.OutputFormatPropertyName)===o.OutputFormat[o.OutputFormat.Simple])t=new o.SpeechRecognitionResult(this.privRequestSession.requestId,u,p.DisplayText,p.Duration,p.Offset+this.privRequestSession.currentTurnAudioOffset,void 0,e.textBody,r);else{var v=s.DetailedSpeechPhrase.fromJSON(e.textBody);t=new o.SpeechRecognitionResult(this.privRequestSession.requestId,u,v.RecognitionStatus===s.RecognitionStatus.Success?v.NBest[0].Display:void 0,v.Duration,v.Offset+this.privRequestSession.currentTurnAudioOffset,void 0,e.textBody,r)}var l=new o.SpeechRecognitionEventArgs(t,t.offset,this.privRequestSession.sessionId);if(this.privSpeechRecognizer.recognized)try{this.privSpeechRecognizer.recognized(this.privSpeechRecognizer,l)}catch(e){}}if(this.privSuccessCallback){try{this.privSuccessCallback(t)}catch(e){this.privErrorCallback&&this.privErrorCallback(e)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}n=!0}return n},t.prototype.cancelRecognition=function(e,t,r,n,i){var a=new o.PropertyCollection;if(a.setProperty(s.CancellationErrorCodePropertyName,o.CancellationErrorCode[n]),this.privSpeechRecognizer.canceled){var c=new o.SpeechRecognitionCanceledEventArgs(r,i,n,void 0,e);try{this.privSpeechRecognizer.canceled(this.privSpeechRecognizer,c)}catch(e){}}if(this.privSuccessCallback){var p=new o.SpeechRecognitionResult(t,o.ResultReason.Canceled,void 0,void 0,void 0,i,void 0,a);try{this.privSuccessCallback(p),this.privSuccessCallback=void 0}catch(e){}}},t}(s.ServiceRecognizerBase);t.SpeechServiceRecognizer=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),i=function(){function e(e){this.privDetailedSpeechPhrase=JSON.parse(e),this.privDetailedSpeechPhrase.RecognitionStatus=n.RecognitionStatus[this.privDetailedSpeechPhrase.RecognitionStatus]}return e.fromJSON=function(t){return new e(t)},Object.defineProperty(e.prototype,"RecognitionStatus",{get:function(){return this.privDetailedSpeechPhrase.RecognitionStatus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"NBest",{get:function(){return this.privDetailedSpeechPhrase.NBest},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Duration",{get:function(){return this.privDetailedSpeechPhrase.Duration},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Offset",{get:function(){return this.privDetailedSpeechPhrase.Offset},enumerable:!0,configurable:!0}),e}();t.DetailedSpeechPhrase=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),i=function(){function e(e){this.privSimpleSpeechPhrase=JSON.parse(e),this.privSimpleSpeechPhrase.RecognitionStatus=n.RecognitionStatus[this.privSimpleSpeechPhrase.RecognitionStatus]}return e.fromJSON=function(t){return new e(t)},Object.defineProperty(e.prototype,"RecognitionStatus",{get:function(){return this.privSimpleSpeechPhrase.RecognitionStatus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"DisplayText",{get:function(){return this.privSimpleSpeechPhrase.DisplayText},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Offset",{get:function(){return this.privSimpleSpeechPhrase.Offset},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Duration",{get:function(){return this.privSimpleSpeechPhrase.Duration},enumerable:!0,configurable:!0}),e}();t.SimpleSpeechPhrase=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t){this.modelImpl=e,this.intentName=t};t.AddedLmIntent=n},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(3),s=r(0),a=r(2),c=function(e){function t(t,r,n,i,o){var s=e.call(this,t,r,n,i,o)||this;return s.privIntentRecognizer=o,s.privIntentDataSent=!1,s}return i(t,e),t.prototype.setIntents=function(e,t){this.privAddedLmIntents=e,this.privUmbrellaIntent=t,this.privIntentDataSent=!0},t.prototype.processTypeSpecificMessages=function(e){var t,r,n=this,i=!1,c=new s.PropertyCollection;switch(e.messageType===o.MessageType.Text&&c.setProperty(s.PropertyId.SpeechServiceResponse_JsonResult,e.textBody),e.path.toLowerCase()){case"speech.hypothesis":var p=a.SpeechHypothesis.fromJSON(e.textBody);if(t=new s.IntentRecognitionResult(void 0,this.privRequestSession.requestId,s.ResultReason.RecognizingIntent,p.Text,p.Duration,p.Offset+this.privRequestSession.currentTurnAudioOffset,void 0,e.textBody,c),this.privRequestSession.onHypothesis(t.offset),r=new s.IntentRecognitionEventArgs(t,p.Offset+this.privRequestSession.currentTurnAudioOffset,this.privRequestSession.sessionId),this.privIntentRecognizer.recognizing)try{this.privIntentRecognizer.recognizing(this.privIntentRecognizer,r)}catch(e){}i=!0;break;case"speech.phrase":var u=a.SimpleSpeechPhrase.fromJSON(e.textBody);t=new s.IntentRecognitionResult(void 0,this.privRequestSession.requestId,a.EnumTranslation.implTranslateRecognitionResult(u.RecognitionStatus),u.DisplayText,u.Duration,u.Offset+this.privRequestSession.currentTurnAudioOffset,void 0,e.textBody,c),r=new s.IntentRecognitionEventArgs(t,t.offset,this.privRequestSession.sessionId);!1===this.privIntentDataSent||s.ResultReason.NoMatch===r.result.reason?(this.privRequestSession.onPhraseRecognized(r.offset+r.result.duration),function(){if(n.privIntentRecognizer.recognized)try{n.privIntentRecognizer.recognized(n.privIntentRecognizer,r)}catch(e){}if(n.privSuccessCallback){try{n.privSuccessCallback(t)}catch(e){n.privErrorCallback&&n.privErrorCallback(e)}n.privSuccessCallback=void 0,n.privErrorCallback=void 0}}()):this.privPendingIntentArgs=r,i=!0;break;case"response":if(r=this.privPendingIntentArgs,this.privPendingIntentArgs=void 0,void 0===r){if(""===e.textBody)return;r=new s.IntentRecognitionEventArgs(new s.IntentRecognitionResult,0,this.privRequestSession.sessionId)}var h=a.IntentResponse.fromJSON(e.textBody),v=this.privAddedLmIntents[h.topScoringIntent.intent];if(void 0!==this.privUmbrellaIntent&&(v=this.privUmbrellaIntent),null!==h&&void 0!==v){var l=void 0===v.intentName?h.topScoringIntent.intent:v.intentName,d=r.result.reason;void 0!==l&&(d=s.ResultReason.RecognizedIntent);var f=void 0!==r.result.properties?r.result.properties:new s.PropertyCollection;f.setProperty(s.PropertyId.LanguageUnderstandingServiceResponse_JsonResult,e.textBody),r=new s.IntentRecognitionEventArgs(new s.IntentRecognitionResult(l,r.result.resultId,d,r.result.text,r.result.duration,r.result.offset,r.result.errorDetails,r.result.json,f),r.offset,r.sessionId)}if(this.privRequestSession.onPhraseRecognized(r.offset+r.result.duration),this.privIntentRecognizer.recognized)try{this.privIntentRecognizer.recognized(this.privIntentRecognizer,r)}catch(e){}if(this.privSuccessCallback){try{this.privSuccessCallback(r.result)}catch(e){this.privErrorCallback&&this.privErrorCallback(e)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}i=!0}return i},t.prototype.cancelRecognition=function(e,t,r,n,i){var o=new s.PropertyCollection;if(o.setProperty(a.CancellationErrorCodePropertyName,s.CancellationErrorCode[n]),this.privIntentRecognizer.canceled){var c=new s.IntentRecognitionCanceledEventArgs(r,i,n,void 0,void 0,e);try{this.privIntentRecognizer.canceled(this.privIntentRecognizer,c)}catch(e){}}if(this.privSuccessCallback){var p=new s.IntentRecognitionResult(void 0,t,s.ResultReason.Canceled,void 0,void 0,void 0,i,void 0,o);try{this.privSuccessCallback(p),this.privSuccessCallback=void 0}catch(e){}}},t}(a.ServiceRecognizerBase);t.IntentServiceRecognizer=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.privIntentResponse=JSON.parse(e)}return e.fromJSON=function(t){return new e(t)},Object.defineProperty(e.prototype,"query",{get:function(){return this.privIntentResponse.query},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topScoringIntent",{get:function(){return this.privIntentResponse.topScoringIntent},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"entities",{get:function(){return this.privIntentResponse.entities},enumerable:!0,configurable:!0}),e}();t.IntentResponse=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(3),i=r(54),o=r(230),s=function(){function e(e){var t=this;this.privIsDisposed=!1,this.privDetachables=new Array,this.privIsAudioNodeDetached=!1,this.privIsRecognizing=!1,this.privIsSpeechEnded=!1,this.privTurnStartAudioOffset=0,this.privLastRecoOffset=0,this.privHypothesisReceived=!1,this.privBytesSent=0,this.privRecogNumber=0,this.onAudioSourceAttachCompleted=function(e,r,n){t.privAudioNode=e,t.privIsAudioNodeDetached=!1,r?t.onComplete():t.onEvent(new i.ListeningStartedEvent(t.privRequestId,t.privSessionId,t.privAudioSourceId,t.privAudioNodeId))},this.onPreConnectionStart=function(e,r){t.privAuthFetchEventId=e,t.privSessionId=r,t.onEvent(new i.ConnectingToServiceEvent(t.privRequestId,t.privAuthFetchEventId,t.privSessionId))},this.onAuthCompleted=function(e,r){e&&t.onComplete()},this.onConnectionEstablishCompleted=function(e,r){if(200===e)return t.onEvent(new i.RecognitionStartedEvent(t.requestId,t.privAudioSourceId,t.privAudioNodeId,t.privAuthFetchEventId,t.privSessionId)),t.privAudioNode&&t.privAudioNode.replay(),t.privTurnStartAudioOffset=t.privLastRecoOffset,void(t.privBytesSent=0);403===e&&t.onComplete()},this.onServiceTurnEndResponse=function(e){t.privTurnDeferral.resolve(!0),!e||t.isSpeechEnded?t.onComplete():(t.privTurnStartAudioOffset=t.privLastRecoOffset,t.privRequestId=n.createNoDashGuid(),t.privAudioNode.replay())},this.onServiceTurnStartResponse=function(){t.privTurnDeferral.state()===n.PromiseState.None&&t.privTurnDeferral.reject("Another turn started before current completed."),t.privTurnDeferral=new n.Deferred},this.dispose=function(e){if(!t.privIsDisposed){t.privIsDisposed=!0;for(var r=0,n=t.privDetachables;r<n.length;r++){n[r].detach()}t.privServiceTelemetryListener.dispose()}},this.getTelemetry=function(){return t.privServiceTelemetryListener.hasTelemetry?t.privServiceTelemetryListener.getTelemetry():null},this.onEvent=function(e){t.privServiceTelemetryListener&&t.privServiceTelemetryListener.onEvent(e),n.Events.instance.onEvent(e)},this.onComplete=function(){t.privIsRecognizing&&(t.privIsRecognizing=!1,t.detachAudioNode())},this.detachAudioNode=function(){t.privIsAudioNodeDetached||(t.privIsAudioNodeDetached=!0,t.privAudioNode&&t.privAudioNode.detach())},this.privAudioSourceId=e,this.privRequestId=n.createNoDashGuid(),this.privAudioNodeId=n.createNoDashGuid(),this.privTurnDeferral=new n.Deferred,this.privTurnDeferral.resolve(!0)}return Object.defineProperty(e.prototype,"sessionId",{get:function(){return this.privSessionId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"requestId",{get:function(){return this.privRequestId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"audioNodeId",{get:function(){return this.privAudioNodeId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"turnCompletionPromise",{get:function(){return this.privTurnDeferral.promise()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSpeechEnded",{get:function(){return this.privIsSpeechEnded},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isRecognizing",{get:function(){return this.privIsRecognizing},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentTurnAudioOffset",{get:function(){return this.privTurnStartAudioOffset},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recogNumber",{get:function(){return this.privRecogNumber},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bytesSent",{get:function(){return this.privBytesSent},enumerable:!0,configurable:!0}),e.prototype.listenForServiceTelemetry=function(e){this.privServiceTelemetryListener&&this.privDetachables.push(e.attachListener(this.privServiceTelemetryListener))},e.prototype.startNewRecognition=function(){this.privIsSpeechEnded=!1,this.privIsRecognizing=!0,this.privTurnStartAudioOffset=0,this.privLastRecoOffset=0,this.privRequestId=n.createNoDashGuid(),this.privRecogNumber++,this.privServiceTelemetryListener=new o.ServiceTelemetryListener(this.privRequestId,this.privAudioSourceId,this.privAudioNodeId),this.onEvent(new i.RecognitionTriggeredEvent(this.requestId,this.privSessionId,this.privAudioSourceId,this.privAudioNodeId))},e.prototype.onHypothesis=function(e){this.privHypothesisReceived||(this.privHypothesisReceived=!0,this.privServiceTelemetryListener.hypothesisReceived(this.privAudioNode.findTimeAtOffset(e)))},e.prototype.onPhraseRecognized=function(e){this.privServiceTelemetryListener.phraseReceived(this.privAudioNode.findTimeAtOffset(e)),this.onServiceRecognized(e)},e.prototype.onServiceRecognized=function(e){this.privLastRecoOffset=e,this.privHypothesisReceived=!1,this.privAudioNode.shrinkBuffers(e)},e.prototype.onAudioSent=function(e){this.privBytesSent+=e},e.prototype.onStopRecognizing=function(){this.onComplete()},e.prototype.onSpeechEnded=function(){this.privIsSpeechEnded=!0},e}();t.RequestSession=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(3),i=r(54),o=function(){function e(e,t,r){var o=this;this.privIsDisposed=!1,this.privListeningTriggerMetric=null,this.privMicMetric=null,this.privConnectionEstablishMetric=null,this.onEvent=function(e){o.privIsDisposed||(e instanceof i.RecognitionTriggeredEvent&&e.requestId===o.privRequestId&&(o.privListeningTriggerMetric={End:e.eventTime,Name:"ListeningTrigger",Start:e.eventTime}),e instanceof n.AudioStreamNodeAttachingEvent&&e.audioSourceId===o.privAudioSourceId&&e.audioNodeId===o.privAudioNodeId&&(o.privMicStartTime=e.eventTime),e instanceof n.AudioStreamNodeAttachedEvent&&e.audioSourceId===o.privAudioSourceId&&e.audioNodeId===o.privAudioNodeId&&(o.privMicStartTime=e.eventTime),e instanceof n.AudioSourceErrorEvent&&e.audioSourceId===o.privAudioSourceId&&(o.privMicMetric||(o.privMicMetric={End:e.eventTime,Error:e.error,Name:"Microphone",Start:o.privMicStartTime})),e instanceof n.AudioStreamNodeErrorEvent&&e.audioSourceId===o.privAudioSourceId&&e.audioNodeId===o.privAudioNodeId&&(o.privMicMetric||(o.privMicMetric={End:e.eventTime,Error:e.error,Name:"Microphone",Start:o.privMicStartTime})),e instanceof n.AudioStreamNodeDetachedEvent&&e.audioSourceId===o.privAudioSourceId&&e.audioNodeId===o.privAudioNodeId&&(o.privMicMetric||(o.privMicMetric={End:e.eventTime,Name:"Microphone",Start:o.privMicStartTime})),e instanceof i.ConnectingToServiceEvent&&e.requestId===o.privRequestId&&(o.privConnectionId=e.sessionId),e instanceof n.ConnectionStartEvent&&e.connectionId===o.privConnectionId&&(o.privConnectionStartTime=e.eventTime),e instanceof n.ConnectionEstablishedEvent&&e.connectionId===o.privConnectionId&&(o.privConnectionEstablishMetric||(o.privConnectionEstablishMetric={End:e.eventTime,Id:o.privConnectionId,Name:"Connection",Start:o.privConnectionStartTime})),e instanceof n.ConnectionEstablishErrorEvent&&e.connectionId===o.privConnectionId&&(o.privConnectionEstablishMetric||(o.privConnectionEstablishMetric={End:e.eventTime,Error:o.getConnectionError(e.statusCode),Id:o.privConnectionId,Name:"Connection",Start:o.privConnectionStartTime})),e instanceof n.ConnectionMessageReceivedEvent&&e.connectionId===o.privConnectionId&&e.message&&e.message.headers&&e.message.headers.path&&(o.privReceivedMessages[e.message.headers.path]||(o.privReceivedMessages[e.message.headers.path]=new Array),o.privReceivedMessages[e.message.headers.path].push(e.networkReceivedTime)))},this.getTelemetry=function(){var e=new Array;o.privListeningTriggerMetric&&e.push(o.privListeningTriggerMetric),o.privMicMetric&&e.push(o.privMicMetric),o.privConnectionEstablishMetric&&e.push(o.privConnectionEstablishMetric),o.privPhraseLatencies.length>0&&e.push({PhraseLatencyMs:o.privPhraseLatencies}),o.privHypothesisLatencies.length>0&&e.push({FirstHypothesisLatencyMs:o.privHypothesisLatencies});var t={Metrics:e,ReceivedMessages:o.privReceivedMessages},r=JSON.stringify(t);return o.privReceivedMessages={},o.privListeningTriggerMetric=null,o.privMicMetric=null,o.privConnectionEstablishMetric=null,o.privPhraseLatencies=[],o.privHypothesisLatencies=[],r},this.dispose=function(){o.privIsDisposed=!0},this.getConnectionError=function(e){switch(e){case 400:case 1002:case 1003:case 1005:case 1007:case 1008:case 1009:return"BadRequest";case 401:return"Unauthorized";case 403:return"Forbidden";case 503:case 1001:return"ServerUnavailable";case 500:case 1011:return"ServerError";case 408:case 504:return"Timeout";default:return"statuscode:"+e.toString()}},this.privRequestId=e,this.privAudioSourceId=t,this.privAudioNodeId=r,this.privReceivedMessages={},this.privPhraseLatencies=[],this.privHypothesisLatencies=[]}return e.prototype.phraseReceived=function(e){e>0&&this.privPhraseLatencies.push(Date.now()-e)},e.prototype.hypothesisReceived=function(e){e>0&&this.privHypothesisLatencies.push(Date.now()-e)},Object.defineProperty(e.prototype,"hasTelemetry",{get:function(){return 0!==Object.keys(this.privReceivedMessages).length||null!==this.privListeningTriggerMetric||null!==this.privMicMetric||null!==this.privConnectionEstablishMetric||0!==this.privPhraseLatencies.length||0!==this.privHypothesisLatencies.length},enumerable:!0,configurable:!0}),e}();t.ServiceTelemetryListener=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.privContext={},this.privDynamicGrammar=e}return e.prototype.setSection=function(e,t){this.privContext[e]=t},e.prototype.toJSON=function(){var e=this.privDynamicGrammar.generateGrammarObject();return this.setSection("dgi",e),JSON.stringify(this.privContext)},e}();t.SpeechContext=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.prototype.addPhrase=function(e){this.privPhrases||(this.privPhrases=[]),e instanceof Array?this.privPhrases=this.privPhrases.concat(e):this.privPhrases.push(e)},e.prototype.clearPhrases=function(){this.privPhrases=void 0},e.prototype.addReferenceGrammar=function(e){this.privGrammars||(this.privGrammars=[]),e instanceof Array?this.privGrammars=this.privGrammars.concat(e):this.privGrammars.push(e)},e.prototype.clearGrammars=function(){this.privGrammars=void 0},e.prototype.generateGrammarObject=function(){if(void 0!==this.privGrammars||void 0!==this.privPhrases){var e={};if(e.ReferenceGrammars=this.privGrammars,void 0!==this.privPhrases&&0!==this.privPhrases.length){var t=[];this.privPhrases.forEach((function(e,r,n){t.push({Text:e})})),e.Groups=[{Type:"Generic",Items:t}]}return e}},e}();t.DynamicGrammarBuilder=n},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(16),s=r(3),a=r(0),c=r(234),p=r(2),u=r(94),h=r(93),v=function(e){function t(t,r,n,i,u){var v=e.call(this,t,r,n,i,u)||this;return v.sendMessage=function(e){var t=s.createGuid(),r=s.createNoDashGuid(),n={context:{interactionId:t},messagePayload:e,version:.5},i=JSON.stringify(n);v.fetchDialogConnection().onSuccessContinueWith((function(e){e.send(new h.SpeechConnectionMessage(s.MessageType.Text,"agent",r,"application/json",i))}))},v.listenOnce=function(e,t,r){return v.privRecognizerConfig.recognitionMode=e,v.privSuccessCallback=t,v.privErrorCallback=r,v.privDialogRequestSession.startNewRecognition(),v.privDialogRequestSession.listenForServiceTelemetry(v.privDialogAudioSource.events),v.dialogConnectImpl(),v.sendPreAudioMessages(),v.privDialogAudioSource.attach(v.privDialogRequestSession.audioNodeId).continueWithPromise((function(e){var t;return e.isError?(v.cancelRecognition(v.privDialogRequestSession.sessionId,v.privDialogRequestSession.requestId,a.CancellationReason.Error,a.CancellationErrorCode.ConnectionFailure,e.error),s.PromiseHelper.fromError(e.error)):v.privDialogAudioSource.format.onSuccessContinueWithPromise((function(r){return t=new o.ReplayableAudioNode(e.result,r.avgBytesPerSec),v.privDialogRequestSession.onAudioSourceAttachCompleted(t,!1),v.privDialogAudioSource.deviceInfo.onSuccessContinueWithPromise((function(e){return v.privRecognizerConfig.SpeechServiceConfig.Context.audio={source:e},v.configConnection().continueWithPromise((function(e){if(e.isError)return v.cancelRecognitionLocal(a.CancellationReason.Error,a.CancellationErrorCode.ConnectionFailure,e.error),s.PromiseHelper.fromError(e.error);var r=new a.SessionEventArgs(v.privDialogRequestSession.sessionId);return v.privRecognizer.sessionStarted&&v.privRecognizer.sessionStarted(v.privRecognizer,r),v.sendAudio(t).on((function(e){}),(function(e){v.cancelRecognition(v.privDialogRequestSession.sessionId,v.privDialogRequestSession.requestId,a.CancellationReason.Error,a.CancellationErrorCode.RuntimeError,e)})),s.PromiseHelper.fromResult(!0)}))}))}))}))},v.sendAudio=function(e){return v.privDialogAudioSource.format.onSuccessContinueWithPromise((function(t){var r=new s.Deferred,n=Date.now(),i=v.privRecognizerConfig.parameters.getProperty("SPEECH-TransmitLengthBeforThrottleMs","5000"),o=t.avgBytesPerSec/1e3*parseInt(i,10),a=v.privDialogRequestSession.recogNumber,c=function(){v.privDialogIsDisposed||v.privDialogRequestSession.isSpeechEnded||!v.privDialogRequestSession.isRecognizing||v.privDialogRequestSession.recogNumber!==a||v.fetchDialogConnection().on((function(i){e.read().on((function(e){var a,p;v.privDialogRequestSession.isSpeechEnded?r.resolve(!0):(!e||e.isEnd?(a=null,p=0):(a=e.buffer,v.privDialogRequestSession.onAudioSent(a.byteLength),p=o>=v.privDialogRequestSession.bytesSent?0:Math.max(0,n-Date.now())),setTimeout((function(){null!==a&&(n=Date.now()+1e3*a.byteLength/(2*t.avgBytesPerSec));var o=i.send(new h.SpeechConnectionMessage(s.MessageType.Binary,"audio",v.privDialogRequestSession.requestId,null,a));e&&!e.isEnd?o.continueWith((function(e){c()})):(v.privDialogRequestSession.onSpeechEnded(),r.resolve(!0))}),p))}),(function(e){v.privDialogRequestSession.isSpeechEnded?r.resolve(!0):r.reject(e)}))}),(function(e){r.reject(e)}))};return c(),r.promise()}))},v.receiveDialogMessageOverride=function(){var e=new s.Deferred;return v.fetchDialogConnection().on((function(t){return t.read().onSuccessContinueWithPromise((function(t){var r=v.isDisposed(),n=!v.isDisposed()&&v.terminateMessageLoop;if(r||n)return e.resolve(void 0),s.PromiseHelper.fromResult(void 0);if(!t)return v.receiveDialogMessageOverride();var i=h.SpeechConnectionMessage.fromConnectionMessage(t);switch(i.path.toLowerCase()){case"turn.start":var o=i.requestId.toUpperCase();o!==v.privDialogRequestSession.requestId.toUpperCase()?v.privTurnStateManager.StartTurn(o):v.privDialogRequestSession.onServiceTurnStartResponse();break;case"speech.startdetected":var c=p.SpeechDetected.fromJSON(i.textBody),u=new a.RecognitionEventArgs(c.Offset,v.privDialogRequestSession.sessionId);v.privRecognizer.speechStartDetected&&v.privRecognizer.speechStartDetected(v.privRecognizer,u);break;case"speech.enddetected":var l=void 0;l=i.textBody.length>0?i.textBody:"{ Offset: 0 }";var d=p.SpeechDetected.fromJSON(l);v.privDialogRequestSession.onServiceRecognized(d.Offset+v.privDialogRequestSession.currentTurnAudioOffset);var f=new a.RecognitionEventArgs(d.Offset+v.privDialogRequestSession.currentTurnAudioOffset,v.privDialogRequestSession.sessionId);v.privRecognizer.speechEndDetected&&v.privRecognizer.speechEndDetected(v.privRecognizer,f);break;case"turn.end":var g=i.requestId.toUpperCase();if(g!==v.privDialogRequestSession.requestId.toUpperCase())v.privTurnStateManager.CompleteTurn(g);else{var y=new a.SessionEventArgs(v.privDialogRequestSession.sessionId);if(v.privDialogRequestSession.onServiceTurnEndResponse(!1),v.privDialogRequestSession.isSpeechEnded&&v.privRecognizer.sessionStopped&&v.privRecognizer.sessionStopped(v.privRecognizer,y),v.privSuccessCallback&&v.privLastResult){try{v.privSuccessCallback(v.privLastResult),v.privLastResult=null}catch(e){v.privErrorCallback&&v.privErrorCallback(e)}v.privSuccessCallback=void 0,v.privErrorCallback=void 0}}break;default:v.processTypeSpecificMessages(i)||v.serviceEvents&&v.serviceEvents.onEvent(new s.ServiceEvent(i.path.toLowerCase(),i.textBody))}return v.receiveDialogMessageOverride()}))}),(function(t){return v.terminateMessageLoop=!0,e.resolve(void 0),s.PromiseHelper.fromResult(void 0)})),e.promise()},v.fetchDialogConnection=function(){return v.configConnection()},v.sendAgentConfig=function(e){if(v.agentConfig&&!v.agentConfigSent){if("custom_commands"===v.privRecognizerConfig.parameters.getProperty(a.PropertyId.Conversation_DialogType)){var t=v.agentConfig.get();t.botInfo.commandsCulture=v.privRecognizerConfig.parameters.getProperty(a.PropertyId.SpeechServiceConnection_RecoLanguage,"en-us"),v.agentConfig.set(t)}var r=v.agentConfig.toJsonString();return v.agentConfigSent=!0,e.send(new h.SpeechConnectionMessage(s.MessageType.Text,"agent.config",v.privDialogRequestSession.requestId,"application/json",r))}return s.PromiseHelper.fromResult(!0)},v.sendAgentContext=function(e){var t=s.createGuid(),r=v.privDialogServiceConnector.properties.getProperty(a.PropertyId.Conversation_Speech_Activity_Template),n={channelData:"",context:{interactionId:t},messagePayload:void 0===typeof r?void 0:r,version:.5},i=JSON.stringify(n);return e.send(new h.SpeechConnectionMessage(s.MessageType.Text,"speech.agent.context",v.privDialogRequestSession.requestId,"application/json",i))},v.privDialogServiceConnector=u,v.privDialogAuthentication=t,v.receiveMessageOverride=v.receiveDialogMessageOverride,v.privTurnStateManager=new c.DialogServiceTurnStateManager,v.recognizeOverride=v.listenOnce,v.connectImplOverride=v.dialogConnectImpl,v.configConnectionOverride=v.configConnection,v.fetchConnectionOverride=v.fetchDialogConnection,v.disconnectOverride=v.privDisconnect,v.privDialogAudioSource=n,v.privDialogRequestSession=new p.RequestSession(n.id()),v.privDialogConnectionFactory=r,v.privDialogIsDisposed=!1,v.agentConfigSent=!1,v.privLastResult=null,v}return i(t,e),t.prototype.isDisposed=function(){return this.privDialogIsDisposed},t.prototype.dispose=function(e){this.privDialogIsDisposed=!0,this.privConnectionConfigPromise&&this.privConnectionConfigPromise.onSuccessContinueWith((function(t){t.dispose(e)}))},t.prototype.privDisconnect=function(){this.cancelRecognition(this.privDialogRequestSession.sessionId,this.privDialogRequestSession.requestId,a.CancellationReason.Error,a.CancellationErrorCode.NoError,"Disconnecting"),this.terminateMessageLoop=!0,this.agentConfigSent=!1,this.privDialogConnectionPromise.result().isCompleted?this.privDialogConnectionPromise.result().isError||(this.privDialogConnectionPromise.result().result.dispose(),this.privDialogConnectionPromise=null):this.privDialogConnectionPromise.onSuccessContinueWith((function(e){e.dispose()}))},t.prototype.processTypeSpecificMessages=function(e){var t,r,n=new a.PropertyCollection;switch(e.messageType===s.MessageType.Text&&n.setProperty(a.PropertyId.SpeechServiceResponse_JsonResult,e.textBody),e.path.toLowerCase()){case"speech.phrase":var i=p.SimpleSpeechPhrase.fromJSON(e.textBody);if(this.privDialogRequestSession.onPhraseRecognized(this.privDialogRequestSession.currentTurnAudioOffset+i.Offset+i.Duration),i.RecognitionStatus===p.RecognitionStatus.Success){var o=this.fireEventForResult(i,n);if(this.privLastResult=o.result,this.privDialogServiceConnector.recognized)try{this.privDialogServiceConnector.recognized(this.privDialogServiceConnector,o)}catch(e){}}r=!0;break;case"speech.hypothesis":var c=p.SpeechHypothesis.fromJSON(e.textBody),h=c.Offset+this.privDialogRequestSession.currentTurnAudioOffset;t=new a.SpeechRecognitionResult(this.privDialogRequestSession.requestId,a.ResultReason.RecognizingSpeech,c.Text,c.Duration,h,void 0,e.textBody,n),this.privDialogRequestSession.onHypothesis(h);var v=new a.SpeechRecognitionEventArgs(t,c.Duration,this.privDialogRequestSession.sessionId);if(this.privDialogServiceConnector.recognizing)try{this.privDialogServiceConnector.recognizing(this.privDialogServiceConnector,v)}catch(e){}r=!0;break;case"audio":var l=e.requestId.toUpperCase(),d=this.privTurnStateManager.GetTurn(l);try{e.binaryBody?d.audioStream.write(e.binaryBody):d.endAudioStream()}catch(e){}r=!0;break;case"response":var f=e.requestId.toUpperCase(),g=u.ActivityPayloadResponse.fromJSON(e.textBody);d=this.privTurnStateManager.GetTurn(f);if(g.conversationId){var y=this.agentConfig.get();y.botInfo.conversationId=g.conversationId,this.agentConfig.set(y)}var m=d.processActivityPayload(g),S=new a.ActivityReceivedEventArgs(g.messagePayload,m);if(this.privDialogServiceConnector.activityReceived)try{this.privDialogServiceConnector.activityReceived(this.privDialogServiceConnector,S)}catch(e){}r=!0}return r},t.prototype.cancelRecognition=function(e,t,r,n,i){if(this.terminateMessageLoop=!0,this.privDialogRequestSession.isRecognizing&&this.privDialogRequestSession.onStopRecognizing(),this.privDialogServiceConnector.canceled){var o=new a.PropertyCollection;o.setProperty(p.CancellationErrorCodePropertyName,a.CancellationErrorCode[n]);var s=new a.SpeechRecognitionCanceledEventArgs(r,i,n,void 0,e);try{this.privDialogServiceConnector.canceled(this.privDialogServiceConnector,s)}catch(e){}if(this.privSuccessCallback){var c=new a.SpeechRecognitionResult(void 0,a.ResultReason.Canceled,void 0,void 0,void 0,i,void 0,o);try{this.privSuccessCallback(c),this.privSuccessCallback=void 0}catch(e){}}}},t.prototype.sendWaveHeader=function(e){var t=this;return this.audioSource.format.onSuccessContinueWithPromise((function(r){return e.send(new h.SpeechConnectionMessage(s.MessageType.Binary,"audio",t.privDialogRequestSession.requestId,null,r.header))}))},t.prototype.dialogConnectImpl=function(e){var t=this;if(void 0===e&&(e=!1),this.privDialogConnectionPromise)return this.privDialogConnectionPromise.result().isCompleted&&(this.privDialogConnectionPromise.result().isError||this.privDialogConnectionPromise.result().result.state()===s.ConnectionState.Disconnected)?(this.agentConfigSent=!1,this.privDialogConnectionPromise=null,this.terminateMessageLoop=!0,this.configConnection()):this.privDialogConnectionPromise;this.privDialogAuthFetchEventId=s.createNoDashGuid(),void 0===this.privConnectionId&&(this.privConnectionId=s.createNoDashGuid()),this.privDialogRequestSession.onPreConnectionStart(this.privDialogAuthFetchEventId,this.privConnectionId);var r=e?this.privDialogAuthentication.fetchOnExpiry(this.privDialogAuthFetchEventId):this.privDialogAuthentication.fetch(this.privDialogAuthFetchEventId);return this.privDialogConnectionPromise=r.continueWithPromise((function(r){if(r.isError)throw t.privDialogRequestSession.onAuthCompleted(!0,r.error),new Error(r.error);t.privDialogRequestSession.onAuthCompleted(!1);var n=t.privDialogConnectionFactory.create(t.privRecognizerConfig,r.result,t.privConnectionId);return t.privDialogRequestSession.listenForServiceTelemetry(n.events),n.events.attach((function(e){t.connectionEvents.onEvent(e)})),n.open().onSuccessContinueWithPromise((function(r){return 200===r.statusCode?(t.privDialogRequestSession.onPreConnectionStart(t.privDialogAuthFetchEventId,t.privConnectionId),t.privDialogRequestSession.onConnectionEstablishCompleted(r.statusCode),s.PromiseHelper.fromResult(n)):403!==r.statusCode||e?(t.privDialogRequestSession.onConnectionEstablishCompleted(r.statusCode,r.reason),s.PromiseHelper.fromError("Unable to contact server. StatusCode: "+r.statusCode+", "+t.privRecognizerConfig.parameters.getProperty(a.PropertyId.SpeechServiceConnection_Endpoint)+" Reason: "+r.reason)):t.dialogConnectImpl(!0)}))})),this.privConnectionLoop=this.startMessageLoop(),this.privDialogConnectionPromise},t.prototype.startMessageLoop=function(){var e=this;return this.terminateMessageLoop=!1,this.receiveDialogMessageOverride().on((function(e){return!0}),(function(t){e.cancelRecognition(e.privDialogRequestSession.sessionId,e.privDialogRequestSession.requestId,a.CancellationReason.Error,a.CancellationErrorCode.RuntimeError,t)}))},t.prototype.configConnection=function(){var e=this;return this.privConnectionConfigPromise?this.privConnectionConfigPromise.result().isCompleted&&(this.privConnectionConfigPromise.result().isError||this.privConnectionConfigPromise.result().result.state()===s.ConnectionState.Disconnected)?(this.privConnectionConfigPromise=null,this.configConnection()):this.privConnectionConfigPromise:this.terminateMessageLoop?(this.terminateMessageLoop=!1,s.PromiseHelper.fromError("Connection to service terminated.")):(this.privConnectionConfigPromise=this.dialogConnectImpl().onSuccessContinueWithPromise((function(t){return e.sendSpeechServiceConfig(t,e.privDialogRequestSession,e.privRecognizerConfig.SpeechServiceConfig.serialize()).onSuccessContinueWithPromise((function(r){return e.sendAgentConfig(t).onSuccessContinueWith((function(e){return t}))}))})),this.privConnectionConfigPromise)},t.prototype.sendPreAudioMessages=function(){var e=this;this.fetchDialogConnection().onSuccessContinueWith((function(t){e.sendAgentContext(t),e.sendWaveHeader(t)}))},t.prototype.fireEventForResult=function(e,t){var r=p.EnumTranslation.implTranslateRecognitionResult(e.RecognitionStatus),n=e.Offset+this.privDialogRequestSession.currentTurnAudioOffset,i=new a.SpeechRecognitionResult(this.privDialogRequestSession.requestId,r,e.DisplayText,e.Duration,n,void 0,JSON.stringify(e),t);return new a.SpeechRecognitionEventArgs(i,n,this.privDialogRequestSession.sessionId)},t}(p.ServiceRecognizerBase);t.DialogServiceAdapter=v},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(12),i=r(235),o=function(){function e(){this.privTurnMap=new Map}return e.prototype.StartTurn=function(e){if(this.privTurnMap.has(e))throw new n.InvalidOperationError("Service error: There is already a turn with id:"+e);var t=new i.DialogServiceTurnState(this,e);return this.privTurnMap.set(e,t),this.privTurnMap.get(e)},e.prototype.GetTurn=function(e){return this.privTurnMap.get(e)},e.prototype.CompleteTurn=function(e){if(!this.privTurnMap.has(e))throw new n.InvalidOperationError("Service error: Received turn end for an unknown turn id:"+e);var t=this.privTurnMap.get(e);return t.complete(),this.privTurnMap.delete(e),t},e}();t.DialogServiceTurnStateManager=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(87),i=r(94),o=function(){function e(e,t){this.privRequestId=t,this.privIsCompleted=!1,this.privAudioStream=null,this.privTurnManager=e,this.resetTurnEndTimeout()}return Object.defineProperty(e.prototype,"audioStream",{get:function(){return this.resetTurnEndTimeout(),this.privAudioStream},enumerable:!0,configurable:!0}),e.prototype.processActivityPayload=function(e){return e.messageDataStreamType===i.MessageDataStreamType.TextToSpeechAudio&&(this.privAudioStream=n.AudioOutputStream.createPullStream()),this.privAudioStream},e.prototype.endAudioStream=function(){null===this.privAudioStream||this.privAudioStream.isClosed||this.privAudioStream.close()},e.prototype.complete=function(){void 0!==this.privTimeoutToken&&clearTimeout(this.privTimeoutToken),this.endAudioStream()},e.prototype.resetTurnEndTimeout=function(){var e=this;void 0!==this.privTimeoutToken&&clearTimeout(this.privTimeoutToken),this.privTimeoutToken=setTimeout((function(){e.privTurnManager.CompleteTurn(e.privRequestId)}),2e3)},e}();t.DialogServiceTurnState=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.prototype.toJsonString=function(){return JSON.stringify(this.iPrivConfig)},e.prototype.get=function(){return this.iPrivConfig},e.prototype.set=function(e){this.iPrivConfig=e},e}();t.AgentConfig=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(238);t.ConversationManager=n.ConversationManager;var i=r(37);t.ConversationTranslatorConfig=i.ConversationTranslatorConfig;var o=r(239);t.ConversationTranslatorRecognizer=o.ConversationTranslatorRecognizer;var s=r(96);t.ConversationReceivedTranslationEventArgs=s.ConversationReceivedTranslationEventArgs,t.LockRoomEventArgs=s.LockRoomEventArgs,t.MuteAllEventArgs=s.MuteAllEventArgs,t.ParticipantAttributeEventArgs=s.ParticipantAttributeEventArgs,t.ParticipantEventArgs=s.ParticipantEventArgs,t.ParticipantsListEventArgs=s.ParticipantsListEventArgs;var a=r(55);t.ConversationTranslatorCommandTypes=a.ConversationTranslatorCommandTypes,t.ConversationTranslatorMessageTypes=a.ConversationTranslatorMessageTypes,t.InternalParticipants=a.InternalParticipants},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(6),i=r(0),o=r(37),s=function(){function e(){}return e.prototype.createOrJoin=function(e,t,r,s){try{n.Contracts.throwIfNullOrUndefined(e,"args");var a=e.getProperty(i.PropertyId.SpeechServiceConnection_RecoLanguage,o.ConversationTranslatorConfig.defaultLanguageCode),c=e.getProperty(i.PropertyId.ConversationTranslator_Name),p=e.getProperty(i.PropertyId.ConversationTranslator_Host,o.ConversationTranslatorConfig.host),u=e.getProperty(i.PropertyId.ConversationTranslator_CorrelationId),h=e.getProperty(i.PropertyId.SpeechServiceConnection_Key),v=e.getProperty(i.PropertyId.SpeechServiceConnection_Region),l=e.getProperty(i.PropertyId.SpeechServiceAuthorization_Token);n.Contracts.throwIfNullOrWhitespace(a,"languageCode"),n.Contracts.throwIfNullOrWhitespace(c,"nickname"),n.Contracts.throwIfNullOrWhitespace(p,"endpointHost");var d={};d[o.ConversationTranslatorConfig.params.apiVersion]=o.ConversationTranslatorConfig.apiVersion,d[o.ConversationTranslatorConfig.params.languageCode]=a,d[o.ConversationTranslatorConfig.params.nickname]=c;var f={};u&&(f[o.ConversationTranslatorConfig.params.correlationId]=u),f[o.ConversationTranslatorConfig.params.clientAppId]=o.ConversationTranslatorConfig.clientAppId,void 0!==t?d[o.ConversationTranslatorConfig.params.roomId]=t:(n.Contracts.throwIfNullOrUndefined(v,o.ConversationTranslatorConfig.strings.authInvalidSubscriptionRegion),f[o.ConversationTranslatorConfig.params.subscriptionRegion]=v,h?f[o.ConversationTranslatorConfig.params.subscriptionKey]=h:l?f[o.ConversationTranslatorConfig.params.authorization]="Bearer "+l:n.Contracts.throwIfNullOrUndefined(h,o.ConversationTranslatorConfig.strings.authInvalidSubscriptionKey));var g={};g.headers=f;var y="https://"+p+o.ConversationTranslatorConfig.restPath;o.request("post",y,d,null,g,(function(e){var t=o.extractHeaderValue(o.ConversationTranslatorConfig.params.requestId,e.headers);if(e.ok){var n=JSON.parse(e.data);if(n&&(n.requestId=t),r){try{r(n)}catch(e){s&&s(e)}r=void 0}}else if(s){var i=o.ConversationTranslatorConfig.strings.invalidCreateJoinConversationResponse.replace("{status}",e.status.toString()),a=void 0;try{i+=" ["+(a=JSON.parse(e.data)).error.code+": "+a.error.message+"]"}catch(t){i+=" ["+e.data+"]"}t&&(i+=" "+t),s(i)}}))}catch(e){if(s)if(e instanceof Error){var m=e;s(m.name+": "+m.message)}else s(e)}},e.prototype.leave=function(e,t,r,s){try{n.Contracts.throwIfNullOrUndefined(e,o.ConversationTranslatorConfig.strings.invalidArgs.replace("{arg}","config")),n.Contracts.throwIfNullOrWhitespace(t,o.ConversationTranslatorConfig.strings.invalidArgs.replace("{arg}","token"));var a=e.getProperty(i.PropertyId.ConversationTranslator_Host,o.ConversationTranslatorConfig.host),c=e.getProperty(i.PropertyId.ConversationTranslator_CorrelationId),p={};p[o.ConversationTranslatorConfig.params.apiVersion]=o.ConversationTranslatorConfig.apiVersion,p[o.ConversationTranslatorConfig.params.sessionToken]=t;var u={};c&&(u[o.ConversationTranslatorConfig.params.correlationId]=c);var h={};h.headers=u;var v="https://"+a+o.ConversationTranslatorConfig.restPath;o.request("delete",v,p,null,h,(function(e){if(e.ok,r){try{r()}catch(e){s&&s(e)}r=void 0}}))}catch(e){if(s)if(e instanceof Error){var l=e;s(l.name+": "+l.message)}else s(e)}},e}();t.ConversationManager=s},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(2),s=r(6),a=r(0),c=r(240),p=r(242),u=r(55),h=r(37),v=function(e){function t(t,r){var n=this,i=t;return s.Contracts.throwIfNull(i,"speechConfig"),(n=e.call(this,r,i.properties,new c.ConversationConnectionFactory)||this).privIsDisposed=!1,n.privProperties=i.properties.clone(),n}return i(t,e),Object.defineProperty(t.prototype,"conversation",{set:function(e){this.privRoom=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"speechRecognitionLanguage",{get:function(){return this.privSpeechRecognitionLanguage},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"properties",{get:function(){return this.privProperties},enumerable:!0,configurable:!0}),t.prototype.isDisposed=function(){return this.privIsDisposed},t.prototype.connect=function(e,t,r){try{s.Contracts.throwIfDisposed(this.privIsDisposed),s.Contracts.throwIfNullOrWhitespace(e,"token"),this.privReco.conversationTranslatorToken=e,this.privReco.connectAsync(t,r)}catch(e){if(r)if(e instanceof Error){var n=e;r(n.name+": "+n.message)}else r(e)}},t.prototype.disconnect=function(e,t){try{s.Contracts.throwIfDisposed(this.privIsDisposed),this.privRoom=void 0,this.privReco.disconnectAsync(e,t)}catch(e){if(t)if(e instanceof Error){var r=e;t(r.name+": "+r.message)}else t(e);this.dispose(!0)}},t.prototype.sendMessageRequest=function(e,t,r){try{s.Contracts.throwIfDisposed(this.privIsDisposed),s.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),s.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),s.Contracts.throwIfNullOrWhitespace(e,"message");var n={participantId:this.privRoom.participantId,roomId:this.privRoom.roomId,text:e,type:u.ConversationTranslatorMessageTypes.instantMessage};this.sendMessage(JSON.stringify(n),t,r)}catch(e){if(r)if(e instanceof Error){var i=e;r(i.name+": "+i.message)}else r(e);this.dispose(!0)}},t.prototype.sendLockRequest=function(e,t,r){try{s.Contracts.throwIfDisposed(this.privIsDisposed),s.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),s.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),s.Contracts.throwIfNullOrUndefined(e,"isLocked");var n={command:u.ConversationTranslatorCommandTypes.setLockState,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:u.ConversationTranslatorMessageTypes.participantCommand,value:e};this.sendMessage(JSON.stringify(n),t,r)}catch(e){if(r)if(e instanceof Error){var i=e;r(i.name+": "+i.message)}else r(e);this.dispose(!0)}},t.prototype.sendMuteAllRequest=function(e,t,r){try{s.Contracts.throwIfDisposed(this.privIsDisposed),s.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),s.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),s.Contracts.throwIfNullOrUndefined(e,"isMuted");var n={command:u.ConversationTranslatorCommandTypes.setMuteAll,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:u.ConversationTranslatorMessageTypes.participantCommand,value:e};this.sendMessage(JSON.stringify(n),t,r)}catch(e){if(r)if(e instanceof Error){var i=e;r(i.name+": "+i.message)}else r(e);this.dispose(!0)}},t.prototype.sendMuteRequest=function(e,t,r,n){try{s.Contracts.throwIfDisposed(this.privIsDisposed),s.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),s.Contracts.throwIfNullOrWhitespace(e,"participantId"),s.Contracts.throwIfNullOrUndefined(t,"isMuted");var i={command:u.ConversationTranslatorCommandTypes.setMute,participantId:e,roomid:this.privRoom.roomId,type:u.ConversationTranslatorMessageTypes.participantCommand,value:t};this.sendMessage(JSON.stringify(i),r,n)}catch(e){if(n)if(e instanceof Error){var o=e;n(o.name+": "+o.message)}else n(e);this.dispose(!0)}},t.prototype.sendEjectRequest=function(e,t,r){try{s.Contracts.throwIfDisposed(this.privIsDisposed),s.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),s.Contracts.throwIfNullOrWhitespace(e,"participantId");var n={command:u.ConversationTranslatorCommandTypes.ejectParticipant,participantId:e,roomid:this.privRoom.roomId,type:u.ConversationTranslatorMessageTypes.participantCommand};if(this.sendMessage(JSON.stringify(n),t,r),t)try{t()}catch(e){r&&r(e)}}catch(e){if(r)if(e instanceof Error){var i=e;r(i.name+": "+i.message)}else r(e);this.dispose(!0)}},t.prototype.sendChangeNicknameRequest=function(e,t,r){try{s.Contracts.throwIfDisposed(this.privIsDisposed),s.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),s.Contracts.throwIfNullOrWhitespace(e,"nickname");var n={command:u.ConversationTranslatorCommandTypes.changeNickname,nickname:e,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:u.ConversationTranslatorMessageTypes.participantCommand,value:e};this.sendMessage(JSON.stringify(n),t,r)}catch(e){if(r)if(e instanceof Error){var i=e;r(i.name+": "+i.message)}else r(e);this.dispose(!0)}},t.prototype.close=function(){s.Contracts.throwIfDisposed(this.privIsDisposed),this.dispose(!0)},t.prototype.dispose=function(t){this.privIsDisposed||t&&(this.privIsDisposed=!0,e.prototype.dispose.call(this,t))},t.prototype.createRecognizerConfig=function(e){return new o.RecognizerConfig(e,this.privProperties)},t.prototype.createServiceRecognizer=function(e,t,r,n){var i=r;return new p.ConversationServiceAdapter(e,t,i,n,this)},t.prototype.sendMessage=function(e,t,r){var n=this.privReco;h.PromiseToEmptyCallback(n.sendMessageAsync(e),t,r)},t}(a.Recognizer);t.ConversationTranslatorRecognizer=v},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(16),s=r(3),a=r(6),c=r(0),p=r(31),u=r(37),h=r(241),v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.create=function(e,t,r){var n=e.parameters.getProperty(c.PropertyId.ConversationTranslator_Host,u.ConversationTranslatorConfig.host),i=e.parameters.getProperty(c.PropertyId.ConversationTranslator_CorrelationId,s.createGuid()),p="wss://"+n+u.ConversationTranslatorConfig.webSocketPath,v=e.parameters.getProperty(c.PropertyId.ConversationTranslator_Token,void 0);a.Contracts.throwIfNullOrUndefined(v,"token");var l={};return l[u.ConversationTranslatorConfig.params.apiVersion]=u.ConversationTranslatorConfig.apiVersion,l[u.ConversationTranslatorConfig.params.token]=v,l[u.ConversationTranslatorConfig.params.correlationId]=i,new o.WebsocketConnection(p,l,{},new h.ConversationWebsocketMessageFormatter,o.ProxyInfo.fromRecognizerConfig(e),r)},t}(p.ConnectionFactoryBase);t.ConversationConnectionFactory=v},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(3),i=r(95),o=function(){this.toConnectionMessage=function(e){var t=new n.Deferred;try{if(e.messageType===n.MessageType.Text){var r=new i.ConversationConnectionMessage(e.messageType,e.textContent,{},e.id);t.resolve(r)}else e.messageType===n.MessageType.Binary&&t.resolve(new i.ConversationConnectionMessage(e.messageType,e.binaryContent,void 0,e.id))}catch(e){t.reject("Error formatting the message. Error: "+e)}return t.promise()},this.fromConnectionMessage=function(e){var t=new n.Deferred;try{if(e.messageType===n.MessageType.Text){var r=""+(e.textBody?e.textBody:"");t.resolve(new n.RawWebsocketMessage(n.MessageType.Text,r,e.id))}}catch(e){t.reject("Error formatting the message. "+e)}return t.promise()}};t.ConversationWebsocketMessageFormatter=o},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(3),s=r(50),a=r(0),c=r(2),p=r(95),u=r(243),h=r(96),v=r(55),l=r(244),d=function(e){function t(t,r,n,i,c){var d=e.call(this,t,r,n,i,c)||this;return d.privUtteranceId="",d.sendMessageAsync=function(e){var t=new s.Sink;return d.fetchConversationConnection().continueWith((function(r){try{r.isError?t.reject(r.error):r.result.send(new p.ConversationConnectionMessage(o.MessageType.Text,e)).continueWith((function(e){try{e.isError?t.reject(e.error):t.resolve(e.result)}catch(e){t.reject("Unhandled inner error: "+e)}}))}catch(e){t.reject("Unhandled error: "+e)}})),new o.Promise(t)},d.noOp=function(){},d.receiveConversationMessageOverride=function(e,t){var r=new o.Deferred;return d.fetchConversationConnection().on((function(e){return e.read().onSuccessContinueWithPromise((function(e){var t=d.isDisposed(),n=!d.isDisposed()&&d.terminateMessageLoop,i=d.privConversationRequestSession.sessionId;if(t||n)return r.resolve(void 0),o.PromiseHelper.fromResult(void 0);if(!e)return d.receiveConversationMessageOverride();try{switch(e.conversationMessageType.toLowerCase()){case"info":case"participant_command":case"command":var s=l.CommandResponsePayload.fromJSON(e.textBody);switch(s.command.toLowerCase()){case"participantlist":var c=l.ParticipantsListPayloadResponse.fromJSON(e.textBody),p=c.participants.map((function(e){return{avatar:e.avatar,displayName:e.nickname,id:e.participantId,isHost:e.ishost,isMuted:e.ismuted,isUsingTts:e.usetts,preferredLanguage:e.locale}}));d.privConversationServiceConnector.participantsListReceived&&d.privConversationServiceConnector.participantsListReceived(d.privConversationServiceConnector,new h.ParticipantsListEventArgs(c.roomid,c.token,c.translateTo,c.profanityFilter,c.roomProfanityFilter,c.roomLocked,c.muteAll,p,i));break;case"settranslatetolanguages":d.privConversationServiceConnector.participantUpdateCommandReceived&&d.privConversationServiceConnector.participantUpdateCommandReceived(d.privConversationServiceConnector,new h.ParticipantAttributeEventArgs(s.participantId,v.ConversationTranslatorCommandTypes.setTranslateToLanguages,s.value,i));break;case"setprofanityfiltering":d.privConversationServiceConnector.participantUpdateCommandReceived&&d.privConversationServiceConnector.participantUpdateCommandReceived(d.privConversationServiceConnector,new h.ParticipantAttributeEventArgs(s.participantId,v.ConversationTranslatorCommandTypes.setProfanityFiltering,s.value,i));break;case"setmute":d.privConversationServiceConnector.participantUpdateCommandReceived&&d.privConversationServiceConnector.participantUpdateCommandReceived(d.privConversationServiceConnector,new h.ParticipantAttributeEventArgs(s.participantId,v.ConversationTranslatorCommandTypes.setMute,s.value,i));break;case"setmuteall":d.privConversationServiceConnector.muteAllCommandReceived&&d.privConversationServiceConnector.muteAllCommandReceived(d.privConversationServiceConnector,new h.MuteAllEventArgs(s.value,i));break;case"roomexpirationwarning":d.privConversationServiceConnector.conversationExpiration&&d.privConversationServiceConnector.conversationExpiration(d.privConversationServiceConnector,new a.ConversationExpirationEventArgs(s.value,d.privConversationRequestSession.sessionId));break;case"setusetts":d.privConversationServiceConnector.participantUpdateCommandReceived&&d.privConversationServiceConnector.participantUpdateCommandReceived(d.privConversationServiceConnector,new h.ParticipantAttributeEventArgs(s.participantId,v.ConversationTranslatorCommandTypes.setUseTTS,s.value,i));break;case"setlockstate":d.privConversationServiceConnector.lockRoomCommandReceived&&d.privConversationServiceConnector.lockRoomCommandReceived(d.privConversationServiceConnector,new h.LockRoomEventArgs(s.value,i));break;case"changenickname":d.privConversationServiceConnector.participantUpdateCommandReceived&&d.privConversationServiceConnector.participantUpdateCommandReceived(d.privConversationServiceConnector,new h.ParticipantAttributeEventArgs(s.participantId,v.ConversationTranslatorCommandTypes.changeNickname,s.nickname,i));break;case"joinsession":var u=l.ParticipantPayloadResponse.fromJSON(e.textBody),f={avatar:u.avatar,displayName:u.nickname,id:u.participantId,isHost:u.ishost,isMuted:u.ismuted,isUsingTts:u.usetts,preferredLanguage:u.locale};d.privConversationServiceConnector.participantJoinCommandReceived&&d.privConversationServiceConnector.participantJoinCommandReceived(d.privConversationServiceConnector,new h.ParticipantEventArgs(f,i));break;case"leavesession":var g={id:s.participantId};d.privConversationServiceConnector.participantLeaveCommandReceived&&d.privConversationServiceConnector.participantLeaveCommandReceived(d.privConversationServiceConnector,new h.ParticipantEventArgs(g,i));break;case"disconnectsession":s.participantId}break;case"partial":case"final":var y=l.SpeechResponsePayload.fromJSON(e.textBody),m=new a.ConversationTranslationResult(y.participantId,d.getTranslations(y.translations),y.language,void 0,void 0,y.recognition,void 0,void 0,e.textBody,void 0);y.isFinal?void 0!==m.text&&m.text.length>0&&y.id!==d.privUtteranceId&&d.privConversationServiceConnector.translationReceived&&d.privConversationServiceConnector.translationReceived(d.privConversationServiceConnector,new h.ConversationReceivedTranslationEventArgs(v.ConversationTranslatorMessageTypes.final,m,i)):d.privConversationServiceConnector.translationReceived&&d.privConversationServiceConnector.translationReceived(d.privConversationServiceConnector,new h.ConversationReceivedTranslationEventArgs(v.ConversationTranslatorMessageTypes.partial,m,i)),d.privUtteranceId=y.id;break;case"translated_message":var S=l.TextResponsePayload.fromJSON(e.textBody),C=new a.ConversationTranslationResult(S.participantId,d.getTranslations(S.translations),S.language,void 0,void 0,S.originalText,void 0,void 0,void 0,e.textBody,void 0);d.privConversationServiceConnector.translationReceived&&d.privConversationServiceConnector.translationReceived(d.privConversationServiceConnector,new h.ConversationReceivedTranslationEventArgs(v.ConversationTranslatorMessageTypes.instantMessage,C,i))}}catch(e){}return d.receiveConversationMessageOverride()}))}),(function(e){d.terminateMessageLoop=!0})),r.promise()},d.fetchConversationConnection=function(){return d.configConnection()},d.privConversationServiceConnector=c,d.privConversationAuthentication=t,d.receiveMessageOverride=d.receiveConversationMessageOverride,d.recognizeOverride=d.noOp,d.connectImplOverride=d.conversationConnectImpl,d.configConnectionOverride=d.configConnection,d.fetchConnectionOverride=d.fetchConversationConnection,d.disconnectOverride=d.privDisconnect,d.privConversationRequestSession=new u.ConversationRequestSession(o.createNoDashGuid()),d.privConversationConnectionFactory=r,d.privConversationIsDisposed=!1,d}return i(t,e),t.prototype.isDisposed=function(){return this.privConversationIsDisposed},t.prototype.dispose=function(e){this.privConversationIsDisposed=!0,this.privConnectionConfigPromise&&this.privConnectionConfigPromise.onSuccessContinueWith((function(t){t.dispose(e)}))},t.prototype.sendMessage=function(e){this.fetchConversationConnection().onSuccessContinueWith((function(t){t.send(new p.ConversationConnectionMessage(o.MessageType.Text,e))}))},t.prototype.privDisconnect=function(){this.terminateMessageLoop||(this.cancelRecognition(this.privConversationRequestSession.sessionId,this.privConversationRequestSession.requestId,a.CancellationReason.Error,a.CancellationErrorCode.NoError,"Disconnecting"),this.terminateMessageLoop=!0,this.privConversationConnectionPromise.result().isCompleted?this.privConversationConnectionPromise.result().isError||(this.privConversationConnectionPromise.result().result.dispose(),this.privConversationConnectionPromise=null):this.privConversationConnectionPromise.onSuccessContinueWith((function(e){e.dispose()})))},t.prototype.processTypeSpecificMessages=function(e,t,r){return!0},t.prototype.cancelRecognition=function(e,t,r,n,i){this.terminateMessageLoop=!0;var o=new a.ConversationTranslationCanceledEventArgs(r,i,n,void 0,e);try{this.privConversationServiceConnector.canceled&&this.privConversationServiceConnector.canceled(this.privConversationServiceConnector,o)}catch(e){}},t.prototype.conversationConnectImpl=function(e){var t=this;if(void 0===e&&(e=!1),this.privConversationConnectionPromise)return this.privConversationConnectionPromise.result().isCompleted&&(this.privConversationConnectionPromise.result().isError||this.privConversationConnectionPromise.result().result.state()===o.ConnectionState.Disconnected)?(this.privConnectionId=null,this.privConversationConnectionPromise=null,this.terminateMessageLoop=!0,this.conversationConnectImpl()):this.privConversationConnectionPromise;this.privConversationAuthFetchEventId=o.createNoDashGuid(),void 0===this.privConnectionId&&(this.privConnectionId=o.createNoDashGuid()),this.privConversationRequestSession.onPreConnectionStart(this.privConversationAuthFetchEventId,this.privConnectionId);var r=e?this.privConversationAuthentication.fetchOnExpiry(this.privConversationAuthFetchEventId):this.privConversationAuthentication.fetch(this.privConversationAuthFetchEventId);return this.privConversationConnectionPromise=r.continueWithPromise((function(r){if(r.isError)throw t.privConversationRequestSession.onAuthCompleted(!0,r.error),new Error(r.error);t.privConversationRequestSession.onAuthCompleted(!1);var n=t.privConversationConnectionFactory.create(t.privRecognizerConfig,r.result,t.privConnectionId);return n.events.attach((function(e){t.connectionEvents.onEvent(e)})),n.open().onSuccessContinueWithPromise((function(r){if(200===r.statusCode){t.privConversationRequestSession.onPreConnectionStart(t.privConversationAuthFetchEventId,t.privConnectionId),t.privConversationRequestSession.onConnectionEstablishCompleted(r.statusCode);var i=new a.SessionEventArgs(t.privConversationRequestSession.sessionId);return t.privConversationServiceConnector.connectionOpened&&t.privConversationServiceConnector.connectionOpened(t.privConversationServiceConnector,i),o.PromiseHelper.fromResult(n)}return 403!==r.statusCode||e?(t.privConversationRequestSession.onConnectionEstablishCompleted(r.statusCode,r.reason),o.PromiseHelper.fromError("Unable to contact server. StatusCode: "+r.statusCode+", "+t.privRecognizerConfig.parameters.getProperty(a.PropertyId.SpeechServiceConnection_Endpoint)+" Reason: "+r.reason)):t.conversationConnectImpl(!0)}))})),this.privConnectionLoop=this.startMessageLoop(),this.privConversationConnectionPromise},t.prototype.startMessageLoop=function(){var e=this;return this.terminateMessageLoop=!1,this.receiveConversationMessageOverride().on((function(e){return!0}),(function(t){e.cancelRecognition(e.privRequestSession?e.privRequestSession.sessionId:"",e.privRequestSession?e.privRequestSession.requestId:"",a.CancellationReason.Error,a.CancellationErrorCode.RuntimeError,t)}))},t.prototype.configConnection=function(){return this.privConnectionConfigPromise?this.privConnectionConfigPromise.result().isCompleted&&(this.privConnectionConfigPromise.result().isError||this.privConnectionConfigPromise.result().result.state()===o.ConnectionState.Disconnected)?(this.privConnectionConfigPromise=null,this.configConnection()):this.privConnectionConfigPromise:this.terminateMessageLoop?o.PromiseHelper.fromResult(void 0):(this.privConnectionConfigPromise=this.conversationConnectImpl().onSuccessContinueWith((function(e){return e})),this.privConnectionConfigPromise)},t.prototype.getTranslations=function(e){var t;if(void 0!==e){t=new a.Translations;for(var r=0,n=e;r<n.length;r++){var i=n[r];t.set(i.lang,i.translation)}}return t},t}(c.ServiceRecognizerBase);t.ConversationServiceAdapter=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(3),i=function(){function e(e){var t=this;this.privIsDisposed=!1,this.privDetachables=new Array,this.onPreConnectionStart=function(e,r){t.privSessionId=r},this.onAuthCompleted=function(e,r){e&&t.onComplete()},this.onConnectionEstablishCompleted=function(e,r){200!==e&&403===e&&t.onComplete()},this.onServiceTurnEndResponse=function(e){e?t.privRequestId=n.createNoDashGuid():t.onComplete()},this.dispose=function(e){if(!t.privIsDisposed){t.privIsDisposed=!0;for(var r=0,n=t.privDetachables;r<n.length;r++){n[r].detach()}}},this.onComplete=function(){},this.privSessionId=e,this.privRequestId=n.createNoDashGuid(),this.privRequestCompletionDeferral=new n.Deferred}return Object.defineProperty(e.prototype,"sessionId",{get:function(){return this.privSessionId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"requestId",{get:function(){return this.privRequestId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"completionPromise",{get:function(){return this.privRequestCompletionDeferral.promise()},enumerable:!0,configurable:!0}),e}();t.ConversationRequestSession=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(245);t.CommandResponsePayload=n.CommandResponsePayload;var i=r(246);t.ParticipantsListPayloadResponse=i.ParticipantsListPayloadResponse,t.ParticipantPayloadResponse=i.ParticipantPayloadResponse;var o=r(247);t.SpeechResponsePayload=o.SpeechResponsePayload,t.TextResponsePayload=o.TextResponsePayload},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.privCommandResponse=JSON.parse(e)}return e.fromJSON=function(t){return new e(t)},Object.defineProperty(e.prototype,"type",{get:function(){return this.privCommandResponse.type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"command",{get:function(){return this.privCommandResponse.command},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.privCommandResponse.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nickname",{get:function(){return this.privCommandResponse.nickname},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"participantId",{get:function(){return this.privCommandResponse.participantId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"roomid",{get:function(){return this.privCommandResponse.roomid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this.privCommandResponse.value},enumerable:!0,configurable:!0}),e}();t.CommandResponsePayload=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.privParticipantsPayloadResponse=JSON.parse(e)}return e.fromJSON=function(t){return new e(t)},Object.defineProperty(e.prototype,"roomid",{get:function(){return this.privParticipantsPayloadResponse.roomid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.privParticipantsPayloadResponse.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"command",{get:function(){return this.privParticipantsPayloadResponse.command},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"participants",{get:function(){return this.privParticipantsPayloadResponse.participants},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"token",{get:function(){return this.privParticipantsPayloadResponse.token},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"translateTo",{get:function(){return this.privParticipantsPayloadResponse.translateTo},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"profanityFilter",{get:function(){return this.privParticipantsPayloadResponse.profanityFilter},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"roomProfanityFilter",{get:function(){return this.privParticipantsPayloadResponse.roomProfanityFilter},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"roomLocked",{get:function(){return this.privParticipantsPayloadResponse.roomLocked},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"muteAll",{get:function(){return this.privParticipantsPayloadResponse.muteAll},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this.privParticipantsPayloadResponse.type},enumerable:!0,configurable:!0}),e}();t.ParticipantsListPayloadResponse=n;var i=function(){function e(e){this.privParticipantPayloadResponse=JSON.parse(e)}return e.fromJSON=function(t){return new e(t)},Object.defineProperty(e.prototype,"nickname",{get:function(){return this.privParticipantPayloadResponse.nickname},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"locale",{get:function(){return this.privParticipantPayloadResponse.locale},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"usetts",{get:function(){return this.privParticipantPayloadResponse.usetts},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ismuted",{get:function(){return this.privParticipantPayloadResponse.ismuted},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ishost",{get:function(){return this.privParticipantPayloadResponse.ishost},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"participantId",{get:function(){return this.privParticipantPayloadResponse.participantId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"avatar",{get:function(){return this.privParticipantPayloadResponse.avatar},enumerable:!0,configurable:!0}),e}();t.ParticipantPayloadResponse=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.privSpeechResponse=JSON.parse(e)}return e.fromJSON=function(t){return new e(t)},Object.defineProperty(e.prototype,"recognition",{get:function(){return this.privSpeechResponse.recognition},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"translations",{get:function(){return this.privSpeechResponse.translations},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.privSpeechResponse.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"language",{get:function(){return this.privSpeechResponse.language},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nickname",{get:function(){return this.privSpeechResponse.nickname},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"participantId",{get:function(){return this.privSpeechResponse.participantId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"roomid",{get:function(){return this.privSpeechResponse.roomid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timestamp",{get:function(){return this.privSpeechResponse.timestamp},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this.privSpeechResponse.type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isFinal",{get:function(){return"final"===this.privSpeechResponse.type},enumerable:!0,configurable:!0}),e}();t.SpeechResponsePayload=n;var i=function(){function e(e){this.privTextResponse=JSON.parse(e)}return e.fromJSON=function(t){return new e(t)},Object.defineProperty(e.prototype,"originalText",{get:function(){return this.privTextResponse.originalText},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"translations",{get:function(){return this.privTextResponse.translations},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.privTextResponse.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"language",{get:function(){return this.privTextResponse.language},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nickname",{get:function(){return this.privTextResponse.nickname},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"participantId",{get:function(){return this.privTextResponse.participantId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"roomid",{get:function(){return this.privTextResponse.roomid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timestamp",{get:function(){return this.privTextResponse.timestamp},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this.privTextResponse.type},enumerable:!0,configurable:!0}),e}();t.TextResponsePayload=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(30),i=r(2),o=r(3),s=function(){function e(e,t){var r=this;this.privStreams={},this.turnOn=function(){if("undefined"==typeof FileReader){var e="Browser does not support FileReader.";return r.onEvent(new o.AudioSourceErrorEvent(e,"")),o.PromiseHelper.fromError(e)}if(r.privFile.name.lastIndexOf(".wav")!==r.privFile.name.length-4){e=r.privFile.name+" is not supported. Only WAVE files are allowed at the moment.";return r.onEvent(new o.AudioSourceErrorEvent(e,"")),o.PromiseHelper.fromError(e)}return r.onEvent(new o.AudioSourceInitializingEvent(r.privId)),r.onEvent(new o.AudioSourceReadyEvent(r.privId)),o.PromiseHelper.fromResult(!0)},this.id=function(){return r.privId},this.attach=function(e){return r.onEvent(new o.AudioStreamNodeAttachingEvent(r.privId,e)),r.upload(e).onSuccessContinueWith((function(t){return r.onEvent(new o.AudioStreamNodeAttachedEvent(r.privId,e)),{detach:function(){t.close(),delete r.privStreams[e],r.onEvent(new o.AudioStreamNodeDetachedEvent(r.privId,e)),r.turnOff()},id:function(){return e},read:function(){return t.read()}}}))},this.detach=function(e){e&&r.privStreams[e]&&(r.privStreams[e].close(),delete r.privStreams[e],r.onEvent(new o.AudioStreamNodeDetachedEvent(r.privId,e)))},this.turnOff=function(){for(var e in r.privStreams)if(e){var t=r.privStreams[e];t&&!t.isClosed&&t.close()}return r.onEvent(new o.AudioSourceOffEvent(r.privId)),o.PromiseHelper.fromResult(!0)},this.readHeader=function(){var e=r.privFile.slice(0,44),t=new FileReader,i=new o.Deferred;return t.onload=function(e){var t=e.target.result,r=new DataView(t);"RIFF"!==String.fromCharCode(r.getUint8(0),r.getUint8(1),r.getUint8(2),r.getUint8(3))&&i.reject("Invalid WAV header in file, RIFF was not found"),"WAVEfmt"!==String.fromCharCode(r.getUint8(8),r.getUint8(9),r.getUint8(10),r.getUint8(11),r.getUint8(12),r.getUint8(13),r.getUint8(14))&&i.reject("Invalid WAV header in file, WAVEfmt was not found");var o=r.getUint16(22,!0),s=r.getUint32(24,!0),a=r.getUint16(34,!0);i.resolve(n.AudioStreamFormat.getWaveFormatPCM(s,a,o))},t.readAsArrayBuffer(e),i.promise()},this.upload=function(e){return r.turnOn().onSuccessContinueWithPromise((function(t){return r.privAudioFormatPromise.onSuccessContinueWith((function(t){new o.ChunkedArrayBufferStream(3200);var n=new FileReader,i=new o.ChunkedArrayBufferStream(t.avgBytesPerSec/10,e);r.privStreams[e]=i;n.onload=function(e){i.isClosed||(i.writeStreamChunk({buffer:n.result,isEnd:!1,timeReceived:Date.now()}),i.close())},n.onerror=function(t){var n="Error occurred while processing '"+r.privFile.name+"'. "+t;throw r.onEvent(new o.AudioStreamNodeErrorEvent(r.privId,e,n)),new Error(n)};var s=r.privFile.slice(44);return n.readAsArrayBuffer(s),i.getReader()}))}))},this.onEvent=function(e){r.privEvents.onEvent(e),o.Events.instance.onEvent(e)},this.privId=t||o.createNoDashGuid(),this.privEvents=new o.EventSource,this.privFile=e,this.privAudioFormatPromise=this.readHeader()}return Object.defineProperty(e.prototype,"format",{get:function(){return this.privAudioFormatPromise},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"events",{get:function(){return this.privEvents},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"deviceInfo",{get:function(){return this.privAudioFormatPromise.onSuccessContinueWithPromise((function(e){return o.PromiseHelper.fromResult({bitspersample:e.bitsPerSample,channelcount:e.channels,connectivity:i.connectivity.Unknown,manufacturer:"Speech SDK",model:"File",samplerate:e.samplesPerSec,type:i.type.File})}))},enumerable:!0,configurable:!0}),e}();t.FileAudioSource=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(3),i=function(){function e(){var e=this;this.record=function(t,r,i){var o=function(){var e=0;try{return t.createScriptProcessor(e,1,1)}catch(n){e=2048;for(var r=t.sampleRate;e<16384&&r>=32e3;)e<<=1,r>>=1;return t.createScriptProcessor(e,1,1)}}(),s=new n.RiffPcmEncoder(t.sampleRate,16e3);o.onaudioprocess=function(e){var t=e.inputBuffer.getChannelData(0);if(i&&!i.isClosed){var r=s.encode(t);r&&(i.writeStreamChunk({buffer:r,isEnd:!1,timeReceived:Date.now()}),!1)}};var a=t.createMediaStreamSource(r);e.privSpeechProcessorScript&&t.audioWorklet?t.audioWorklet.addModule(e.privSpeechProcessorScript).then((function(){var n=new AudioWorkletNode(t,"speech-processor");n.port.onmessage=function(e){var t=e.data;if(i&&!i.isClosed){var r=s.encode(t);r&&(i.writeStreamChunk({buffer:r,isEnd:!1,timeReceived:Date.now()}),!1)}},a.connect(n),n.connect(t.destination),e.privMediaResources={scriptProcessorNode:n,source:a,stream:r}})).catch((function(){a.connect(o),o.connect(t.destination),e.privMediaResources={scriptProcessorNode:o,source:a,stream:r}})):(a.connect(o),o.connect(t.destination),e.privMediaResources={scriptProcessorNode:o,source:a,stream:r})},this.releaseMediaResources=function(t){e.privMediaResources&&(e.privMediaResources.scriptProcessorNode&&(e.privMediaResources.scriptProcessorNode.disconnect(t.destination),e.privMediaResources.scriptProcessorNode=null),e.privMediaResources.source&&(e.privMediaResources.source.disconnect(),e.privMediaResources.stream.getTracks().forEach((function(e){return e.stop()})),e.privMediaResources.source=null))}}return e.prototype.setWorkletUrl=function(e){this.privSpeechProcessorScript=e},e}();t.PcmRecorder=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(3),i=r(97),o=function(){function e(e,t,r,o,s,a){var c=this;if(this.privIsDisposed=!1,this.dispose=function(){c.privIsDisposed=!0,c.privConnectionMessageAdapter&&c.privConnectionMessageAdapter.close()},this.isDisposed=function(){return c.privIsDisposed},this.state=function(){return c.privConnectionMessageAdapter.state},this.open=function(){return c.privConnectionMessageAdapter.open()},this.send=function(e){return c.privConnectionMessageAdapter.send(e)},this.read=function(){return c.privConnectionMessageAdapter.read()},!e)throw new n.ArgumentNullError("uri");if(!o)throw new n.ArgumentNullError("messageFormatter");this.privMessageFormatter=o;var p="",u=0;if(t)for(var h in t){if(h)p+=0===u&&-1===e.indexOf("?")?"?":"&",p+=h+"="+encodeURIComponent(t[h]),u++}if(r)for(var v in r){if(v)p+=0===u?"?":"&",p+=v+"="+encodeURIComponent(r[v]),u++}this.privUri=e+p,this.privId=a||n.createNoDashGuid(),this.privConnectionMessageAdapter=new i.WebsocketMessageAdapter(this.privUri,this.id,this.privMessageFormatter,s,r)}return Object.defineProperty(e.prototype,"id",{get:function(){return this.privId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"events",{get:function(){return this.privConnectionMessageAdapter.events},enumerable:!0,configurable:!0}),e}();t.WebsocketConnection=o},function(e,t,r){"use strict";t.byteLength=function(e){var t=p(e),r=t[0],n=t[1];return 3*(r+n)/4-n},t.toByteArray=function(e){var t,r,n=p(e),s=n[0],a=n[1],c=new o(function(e,t,r){return 3*(t+r)/4-r}(0,s,a)),u=0,h=a>0?s-4:s;for(r=0;r<h;r+=4)t=i[e.charCodeAt(r)]<<18|i[e.charCodeAt(r+1)]<<12|i[e.charCodeAt(r+2)]<<6|i[e.charCodeAt(r+3)],c[u++]=t>>16&255,c[u++]=t>>8&255,c[u++]=255&t;2===a&&(t=i[e.charCodeAt(r)]<<2|i[e.charCodeAt(r+1)]>>4,c[u++]=255&t);1===a&&(t=i[e.charCodeAt(r)]<<10|i[e.charCodeAt(r+1)]<<4|i[e.charCodeAt(r+2)]>>2,c[u++]=t>>8&255,c[u++]=255&t);return c},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,o=[],s=0,a=r-i;s<a;s+=16383)o.push(u(e,s,s+16383>a?a:s+16383));1===i?(t=e[r-1],o.push(n[t>>2]+n[t<<4&63]+"==")):2===i&&(t=(e[r-2]<<8)+e[r-1],o.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return o.join("")};for(var n=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,c=s.length;a<c;++a)n[a]=s[a],i[s.charCodeAt(a)]=a;function p(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function u(e,t,r){for(var i,o,s=[],a=t;a<r;a+=3)i=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(n[(o=i)>>18&63]+n[o>>12&63]+n[o>>6&63]+n[63&o]);return s.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,r,n,i){var o,s,a=8*i-n-1,c=(1<<a)-1,p=c>>1,u=-7,h=r?i-1:0,v=r?-1:1,l=e[t+h];for(h+=v,o=l&(1<<-u)-1,l>>=-u,u+=a;u>0;o=256*o+e[t+h],h+=v,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=n;u>0;s=256*s+e[t+h],h+=v,u-=8);if(0===o)o=1-p;else{if(o===c)return s?NaN:1/0*(l?-1:1);s+=Math.pow(2,n),o-=p}return(l?-1:1)*s*Math.pow(2,o-n)},t.write=function(e,t,r,n,i,o){var s,a,c,p=8*o-i-1,u=(1<<p)-1,h=u>>1,v=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,l=n?0:o-1,d=n?1:-1,f=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),(t+=s+h>=1?v/c:v*Math.pow(2,1-h))*c>=2&&(s++,c/=2),s+h>=u?(a=0,s=u):s+h>=1?(a=(t*c-1)*Math.pow(2,i),s+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,i),s=0));i>=8;e[r+l]=255&a,l+=d,a/=256,i-=8);for(s=s<<i|a,p+=i;p>0;e[r+l]=255&s,l+=d,s/=256,p-=8);e[r+l-d]|=128*f}},function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},function(e,t){},function(e,t){},function(e,t){},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(3),i=function(){function e(e,t){var r=this;this.privBuffers=[],this.privReplayOffset=0,this.privLastShrinkOffset=0,this.privBufferStartOffset=0,this.privBufferSerial=0,this.privBufferedBytes=0,this.privReplay=!1,this.privLastChunkAcquiredTime=0,this.id=function(){return r.privAudioNode.id()},this.privAudioNode=e,this.privBytesPerSecond=t}return e.prototype.read=function(){var e=this;if(this.privReplay&&0!==this.privBuffers.length){var t=this.privReplayOffset-this.privBufferStartOffset,r=Math.round(t*this.privBytesPerSecond*1e-7);0!=r%2&&r++;for(var i=0;i<this.privBuffers.length&&r>=this.privBuffers[i].chunk.buffer.byteLength;)r-=this.privBuffers[i++].chunk.buffer.byteLength;var s=this.privBuffers[i].chunk.buffer.slice(r);return this.privReplayOffset+=s.byteLength/this.privBytesPerSecond*1e7,i===this.privBuffers.length-1&&(this.privReplay=!1),n.PromiseHelper.fromResult({buffer:s,isEnd:!1,timeReceived:this.privBuffers[i].chunk.timeReceived})}return this.privAudioNode.read().onSuccessContinueWith((function(t){return t&&t.buffer&&(e.privBuffers.push(new o(t,e.privBufferSerial++,e.privBufferedBytes)),e.privBufferedBytes+=t.buffer.byteLength),t}))},e.prototype.detach=function(){this.privAudioNode.detach(),this.privBuffers=void 0},e.prototype.replay=function(){this.privBuffers&&0!==this.privBuffers.length&&(this.privReplay=!0,this.privReplayOffset=this.privLastShrinkOffset)},e.prototype.shrinkBuffers=function(e){if(void 0!==this.privBuffers){this.privLastShrinkOffset=e;for(var t=e-this.privBufferStartOffset,r=Math.round(t*this.privBytesPerSecond*1e-7),n=0;n<this.privBuffers.length&&r>=this.privBuffers[n].chunk.buffer.byteLength;)r-=this.privBuffers[n++].chunk.buffer.byteLength;this.privBufferStartOffset=Math.round(e-r/this.privBytesPerSecond*1e7),this.privBuffers=this.privBuffers.slice(n)}},e.prototype.findTimeAtOffset=function(e){if(e<this.privBufferStartOffset||void 0===this.privBuffers)return 0;for(var t=0,r=this.privBuffers;t<r.length;t++){var n=r[t],i=n.byteOffset/this.privBytesPerSecond*1e7,o=i+n.chunk.buffer.byteLength/this.privBytesPerSecond*1e7;if(e>=i&&e<=o)return n.chunk.timeReceived}return 0},e}();t.ReplayableAudioNode=i;var o=function(e,t,r){this.chunk=e,this.serial=t,this.byteOffset=r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=function(){function e(e,t,r,n){this.privProxyHostName=e,this.privProxyPort=t,this.privProxyUserName=r,this.privProxyPassword=n}return e.fromRecognizerConfig=function(t){return new e(t.parameters.getProperty(n.PropertyId.SpeechServiceConnection_ProxyHostName),parseInt(t.parameters.getProperty(n.PropertyId.SpeechServiceConnection_ProxyPort),10),t.parameters.getProperty(n.PropertyId.SpeechServiceConnection_ProxyUserName),t.parameters.getProperty(n.PropertyId.SpeechServiceConnection_ProxyPassword))},Object.defineProperty(e.prototype,"HostName",{get:function(){return this.privProxyHostName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Port",{get:function(){return this.privProxyPort},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"UserName",{get:function(){return this.privProxyUserName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Password",{get:function(){return this.privProxyPassword},enumerable:!0,configurable:!0}),e}();t.ProxyInfo=i},function(e,t,r){"use strict";var n=r(100),i=r(8);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.audioContext,r=e.enableTelemetry,n=e.ponyfill,i=void 0===n?{AudioContext:window.AudioContext||window.webkitAudioContext}:n,b=e.recognizer,P=e.textNormalization;if(!i.AudioContext)return console.warn("botframework-directlinespeech-sdk: This browser does not support Web Audio API. Speech support is disabled."),function(){return{}};return function(){var e=(0,v.createSpeechRecognitionPonyfillFromRecognizer)({createRecognizer:function(){return b},enableTelemetry:r,looseEvents:!0,textNormalization:P}),n=e.SpeechGrammarList,R=e.SpeechRecognition;t||(t=new i.AudioContext);var I=(0,g.default)(),w=I.cancelAll,E=I.push,T=function(e){(0,p.default)(v,e);var r,n,i=(r=v,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,h.default)(r);if(n){var i=(0,h.default)(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return(0,u.default)(this,e)});function v(){return(0,a.default)(this,v),i.apply(this,arguments)}return(0,c.default)(v,[{key:"cancel",value:function(){w()}},{key:"getVoices",value:function(){return[]}},{key:"speak",value:function(e){E((function(){var r=new l.default,n=r.signal;return{abort:r.abort.bind(r),result:(0,s.default)(o.default.mark((function r(){var i,s,a;return o.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e.dispatchEvent((0,d.default)("start")),r.prev=1,!e.audioStream){r.next=8;break}return i=e.audioStream,s=i.format,a=i.streamReader,r.next=6,(0,m.default)(t,s,a,{signal:n});case 6:r.next=10;break;case 8:return r.next=10,(0,S.default)(t);case 10:r.next=16;break;case 12:if(r.prev=12,r.t0=r.catch(1),"aborted"===r.t0.message){r.next=16;break}return r.abrupt("return",e.dispatchEvent((0,f.default)(r.t0)));case 16:e.dispatchEvent((0,d.default)("end"));case 17:case"end":return r.stop()}}),r,null,[[1,12]])})))()}})).result.catch((function(e){if(!/^cancelled/i.test(e.message))throw e}))}}]),v}(y.default);return(0,y.defineEventAttribute)(T,"voiceschanged"),{SpeechGrammarList:n,SpeechRecognition:R,speechSynthesis:new T,SpeechSynthesisUtterance:C.default}}};var o=i(r(22)),s=i(r(23)),a=i(r(56)),c=i(r(102)),p=i(r(103)),u=i(r(104)),h=i(r(105)),v=r(262),l=i(r(284)),d=i(r(113)),f=i(r(289)),g=i(r(290)),y=n(r(58)),m=i(r(291)),S=i(r(294)),C=i(r(116))},function(e,t){function r(t,n){return e.exports=r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},r(t,n)}e.exports=r},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t,r){"use strict";var n=r(263);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"createSpeechRecognitionPonyfillFromRecognizer",{enumerable:!0,get:function(){return i.createSpeechRecognitionPonyfillFromRecognizer}}),t.default=void 0;var i=n(r(264)),o=i.default;t.default=o},function(e,t,r){var n=r(106);function i(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return i=function(){return e},e}e.exports=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==n(e)&&"function"!=typeof e)return{default:e};var t=i();if(t&&t.has(e))return t.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){var a=o?Object.getOwnPropertyDescriptor(e,s):null;a&&(a.get||a.set)?Object.defineProperty(r,s,a):r[s]=e[s]}return r.default=e,t&&t.set(e,r),r}},function(e,t,r){"use strict";var n=r(27);Object.defineProperty(t,"__esModule",{value:!0}),t.createSpeechRecognitionPonyfillFromRecognizer=x,t.default=void 0;var i=n(r(107)),o=n(r(265)),s=n(r(109)),a=n(r(110)),c=n(r(270)),p=n(r(272)),u=n(r(274)),h=n(r(57)),v=n(r(111)),l=r(58),d=n(r(275)),f=n(r(278)),g=n(r(279)),y=n(r(283)),m=n(r(112));function S(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var i=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,p.default)(this,r)}}function C(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function b(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?C(Object(r),!0).forEach((function(t){(0,h.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):C(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var P=m.default.AudioConfig,R=m.default.OutputFormat,I=m.default.ResultReason,w=m.default.SpeechConfig,E=m.default.SpeechRecognizer;function T(e){var t=e.duration,r=e.errorDetails,n=e.json,i=e.offset,o=e.properties,s=e.reason,a=e.resultId,c=e.text;return{duration:t,errorDetails:r,json:JSON.parse(n),offset:i,properties:o,reason:s,resultId:a,text:c}}function O(e,t){return function(){return e.apply(void 0,arguments).onSuccessContinueWith((function(e){return t(e)}))}}function A(e){return function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return new Promise((function(t,n){return e.apply(void 0,r.concat([t,n]))}))}}var _=function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.data,i=r.emma,o=r.interpretation,s=r.resultIndex,a=r.results;(0,v.default)(this,e),this.data=n,this.emma=i,this.interpretation=o,this.resultIndex=s,this.results=a,this.type=t};function D(e){var t,r,n=e.attach;return e.attach=O(n.bind(e),(function(n){return b(b({},n),{},{read:O(n.read.bind(n),(function(n){var i,o;return!t&&(i=n.buffer,o=new Int16Array(i),[].reduce.call(o,(function(e,t){return e+Math.abs(t)}),0)/o.length>150)&&(e.events.onEvent({name:"FirstAudibleChunk"}),t=!0),r?{buffer:new ArrayBuffer(0),isEnd:!0,timeReceived:Date.now()}:n}))})})),{audioConfig:e,pause:function(){r=!0},unprepare:function(){e.attach=n}}}function x(e){var t=e.createRecognizer,r=e.enableTelemetry,n=e.looseEvents,p=e.referenceGrammars,u=e.textNormalization;E.enableTelemetry(!1!==r);var h=function(e){(0,c.default)(l,e);var r,h=S(l);function l(){var e;return(0,v.default)(this,l),(e=h.call(this))._continuous=!1,e._interimResults=!1,e._lang="undefined"!=typeof window?window.document.documentElement.getAttribute("lang")||window.navigator.language:"en-US",e._grammars=new y.default,e._maxAlternatives=1,e}return(0,a.default)(l,[{key:"emitCognitiveServices",value:function(e,t){this.dispatchEvent(new _("cognitiveservices",{data:b(b({},t),{},{type:e})}))}},{key:"start",value:function(){var e=this;this._startOnce().catch((function(t){e.dispatchEvent(new ErrorEvent("error",{error:t,message:t&&(t.stack||t.message)}))}))}},{key:"_startOnce",value:(r=(0,s.default)(i.default.mark((function e(){var r,s,a,c,h,v,l,g,y,m,S,C,b,P,R,w,E,O=this;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t(this.lang);case 2:return r=e.sent,s=D(r.audioConfig),a=s.pause,c=s.unprepare,e.prev=4,h=(0,f.default)(),y=r.audioConfig.events.attach((function(e){var t=e.name;"AudioSourceReadyEvent"===t?h.push({audioSourceReady:{}}):"AudioSourceOffEvent"===t?h.push({audioSourceOff:{}}):"FirstAudibleChunk"===t&&h.push({firstAudibleChunk:{}})})),m=y.detach,r.canceled=function(e,t){var r=t.errorDetails,n=t.offset,i=t.reason,o=t.sessionId;h.push({canceled:{errorDetails:r,offset:n,reason:i,sessionId:o}})},r.recognized=function(e,t){var r=t.offset,n=t.result,i=t.sessionId;h.push({recognized:{offset:r,result:T(n),sessionId:i}})},r.recognizing=function(e,t){var r=t.offset,n=t.result,i=t.sessionId;h.push({recognizing:{offset:r,result:T(n),sessionId:i}})},r.sessionStarted=function(e,t){var r=t.sessionId;h.push({sessionStarted:{sessionId:r}})},r.sessionStopped=function(e,t){var r=t.sessionId;h.push({sessionStopped:{sessionId:r}})},r.speechStartDetected=function(e,t){var r=t.offset,n=t.sessionId;h.push({speechStartDetected:{offset:r,sessionId:n}})},r.speechEndDetected=function(e,t){var r=t.sessionId;h.push({speechEndDetected:{sessionId:r}})},S=this.grammars.phrases,C=r.privReco.dynamicGrammar,p&&p.length&&C.addReferenceGrammar(p),S&&S.length&&C.addPhrase(S),e.next=20,A(r.startContinuousRecognitionAsync.bind(r))();case 20:r.stopContinuousRecognitionAsync?(this.abort=function(){return h.push({abort:{}})},this.stop=function(){return h.push({stop:{}})}):this.abort=this.stop=void 0,R=[],w=i.default.mark((function e(t){var s,c,p,f,y,m,S,C,w,E,T,D;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.shift();case 2:if(s=e.sent,c=s.abort,p=s.audioSourceOff,f=s.audioSourceReady,y=s.canceled,m=s.firstAudibleChunk,S=s.recognized,C=s.recognizing,w=s.stop,Object.keys(s).forEach((function(e){return O.emitCognitiveServices(e,s[e])})),E=y&&y.errorDetails,!/Permission[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]denied/.test(E||"")){e.next=9;break}return P={error:"not-allowed",type:"error"},e.abrupt("return","break");case 9:if(t||O.dispatchEvent(new _("start")),!E){e.next=15;break}return/1006/.test(E)?(b||(O.dispatchEvent(new _("audiostart")),O.dispatchEvent(new _("audioend"))),P={error:"network",type:"error"}):P={error:"unknown",type:"error"},e.abrupt("return","break");case 15:if(!c&&!w){e.next=22;break}if(c?(P={error:"aborted",type:"error"},g="abort"):(a(),g="stop"),!c||!r.stopContinuousRecognitionAsync){e.next=20;break}return e.next=20,A(r.stopContinuousRecognitionAsync.bind(r))();case 20:e.next=61;break;case 22:if(!f){e.next=27;break}O.dispatchEvent(new _("audiostart")),b=!0,e.next=61;break;case 27:if(!m){e.next=32;break}O.dispatchEvent(new _("soundstart")),v=!0,e.next=61;break;case 32:if(!p){e.next=40;break}return l&&O.dispatchEvent(new _("speechend")),v&&O.dispatchEvent(new _("soundend")),b&&O.dispatchEvent(new _("audioend")),b=v=l=!1,e.abrupt("return","break");case 40:if("abort"===g){e.next=61;break}if(!S||!S.result||S.result.reason!==I.NoMatch){e.next=45;break}P={error:"no-speech",type:"error"},e.next=61;break;case 45:if(!S&&!C){e.next=61;break}if(b||(O.dispatchEvent(new _("audiostart")),b=!0),v||(O.dispatchEvent(new _("soundstart")),v=!0),l||(O.dispatchEvent(new _("speechstart")),l=!0),!S){e.next=60;break}if(T=(0,d.default)(S.result,{maxAlternatives:O.maxAlternatives,textNormalization:u}),(D=!!T[0].transcript)&&(R=[].concat((0,o.default)(R),[T]),O.continuous&&O.dispatchEvent(new _("result",{results:R}))),P=O.continuous&&D?null:{results:R,type:"result"},O.continuous||!r.stopContinuousRecognitionAsync){e.next=57;break}return e.next=57,A(r.stopContinuousRecognitionAsync.bind(r))();case 57:n&&P&&D&&(O.dispatchEvent(new _(P.type,P)),P=null),e.next=61;break;case 60:C&&O.interimResults&&O.dispatchEvent(new _("result",{results:[].concat((0,o.default)(R),[(0,d.default)(C.result,{maxAlternatives:O.maxAlternatives,textNormalization:u})])}));case 61:case"end":return e.stop()}}),e)})),E=0;case 24:if(g&&!b){e.next=32;break}return e.delegateYield(w(E),"t0",26);case 26:if("break"!==e.t0){e.next=29;break}return e.abrupt("break",32);case 29:E++,e.next=24;break;case 32:l&&this.dispatchEvent(new _("speechend")),v&&this.dispatchEvent(new _("soundend")),b&&this.dispatchEvent(new _("audioend")),P&&("result"!==P.type||P.results.length||(P={error:"no-speech",type:"error"}),"error"===P.type?this.dispatchEvent(new ErrorEvent("error",P)):this.dispatchEvent(new _(P.type,P))),this.dispatchEvent(new _("end")),m(),e.next=44;break;case 40:throw e.prev=40,e.t1=e.catch(4),console.error(e.t1),e.t1;case 44:return e.prev=44,c(),r.dispose(),e.finish(44);case 48:case"end":return e.stop()}}),e,this,[[4,40,44,48]])}))),function(){return r.apply(this,arguments)})},{key:"continuous",get:function(){return this._continuous},set:function(e){this._continuous=e}},{key:"grammars",get:function(){return this._grammars},set:function(e){if(!(e instanceof y.default))throw new Error("The provided value is not of type 'SpeechGrammarList'");this._grammars=e}},{key:"interimResults",get:function(){return this._interimResults},set:function(e){this._interimResults=e}},{key:"maxAlternatives",get:function(){return this._maxAlternatives},set:function(e){this._maxAlternatives=e}},{key:"lang",get:function(){return this._lang},set:function(e){this._lang=e}}]),l}(l.EventTarget);return(0,l.defineEventAttribute)(h.prototype,"audioend"),(0,l.defineEventAttribute)(h.prototype,"audiostart"),(0,l.defineEventAttribute)(h.prototype,"cognitiveservices"),(0,l.defineEventAttribute)(h.prototype,"end"),(0,l.defineEventAttribute)(h.prototype,"error"),(0,l.defineEventAttribute)(h.prototype,"nomatch"),(0,l.defineEventAttribute)(h.prototype,"result"),(0,l.defineEventAttribute)(h.prototype,"soundend"),(0,l.defineEventAttribute)(h.prototype,"soundstart"),(0,l.defineEventAttribute)(h.prototype,"speechend"),(0,l.defineEventAttribute)(h.prototype,"speechstart"),(0,l.defineEventAttribute)(h.prototype,"start"),{SpeechGrammarList:y.default,SpeechRecognition:h,SpeechRecognitionEvent:_}}t.default=function(e){var t=(0,g.default)(e),r=t.audioConfig,n=void 0===r?P.fromDefaultMicrophoneInput():r,o=t.enableTelemetry,a=void 0===o||o,c=t.fetchCredentials,p=t.looseEvents,u=t.referenceGrammars,h=t.speechRecognitionEndpointId,v=t.textNormalization,l=void 0===v?"display":v;return n||window.navigator.mediaDevices&&window.navigator.mediaDevices.getUserMedia?x({audioConfig:n,createRecognizer:function(){var e=(0,s.default)(i.default.mark((function e(t){var r,o,s,a,p,u,v;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c();case 2:return r=e.sent,o=r.authorizationToken,s=r.region,a=r.speechRecognitionHostname,p=r.subscriptionKey,a?(v={hostname:a,port:443,protocol:"wss:"},o?(u=w.fromHost(v)).authorizationToken=o:u=w.fromHost(v,p)):u=o?w.fromAuthorizationToken(o,s):w.fromSubscription(p,s),h&&(u.endpointId=h),u.outputFormat=R.Detailed,u.speechRecognitionLanguage=t||"en-US",e.abrupt("return",new E(u,n));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),enableTelemetry:a,looseEvents:p,referenceGrammars:u,textNormalization:l}):(console.warn("web-speech-cognitive-services: This browser does not support WebRTC and it will not work with Cognitive Services Speech Services."),{})}},function(e,t,r){var n=r(266),i=r(267),o=r(268),s=r(269);e.exports=function(e){return n(e)||i(e)||o(e)||s()}},function(e,t,r){var n=r(108);e.exports=function(e){if(Array.isArray(e))return n(e)}},function(e,t){e.exports=function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}},function(e,t,r){var n=r(108);e.exports=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(e,t,r){var n=r(271);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}},function(e,t){function r(t,n){return e.exports=r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},r(t,n)}e.exports=r},function(e,t,r){var n=r(106),i=r(273);e.exports=function(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?i(e):t}},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t){function r(t){return e.exports=r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},r(t)}e.exports=r},function(e,t,r){"use strict";var n=r(27);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.maxAlternatives,n=void 0===r?1/0:r,o=t.textNormalization,c=void 0===o?"display":o;if(e.reason===s||e.reason===a&&!e.json.NBest){var p=[{confidence:.5,transcript:e.text}];return e.reason===a&&(p.isFinal=!0),p}if(e.reason===a){var u=(0,i.default)((e.json.NBest||[]).slice(0,n).map((function(e){var t=e.Confidence,r=e.Display,n=e.ITN,i=e.Lexical,o=e.MaskedITN;return{confidence:t,transcript:"itn"===c?n:"lexical"===c?i:"maskeditn"===c?o:r}})),{isFinal:!0});return u}return[]};var i=n(r(276)),o=n(r(112)).default.ResultReason,s=o.RecognizingSpeech,a=o.RecognizedSpeech},function(e,t,r){"use strict";var n=r(27);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var r=s(s(s({},[].reduce.call(e,(function(e,t,r){return e[r]=t,e}),{})),t),{},(0,i.default)({length:e.length},Symbol.iterator,(function(){return[].slice.call(r)[Symbol.iterator]()})));return r};var i=n(r(57));function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(16);r(3).Events.instance.attachListener(new n.ConsoleLoggingListener),function(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}(r(0))},function(e,t,r){"use strict";var n=r(27);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e,t=[];return{push:function(r){if(e){var n=e.resolve;e=null,n(r)}else t.push(r)},shift:function(){return t.length?Promise.resolve(t.shift()):(e||(e=(0,i.default)())).promise}}};var i=n(r(59))},function(e,t,r){"use strict";var n=r(27);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.authorizationToken,r=e.credentials,n=e.looseEvent,i=e.looseEvents,p=e.region,v=void 0===p?"westus":p,l=e.subscriptionKey,d=(0,a.default)(e,["authorizationToken","credentials","looseEvent","looseEvents","region","subscriptionKey"]);void 0!==n&&(console.warn('web-speech-cognitive-services: The option "looseEvent" should be named as "looseEvents".'),i=n);if(!r){if(!t&&!l)throw new Error("web-speech-cognitive-services: Credentials must be specified.");console.warn("web-speech-cognitive-services: We are deprecating authorizationToken, region, and subscriptionKey. Please use credentials instead. The deprecated option will be removed on or after 2020-11-14."),r=function(){var e=(0,s.default)(o.default.mark((function e(){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=8;break}return e.next=3,(0,c.default)(t);case 3:e.t1=e.sent,e.t2=v,e.t0={authorizationToken:e.t1,region:e.t2},e.next=13;break;case 8:return e.t3=v,e.next=11,(0,c.default)(l);case 11:e.t4=e.sent,e.t0={region:e.t3,subscriptionKey:e.t4};case 13:return e.abrupt("return",e.t0);case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}return u(u({},d),{},{fetchCredentials:(f=(0,s.default)(o.default.mark((function e(){var t,n,i,s,a,p,u,v;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,c.default)(r);case 2:if(t=e.sent,n=t.authorizationToken,i=t.customVoiceHostname,s=t.region,a=t.speechRecognitionHostname,p=t.speechSynthesisHostname,u=t.subscriptionKey,!(!n&&!u||n&&u)){e.next=13;break}throw new Error('web-speech-cognitive-services: Either "authorizationToken" or "subscriptionKey" must be provided.');case 13:if(s||a&&p){e.next=17;break}throw new Error('web-speech-cognitive-services: Either "region" or "speechRecognitionHostname" and "speechSynthesisHostname" must be set.');case 17:if(!s||!(i||a||p)){e.next=21;break}throw new Error('web-speech-cognitive-services: Only either "region" or "customVoiceHostname", "speechRecognitionHostname" and "speechSynthesisHostname" can be set.');case 21:if(!n){e.next=26;break}if("string"==typeof n){e.next=24;break}throw new Error('web-speech-cognitive-services: "authorizationToken" must be a string.');case 24:e.next=28;break;case 26:if("string"==typeof u){e.next=28;break}throw new Error('web-speech-cognitive-services: "subscriptionKey" must be a string.');case 28:return h&&u&&(console.warn("web-speech-cognitive-services: In production environment, subscription key should not be used, authorization token should be used instead."),h=!1),v=n?{authorizationToken:n}:{subscriptionKey:u},s?v.region=s:(v.customVoiceHostname=i,v.speechRecognitionHostname=a,v.speechSynthesisHostname=p),e.abrupt("return",v);case 32:case"end":return e.stop()}}),e)}))),function(){return f.apply(this,arguments)}),looseEvents:i});var f};var i=n(r(57)),o=n(r(107)),s=n(r(109)),a=n(r(280)),c=n(r(282));function p(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?p(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var h=!0},function(e,t,r){var n=r(281);e.exports=function(e,t){if(null==e)return{};var r,i,o=n(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)r=s[i],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}},function(e,t){e.exports=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return"function"==typeof e?e():e}},function(e,t,r){"use strict";var n=r(27);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(111)),o=n(r(110)),s=function(){function e(){(0,i.default)(this,e),this._phrases=[]}return(0,o.default)(e,[{key:"addFromString",value:function(){throw new Error("JSGF is not supported")}},{key:"phrases",get:function(){return this._phrases},set:function(e){if(Array.isArray(e))this._phrases=e;else{if("string"!=typeof e)throw new Error("The provided value is not an array or of type 'string'");this._phrases=[e]}}}]),e}();t.default=s},function(e,t){e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}r.r(t),r.d(t,"AbortController",(function(){return M})),r.d(t,"AbortSignal",(function(){return N}));var i=new WeakMap,o=new WeakMap;function s(e){var t=i.get(e);return console.assert(null!=t,"'this' is expected an Event object, but got",e),t}function a(e){null==e.passiveListener?e.event.cancelable&&(e.canceled=!0,"function"==typeof e.event.preventDefault&&e.event.preventDefault()):"undefined"!=typeof console&&"function"==typeof console.error&&console.error("Unable to preventDefault inside passive event listener invocation.",e.passiveListener)}function c(e,t){i.set(this,{eventTarget:e,event:t,eventPhase:2,currentTarget:e,canceled:!1,stopped:!1,immediateStopped:!1,passiveListener:null,timeStamp:t.timeStamp||Date.now()}),Object.defineProperty(this,"isTrusted",{value:!1,enumerable:!0});for(var r=Object.keys(t),n=0;n<r.length;++n){var o=r[n];o in this||Object.defineProperty(this,o,p(o))}}function p(e){return{get:function(){return s(this).event[e]},set:function(t){s(this).event[e]=t},configurable:!0,enumerable:!0}}function u(e){return{value:function(){var t=s(this).event;return t[e].apply(t,arguments)},configurable:!0,enumerable:!0}}function h(e){if(null==e||e===Object.prototype)return c;var t=o.get(e);return null==t&&(t=function(e,t){var r=Object.keys(t);if(0===r.length)return e;function n(t,r){e.call(this,t,r)}n.prototype=Object.create(e.prototype,{constructor:{value:n,configurable:!0,writable:!0}});for(var i=0;i<r.length;++i){var o=r[i];if(!(o in e.prototype)){var s="function"==typeof Object.getOwnPropertyDescriptor(t,o).value;Object.defineProperty(n.prototype,o,s?u(o):p(o))}}return n}(h(Object.getPrototypeOf(e)),e),o.set(e,t)),t}function v(e){return s(e).immediateStopped}function l(e,t){s(e).passiveListener=t}c.prototype={get type(){return s(this).event.type},get target(){return s(this).eventTarget},get currentTarget(){return s(this).currentTarget},composedPath:function(){var e=s(this).currentTarget;return null==e?[]:[e]},get NONE(){return 0},get CAPTURING_PHASE(){return 1},get AT_TARGET(){return 2},get BUBBLING_PHASE(){return 3},get eventPhase(){return s(this).eventPhase},stopPropagation:function(){var e=s(this);e.stopped=!0,"function"==typeof e.event.stopPropagation&&e.event.stopPropagation()},stopImmediatePropagation:function(){var e=s(this);e.stopped=!0,e.immediateStopped=!0,"function"==typeof e.event.stopImmediatePropagation&&e.event.stopImmediatePropagation()},get bubbles(){return Boolean(s(this).event.bubbles)},get cancelable(){return Boolean(s(this).event.cancelable)},preventDefault:function(){a(s(this))},get defaultPrevented(){return s(this).canceled},get composed(){return Boolean(s(this).event.composed)},get timeStamp(){return s(this).timeStamp},get srcElement(){return s(this).eventTarget},get cancelBubble(){return s(this).stopped},set cancelBubble(e){if(e){var t=s(this);t.stopped=!0,"boolean"==typeof t.event.cancelBubble&&(t.event.cancelBubble=!0)}},get returnValue(){return!s(this).canceled},set returnValue(e){e||a(s(this))},initEvent:function(){}},Object.defineProperty(c.prototype,"constructor",{value:c,configurable:!0,writable:!0}),"undefined"!=typeof window&&void 0!==window.Event&&(Object.setPrototypeOf(c.prototype,window.Event.prototype),o.set(window.Event.prototype,c));var d=new WeakMap;function f(e){return null!==e&&"object"===n(e)}function g(e){var t=d.get(e);if(null==t)throw new TypeError("'this' is expected an EventTarget object, but got another value.");return t}function y(e,t){Object.defineProperty(e,"on".concat(t),function(e){return{get:function(){for(var t=g(this).get(e);null!=t;){if(3===t.listenerType)return t.listener;t=t.next}return null},set:function(t){"function"==typeof t||f(t)||(t=null);for(var r=g(this),n=null,i=r.get(e);null!=i;)3===i.listenerType?null!==n?n.next=i.next:null!==i.next?r.set(e,i.next):r.delete(e):n=i,i=i.next;if(null!==t){var o={listener:t,listenerType:3,passive:!1,once:!1,next:null};null===n?r.set(e,o):n.next=o}},configurable:!0,enumerable:!0}}(t))}function m(e){function t(){S.call(this)}t.prototype=Object.create(S.prototype,{constructor:{value:t,configurable:!0,writable:!0}});for(var r=0;r<e.length;++r)y(t.prototype,e[r]);return t}function S(){if(!(this instanceof S)){if(1===arguments.length&&Array.isArray(arguments[0]))return m(arguments[0]);if(arguments.length>0){for(var e=new Array(arguments.length),t=0;t<arguments.length;++t)e[t]=arguments[t];return m(e)}throw new TypeError("Cannot call a class as a function")}d.set(this,new Map)}S.prototype={addEventListener:function(e,t,r){if(null!=t){if("function"!=typeof t&&!f(t))throw new TypeError("'listener' should be a function or an object.");var n=g(this),i=f(r),o=(i?Boolean(r.capture):Boolean(r))?1:2,s={listener:t,listenerType:o,passive:i&&Boolean(r.passive),once:i&&Boolean(r.once),next:null},a=n.get(e);if(void 0!==a){for(var c=null;null!=a;){if(a.listener===t&&a.listenerType===o)return;c=a,a=a.next}c.next=s}else n.set(e,s)}},removeEventListener:function(e,t,r){if(null!=t)for(var n=g(this),i=(f(r)?Boolean(r.capture):Boolean(r))?1:2,o=null,s=n.get(e);null!=s;){if(s.listener===t&&s.listenerType===i)return void(null!==o?o.next=s.next:null!==s.next?n.set(e,s.next):n.delete(e));o=s,s=s.next}},dispatchEvent:function(e){if(null==e||"string"!=typeof e.type)throw new TypeError('"event.type" should be a string.');var t=g(this),r=e.type,n=t.get(r);if(null==n)return!0;for(var i=function(e,t){return new(h(Object.getPrototypeOf(t)))(e,t)}(this,e),o=null;null!=n;){if(n.once?null!==o?o.next=n.next:null!==n.next?t.set(r,n.next):t.delete(r):o=n,l(i,n.passive?n.listener:null),"function"==typeof n.listener)try{n.listener.call(this,i)}catch(e){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(e)}else 3!==n.listenerType&&"function"==typeof n.listener.handleEvent&&n.listener.handleEvent(i);if(v(i))break;n=n.next}return l(i,null),function(e,t){s(e).eventPhase=t}(i,0),function(e,t){s(e).currentTarget=t}(i,null),!i.defaultPrevented}},Object.defineProperty(S.prototype,"constructor",{value:S,configurable:!0,writable:!0}),"undefined"!=typeof window&&void 0!==window.EventTarget&&Object.setPrototypeOf(S.prototype,window.EventTarget.prototype);function C(e){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function P(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function R(e,t,r){return t&&P(e.prototype,t),r&&P(e,r),e}function I(e,t){return(I=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function w(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=T(e);if(t){var i=T(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return E(this,r)}}function E(e,t){return!t||"object"!==C(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function T(e){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var O=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&I(e,t)}(r,e);var t=w(r);function r(){throw b(this,r),t.call(this),new TypeError("AbortSignal cannot be constructed directly")}return R(r,[{key:"aborted",get:function(){var e=A.get(this);if("boolean"!=typeof e)throw new TypeError("Expected 'this' to be an 'AbortSignal' object, but got ".concat(null===this?"null":C(this)));return e}}]),r}(S);y(O.prototype,"abort");var A=new WeakMap;Object.defineProperties(O.prototype,{aborted:{enumerable:!0}}),"function"==typeof Symbol&&"symbol"===C(Symbol.toStringTag)&&Object.defineProperty(O.prototype,Symbol.toStringTag,{configurable:!0,value:"AbortSignal"});var _=function(){function e(){var t;b(this,e),D.set(this,(t=Object.create(O.prototype),S.call(t),A.set(t,!1),t))}return R(e,[{key:"abort",value:function(){var e;e=x(this),!1===A.get(e)&&(A.set(e,!0),e.dispatchEvent({type:"abort"}))}},{key:"signal",get:function(){return x(this)}}]),e}(),D=new WeakMap;function x(e){var t=D.get(e);if(null==t)throw new TypeError("Expected 'this' to be an 'AbortController' object, but got ".concat(null===e?"null":C(e)));return t}Object.defineProperties(_.prototype,{signal:{enumerable:!0},abort:{enumerable:!0}}),"function"==typeof Symbol&&"symbol"===C(Symbol.toStringTag)&&Object.defineProperty(_.prototype,Symbol.toStringTag,{configurable:!0,value:"AbortController"});var k=_,M=("undefined"==typeof window?{}:window).AbortController||k,N=("undefined"==typeof window?{}:window).AbortSignal||O;t.default=M}])},function(e,t,r){var n=r(286),i=r(287),o=r(114),s=r(288);e.exports=function(e,t){return n(e)||i(e,t)||o(e,t)||s()}},function(e,t){e.exports=function(e){if(Array.isArray(e))return e}},function(e,t){e.exports=function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{n||null==a.return||a.return()}finally{if(i)throw o}}return r}}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(e,t,r){"use strict";var n=r(8);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(0,i.default)("error",{error:e})};var i=n(r(113))},function(e,t,r){"use strict";var n=r(8);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=[],t={cancelAll:function(){e.forEach((function(e){return(0,e.cancel)()}))},push:function(t){var r,n=(0,s.default)(),a=(0,s.default)(),c={promise:a.promise},p=c.cancel=function(){t=function(){return{result:Promise.reject(new Error("cancelled before start"))}},r&&r(),n.reject(new Error("cancelled in the midway"))},u=function(){var s=(0,o.default)(i.default.mark((function o(){var s,p,u;return i.default.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return s=t(),p=s.abort,u=s.result,r=p,i.prev=2,i.t0=a,i.next=6,Promise.race([u,n.promise]);case 6:i.t1=i.sent,i.t0.resolve.call(i.t0,i.t1),i.next=13;break;case 10:i.prev=10,i.t2=i.catch(2),a.reject(i.t2);case 13:e=e.filter((function(e){return e!==c}));case 14:case"end":return i.stop()}}),o,null,[[2,10]])})));return function(){return s.apply(this,arguments)}}(),h=e[e.length-1],v=h&&h.promise||Promise.resolve();return e.push(c),v.then(u,u),{cancel:p,result:a.promise}}};return Object.defineProperty(t,"length",{get:function(){return e.length}}),t};var i=n(r(22)),o=n(r(23)),s=n(r(59))},function(e,t,r){"use strict";var n=r(8);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){return g.apply(this,arguments)};var i=n(r(22)),o=n(r(60)),s=n(r(23)),a=n(r(292)),c=n(r(293));function p(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?p(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function h(e,t){for(var r=new Float32Array(e.length),n=0;n<e.length;n++)r[n]=e[n]/t;return r}function v(e,t){switch(e.bitsPerSample){case 8:return h(new Int8Array(t),128);case 16:return h(new Int16Array(t),32768);case 32:return h(new Int32Array(t),2147483648);default:throw new Error("Only WAVE_FORMAT_PCM (8/16/32 bps) format supported at this time")}}function l(e){return new Promise((function(t,r){e.onabort=function(){return r(new Error("aborted"))}}))}function d(e,t){for(var r=t.channels,n=new Array(r),i=e.length/r,o=0;o<r;o++){var s=new Float32Array(i);n[o]=s;for(var a=0;a<i;a++)s[a]=e[a*r+o]}return n}function f(e,t){if(1===t)return e;for(var r,n=new Array(t).fill(e[0]),i=new Float32Array(e.length*t),o=0;o<e.length;o++)for(var s=e[o],a=o*t,c=0;c<t;c++)n.shift(),n.push(s),i[a+c]=(r=n).reduce((function(e,t){return e+t}),0)/r.length;return i}function g(){return(g=(0,s.default)(i.default.mark((function e(t,r,n){var o,s,p,h,g=arguments;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=g.length>3&&void 0!==g[3]?g[3]:{},s=o.signal,p=void 0===s?{}:s,h=[],e.prev=2,e.delegateYield(i.default.mark((function e(){var o,s,h,g,y,m,S,C,b,P;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=l(p),s=function(){return Promise.race([o.catch((function(){return{isEnd:!0}})),(0,a.default)(n.read())])},!p.aborted){e.next=4;break}throw new Error("aborted");case 4:for(h=r.samplesPerSec,g=1;h<44100&&h<96e3;)g++,h=r.samplesPerSec*g;return y=(0,c.default)(t,u(u({},r),{},{samplesPerSec:h}),4096/(r.bitsPerSample/8)*g),e.next=10,s();case 10:m=e.sent,S=0;case 12:if(m.isEnd||!(S<1e3)||p.aborted){e.next=25;break}if(!p.aborted){e.next=15;break}return e.abrupt("break",25);case 15:C=v(r,m.buffer),b=d(C,r),P=b.map((function(e){return f(e,g)})),y.push(P);case 19:return e.next=21,s();case 21:m=e.sent,S++,e.next=12;break;case 25:if(o.catch((function(){return y.cancelAll()})),!p.aborted){e.next=28;break}throw new Error("aborted");case 28:return e.next=30,Promise.race([o,y.flush()]);case 30:case"end":return e.stop()}}),e)}))(),"t0",4);case 4:return e.prev=4,h.forEach((function(e){return e.stop()})),e.finish(4);case 7:case"end":return e.stop()}}),e,null,[[2,,4,7]])})))).apply(this,arguments)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return new Promise((function(t,r){return e.on(t,r)}))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){var n,i=t.channels,o=t.samplesPerSec,s=new Array(3).fill().map((function(){return e.createBuffer(i,r,o)})),a=[],c=[];return{cancelAll:function(){c.splice(0),a.forEach((function(e){return e.stop()}))},flush:function(){return new Promise((function(e){return c.push(e)}))},push:function(t){if(!t)throw new Error("multiChannelArray must not be falsy.");c.push(t),function t(){"number"!=typeof n&&(n=e.currentTime);var r=e.createBufferSource(),i=c.shift();if("function"==typeof i)i();else if(i){var o=s.shift();if(!o)return void c.unshift(i);!function(e){for(var t=e.numberOfChannels,r=0;r<t;r++){var n=e.getChannelData(r);[].fill.call(n,0)}}(o),function(e,t){for(var r=e.numberOfChannels,n=0;n<r;n++){var i=t[n];if(e.copyToChannel)e.copyToChannel(i,n);else for(var o=i.length,s=e.getChannelData(n),a=0;a<o;a++)s[a]=i[a]}}(o,i),r.buffer=o,r.connect(e.destination),r.start(n),a.push(r),n+=o.duration,r.addEventListener("ended",(function(){a=a.filter((function(e){return e!==r})),s.push(o),t()}))}}()}}}},function(e,t,r){"use strict";var n=r(8);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return h.apply(this,arguments)};var i=n(r(22)),o=n(r(23)),s=r(295),a=n(r(296)),c="SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU3LjU2LjEwMQAAAAAAAAAAAAAA//tAwAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAACAAABhgC7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7//////////////////////////////////////////////////////////////////8AAAAATGF2YzU3LjY0AAAAAAAAAAAAAAAAJAUHAAAAAAAAAYYoRBqpAAAAAAD/+xDEAAPAAAGkAAAAIAAANIAAAARMQU1FMy45OS41VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7EMQpg8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV";function p(e,t){return new Promise((function(r,n){var i=e.decodeAudioData(t,r,n);i&&"function"==typeof i.then&&r(i)}))}function u(e,t,r){return new Promise((function(n,i){var o,s,c,p=new a.default,u=new a.default,h=(s="statechange",c=function(e){return"closed"===e.target.state&&p.eventListener()},(o=e).addEventListener(s,c),function(){return o.removeEventListener(s,c)});try{r.buffer=t,r.onended=u.eventListener,r.connect(e.destination),r.start(0),Promise.race([p.upcoming(),u.upcoming()]).then(n)}catch(e){i(e)}finally{h()}}))}function h(){return(h=(0,o.default)(i.default.mark((function e(t){var r,n;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.createBufferSource(),e.next=3,p(t,(0,s.decode)(c));case 3:return n=e.sent,e.next=6,u(t,n,r);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},function(e,t){!function(){"use strict";for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=new Uint8Array(256),n=0;n<e.length;n++)r[e.charCodeAt(n)]=n;t.encode=function(t){var r,n=new Uint8Array(t),i=n.length,o="";for(r=0;r<i;r+=3)o+=e[n[r]>>2],o+=e[(3&n[r])<<4|n[r+1]>>4],o+=e[(15&n[r+1])<<2|n[r+2]>>6],o+=e[63&n[r+2]];return i%3==2?o=o.substring(0,o.length-1)+"=":i%3==1&&(o=o.substring(0,o.length-2)+"=="),o},t.decode=function(e){var t,n,i,o,s,a=.75*e.length,c=e.length,p=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var u=new ArrayBuffer(a),h=new Uint8Array(u);for(t=0;t<c;t+=4)n=r[e.charCodeAt(t)],i=r[e.charCodeAt(t+1)],o=r[e.charCodeAt(t+2)],s=r[e.charCodeAt(t+3)],h[p++]=n<<2|i>>4,h[p++]=(15&i)<<4|o>>2,h[p++]=(3&o)<<6|63&s;return u}}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,i=(n=r(297))&&n.__esModule?n:{default:n};function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a=function(){function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o(this,e),this.defers=[],this.upcomingDeferred=null,this.eventListener=this.eventListener.bind(this),this.options=r,this.one=this.one.bind(this),this.upcoming=this.upcoming.bind(this),this[Symbol.iterator]=function(){return{next:function(){return{done:!1,value:t.upcoming()}}}}}var t,r,n;return t=e,(r=[{key:"eventListener",value:function(e){var t=this.defers.shift(),r=this.options.array?[].slice.call(arguments):e;t&&t.resolve(r),this.upcomingDeferred&&(this.upcomingDeferred.resolve(r),this.upcomingDeferred=null)}},{key:"one",value:function(){var e=(0,i.default)();return this.defers.push(e),e.promise}},{key:"upcoming",value:function(){return this.upcomingDeferred||(this.upcomingDeferred=(0,i.default)()),this.upcomingDeferred.promise}}])&&s(t.prototype,r),n&&s(t,n),e}();t.default=a,e.exports=t.default,e.exports.default=t.default},function(e,t,r){"use strict";e.exports=function(){var e={};return e.promise=new Promise((function(t,r){e.resolve=t,e.reject=r})),e}},function(e,t,r){"use strict";var n=r(8);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(60)),o=n(r(56)),s=n(r(102)),a=n(r(299)),c=n(r(329)),p=n(r(331)),u=n(r(116));function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var l=function(){function e(t){var r,n=this,i=t.dialogServiceConnector;(0,o.default)(this,e),this.dialogServiceConnector=i,this.activity$=(0,p.default)(new a.default((function(e){n._activityObserver=e,r.next(0),r.next(1),r.next(2)}))),this.connectionStatus$=(0,p.default)(new a.default((function(e){r=e}))),i.activityReceived=function(e,t){var r=t.activity,i=t.audioStream;try{n._activityObserver&&n._activityObserver.next(v(v({},r),{},{channelData:v(v({},r.channelData),{},{speechSynthesisUtterance:new u.default(i)}),from:v(v({},r.from),{},{role:"bot"}),timestamp:(new Date).toISOString()}))}catch(e){console.error(e)}}}return(0,s.default)(e,[{key:"end",value:function(){try{this.dialogServiceConnector.close()}catch(e){if(!~e.message.indexOf("already disposed"))throw e}}},{key:"postActivity",value:function(e){e=v(v({},e),{},{from:{role:"user"}});try{var t=(0,c.default)().toString(36).substr(2);return!(!e.channelData||!e.channelData.speech)||this.dialogServiceConnector.sendActivityAsync(e),this._activityObserver&&this._activityObserver.next(v(v({},e),{},{id:t,timestamp:(new Date).toISOString()})),a.default.of(t)}catch(e){return new a.default((function(t){return t.error(e)}))}}}]),e}();t.default=l},function(e,t,r){r(300),r(311),r(314),r(316),r(325);var n=r(35);e.exports=n.Observable},function(e,t,r){"use strict";var n=r(39),i=r(18),o=r(301),s=r(118),a=r(15),c=r(26),p=r(303),u=r(20).f,h=r(19),v=r(304),l=r(305),d=r(306),f=r(310),g=r(10),y=r(34),m=g("observable"),S=y.get,C=y.set,b=function(e){return null==e?void 0:s(e)},P=function(e){var t=e.cleanup;if(t){e.cleanup=void 0;try{t()}catch(e){f(e)}}},R=function(e){return void 0===e.observer},I=function(e,t){if(!i){e.closed=!0;var r=t.subscriptionObserver;r&&(r.closed=!0)}t.observer=void 0},w=function(e,t){var r,n=C(this,{cleanup:void 0,observer:a(e),subscriptionObserver:void 0});i||(this.closed=!1);try{(r=b(e.start))&&r.call(e,this)}catch(e){f(e)}if(!R(n)){var o=n.subscriptionObserver=new E(this);try{var c=t(o),p=c;null!=c&&(n.cleanup="function"==typeof c.unsubscribe?function(){p.unsubscribe()}:s(c))}catch(e){return void o.error(e)}R(n)&&P(n)}};w.prototype=v({},{unsubscribe:function(){var e=S(this);R(e)||(I(this,e),P(e))}}),i&&u(w.prototype,"closed",{configurable:!0,get:function(){return R(S(this))}});var E=function(e){C(this,{subscription:e}),i||(this.closed=!1)};E.prototype=v({},{next:function(e){var t=S(S(this).subscription);if(!R(t)){var r=t.observer;try{var n=b(r.next);n&&n.call(r,e)}catch(e){f(e)}}},error:function(e){var t=S(this).subscription,r=S(t);if(!R(r)){var n=r.observer;I(t,r);try{var i=b(n.error);i?i.call(n,e):f(e)}catch(e){f(e)}P(r)}},complete:function(){var e=S(this).subscription,t=S(e);if(!R(t)){var r=t.observer;I(e,t);try{var n=b(r.complete);n&&n.call(r)}catch(e){f(e)}P(t)}}}),i&&u(E.prototype,"closed",{configurable:!0,get:function(){return R(S(S(this).subscription))}});var T=function(e){p(this,T,"Observable"),C(this,{subscriber:s(e)})};v(T.prototype,{subscribe:function(e){var t=arguments.length;return new w("function"==typeof e?{next:e,error:t>1?arguments[1]:void 0,complete:t>2?arguments[2]:void 0}:c(e)?e:{},S(this).subscriber)}}),v(T,{from:function(e){var t="function"==typeof this?this:T,r=b(a(e)[m]);if(r){var n=a(r.call(e));return n.constructor===t?n:new t((function(e){return n.subscribe(e)}))}var i=l(e);return new t((function(e){d(i,(function(t){if(e.next(t),e.closed)return d.stop()}),void 0,!1,!0),e.complete()}))},of:function(){for(var e="function"==typeof this?this:T,t=arguments.length,r=new Array(t),n=0;n<t;)r[n]=arguments[n++];return new e((function(e){for(var n=0;n<t;n++)if(e.next(r[n]),e.closed)return;e.complete()}))}}),h(T.prototype,m,(function(){return this})),n({global:!0},{Observable:T}),o("Observable")},function(e,t,r){"use strict";var n=r(46),i=r(20),o=r(10),s=r(18),a=o("species");e.exports=function(e){var t=n(e),r=i.f;s&&t&&!t[a]&&r(t,a,{configurable:!0,get:function(){return this}})}},function(e,t,r){var n=r(117);e.exports=n&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(e,t){e.exports=function(e,t,r){if(!(e instanceof t))throw TypeError("Incorrect "+(r?r+" ":"")+"invocation");return e}},function(e,t,r){var n=r(33);e.exports=function(e,t,r){for(var i in t)n(e,i,t[i],r);return e}},function(e,t,r){var n=r(15),i=r(119);e.exports=function(e){var t=i(e);if("function"!=typeof t)throw TypeError(String(e)+" is not iterable");return n(t.call(e))}},function(e,t,r){var n=r(15),i=r(307),o=r(78),s=r(308),a=r(119),c=r(309),p=function(e,t){this.stopped=e,this.result=t};(e.exports=function(e,t,r,u,h){var v,l,d,f,g,y,m,S=s(t,r,u?2:1);if(h)v=e;else{if("function"!=typeof(l=a(e)))throw TypeError("Target is not iterable");if(i(l)){for(d=0,f=o(e.length);f>d;d++)if((g=u?S(n(m=e[d])[0],m[1]):S(e[d]))&&g instanceof p)return g;return new p(!1)}v=l.call(e)}for(y=v.next;!(m=y.call(v)).done;)if("object"==typeof(g=c(v,S,m.value,u))&&g&&g instanceof p)return g;return new p(!1)}).stop=function(e){return new p(!0,e)}},function(e,t,r){var n=r(10),i=r(32),o=n("iterator"),s=Array.prototype;e.exports=function(e){return void 0!==e&&(i.Array===e||s[o]===e)}},function(e,t,r){var n=r(118);e.exports=function(e,t,r){if(n(e),void 0===t)return e;switch(r){case 0:return function(){return e.call(t)};case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,i){return e.call(t,r,n,i)}}return function(){return e.apply(t,arguments)}}},function(e,t,r){var n=r(15);e.exports=function(e,t,r,i){try{return i?t(n(r)[0],r[1]):t(r)}catch(t){var o=e.return;throw void 0!==o&&n(o.call(e)),t}}},function(e,t,r){var n=r(9);e.exports=function(e,t){var r=n.console;r&&r.error&&(1===arguments.length?r.error(e):r.error(e,t))}},function(e,t,r){r(312)("observable")},function(e,t,r){var n=r(35),i=r(14),o=r(313),s=r(20).f;e.exports=function(e){var t=n.Symbol||(n.Symbol={});i(t,e)||s(t,e,{value:o.f(e)})}},function(e,t,r){var n=r(10);t.f=n},function(e,t,r){var n=r(61),i=r(33),o=r(315);n||i(Object.prototype,"toString",o,{unsafe:!0})},function(e,t,r){"use strict";var n=r(61),i=r(120);e.exports=n?{}.toString:function(){return"[object "+i(this)+"]"}},function(e,t,r){"use strict";var n=r(317).charAt,i=r(34),o=r(121),s=i.set,a=i.getterFor("String Iterator");o(String,"String",(function(e){s(this,{type:"String Iterator",string:String(e),index:0})}),(function(){var e,t=a(this),r=t.string,i=t.index;return i>=r.length?{value:void 0,done:!0}:(e=n(r,i),t.index+=e.length,{value:e,done:!1})}))},function(e,t,r){var n=r(47),i=r(41),o=function(e){return function(t,r){var o,s,a=String(i(t)),c=n(r),p=a.length;return c<0||c>=p?e?"":void 0:(o=a.charCodeAt(c))<55296||o>56319||c+1===p||(s=a.charCodeAt(c+1))<56320||s>57343?e?a.charAt(c):o:e?a.slice(c,c+2):s-56320+(o-55296<<10)+65536}};e.exports={codeAt:o(!1),charAt:o(!0)}},function(e,t,r){"use strict";var n=r(122).IteratorPrototype,i=r(124),o=r(40),s=r(125),a=r(32),c=function(){return this};e.exports=function(e,t,r){var p=t+" Iterator";return e.prototype=i(n,{next:o(1,r)}),s(e,p,!1,!0),a[p]=c,e}},function(e,t,r){var n=r(41);e.exports=function(e){return Object(n(e))}},function(e,t,r){var n=r(25);e.exports=!n((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},function(e,t,r){var n=r(18),i=r(20),o=r(15),s=r(79);e.exports=n?Object.defineProperties:function(e,t){o(e);for(var r,n=s(t),a=n.length,c=0;a>c;)i.f(e,r=n[c++],t[r]);return e}},function(e,t,r){var n=r(46);e.exports=n("document","documentElement")},function(e,t,r){var n=r(15),i=r(324);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(r,[]),t=r instanceof Array}catch(e){}return function(r,o){return n(r),i(o),t?e.call(r,o):r.__proto__=o,r}}():void 0)},function(e,t,r){var n=r(26);e.exports=function(e){if(!n(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype");return e}},function(e,t,r){var n=r(9),i=r(326),o=r(327),s=r(19),a=r(10),c=a("iterator"),p=a("toStringTag"),u=o.values;for(var h in i){var v=n[h],l=v&&v.prototype;if(l){if(l[c]!==u)try{s(l,c,u)}catch(e){l[c]=u}if(l[p]||s(l,p,h),i[h])for(var d in o)if(l[d]!==o[d])try{s(l,d,o[d])}catch(e){l[d]=o[d]}}}},function(e,t){e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},function(e,t,r){"use strict";var n=r(29),i=r(328),o=r(32),s=r(34),a=r(121),c=s.set,p=s.getterFor("Array Iterator");e.exports=a(Array,"Array",(function(e,t){c(this,{type:"Array Iterator",target:n(e),index:0,kind:t})}),(function(){var e=p(this),t=e.target,r=e.kind,n=e.index++;return!t||n>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==r?{value:n,done:!1}:"values"==r?{value:t[n],done:!1}:{value:[n,t[n]],done:!1}}),"values"),o.Arguments=o.Array,i("keys"),i("values"),i("entries")},function(e,t,r){var n=r(10),i=r(124),o=r(20),s=n("unscopables"),a=Array.prototype;null==a[s]&&o.f(a,s,{configurable:!0,value:i(null)}),e.exports=function(e){a[s][e]=!0}},function(e,t,r){e.exports=function(e){if(!e)return Math.random;var t=Math.pow(2,32),r=new Uint32Array(1);return function(){return e.getRandomValues(r)[0]/t}}(r(330))},function(e,t){var r="undefined"!=typeof window?window:self;e.exports=r.crypto||r.msCrypto},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t,r=[];return new Observable((function(n){return t||(t=e.subscribe({complete:function(){r.forEach((function(e){return e.complete()}))},error:function(e){r.forEach((function(t){return t.error(e)}))},next:function(e){r.forEach((function(t){return t.next(e)}))}})),r.push(n),function(){(r=r.filter((function(e){return e!==n}))).length||(t.unsubscribe(),t=null)}}))}},function(e,t,r){"use strict";var n=r(8);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t;return e.listenOnceAsync=s(e.listenOnceAsync.bind(e),(function(e,r){t=(0,o.default)();for(var n=arguments.length,i=new Array(n>2?n-2:0),a=2;a<n;a++)i[a-2]=arguments[a];return[s(e,null,(function(e){return t.resolve(e),e})),s(r,null,(function(e){return t.reject(e),e}))].concat(i)})),e.startContinuousRecognitionAsync=function(t,r){e.listenOnceAsync((function(){}),(function(e){t=null,r&&r(e)})),setTimeout((function(){r=null,t&&t()}),0)},e};var i=n(r(333)),o=n(r(59));function s(e,t,r){return function(){for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];o=t?t.apply(void 0,(0,i.default)(o)):o;var a=e.apply(void 0,(0,i.default)(o));return r?r(a):a}}},function(e,t,r){var n=r(334),i=r(335),o=r(114),s=r(336);e.exports=function(e){return n(e)||i(e)||o(e)||s()}},function(e,t,r){var n=r(115);e.exports=function(e){if(Array.isArray(e))return n(e)}},function(e,t){e.exports=function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(e,t,r){"use strict";var n=r(8);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return a.apply(this,arguments)};var i=n(r(22)),o=n(r(23)),s=n(r(338));function a(){return(a=(0,o.default)(i.default.mark((function e(t){var r,n;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,s.default)("https://directline.botframework.com/v3/directline/tokens/refresh",{headers:{authorization:"Bearer ".concat(t)},method:"POST"});case 2:return r=e.sent,n=r.token,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},function(e,t,r){"use strict";var n=r(8);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return u.apply(this,arguments)};var i=n(r(22)),o=n(r(60)),s=n(r(23)),a=n(r(339));function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function u(){return(u=(0,s.default)(i.default.mark((function e(t,r){var n;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,a.default)(t,p(p({},r),{},{headers:p(p({},r.headers),{},{accept:"application/json"})}));case 2:if((n=e.sent).ok){e.next=5;break}throw new Error("Failed to fetch JSON from server due to ".concat(n.status));case 5:return e.abrupt("return",n.json());case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},function(e,t,r){"use strict";var n=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n)return n;throw new Error("unable to locate global object")}();e.exports=t=n.fetch,t.default=n.fetch.bind(n),t.Headers=n.Headers,t.Request=n.Request,t.Response=n.Response},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return"function"==typeof e?e():e}},function(e,t,r){"use strict";r.r(t),r.d(t,"AudioConfig",(function(){return V})),r.d(t,"AudioStreamFormat",(function(){return v})),r.d(t,"AudioInputStream",(function(){return B})),r.d(t,"PullAudioInputStream",(function(){return W})),r.d(t,"PushAudioInputStream",(function(){return U})),r.d(t,"AudioOutputStream",(function(){return G})),r.d(t,"PullAudioOutputStream",(function(){return K})),r.d(t,"CancellationReason",(function(){return Y})),r.d(t,"PullAudioInputStreamCallback",(function(){return q})),r.d(t,"KeywordRecognitionModel",(function(){return Z})),r.d(t,"SessionEventArgs",(function(){return ee})),r.d(t,"RecognitionEventArgs",(function(){return te})),r.d(t,"OutputFormat",(function(){return $})),r.d(t,"IntentRecognitionEventArgs",(function(){return re})),r.d(t,"RecognitionResult",(function(){return ne})),r.d(t,"SpeechRecognitionResult",(function(){return ie})),r.d(t,"IntentRecognitionResult",(function(){return oe})),r.d(t,"LanguageUnderstandingModel",(function(){return se})),r.d(t,"SpeechRecognitionEventArgs",(function(){return ce})),r.d(t,"SpeechRecognitionCanceledEventArgs",(function(){return pe})),r.d(t,"TranslationRecognitionEventArgs",(function(){return ue})),r.d(t,"TranslationSynthesisEventArgs",(function(){return he})),r.d(t,"TranslationRecognitionResult",(function(){return ve})),r.d(t,"TranslationSynthesisResult",(function(){return le})),r.d(t,"ResultReason",(function(){return X})),r.d(t,"SpeechConfig",(function(){return ye})),r.d(t,"SpeechConfigImpl",(function(){return me})),r.d(t,"SpeechTranslationConfig",(function(){return Se})),r.d(t,"PropertyCollection",(function(){return ge})),r.d(t,"PropertyId",(function(){return de})),r.d(t,"Recognizer",(function(){return He})),r.d(t,"SpeechRecognizer",(function(){return st})),r.d(t,"IntentRecognizer",(function(){return vt})),r.d(t,"TranslationRecognizer",(function(){return Pt})),r.d(t,"Translations",(function(){return yt})),r.d(t,"NoMatchReason",(function(){return ft})),r.d(t,"NoMatchDetails",(function(){return Rt})),r.d(t,"TranslationRecognitionCanceledEventArgs",(function(){return gt})),r.d(t,"IntentRecognitionCanceledEventArgs",(function(){return pt})),r.d(t,"CancellationDetails",(function(){return It})),r.d(t,"CancellationErrorCode",(function(){return Re})),r.d(t,"ConnectionEventArgs",(function(){return wt})),r.d(t,"ServiceEventArgs",(function(){return Et})),r.d(t,"Connection",(function(){return Tt})),r.d(t,"PhraseListGrammar",(function(){return Ot})),r.d(t,"DialogServiceConfig",(function(){return At})),r.d(t,"BotFrameworkConfig",(function(){return Dt})),r.d(t,"CustomCommandsConfig",(function(){return xt})),r.d(t,"DialogServiceConnector",(function(){return Ht})),r.d(t,"ActivityReceivedEventArgs",(function(){return zt})),r.d(t,"ServicePropertyChannel",(function(){return Bt})),r.d(t,"ProfanityOption",(function(){return fe})),r.d(t,"BaseAudioPlayer",(function(){return Vt})),r.d(t,"Conversation",(function(){return jr})),r.d(t,"ConversationExpirationEventArgs",(function(){return lr})),r.d(t,"ConversationParticipantsChangedEventArgs",(function(){return _r})),r.d(t,"ConversationTranslationCanceledEventArgs",(function(){return fr})),r.d(t,"ConversationTranslationEventArgs",(function(){return kr})),r.d(t,"ConversationTranslationResult",(function(){return dr})),r.d(t,"ConversationTranslator",(function(){return Lr})),r.d(t,"Participant",(function(){return Nr})),r.d(t,"ParticipantChangedReason",(function(){return Dr})),r.d(t,"User",(function(){return Mr}));var n=r(13);var i,o,s,a,c,p=r(342);class u{constructor(e,t){this.encode=e=>{const t=this.downSampleAudioFrame(e,this.privActualSampleRate,this.privDesiredSampleRate);if(!t)return null;const r=2*t.length,n=new ArrayBuffer(r),i=new DataView(n);return this.floatTo16BitPCM(i,0,t),n},this.setString=(e,t,r)=>{for(let n=0;n<r.length;n++)e.setUint8(t+n,r.charCodeAt(n))},this.floatTo16BitPCM=(e,t,r)=>{for(let n=0;n<r.length;n++,t+=2){const i=Math.max(-1,Math.min(1,r[n]));e.setInt16(t,i<0?32768*i:32767*i,!0)}},this.downSampleAudioFrame=(e,t,r)=>{if(r===t||r>t)return e;const n=t/r,i=Math.round(e.length/n),o=new Float32Array(i);let s=0,a=0;for(;a<i;){const t=Math.round((a+1)*n);let r=0,i=0;for(;s<t&&s<e.length;)r+=e[s++],i++;o[a++]=r/i}return o},this.privActualSampleRate=e,this.privDesiredSampleRate=t}}class h{constructor(){this.record=(e,t,r)=>{const n=(()=>{let t=0;try{return e.createScriptProcessor(t,1,1)}catch(r){t=2048;let n=e.sampleRate;for(;t<16384&&n>=32e3;)t<<=1,n>>=1;return e.createScriptProcessor(t,1,1)}})(),i=new u(e.sampleRate,16e3);let o=!0;n.onaudioprocess=e=>{const t=e.inputBuffer.getChannelData(0);if(r&&!r.isClosed){const e=i.encode(t);e&&(r.writeStreamChunk({buffer:e,isEnd:!1,timeReceived:Date.now()}),o=!1)}};const s=e.createMediaStreamSource(t);this.privSpeechProcessorScript&&e.audioWorklet?e.audioWorklet.addModule(this.privSpeechProcessorScript).then(()=>{const n=new AudioWorkletNode(e,"speech-processor");n.port.onmessage=e=>{const t=e.data;if(r&&!r.isClosed){const e=i.encode(t);e&&(r.writeStreamChunk({buffer:e,isEnd:!1,timeReceived:Date.now()}),o=!1)}},s.connect(n),n.connect(e.destination),this.privMediaResources={scriptProcessorNode:n,source:s,stream:t}}).catch(()=>{s.connect(n),n.connect(e.destination),this.privMediaResources={scriptProcessorNode:n,source:s,stream:t}}):(s.connect(n),n.connect(e.destination),this.privMediaResources={scriptProcessorNode:n,source:s,stream:t})},this.releaseMediaResources=e=>{this.privMediaResources&&(this.privMediaResources.scriptProcessorNode&&(this.privMediaResources.scriptProcessorNode.disconnect(e.destination),this.privMediaResources.scriptProcessorNode=null),this.privMediaResources.source&&(this.privMediaResources.source.disconnect(),this.privMediaResources.stream.getTracks().forEach(e=>e.stop()),this.privMediaResources.source=null))}}setWorkletUrl(e){this.privSpeechProcessorScript=e}}class v{static getDefaultInputFormat(){return l.getDefaultInputFormat()}static getWaveFormatPCM(e,t,r){return new l(e,t,r)}}class l extends v{constructor(e=16e3,t=16,r=1){super(),this.setString=(e,t,r)=>{for(let n=0;n<r.length;n++)e.setUint8(t+n,r.charCodeAt(n))},this.formatTag=1,this.bitsPerSample=t,this.samplesPerSec=e,this.channels=r,this.avgBytesPerSec=this.samplesPerSec*this.channels*(this.bitsPerSample/8),this.blockAlign=this.channels*Math.max(this.bitsPerSample,8),this.privHeader=new ArrayBuffer(44);const n=new DataView(this.privHeader);this.setString(n,0,"RIFF"),n.setUint32(4,0,!0),this.setString(n,8,"WAVEfmt "),n.setUint32(16,16,!0),n.setUint16(20,1,!0),n.setUint16(22,this.channels,!0),n.setUint32(24,this.samplesPerSec,!0),n.setUint32(28,this.avgBytesPerSec,!0),n.setUint16(32,this.channels*(this.bitsPerSample/8),!0),n.setUint16(34,this.bitsPerSample,!0),this.setString(n,36,"data"),n.setUint32(40,0,!0)}static getDefaultInputFormat(){return new l}close(){}get header(){return this.privHeader}}!function(e){e[e.Interactive=0]="Interactive",e[e.Conversation=1]="Conversation",e[e.Dictation=2]="Dictation"}(i||(i={})),function(e){e[e.Simple=0]="Simple",e[e.Detailed=1]="Detailed"}(o||(o={}));class d{constructor(e,t){this.privRecognitionMode=i.Interactive,this.privSpeechServiceConfig=e||new f(new g(null)),this.privParameters=t}get parameters(){return this.privParameters}get recognitionMode(){return this.privRecognitionMode}set recognitionMode(e){this.privRecognitionMode=e,this.privRecognitionActivityTimeout=e===i.Interactive?8e3:25e3,this.privSpeechServiceConfig.Recognition=i[e]}get SpeechServiceConfig(){return this.privSpeechServiceConfig}get recognitionActivityTimeout(){return this.privRecognitionActivityTimeout}get isContinuousRecognition(){return this.privRecognitionMode!==i.Interactive}}class f{constructor(e){this.serialize=()=>JSON.stringify(this,(e,t)=>{if(t&&"object"==typeof t){const e={};for(const r in t)Object.hasOwnProperty.call(t,r)&&(e[r&&r.charAt(0).toLowerCase()+r.substring(1)]=t[r]);return e}return t}),this.context=e}get Context(){return this.context}get Recognition(){return this.recognition}set Recognition(e){this.recognition=e.toLowerCase()}}class g{constructor(e){this.system=new y,this.os=e}}class y{constructor(){this.name="SpeechSDK",this.version="1.10.1",this.build="JavaScript",this.lang="JavaScript"}}class m{constructor(e,t,r){this.platform=e,this.name=t,this.version=r}}!function(e){e.Bluetooth="Bluetooth",e.Wired="Wired",e.WiFi="WiFi",e.Cellular="Cellular",e.InBuilt="InBuilt",e.Unknown="Unknown"}(s||(s={})),(c=a||(a={})).Phone="Phone",c.Speaker="Speaker",c.Car="Car",c.Headset="Headset",c.Thermostat="Thermostat",c.Microphones="Microphones",c.Deskphone="Deskphone",c.RemoteControl="RemoteControl",c.Unknown="Unknown",c.File="File",c.Stream="Stream";var S=r(5);class C extends n.b{constructor(e,t,r=n.a.Info){super(e,r),this.privAudioSourceId=t}get audioSourceId(){return this.privAudioSourceId}}class b extends C{constructor(e){super("AudioSourceInitializingEvent",e)}}class P extends C{constructor(e){super("AudioSourceReadyEvent",e)}}class R extends C{constructor(e){super("AudioSourceOffEvent",e)}}class I extends C{constructor(e,t){super("AudioSourceErrorEvent",e,n.a.Error),this.privError=t}get error(){return this.privError}}class w extends C{constructor(e,t,r){super(e,t),this.privAudioNodeId=r}get audioNodeId(){return this.privAudioNodeId}}class E extends w{constructor(e,t){super("AudioStreamNodeAttachingEvent",e,t)}}class T extends w{constructor(e,t){super("AudioStreamNodeAttachedEvent",e,t)}}class O extends w{constructor(e,t){super("AudioStreamNodeDetachedEvent",e,t)}}class A extends w{constructor(e,t,r){super("AudioStreamNodeErrorEvent",e,t),this.privError=r}get error(){return this.privError}}var _=r(1),D=r(7),x=r(38);class k{constructor(e,t,r){this.privIsClosed=!1,this.read=()=>{if(this.isClosed)throw new _.b("StreamReader closed");return this.privReaderQueue.dequeue().onSuccessContinueWith(e=>((void 0===e||e.isEnd)&&this.privReaderQueue.dispose("End of stream reached"),e))},this.close=()=>{this.privIsClosed||(this.privIsClosed=!0,this.privReaderQueue.dispose("StreamReader closed"),this.privOnClose())},this.privReaderQueue=t,this.privOnClose=r,this.privStreamId=e}get isClosed(){return this.privIsClosed}get streamId(){return this.privStreamId}}class M extends class{constructor(e){this.privReaderIdCounter=1,this.privIsEnded=!1,this.getReader=()=>{const e=this.privReaderIdCounter;this.privReaderIdCounter++;const t=new x.a,r=this.privStreambuffer.length;this.privReaderQueues[e]=t;for(let e=0;e<r;e++)t.enqueue(this.privStreambuffer[e]);return new k(this.privId,t,()=>{delete this.privReaderQueues[e]})},this.throwIfClosed=()=>{if(this.privIsEnded)throw new _.b("Stream closed")},this.privId=e||Object(D.b)(),this.privStreambuffer=[],this.privReaderQueues={}}get isClosed(){return this.privIsEnded}get id(){return this.privId}close(){this.privIsEnded||(this.writeStreamChunk({buffer:null,isEnd:!0,timeReceived:Date.now()}),this.privIsEnded=!0)}writeStreamChunk(e){this.throwIfClosed(),this.privStreambuffer.push(e);for(const t in this.privReaderQueues)if(!this.privReaderQueues[t].isDisposed())try{this.privReaderQueues[t].enqueue(e)}catch(e){}}}{constructor(e,t){super(t),this.privTargetChunkSize=e,this.privNextBufferReadyBytes=0}writeStreamChunk(e){if(e.isEnd||0===this.privNextBufferReadyBytes&&e.buffer.byteLength===this.privTargetChunkSize)return void super.writeStreamChunk(e);let t=0;for(;t<e.buffer.byteLength;){void 0===this.privNextBufferToWrite&&(this.privNextBufferToWrite=new ArrayBuffer(this.privTargetChunkSize),this.privNextBufferStartTime=e.timeReceived);const r=Math.min(e.buffer.byteLength-t,this.privTargetChunkSize-this.privNextBufferReadyBytes),n=new Uint8Array(this.privNextBufferToWrite),i=new Uint8Array(e.buffer.slice(t,r+t));n.set(i,this.privNextBufferReadyBytes),this.privNextBufferReadyBytes+=r,t+=r,this.privNextBufferReadyBytes===this.privTargetChunkSize&&(super.writeStreamChunk({buffer:this.privNextBufferToWrite,isEnd:!1,timeReceived:this.privNextBufferStartTime}),this.privNextBufferReadyBytes=0,this.privNextBufferToWrite=void 0)}}close(){0===this.privNextBufferReadyBytes||this.isClosed||super.writeStreamChunk({buffer:this.privNextBufferToWrite.slice(0,this.privNextBufferReadyBytes),isEnd:!1,timeReceived:this.privNextBufferStartTime}),super.close()}}var N=r(62);class j{constructor(e,t,r){this.privRecorder=e,this.deviceId=t,this.privStreams={},this.turnOn=()=>{if(this.privInitializeDeferral)return this.privInitializeDeferral.promise();this.privInitializeDeferral=new S.a;try{this.createAudioContext()}catch(e){if(e instanceof Error){const t=e;this.privInitializeDeferral.reject(t.name+": "+t.message)}else this.privInitializeDeferral.reject(e);return this.privInitializeDeferral.promise()}const e=window.navigator;let t=e.getUserMedia||e.webkitGetUserMedia||e.mozGetUserMedia||e.msGetUserMedia;if(e.mediaDevices&&(t=(t,r,n)=>{e.mediaDevices.getUserMedia(t).then(r).catch(n)}),t){const e=()=>{this.onEvent(new b(this.privId)),t({audio:!this.deviceId||{deviceId:this.deviceId},video:!1},e=>{this.privMediaStream=e,this.onEvent(new P(this.privId)),this.privInitializeDeferral.resolve(!0)},e=>{const t="Error occurred during microphone initialization: "+e,r=this.privInitializeDeferral;this.privInitializeDeferral=null,r.reject(t),this.onEvent(new I(this.privId,t))})};"suspended"===this.privContext.state?this.privContext.resume().then(e,e=>{this.privInitializeDeferral.reject("Failed to initialize audio context: "+e)}):e()}else{const e="Browser does not support getUserMedia.";this.privInitializeDeferral.reject(e),this.onEvent(new I(e,""))}return this.privInitializeDeferral.promise()},this.id=()=>this.privId,this.attach=e=>(this.onEvent(new E(this.privId,e)),this.listen(e).onSuccessContinueWith(t=>(this.onEvent(new T(this.privId,e)),{detach:()=>{t.close(),this.turnOff(),delete this.privStreams[e],this.onEvent(new O(this.privId,e))},id:()=>e,read:()=>t.read()}))),this.detach=e=>{e&&this.privStreams[e]&&(this.privStreams[e].close(),delete this.privStreams[e],this.onEvent(new O(this.privId,e)))},this.turnOff=()=>{for(const e in this.privStreams)if(e){const t=this.privStreams[e];t&&t.close()}return this.onEvent(new R(this.privId)),this.privInitializeDeferral=null,this.destroyAudioContext(),S.c.fromResult(!0)},this.listen=e=>this.turnOn().onSuccessContinueWith(t=>{const r=new M(this.privOutputChunkSize,e);this.privStreams[e]=r;try{this.privRecorder.record(this.privContext,this.privMediaStream,r)}catch(t){throw this.onEvent(new A(this.privId,e,t)),t}return r.getReader()}),this.onEvent=e=>{this.privEvents.onEvent(e),p.a.instance.onEvent(e)},this.createAudioContext=()=>{if(this.privContext)return;const e=window.AudioContext||window.webkitAudioContext||!1;if(!e)throw new Error("Browser does not support Web Audio API (AudioContext is not available).");this.privContext=new e},this.destroyAudioContext=()=>{if(!this.privContext)return;this.privRecorder.releaseMediaResources(this.privContext);let e=!1;"close"in this.privContext&&(e=!0),e?(this.privContext.close(),this.privContext=null):null!==this.privContext&&"running"===this.privContext.state&&this.privContext.suspend()},this.privOutputChunkSize=j.AUDIOFORMAT.avgBytesPerSec/10,this.privId=r||Object(D.b)(),this.privEvents=new N.a}get format(){return S.c.fromResult(j.AUDIOFORMAT)}get events(){return this.privEvents}get deviceInfo(){return this.getMicrophoneLabel().onSuccessContinueWith(e=>({bitspersample:j.AUDIOFORMAT.bitsPerSample,channelcount:j.AUDIOFORMAT.channels,connectivity:s.Unknown,manufacturer:"Speech SDK",model:e,samplerate:j.AUDIOFORMAT.samplesPerSec,type:a.Microphones}))}setProperty(e,t){if("MICROPHONE-WorkletSourceUrl"!==e)throw new Error("Property '"+e+"' is not supported on Microphone.");this.privRecorder.setWorkletUrl(t)}getMicrophoneLabel(){if(void 0!==this.privMicrophoneLabel)return S.c.fromResult(this.privMicrophoneLabel);if(void 0===this.privMediaStream||!this.privMediaStream.active)return S.c.fromResult("microphone");this.privMicrophoneLabel="microphone";const e=this.privMediaStream.getTracks()[0].getSettings().deviceId;if(void 0===e)return S.c.fromResult(this.privMicrophoneLabel);const t=new S.a;return navigator.mediaDevices.enumerateDevices().then(r=>{for(const t of r)if(t.deviceId===e){this.privMicrophoneLabel=t.label;break}t.resolve(this.privMicrophoneLabel)},()=>t.resolve(this.privMicrophoneLabel)),t.promise()}}j.AUDIOFORMAT=v.getDefaultInputFormat();class z{constructor(e,t){this.privStreams={},this.turnOn=()=>{if("undefined"==typeof FileReader){const e="Browser does not support FileReader.";return this.onEvent(new I(e,"")),S.c.fromError(e)}if(this.privFile.name.lastIndexOf(".wav")!==this.privFile.name.length-4){const e=this.privFile.name+" is not supported. Only WAVE files are allowed at the moment.";return this.onEvent(new I(e,"")),S.c.fromError(e)}return this.onEvent(new b(this.privId)),this.onEvent(new P(this.privId)),S.c.fromResult(!0)},this.id=()=>this.privId,this.attach=e=>(this.onEvent(new E(this.privId,e)),this.upload(e).onSuccessContinueWith(t=>(this.onEvent(new T(this.privId,e)),{detach:()=>{t.close(),delete this.privStreams[e],this.onEvent(new O(this.privId,e)),this.turnOff()},id:()=>e,read:()=>t.read()}))),this.detach=e=>{e&&this.privStreams[e]&&(this.privStreams[e].close(),delete this.privStreams[e],this.onEvent(new O(this.privId,e)))},this.turnOff=()=>{for(const e in this.privStreams)if(e){const t=this.privStreams[e];t&&!t.isClosed&&t.close()}return this.onEvent(new R(this.privId)),S.c.fromResult(!0)},this.readHeader=()=>{const e=this.privFile.slice(0,44),t=new FileReader,r=new S.a;return t.onload=e=>{const t=e.target.result,n=new DataView(t);"RIFF"!==String.fromCharCode(n.getUint8(0),n.getUint8(1),n.getUint8(2),n.getUint8(3))&&r.reject("Invalid WAV header in file, RIFF was not found");"WAVEfmt"!==String.fromCharCode(n.getUint8(8),n.getUint8(9),n.getUint8(10),n.getUint8(11),n.getUint8(12),n.getUint8(13),n.getUint8(14))&&r.reject("Invalid WAV header in file, WAVEfmt was not found");const i=n.getUint16(22,!0),o=n.getUint32(24,!0),s=n.getUint16(34,!0);r.resolve(v.getWaveFormatPCM(o,s,i))},t.readAsArrayBuffer(e),r.promise()},this.upload=e=>this.turnOn().onSuccessContinueWithPromise(t=>this.privAudioFormatPromise.onSuccessContinueWith(t=>{new M(3200);const r=new FileReader,n=new M(t.avgBytesPerSec/10,e);this.privStreams[e]=n;r.onload=e=>{n.isClosed||(n.writeStreamChunk({buffer:r.result,isEnd:!1,timeReceived:Date.now()}),n.close())},r.onerror=t=>{const r=`Error occurred while processing '${this.privFile.name}'. ${t}`;throw this.onEvent(new A(this.privId,e,r)),new Error(r)};const i=this.privFile.slice(44);return r.readAsArrayBuffer(i),n.getReader()})),this.onEvent=e=>{this.privEvents.onEvent(e),p.a.instance.onEvent(e)},this.privId=t||Object(D.b)(),this.privEvents=new N.a,this.privFile=e,this.privAudioFormatPromise=this.readHeader()}get format(){return this.privAudioFormatPromise}get events(){return this.privEvents}get deviceInfo(){return this.privAudioFormatPromise.onSuccessContinueWithPromise(e=>S.c.fromResult({bitspersample:e.bitsPerSample,channelcount:e.channels,connectivity:s.Unknown,manufacturer:"Speech SDK",model:"File",samplerate:e.samplesPerSec,type:a.File}))}}class L{static throwIfNullOrUndefined(e,t){if(null==e)throw new Error("throwIfNullOrUndefined:"+t)}static throwIfNull(e,t){if(null===e)throw new Error("throwIfNull:"+t)}static throwIfNullOrWhitespace(e,t){if(L.throwIfNullOrUndefined(e,t),(""+e).trim().length<1)throw new Error("throwIfNullOrWhitespace:"+t)}static throwIfDisposed(e){if(e)throw new Error("the object is already disposed")}static throwIfArrayEmptyOrWhitespace(e,t){if(L.throwIfNullOrUndefined(e,t),0===e.length)throw new Error("throwIfArrayEmptyOrWhitespace:"+t);for(const r of e)L.throwIfNullOrWhitespace(r,t)}static throwIfFileDoesNotExist(e,t){L.throwIfNullOrWhitespace(e,t)}}class q{}class B{constructor(){}static createPushStream(e){return U.create(e)}static createPullStream(e,t){return W.create(e,t)}}class U extends B{static create(e){return new F(e)}}class F extends U{constructor(e){super(),this.onEvent=e=>{this.privEvents.onEvent(e),p.a.instance.onEvent(e)},this.privFormat=void 0===e?l.getDefaultInputFormat():e,this.privEvents=new N.a,this.privId=Object(D.b)(),this.privStream=new M(this.privFormat.avgBytesPerSec/10)}get format(){return S.c.fromResult(this.privFormat)}write(e){this.privStream.writeStreamChunk({buffer:e,isEnd:!1,timeReceived:Date.now()})}close(){this.privStream.close()}id(){return this.privId}turnOn(){return this.onEvent(new b(this.privId)),this.onEvent(new P(this.privId)),S.c.fromResult(!0)}attach(e){return this.onEvent(new E(this.privId,e)),this.turnOn().onSuccessContinueWith(e=>this.privStream.getReader()).onSuccessContinueWith(t=>(this.onEvent(new T(this.privId,e)),{detach:()=>{t.close(),this.onEvent(new O(this.privId,e)),this.turnOff()},id:()=>e,read:()=>t.read()}))}detach(e){this.onEvent(new O(this.privId,e))}turnOff(){return S.c.fromResult(!1)}get events(){return this.privEvents}get deviceInfo(){return S.c.fromResult({bitspersample:this.privFormat.bitsPerSample,channelcount:this.privFormat.channels,connectivity:s.Unknown,manufacturer:"Speech SDK",model:"PushStream",samplerate:this.privFormat.samplesPerSec,type:a.Stream})}}class W extends B{constructor(){super()}static create(e,t){return new H(e,t)}}class H extends W{constructor(e,t){super(),this.onEvent=e=>{this.privEvents.onEvent(e),p.a.instance.onEvent(e)},this.privFormat=void 0===t?v.getDefaultInputFormat():t,this.privEvents=new N.a,this.privId=Object(D.b)(),this.privCallback=e,this.privIsClosed=!1,this.privBufferSize=this.privFormat.avgBytesPerSec/10}get format(){return S.c.fromResult(this.privFormat)}close(){this.privIsClosed=!0,this.privCallback.close()}id(){return this.privId}turnOn(){return this.onEvent(new b(this.privId)),this.onEvent(new P(this.privId)),S.c.fromResult(!0)}attach(e){return this.onEvent(new E(this.privId,e)),this.turnOn().onSuccessContinueWith(t=>(this.onEvent(new T(this.privId,e)),{detach:()=>{this.privCallback.close(),this.onEvent(new O(this.privId,e)),this.turnOff()},id:()=>e,read:()=>{let e,t=0;for(;t<this.privBufferSize;){const r=new ArrayBuffer(this.privBufferSize-t),n=this.privCallback.read(r);if(void 0===e)e=r;else{new Int8Array(e).set(new Int8Array(r),t)}if(0===n)break;t+=n}return S.c.fromResult({buffer:e.slice(0,t),isEnd:this.privIsClosed||0===t,timeReceived:Date.now()})}}))}detach(e){this.onEvent(new O(this.privId,e))}turnOff(){return S.c.fromResult(!1)}get events(){return this.privEvents}get deviceInfo(){return S.c.fromResult({bitspersample:this.privFormat.bitsPerSample,channelcount:this.privFormat.channels,connectivity:s.Unknown,manufacturer:"Speech SDK",model:"PullStream",samplerate:this.privFormat.samplesPerSec,type:a.Stream})}}class V{static fromDefaultMicrophoneInput(){const e=new h;return new J(new j(e))}static fromMicrophoneInput(e){const t=new h;return new J(new j(t,e))}static fromWavFileInput(e){return new J(new z(e))}static fromStreamInput(e){if(e instanceof q)return new J(new H(e));if(e instanceof B)return new J(e);throw new Error("Not Supported Type")}}class J extends V{constructor(e){super(),this.privSource=e}get format(){return this.privSource.format}close(){this.privSource.turnOff()}id(){return this.privSource.id()}turnOn(){return this.privSource.turnOn()}attach(e){return this.privSource.attach(e)}detach(e){return this.privSource.detach(e)}turnOff(){return this.privSource.turnOff()}get events(){return this.privSource.events}setProperty(e,t){if(L.throwIfNull(t,"value"),void 0===this.privSource.setProperty)throw new Error("This AudioConfig instance does not support setting properties.");this.privSource.setProperty(e,t)}getProperty(e,t){if(void 0!==this.privSource.getProperty)return this.privSource.getProperty(e,t);throw new Error("This AudioConfig instance does not support getting properties.")}get deviceInfo(){return this.privSource.deviceInfo}}class G{constructor(){}static createPullStream(e){return K.create(e)}}class K extends G{static create(e){return new Q(4096,e)}}class Q extends K{constructor(e,t){super(),this.privFormat=void 0===t?l.getDefaultInputFormat():t,this.privId=Object(D.b)(),this.privStream=new M(e),this.streamReader=this.privStream.getReader()}get format(){return this.privFormat}get isClosed(){return this.privStream.isClosed}get id(){return this.privId}read(){return this.streamReader.read().onSuccessContinueWithPromise(e=>S.c.fromResult(e.buffer))}write(e){this.privStream.writeStreamChunk({buffer:e,isEnd:!1,timeReceived:Date.now()})}close(){this.privStream.close()}}var Y,$,X;!function(e){e[e.Error=0]="Error",e[e.EndOfStream=1]="EndOfStream"}(Y||(Y={}));class Z{constructor(){this.privDisposed=!1}static fromFile(e){throw L.throwIfFileDoesNotExist(e,"fileName"),new Error("Not yet implemented.")}static fromStream(e){throw L.throwIfNull(e,"file"),new Error("Not yet implemented.")}close(){this.privDisposed||(this.privDisposed=!0)}}class ee{constructor(e){this.privSessionId=e}get sessionId(){return this.privSessionId}}class te extends ee{constructor(e,t){super(t),this.privOffset=e}get offset(){return this.privOffset}}!function(e){e[e.Simple=0]="Simple",e[e.Detailed=1]="Detailed"}($||($={}));class re extends te{constructor(e,t,r){super(t,r),this.privResult=e}get result(){return this.privResult}}class ne{constructor(e,t,r,n,i,o,s,a){this.privResultId=e,this.privReason=t,this.privText=r,this.privDuration=n,this.privOffset=i,this.privErrorDetails=o,this.privJson=s,this.privProperties=a}get resultId(){return this.privResultId}get reason(){return this.privReason}get text(){return this.privText}get duration(){return this.privDuration}get offset(){return this.privOffset}get errorDetails(){return this.privErrorDetails}get json(){return this.privJson}get properties(){return this.privProperties}}class ie extends ne{constructor(e,t,r,n,i,o,s,a){super(e,t,r,n,i,o,s,a)}}class oe extends ie{constructor(e,t,r,n,i,o,s,a,c){super(t,r,n,i,o,s,a,c),this.privIntentId=e}get intentId(){return this.privIntentId}}class se{constructor(){}static fromEndpoint(e){L.throwIfNull(e,"uri"),L.throwIfNullOrWhitespace(e.hostname,"uri");const t=new ae,r=e.host.indexOf(".");if(-1===r)throw new Error("Could not determine region from endpoint");t.region=e.host.substr(0,r);const n=e.pathname.lastIndexOf("/")+1;if(-1===n)throw new Error("Could not determine appId from endpoint");if(t.appId=e.pathname.substr(n),t.subscriptionKey=e.searchParams.get("subscription-key"),void 0===t.subscriptionKey)throw new Error("Could not determine subscription key from endpoint");return t}static fromAppId(e){L.throwIfNullOrWhitespace(e,"appId");const t=new ae;return t.appId=e,t}static fromSubscription(e,t,r){L.throwIfNullOrWhitespace(e,"subscriptionKey"),L.throwIfNullOrWhitespace(t,"appId"),L.throwIfNullOrWhitespace(r,"region");const n=new ae;return n.appId=t,n.region=r,n.subscriptionKey=e,n}}class ae extends se{}class ce extends te{constructor(e,t,r){super(t,r),this.privResult=e}get result(){return this.privResult}}class pe extends te{constructor(e,t,r,n,i){super(n,i),this.privReason=e,this.privErrorDetails=t,this.privErrorCode=r}get reason(){return this.privReason}get errorCode(){return this.privErrorCode}get errorDetails(){return this.privErrorDetails}}class ue extends te{constructor(e,t,r){super(t,r),this.privResult=e}get result(){return this.privResult}}class he extends ee{constructor(e,t){super(t),this.privResult=e}get result(){return this.privResult}}class ve extends ie{constructor(e,t,r,n,i,o,s,a,c){super(t,r,n,i,o,s,a,c),this.privTranslations=e}get translations(){return this.privTranslations}}class le{constructor(e,t){this.privReason=e,this.privAudio=t}get audio(){return this.privAudio}get reason(){return this.privReason}}!function(e){e[e.NoMatch=0]="NoMatch",e[e.Canceled=1]="Canceled",e[e.RecognizingSpeech=2]="RecognizingSpeech",e[e.RecognizedSpeech=3]="RecognizedSpeech",e[e.RecognizingIntent=4]="RecognizingIntent",e[e.RecognizedIntent=5]="RecognizedIntent",e[e.TranslatingSpeech=6]="TranslatingSpeech",e[e.TranslatedSpeech=7]="TranslatedSpeech",e[e.SynthesizingAudio=8]="SynthesizingAudio",e[e.SynthesizingAudioCompleted=9]="SynthesizingAudioCompleted"}(X||(X={}));var de,fe;!function(e){e[e.SpeechServiceConnection_Key=0]="SpeechServiceConnection_Key",e[e.SpeechServiceConnection_Endpoint=1]="SpeechServiceConnection_Endpoint",e[e.SpeechServiceConnection_Region=2]="SpeechServiceConnection_Region",e[e.SpeechServiceAuthorization_Token=3]="SpeechServiceAuthorization_Token",e[e.SpeechServiceAuthorization_Type=4]="SpeechServiceAuthorization_Type",e[e.SpeechServiceConnection_EndpointId=5]="SpeechServiceConnection_EndpointId",e[e.SpeechServiceConnection_TranslationToLanguages=6]="SpeechServiceConnection_TranslationToLanguages",e[e.SpeechServiceConnection_TranslationVoice=7]="SpeechServiceConnection_TranslationVoice",e[e.SpeechServiceConnection_TranslationFeatures=8]="SpeechServiceConnection_TranslationFeatures",e[e.SpeechServiceConnection_IntentRegion=9]="SpeechServiceConnection_IntentRegion",e[e.SpeechServiceConnection_ProxyHostName=10]="SpeechServiceConnection_ProxyHostName",e[e.SpeechServiceConnection_ProxyPort=11]="SpeechServiceConnection_ProxyPort",e[e.SpeechServiceConnection_ProxyUserName=12]="SpeechServiceConnection_ProxyUserName",e[e.SpeechServiceConnection_ProxyPassword=13]="SpeechServiceConnection_ProxyPassword",e[e.SpeechServiceConnection_RecoMode=14]="SpeechServiceConnection_RecoMode",e[e.SpeechServiceConnection_RecoLanguage=15]="SpeechServiceConnection_RecoLanguage",e[e.Speech_SessionId=16]="Speech_SessionId",e[e.SpeechServiceResponse_RequestDetailedResultTrueFalse=17]="SpeechServiceResponse_RequestDetailedResultTrueFalse",e[e.SpeechServiceResponse_RequestProfanityFilterTrueFalse=18]="SpeechServiceResponse_RequestProfanityFilterTrueFalse",e[e.SpeechServiceResponse_JsonResult=19]="SpeechServiceResponse_JsonResult",e[e.SpeechServiceResponse_JsonErrorDetails=20]="SpeechServiceResponse_JsonErrorDetails",e[e.CancellationDetails_Reason=21]="CancellationDetails_Reason",e[e.CancellationDetails_ReasonText=22]="CancellationDetails_ReasonText",e[e.CancellationDetails_ReasonDetailedText=23]="CancellationDetails_ReasonDetailedText",e[e.LanguageUnderstandingServiceResponse_JsonResult=24]="LanguageUnderstandingServiceResponse_JsonResult",e[e.SpeechServiceConnection_Url=25]="SpeechServiceConnection_Url",e[e.SpeechServiceConnection_InitialSilenceTimeoutMs=26]="SpeechServiceConnection_InitialSilenceTimeoutMs",e[e.SpeechServiceConnection_EndSilenceTimeoutMs=27]="SpeechServiceConnection_EndSilenceTimeoutMs",e[e.SpeechServiceConnection_EnableAudioLogging=28]="SpeechServiceConnection_EnableAudioLogging",e[e.SpeechServiceResponse_ProfanityOption=29]="SpeechServiceResponse_ProfanityOption",e[e.SpeechServiceResponse_PostProcessingOption=30]="SpeechServiceResponse_PostProcessingOption",e[e.SpeechServiceResponse_RequestWordLevelTimestamps=31]="SpeechServiceResponse_RequestWordLevelTimestamps",e[e.SpeechServiceResponse_StablePartialResultThreshold=32]="SpeechServiceResponse_StablePartialResultThreshold",e[e.SpeechServiceResponse_OutputFormatOption=33]="SpeechServiceResponse_OutputFormatOption",e[e.SpeechServiceResponse_TranslationRequestStablePartialResult=34]="SpeechServiceResponse_TranslationRequestStablePartialResult",e[e.Conversation_ApplicationId=35]="Conversation_ApplicationId",e[e.Conversation_DialogType=36]="Conversation_DialogType",e[e.Conversation_Initial_Silence_Timeout=37]="Conversation_Initial_Silence_Timeout",e[e.Conversation_From_Id=38]="Conversation_From_Id",e[e.Conversation_Speech_Activity_Template=39]="Conversation_Speech_Activity_Template",e[e.SpeechServiceConnection_Host=40]="SpeechServiceConnection_Host",e[e.ConversationTranslator_Host=41]="ConversationTranslator_Host",e[e.ConversationTranslator_Name=42]="ConversationTranslator_Name",e[e.ConversationTranslator_CorrelationId=43]="ConversationTranslator_CorrelationId",e[e.ConversationTranslator_Token=44]="ConversationTranslator_Token"}(de||(de={}));class ge{constructor(){this.privKeys=[],this.privValues=[]}getProperty(e,t){let r;r="string"==typeof e?e:de[e];for(let e=0;e<this.privKeys.length;e++)if(this.privKeys[e]===r)return this.privValues[e];return t}setProperty(e,t){let r;r="string"==typeof e?e:de[e];for(let e=0;e<this.privKeys.length;e++)if(this.privKeys[e]===r)return void(this.privValues[e]=t);this.privKeys.push(r),this.privValues.push(t)}clone(){const e=new ge;for(let t=0;t<this.privKeys.length;t++)e.privKeys.push(this.privKeys[t]),e.privValues.push(this.privValues[t]);return e}}!function(e){e[e.Masked=0]="Masked",e[e.Removed=1]="Removed",e[e.Raw=2]="Raw"}(fe||(fe={}));class ye{constructor(){}static fromSubscription(e,t){L.throwIfNullOrWhitespace(e,"subscriptionKey"),L.throwIfNullOrWhitespace(t,"region");const r=new me;return r.setProperty(de.SpeechServiceConnection_Region,t),r.setProperty(de.SpeechServiceConnection_IntentRegion,t),r.setProperty(de.SpeechServiceConnection_Key,e),r}static fromEndpoint(e,t){L.throwIfNull(e,"endpoint");const r=new me;return r.setProperty(de.SpeechServiceConnection_Endpoint,e.href),void 0!==t&&r.setProperty(de.SpeechServiceConnection_Key,t),r}static fromHost(e,t){L.throwIfNull(e,"hostName");const r=new me;return r.setProperty(de.SpeechServiceConnection_Host,e.protocol+"//"+e.hostname+(""===e.port?"":":"+e.port)),void 0!==t&&r.setProperty(de.SpeechServiceConnection_Key,t),r}static fromAuthorizationToken(e,t){L.throwIfNull(e,"authorizationToken"),L.throwIfNullOrWhitespace(t,"region");const r=new me;return r.setProperty(de.SpeechServiceConnection_Region,t),r.setProperty(de.SpeechServiceConnection_IntentRegion,t),r.authorizationToken=e,r}close(){}}class me extends ye{constructor(){super(),this.privProperties=new ge,this.speechRecognitionLanguage="en-US",this.outputFormat=$.Simple}get properties(){return this.privProperties}get endPoint(){return new URL(this.privProperties.getProperty(de.SpeechServiceConnection_Endpoint))}get subscriptionKey(){return this.privProperties.getProperty(de.SpeechServiceConnection_Key)}get region(){return this.privProperties.getProperty(de.SpeechServiceConnection_Region)}get authorizationToken(){return this.privProperties.getProperty(de.SpeechServiceAuthorization_Token)}set authorizationToken(e){this.privProperties.setProperty(de.SpeechServiceAuthorization_Token,e)}get speechRecognitionLanguage(){return this.privProperties.getProperty(de.SpeechServiceConnection_RecoLanguage)}set speechRecognitionLanguage(e){this.privProperties.setProperty(de.SpeechServiceConnection_RecoLanguage,e)}get outputFormat(){return $[this.privProperties.getProperty("OutputFormat",void 0)]}set outputFormat(e){this.privProperties.setProperty("OutputFormat",$[e])}get endpointId(){return this.privProperties.getProperty(de.SpeechServiceConnection_EndpointId)}set endpointId(e){this.privProperties.setProperty(de.SpeechServiceConnection_EndpointId,e)}setProperty(e,t){L.throwIfNull(t,"value"),this.privProperties.setProperty(e,t)}getProperty(e,t){return this.privProperties.getProperty(e,t)}setProxy(e,t,r,n){this.setProperty(de[de.SpeechServiceConnection_ProxyHostName],e),this.setProperty(de[de.SpeechServiceConnection_ProxyPort],t),this.setProperty(de[de.SpeechServiceConnection_ProxyUserName],r),this.setProperty(de[de.SpeechServiceConnection_ProxyPassword],n)}setServiceProperty(e,t,r){const n=JSON.parse(this.privProperties.getProperty("ServiceProperties","{}"));n[e]=t,this.privProperties.setProperty("ServiceProperties",JSON.stringify(n))}setProfanity(e){this.privProperties.setProperty(de.SpeechServiceResponse_ProfanityOption,fe[e])}enableAudioLogging(){this.privProperties.setProperty(de.SpeechServiceConnection_EnableAudioLogging,"true")}requestWordLevelTimestamps(){this.privProperties.setProperty(de.SpeechServiceResponse_RequestWordLevelTimestamps,"true")}enableDictation(){this.privProperties.setProperty("ForceDication","true")}clone(){const e=new me;return e.privProperties=this.privProperties.clone(),e}}class Se extends ye{constructor(){super()}static fromSubscription(e,t){L.throwIfNullOrWhitespace(e,"subscriptionKey"),L.throwIfNullOrWhitespace(t,"region");const r=new Ce;return r.properties.setProperty(de.SpeechServiceConnection_Key,e),r.properties.setProperty(de.SpeechServiceConnection_Region,t),r}static fromAuthorizationToken(e,t){L.throwIfNullOrWhitespace(e,"authorizationToken"),L.throwIfNullOrWhitespace(t,"region");const r=new Ce;return r.properties.setProperty(de.SpeechServiceAuthorization_Token,e),r.properties.setProperty(de.SpeechServiceConnection_Region,t),r}static fromHost(e,t){L.throwIfNull(e,"hostName");const r=new Ce;return r.setProperty(de.SpeechServiceConnection_Host,e.protocol+"//"+e.hostname+(""===e.port?"":":"+e.port)),void 0!==t&&r.setProperty(de.SpeechServiceConnection_Key,t),r}static fromEndpoint(e,t){L.throwIfNull(e,"endpoint"),L.throwIfNull(t,"subscriptionKey");const r=new Ce;return r.properties.setProperty(de.SpeechServiceConnection_Endpoint,e.href),r.properties.setProperty(de.SpeechServiceConnection_Key,t),r}}class Ce extends Se{constructor(){super(),this.privSpeechProperties=new ge,this.outputFormat=$.Simple}set authorizationToken(e){L.throwIfNullOrWhitespace(e,"value"),this.privSpeechProperties.setProperty(de.SpeechServiceAuthorization_Token,e)}set speechRecognitionLanguage(e){L.throwIfNullOrWhitespace(e,"value"),this.privSpeechProperties.setProperty(de.SpeechServiceConnection_RecoLanguage,e)}get subscriptionKey(){return this.privSpeechProperties.getProperty(de[de.SpeechServiceConnection_Key])}get outputFormat(){return $[this.privSpeechProperties.getProperty("OutputFormat",void 0)]}set outputFormat(e){this.privSpeechProperties.setProperty("OutputFormat",$[e])}get endpointId(){return this.privSpeechProperties.getProperty(de.SpeechServiceConnection_EndpointId)}set endpointId(e){this.privSpeechProperties.setProperty(de.SpeechServiceConnection_EndpointId,e)}addTargetLanguage(e){L.throwIfNullOrWhitespace(e,"value");const t=this.targetLanguages;t.push(e),this.privSpeechProperties.setProperty(de.SpeechServiceConnection_TranslationToLanguages,t.join(","))}get targetLanguages(){return void 0!==this.privSpeechProperties.getProperty(de.SpeechServiceConnection_TranslationToLanguages,void 0)?this.privSpeechProperties.getProperty(de.SpeechServiceConnection_TranslationToLanguages).split(","):[]}get voiceName(){return this.getProperty(de[de.SpeechServiceConnection_TranslationVoice])}set voiceName(e){L.throwIfNullOrWhitespace(e,"value"),this.privSpeechProperties.setProperty(de.SpeechServiceConnection_TranslationVoice,e)}get region(){return this.privSpeechProperties.getProperty(de.SpeechServiceConnection_Region)}setProxy(e,t,r,n){this.setProperty(de[de.SpeechServiceConnection_ProxyHostName],e),this.setProperty(de[de.SpeechServiceConnection_ProxyPort],t),this.setProperty(de[de.SpeechServiceConnection_ProxyUserName],r),this.setProperty(de[de.SpeechServiceConnection_ProxyPassword],n)}getProperty(e,t){return this.privSpeechProperties.getProperty(e,t)}setProperty(e,t){this.privSpeechProperties.setProperty(e,t)}get properties(){return this.privSpeechProperties}close(){}setServiceProperty(e,t,r){const n=JSON.parse(this.privSpeechProperties.getProperty("ServiceProperties","{}"));n[e]=t,this.privSpeechProperties.setProperty("ServiceProperties",JSON.stringify(n))}setProfanity(e){this.privSpeechProperties.setProperty(de.SpeechServiceResponse_ProfanityOption,fe[e])}enableAudioLogging(){this.privSpeechProperties.setProperty(de.SpeechServiceConnection_EnableAudioLogging,"true")}requestWordLevelTimestamps(){this.privSpeechProperties.setProperty(de.SpeechServiceResponse_RequestWordLevelTimestamps,"true")}enableDictation(){this.privSpeechProperties.setProperty("ForceDication","true")}}class be{constructor(e,t){this.privBuffers=[],this.privReplayOffset=0,this.privLastShrinkOffset=0,this.privBufferStartOffset=0,this.privBufferSerial=0,this.privBufferedBytes=0,this.privReplay=!1,this.privLastChunkAcquiredTime=0,this.id=()=>this.privAudioNode.id(),this.privAudioNode=e,this.privBytesPerSecond=t}read(){if(this.privReplay&&0!==this.privBuffers.length){const e=this.privReplayOffset-this.privBufferStartOffset;let t=Math.round(e*this.privBytesPerSecond*1e-7);0!=t%2&&t++;let r=0;for(;r<this.privBuffers.length&&t>=this.privBuffers[r].chunk.buffer.byteLength;)t-=this.privBuffers[r++].chunk.buffer.byteLength;const n=this.privBuffers[r].chunk.buffer.slice(t);return this.privReplayOffset+=n.byteLength/this.privBytesPerSecond*1e7,r===this.privBuffers.length-1&&(this.privReplay=!1),S.c.fromResult({buffer:n,isEnd:!1,timeReceived:this.privBuffers[r].chunk.timeReceived})}return this.privAudioNode.read().onSuccessContinueWith(e=>(e&&e.buffer&&(this.privBuffers.push(new Pe(e,this.privBufferSerial++,this.privBufferedBytes)),this.privBufferedBytes+=e.buffer.byteLength),e))}detach(){this.privAudioNode.detach(),this.privBuffers=void 0}replay(){this.privBuffers&&0!==this.privBuffers.length&&(this.privReplay=!0,this.privReplayOffset=this.privLastShrinkOffset)}shrinkBuffers(e){if(void 0===this.privBuffers)return;this.privLastShrinkOffset=e;const t=e-this.privBufferStartOffset;let r=Math.round(t*this.privBytesPerSecond*1e-7),n=0;for(;n<this.privBuffers.length&&r>=this.privBuffers[n].chunk.buffer.byteLength;)r-=this.privBuffers[n++].chunk.buffer.byteLength;this.privBufferStartOffset=Math.round(e-r/this.privBytesPerSecond*1e7),this.privBuffers=this.privBuffers.slice(n)}findTimeAtOffset(e){if(e<this.privBufferStartOffset||void 0===this.privBuffers)return 0;for(const t of this.privBuffers){const r=t.byteOffset/this.privBytesPerSecond*1e7,n=r+t.chunk.buffer.byteLength/this.privBytesPerSecond*1e7;if(e>=r&&e<=n)return t.chunk.timeReceived}return 0}}class Pe{constructor(e,t,r){this.chunk=e,this.serial=t,this.byteOffset=r}}var Re,Ie,we=r(24),Ee=r(28),Te=r(11);!function(e){e[e.NoError=0]="NoError",e[e.AuthenticationFailure=1]="AuthenticationFailure",e[e.BadRequestParameters=2]="BadRequestParameters",e[e.TooManyRequests=3]="TooManyRequests",e[e.ConnectionFailure=4]="ConnectionFailure",e[e.ServiceTimeout=5]="ServiceTimeout",e[e.ServiceError=6]="ServiceError",e[e.RuntimeError=7]="RuntimeError"}(Re||(Re={}));class Oe{constructor(e){this.privSpeechStartDetected=JSON.parse(e)}static fromJSON(e){return new Oe(e)}get Offset(){return this.privSpeechStartDetected.Offset}}class Ae extends n.b{constructor(e,t,r,i=n.a.Info){super(e,i),this.privRequestId=t,this.privSessionId=r}get requestId(){return this.privRequestId}get sessionId(){return this.privSessionId}}class _e extends Ae{constructor(e,t,r,n){super("RecognitionTriggeredEvent",e,t),this.privAudioSourceId=r,this.privAudioNodeId=n}get audioSourceId(){return this.privAudioSourceId}get audioNodeId(){return this.privAudioNodeId}}class De extends Ae{constructor(e,t,r,n){super("ListeningStartedEvent",e,t),this.privAudioSourceId=r,this.privAudioNodeId=n}get audioSourceId(){return this.privAudioSourceId}get audioNodeId(){return this.privAudioNodeId}}class xe extends Ae{constructor(e,t,r){super("ConnectingToServiceEvent",e,r),this.privAuthFetchEventid=t}get authFetchEventid(){return this.privAuthFetchEventid}}class ke extends Ae{constructor(e,t,r,n,i){super("RecognitionStartedEvent",e,i),this.privAudioSourceId=t,this.privAudioNodeId=r,this.privAuthFetchEventId=n}get audioSourceId(){return this.privAudioSourceId}get audioNodeId(){return this.privAudioNodeId}get authFetchEventId(){return this.privAuthFetchEventId}}!function(e){e[e.Success=0]="Success",e[e.AudioSourceError=1]="AudioSourceError",e[e.AudioSourceTimeout=2]="AudioSourceTimeout",e[e.AuthTokenFetchError=3]="AuthTokenFetchError",e[e.AuthTokenFetchTimeout=4]="AuthTokenFetchTimeout",e[e.UnAuthorized=5]="UnAuthorized",e[e.ConnectTimeout=6]="ConnectTimeout",e[e.ConnectError=7]="ConnectError",e[e.ClientRecognitionActivityTimeout=8]="ClientRecognitionActivityTimeout",e[e.UnknownError=9]="UnknownError"}(Ie||(Ie={}));class Me{constructor(e,t,r){this.privIsDisposed=!1,this.privListeningTriggerMetric=null,this.privMicMetric=null,this.privConnectionEstablishMetric=null,this.onEvent=e=>{this.privIsDisposed||(e instanceof _e&&e.requestId===this.privRequestId&&(this.privListeningTriggerMetric={End:e.eventTime,Name:"ListeningTrigger",Start:e.eventTime}),e instanceof E&&e.audioSourceId===this.privAudioSourceId&&e.audioNodeId===this.privAudioNodeId&&(this.privMicStartTime=e.eventTime),e instanceof T&&e.audioSourceId===this.privAudioSourceId&&e.audioNodeId===this.privAudioNodeId&&(this.privMicStartTime=e.eventTime),e instanceof I&&e.audioSourceId===this.privAudioSourceId&&(this.privMicMetric||(this.privMicMetric={End:e.eventTime,Error:e.error,Name:"Microphone",Start:this.privMicStartTime})),e instanceof A&&e.audioSourceId===this.privAudioSourceId&&e.audioNodeId===this.privAudioNodeId&&(this.privMicMetric||(this.privMicMetric={End:e.eventTime,Error:e.error,Name:"Microphone",Start:this.privMicStartTime})),e instanceof O&&e.audioSourceId===this.privAudioSourceId&&e.audioNodeId===this.privAudioNodeId&&(this.privMicMetric||(this.privMicMetric={End:e.eventTime,Name:"Microphone",Start:this.privMicStartTime})),e instanceof xe&&e.requestId===this.privRequestId&&(this.privConnectionId=e.sessionId),e instanceof Ee.f&&e.connectionId===this.privConnectionId&&(this.privConnectionStartTime=e.eventTime),e instanceof Ee.c&&e.connectionId===this.privConnectionId&&(this.privConnectionEstablishMetric||(this.privConnectionEstablishMetric={End:e.eventTime,Id:this.privConnectionId,Name:"Connection",Start:this.privConnectionStartTime})),e instanceof Ee.b&&e.connectionId===this.privConnectionId&&(this.privConnectionEstablishMetric||(this.privConnectionEstablishMetric={End:e.eventTime,Error:this.getConnectionError(e.statusCode),Id:this.privConnectionId,Name:"Connection",Start:this.privConnectionStartTime})),e instanceof Ee.d&&e.connectionId===this.privConnectionId&&e.message&&e.message.headers&&e.message.headers.path&&(this.privReceivedMessages[e.message.headers.path]||(this.privReceivedMessages[e.message.headers.path]=new Array),this.privReceivedMessages[e.message.headers.path].push(e.networkReceivedTime)))},this.getTelemetry=()=>{const e=new Array;this.privListeningTriggerMetric&&e.push(this.privListeningTriggerMetric),this.privMicMetric&&e.push(this.privMicMetric),this.privConnectionEstablishMetric&&e.push(this.privConnectionEstablishMetric),this.privPhraseLatencies.length>0&&e.push({PhraseLatencyMs:this.privPhraseLatencies}),this.privHypothesisLatencies.length>0&&e.push({FirstHypothesisLatencyMs:this.privHypothesisLatencies});const t={Metrics:e,ReceivedMessages:this.privReceivedMessages},r=JSON.stringify(t);return this.privReceivedMessages={},this.privListeningTriggerMetric=null,this.privMicMetric=null,this.privConnectionEstablishMetric=null,this.privPhraseLatencies=[],this.privHypothesisLatencies=[],r},this.dispose=()=>{this.privIsDisposed=!0},this.getConnectionError=e=>{switch(e){case 400:case 1002:case 1003:case 1005:case 1007:case 1008:case 1009:return"BadRequest";case 401:return"Unauthorized";case 403:return"Forbidden";case 503:case 1001:return"ServerUnavailable";case 500:case 1011:return"ServerError";case 408:case 504:return"Timeout";default:return"statuscode:"+e.toString()}},this.privRequestId=e,this.privAudioSourceId=t,this.privAudioNodeId=r,this.privReceivedMessages={},this.privPhraseLatencies=[],this.privHypothesisLatencies=[]}phraseReceived(e){e>0&&this.privPhraseLatencies.push(Date.now()-e)}hypothesisReceived(e){e>0&&this.privHypothesisLatencies.push(Date.now()-e)}get hasTelemetry(){return 0!==Object.keys(this.privReceivedMessages).length||null!==this.privListeningTriggerMetric||null!==this.privMicMetric||null!==this.privConnectionEstablishMetric||0!==this.privPhraseLatencies.length||0!==this.privHypothesisLatencies.length}}class Ne{constructor(e){this.privIsDisposed=!1,this.privDetachables=new Array,this.privIsAudioNodeDetached=!1,this.privIsRecognizing=!1,this.privIsSpeechEnded=!1,this.privTurnStartAudioOffset=0,this.privLastRecoOffset=0,this.privHypothesisReceived=!1,this.privBytesSent=0,this.privRecogNumber=0,this.onAudioSourceAttachCompleted=(e,t,r)=>{this.privAudioNode=e,this.privIsAudioNodeDetached=!1,t?this.onComplete():this.onEvent(new De(this.privRequestId,this.privSessionId,this.privAudioSourceId,this.privAudioNodeId))},this.onPreConnectionStart=(e,t)=>{this.privAuthFetchEventId=e,this.privSessionId=t,this.onEvent(new xe(this.privRequestId,this.privAuthFetchEventId,this.privSessionId))},this.onAuthCompleted=(e,t)=>{e&&this.onComplete()},this.onConnectionEstablishCompleted=(e,t)=>{if(200===e)return this.onEvent(new ke(this.requestId,this.privAudioSourceId,this.privAudioNodeId,this.privAuthFetchEventId,this.privSessionId)),this.privAudioNode&&this.privAudioNode.replay(),this.privTurnStartAudioOffset=this.privLastRecoOffset,void(this.privBytesSent=0);403===e&&this.onComplete()},this.onServiceTurnEndResponse=e=>{this.privTurnDeferral.resolve(!0),!e||this.isSpeechEnded?this.onComplete():(this.privTurnStartAudioOffset=this.privLastRecoOffset,this.privRequestId=Object(D.b)(),this.privAudioNode.replay())},this.onServiceTurnStartResponse=()=>{this.privTurnDeferral.state()===S.d.None&&this.privTurnDeferral.reject("Another turn started before current completed."),this.privTurnDeferral=new S.a},this.dispose=e=>{if(!this.privIsDisposed){this.privIsDisposed=!0;for(const e of this.privDetachables)e.detach();this.privServiceTelemetryListener.dispose()}},this.getTelemetry=()=>this.privServiceTelemetryListener.hasTelemetry?this.privServiceTelemetryListener.getTelemetry():null,this.onEvent=e=>{this.privServiceTelemetryListener&&this.privServiceTelemetryListener.onEvent(e),p.a.instance.onEvent(e)},this.onComplete=()=>{this.privIsRecognizing&&(this.privIsRecognizing=!1,this.detachAudioNode())},this.detachAudioNode=()=>{this.privIsAudioNodeDetached||(this.privIsAudioNodeDetached=!0,this.privAudioNode&&this.privAudioNode.detach())},this.privAudioSourceId=e,this.privRequestId=Object(D.b)(),this.privAudioNodeId=Object(D.b)(),this.privTurnDeferral=new S.a,this.privTurnDeferral.resolve(!0)}get sessionId(){return this.privSessionId}get requestId(){return this.privRequestId}get audioNodeId(){return this.privAudioNodeId}get turnCompletionPromise(){return this.privTurnDeferral.promise()}get isSpeechEnded(){return this.privIsSpeechEnded}get isRecognizing(){return this.privIsRecognizing}get currentTurnAudioOffset(){return this.privTurnStartAudioOffset}get recogNumber(){return this.privRecogNumber}get bytesSent(){return this.privBytesSent}listenForServiceTelemetry(e){this.privServiceTelemetryListener&&this.privDetachables.push(e.attachListener(this.privServiceTelemetryListener))}startNewRecognition(){this.privIsSpeechEnded=!1,this.privIsRecognizing=!0,this.privTurnStartAudioOffset=0,this.privLastRecoOffset=0,this.privRequestId=Object(D.b)(),this.privRecogNumber++,this.privServiceTelemetryListener=new Me(this.privRequestId,this.privAudioSourceId,this.privAudioNodeId),this.onEvent(new _e(this.requestId,this.privSessionId,this.privAudioSourceId,this.privAudioNodeId))}onHypothesis(e){this.privHypothesisReceived||(this.privHypothesisReceived=!0,this.privServiceTelemetryListener.hypothesisReceived(this.privAudioNode.findTimeAtOffset(e)))}onPhraseRecognized(e){this.privServiceTelemetryListener.phraseReceived(this.privAudioNode.findTimeAtOffset(e)),this.onServiceRecognized(e)}onServiceRecognized(e){this.privLastRecoOffset=e,this.privHypothesisReceived=!1,this.privAudioNode.shrinkBuffers(e)}onAudioSent(e){this.privBytesSent+=e}onStopRecognizing(){this.onComplete()}onSpeechEnded(){this.privIsSpeechEnded=!0}}class je{addPhrase(e){this.privPhrases||(this.privPhrases=[]),e instanceof Array?this.privPhrases=this.privPhrases.concat(e):this.privPhrases.push(e)}clearPhrases(){this.privPhrases=void 0}addReferenceGrammar(e){this.privGrammars||(this.privGrammars=[]),e instanceof Array?this.privGrammars=this.privGrammars.concat(e):this.privGrammars.push(e)}clearGrammars(){this.privGrammars=void 0}generateGrammarObject(){if(void 0===this.privGrammars&&void 0===this.privPhrases)return;const e={};if(e.ReferenceGrammars=this.privGrammars,void 0!==this.privPhrases&&0!==this.privPhrases.length){const t=[];this.privPhrases.forEach((e,r,n)=>{t.push({Text:e})}),e.Groups=[{Type:"Generic",Items:t}]}return e}}class ze{constructor(e){this.privContext={},this.privDynamicGrammar=e}setSection(e,t){this.privContext[e]=t}toJSON(){const e=this.privDynamicGrammar.generateGrammarObject();this.setSection("dgi",e);return JSON.stringify(this.privContext)}}class Le{toJsonString(){return JSON.stringify(this.iPrivConfig)}get(){return this.iPrivConfig}set(e){this.iPrivConfig=e}}class qe extends we.a{constructor(e,t,r,n,i,o,s){if(!t)throw new _.a("path");if(!r)throw new _.a("requestId");const a={};if(a.path=t,a["x-requestid"]=r,a["x-timestamp"]=(new Date).toISOString(),n&&(a["content-type"]=n),o)for(const e in o)e&&(a[e]=o[e]);s?super(e,i,a,s):super(e,i,a),this.privPath=t,this.privRequestId=r,this.privContentType=n,this.privAdditionalHeaders=o}get path(){return this.privPath}get requestId(){return this.privRequestId}get contentType(){return this.privContentType}get additionalHeaders(){return this.privAdditionalHeaders}}qe.fromConnectionMessage=e=>{let t=null,r=null,n=null,i=null;const o={};if(e.headers)for(const s in e.headers)s&&(s.toLowerCase()==="path".toLowerCase()?t=e.headers[s]:s.toLowerCase()==="x-requestid".toLowerCase()?r=e.headers[s]:s.toLowerCase()==="x-timestamp".toLowerCase()?i=e.headers[s]:s.toLowerCase()==="content-type".toLowerCase()?n=e.headers[s]:o[s]=e.headers[s]);return new qe(e.messageType,t,r,n,e.body,o,e.id)};class Be{constructor(e,t,r,n,i){if(this.recognizeOverride=void 0,this.disconnectOverride=void 0,this.sendTelemetryData=()=>{const e=this.privRequestSession.getTelemetry();if(!0!==Be.telemetryDataEnabled||this.privIsDisposed||null===e)return S.c.fromResult(!0);if(Be.telemetryData)try{Be.telemetryData(e)}catch(e){}return this.fetchConnection().onSuccessContinueWith(t=>t.send(new qe(we.b.Text,"telemetry",this.privRequestSession.requestId,"application/json",e)))},this.receiveMessageOverride=void 0,this.receiveMessage=()=>this.fetchConnection().on(e=>e.read().onSuccessContinueWithPromise(e=>{if(void 0!==this.receiveMessageOverride)return this.receiveMessageOverride();if(this.privIsDisposed)return S.c.fromResult(void 0);if(!e)return this.privRequestSession.isRecognizing?this.receiveMessage():S.c.fromResult(!0);this.privServiceHasSentMessage=!0;const t=qe.fromConnectionMessage(e);if(t.requestId.toLowerCase()===this.privRequestSession.requestId.toLowerCase())switch(t.path.toLowerCase()){case"turn.start":this.privMustReportEndOfStream=!0,this.privRequestSession.onServiceTurnStartResponse();break;case"speech.startdetected":const e=Oe.fromJSON(t.textBody),r=new te(e.Offset,this.privRequestSession.sessionId);this.privRecognizer.speechStartDetected&&this.privRecognizer.speechStartDetected(this.privRecognizer,r);break;case"speech.enddetected":let n;n=t.textBody.length>0?t.textBody:"{ Offset: 0 }";const i=Oe.fromJSON(n);this.privRecognizerConfig.isContinuousRecognition&&this.privRequestSession.onServiceRecognized(i.Offset+this.privRequestSession.currentTurnAudioOffset);const o=new te(i.Offset+this.privRequestSession.currentTurnAudioOffset,this.privRequestSession.sessionId);this.privRecognizer.speechEndDetected&&this.privRecognizer.speechEndDetected(this.privRecognizer,o);break;case"turn.end":this.sendTelemetryData(),this.privRequestSession.isSpeechEnded&&this.privMustReportEndOfStream&&(this.privMustReportEndOfStream=!1,this.cancelRecognitionLocal(Y.EndOfStream,Re.NoError,void 0));const s=new ee(this.privRequestSession.sessionId);if(this.privRequestSession.onServiceTurnEndResponse(this.privRecognizerConfig.isContinuousRecognition),!this.privRecognizerConfig.isContinuousRecognition||this.privRequestSession.isSpeechEnded||!this.privRequestSession.isRecognizing)return this.privRecognizer.sessionStopped&&this.privRecognizer.sessionStopped(this.privRecognizer,s),S.c.fromResult(!0);this.fetchConnection().onSuccessContinueWith(e=>{this.sendSpeechContext(e),this.sendWaveHeader(e)});break;default:this.processTypeSpecificMessages(t)||this.privServiceEvents&&this.serviceEvents.onEvent(new Ee.g(t.path.toLowerCase(),t.textBody))}return this.receiveMessage()}),e=>{}),this.sendSpeechContext=e=>{const t=this.speechContext.toJSON();return t?e.send(new qe(we.b.Text,"speech.context",this.privRequestSession.requestId,"application/json",t)):S.c.fromResult(!0)},this.connectImplOverride=void 0,this.configConnectionOverride=void 0,this.fetchConnectionOverride=void 0,this.sendSpeechServiceConfig=(e,t,r)=>{if(!0!==Be.telemetryDataEnabled){const e={context:{system:JSON.parse(r).context.system}};r=JSON.stringify(e)}return r?e.send(new qe(we.b.Text,"speech.config",t.requestId,"application/json",r)):S.c.fromResult(!0)},this.sendAudio=e=>this.audioSource.format.onSuccessContinueWithPromise(t=>{const r=new S.a;let n=Date.now();const i=this.privRecognizerConfig.parameters.getProperty("SPEECH-TransmitLengthBeforThrottleMs","5000"),o=t.avgBytesPerSec/1e3*parseInt(i,10),s=this.privRequestSession.recogNumber,a=()=>{this.privIsDisposed||this.privRequestSession.isSpeechEnded||!this.privRequestSession.isRecognizing||this.privRequestSession.recogNumber!==s||this.fetchConnection().on(i=>{e.read().on(e=>{if(this.privRequestSession.isSpeechEnded)return void r.resolve(!0);let s,c;!e||e.isEnd?(s=null,c=0):(s=e.buffer,this.privRequestSession.onAudioSent(s.byteLength),c=o>=this.privRequestSession.bytesSent?0:Math.max(0,n-Date.now())),setTimeout(()=>{null!==s&&(n=Date.now()+1e3*s.byteLength/(2*t.avgBytesPerSec));const o=i.send(new qe(we.b.Binary,"audio",this.privRequestSession.requestId,null,s));(null==e?void 0:e.isEnd)?(this.privRequestSession.onSpeechEnded(),r.resolve(!0)):o.continueWith(e=>{a()})},c)},e=>{this.privRequestSession.isSpeechEnded?r.resolve(!0):r.reject(e)})},e=>{r.reject(e)})};return a(),r.promise()}),this.fetchConnection=()=>void 0!==this.fetchConnectionOverride?this.fetchConnectionOverride():this.configureConnection(),!e)throw new _.a("authentication");if(!t)throw new _.a("connectionFactory");if(!r)throw new _.a("audioSource");if(!n)throw new _.a("recognizerConfig");this.privMustReportEndOfStream=!1,this.privAuthentication=e,this.privConnectionFactory=t,this.privAudioSource=r,this.privRecognizerConfig=n,this.privIsDisposed=!1,this.privRecognizer=i,this.privRequestSession=new Ne(this.privAudioSource.id()),this.privConnectionEvents=new N.a,this.privServiceEvents=new N.a,this.privDynamicGrammar=new je,this.privSpeechContext=new ze(this.privDynamicGrammar),this.privAgentConfig=new Le}get audioSource(){return this.privAudioSource}get speechContext(){return this.privSpeechContext}get dynamicGrammar(){return this.privDynamicGrammar}get agentConfig(){return this.privAgentConfig}set conversationTranslatorToken(e){this.privRecognizerConfig.parameters.setProperty(de.ConversationTranslator_Token,e)}isDisposed(){return this.privIsDisposed}dispose(e){this.privIsDisposed=!0,this.privConnectionConfigurationPromise&&this.privConnectionConfigurationPromise.onSuccessContinueWith(t=>{t.dispose(e)})}get connectionEvents(){return this.privConnectionEvents}get serviceEvents(){return this.privServiceEvents}get recognitionMode(){return this.privRecognizerConfig.recognitionMode}recognize(e,t,r){return void 0!==this.recognizeOverride?this.recognizeOverride(e,t,r):(this.privConnectionConfigurationPromise=null,this.privRecognizerConfig.recognitionMode=e,this.privSuccessCallback=t,this.privErrorCallback=r,this.privRequestSession.startNewRecognition(),this.privRequestSession.listenForServiceTelemetry(this.privAudioSource.events),this.connectImpl(),this.audioSource.attach(this.privRequestSession.audioNodeId).onSuccessContinueWithPromise(e=>{let t;return this.audioSource.format.onSuccessContinueWithPromise(r=>(t=new be(e,r.avgBytesPerSec),this.privRequestSession.onAudioSourceAttachCompleted(t,!1),this.audioSource.deviceInfo.onSuccessContinueWithPromise(e=>(this.privRecognizerConfig.SpeechServiceConfig.Context.audio={source:e},this.configureConnection().continueWithPromise(e=>{if(e.isError)return this.cancelRecognitionLocal(Y.Error,Re.ConnectionFailure,e.error),S.c.fromError(e.error);const r=new ee(this.privRequestSession.sessionId);this.privRecognizer.sessionStarted&&this.privRecognizer.sessionStarted(this.privRecognizer,r);this.receiveMessage();return this.sendAudio(t).on(e=>{},e=>{this.cancelRecognitionLocal(Y.Error,Re.RuntimeError,e)}),S.c.fromResult(!0)})))))}))}stopRecognizing(){return this.privRequestSession.isRecognizing?(this.audioSource.turnOff(),this.sendFinalAudio().onSuccessContinueWithPromise(e=>(this.privRequestSession.onStopRecognizing(),this.privRequestSession.turnCompletionPromise.onSuccessContinueWith(e=>(this.privRequestSession.onStopRecognizing(),this.privRequestSession.dispose(),!0))))):S.c.fromResult(!0)}connect(){this.connectImpl().result()}connectAsync(e,t){this.connectImpl().continueWith(r=>{try{r.isError?t&&t(r.error):r.isCompleted&&e&&e()}catch(e){t&&t(e)}})}disconnect(){void 0===this.disconnectOverride?(this.cancelRecognitionLocal(Y.Error,Re.NoError,"Disconnecting"),this.privConnectionPromise.result().isCompleted?this.privConnectionPromise.result().isError||(this.privConnectionPromise.result().result.dispose(),this.privConnectionPromise=null):this.privConnectionPromise.onSuccessContinueWith(e=>{e.dispose()})):this.disconnectOverride()}disconnectAsync(e,t){try{if(void 0!==this.disconnectOverride)return this.disconnectOverride(),void(e&&e());this.cancelRecognitionLocal(Y.Error,Re.NoError,"Disconnecting"),this.privConnectionPromise.continueWith(r=>{try{r.isError?t&&t(r.error):r.isCompleted&&(r.result.dispose(),e&&e())}catch(e){t&&t(e)}})}catch(e){t&&t(e)}}sendMessage(e){}set activityTemplate(e){this.privActivityTemplate=e}get activityTemplate(){return this.privActivityTemplate}cancelRecognitionLocal(e,t,r){this.privRequestSession.isRecognizing&&(this.privRequestSession.onStopRecognizing(),this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,e,t,r))}sendWaveHeader(e){return this.audioSource.format.onSuccessContinueWithPromise(t=>e.send(new qe(we.b.Binary,"audio",this.privRequestSession.requestId,"audio/x-wav",t.header)))}connectImpl(e=!1){if(void 0!==this.connectImplOverride)return this.connectImplOverride(e);if(this.privConnectionPromise)return this.privConnectionPromise.result().isCompleted&&(this.privConnectionPromise.result().isError||this.privConnectionPromise.result().result.state()===Te.a.Disconnected)&&!0===this.privServiceHasSentMessage?(this.privConnectionId=null,this.privConnectionPromise=null,this.privServiceHasSentMessage=!1,this.connectImpl()):this.privConnectionPromise;this.privAuthFetchEventId=Object(D.b)(),this.privConnectionId=Object(D.b)(),this.privRequestSession.onPreConnectionStart(this.privAuthFetchEventId,this.privConnectionId);const t=e?this.privAuthentication.fetchOnExpiry(this.privAuthFetchEventId):this.privAuthentication.fetch(this.privAuthFetchEventId);return this.privConnectionPromise=t.continueWithPromise(t=>{if(t.isError)throw this.privRequestSession.onAuthCompleted(!0,t.error),new Error(t.error);this.privRequestSession.onAuthCompleted(!1);const r=this.privConnectionFactory.create(this.privRecognizerConfig,t.result,this.privConnectionId);return this.privRequestSession.listenForServiceTelemetry(r.events),r.events.attach(e=>{this.connectionEvents.onEvent(e)}),r.open().onSuccessContinueWithPromise(t=>200===t.statusCode?(this.privRequestSession.onPreConnectionStart(this.privAuthFetchEventId,this.privConnectionId),this.privRequestSession.onConnectionEstablishCompleted(t.statusCode),S.c.fromResult(r)):403!==t.statusCode||e?(this.privRequestSession.onConnectionEstablishCompleted(t.statusCode,t.reason),S.c.fromError(`Unable to contact server. StatusCode: ${t.statusCode}, ${this.privRecognizerConfig.parameters.getProperty(de.SpeechServiceConnection_Endpoint)} Reason: ${t.reason}`)):this.connectImpl(!0))}),this.privConnectionPromise}writeBufferToConsole(e){let t="Buffer Size: ";if(null===e)t+="null";else{const r=new Uint8Array(e);t+=e.byteLength+"\r\n";for(let n=0;n<e.byteLength;n++)t+=r[n].toString(16).padStart(2,"0")+" "}console.info(t)}sendFinalAudio(){const e=new S.a;return this.fetchConnection().on(t=>{t.send(new qe(we.b.Binary,"audio",this.privRequestSession.requestId,null,null)).on(t=>{e.resolve(!0)},t=>{e.reject(t)})},t=>{e.reject(t)}),e.promise()}configureConnection(){return void 0!==this.configConnectionOverride?this.configConnectionOverride():this.privConnectionConfigurationPromise?this.privConnectionConfigurationPromise.result().isCompleted&&(this.privConnectionConfigurationPromise.result().isError||this.privConnectionConfigurationPromise.result().result.state()===Te.a.Disconnected)?(this.privConnectionConfigurationPromise=null,this.configureConnection()):this.privConnectionConfigurationPromise:(this.privConnectionConfigurationPromise=this.connectImpl().onSuccessContinueWithPromise(e=>this.sendSpeechServiceConfig(e,this.privRequestSession,this.privRecognizerConfig.SpeechServiceConfig.serialize()).onSuccessContinueWithPromise(t=>this.sendSpeechContext(e).onSuccessContinueWithPromise(t=>this.sendWaveHeader(e).onSuccessContinueWith(t=>e)))),this.privConnectionConfigurationPromise)}}Be.telemetryDataEnabled=!0;class Ue{constructor(e,t){this.privHeaderName=e,this.privToken=t}get headerName(){return this.privHeaderName}get token(){return this.privToken}}class Fe{constructor(e){if(this.fetch=e=>S.c.fromResult(this.privAuthInfo),this.fetchOnExpiry=e=>S.c.fromResult(this.privAuthInfo),!e)throw new _.a("subscriptionKey");this.privAuthInfo=new Ue("Ocp-Apim-Subscription-Key",e)}}class We{constructor(e,t){if(this.fetch=e=>this.privFetchCallback(e).onSuccessContinueWith(e=>new Ue("Authorization",e)),this.fetchOnExpiry=e=>this.privFetchOnExpiryCallback(e).onSuccessContinueWith(e=>new Ue("Authorization",e)),!e)throw new _.a("fetchCallback");if(!t)throw new _.a("fetchOnExpiryCallback");this.privFetchCallback=e,this.privFetchOnExpiryCallback=t}}class He{constructor(e,t,r){this.audioConfig=void 0!==e?e:V.fromDefaultMicrophoneInput(),this.privDisposed=!1,this.privProperties=t.clone(),this.privConnectionFactory=r,this.implCommonRecognizerSetup()}close(){L.throwIfDisposed(this.privDisposed),this.dispose(!0)}get internalData(){return this.privReco}dispose(e){this.privDisposed||(e&&this.privReco&&(this.privReco.audioSource.turnOff(),this.privReco.dispose()),this.privDisposed=!0)}static get telemetryEnabled(){return Be.telemetryDataEnabled}static enableTelemetry(e){Be.telemetryDataEnabled=e}implCommonRecognizerSetup(){let e="undefined"!=typeof window?"Browser":"Node",t="unknown",r="unknown";"undefined"!=typeof navigator&&(e=e+"/"+navigator.platform,t=navigator.userAgent,r=navigator.appVersion);const n=this.createRecognizerConfig(new f(new g(new m(e,t,r)))),i=this.privProperties.getProperty(de.SpeechServiceConnection_Key,void 0),o=i&&""!==i?new Fe(i):new We(e=>{const t=this.privProperties.getProperty(de.SpeechServiceAuthorization_Token,void 0);return S.c.fromResult(t)},e=>{const t=this.privProperties.getProperty(de.SpeechServiceAuthorization_Token,void 0);return S.c.fromResult(t)});this.privReco=this.createServiceRecognizer(o,this.privConnectionFactory,this.audioConfig,n)}recognizeOnceAsyncImpl(e,t,r){try{L.throwIfDisposed(this.privDisposed),this.implRecognizerStop().on(n=>{try{this.privReco.recognize(e,e=>{this.implRecognizerStop().on(r=>{t&&t(e)},e=>{r&&r(e)})},e=>{this.implRecognizerStop(),r&&r(e)}).on(e=>{},e=>{r&&r(e)})}catch(e){if(r)if(e instanceof Error){const t=e;r(t.name+": "+t.message)}else r(e);this.dispose(!0)}},e=>{r&&r(e)})}catch(e){if(r)if(e instanceof Error){const t=e;r(t.name+": "+t.message)}else r(e);this.dispose(!0)}}startContinuousRecognitionAsyncImpl(e,t,r){try{L.throwIfDisposed(this.privDisposed),this.implRecognizerStop().on(n=>{this.privReco.recognize(e,void 0,void 0).on(e=>{if(t){try{t()}catch(e){r&&r(e)}t=void 0}},e=>{r&&r(e),this.dispose(!0)})},e=>{r&&r(e),this.dispose(!0)})}catch(e){if(r)if(e instanceof Error){const t=e;r(t.name+": "+t.message)}else r(e);this.dispose(!0)}}stopContinuousRecognitionAsyncImpl(e,t){try{L.throwIfDisposed(this.privDisposed),this.implRecognizerStop().on(r=>{if(e)try{e()}catch(e){t&&t(e)}},e=>{t&&t(e)})}catch(e){if(t)if(e instanceof Error){const r=e;t(r.name+": "+r.message)}else t(e);this.dispose(!0)}}implRecognizerStop(){return this.privReco?this.privReco.stopRecognizing():S.c.fromResult(!0)}}class Ve{constructor(e){this.privSpeechHypothesis=JSON.parse(e)}static fromJSON(e){return new Ve(e)}get Text(){return this.privSpeechHypothesis.Text}get Offset(){return this.privSpeechHypothesis.Offset}get Duration(){return this.privSpeechHypothesis.Duration}}var Je,Ge;!function(e){e[e.Success=0]="Success",e[e.SynthesisEnd=1]="SynthesisEnd",e[e.Error=2]="Error"}(Je||(Je={})),function(e){e[e.Success=0]="Success",e[e.NoMatch=1]="NoMatch",e[e.InitialSilenceTimeout=2]="InitialSilenceTimeout",e[e.BabbleTimeout=3]="BabbleTimeout",e[e.Error=4]="Error",e[e.EndOfDictation=5]="EndOfDictation",e[e.TooManyRequests=6]="TooManyRequests"}(Ge||(Ge={}));class Ke{constructor(e){this.privSimpleSpeechPhrase=JSON.parse(e),this.privSimpleSpeechPhrase.RecognitionStatus=Ge[this.privSimpleSpeechPhrase.RecognitionStatus]}static fromJSON(e){return new Ke(e)}get RecognitionStatus(){return this.privSimpleSpeechPhrase.RecognitionStatus}get DisplayText(){return this.privSimpleSpeechPhrase.DisplayText}get Offset(){return this.privSimpleSpeechPhrase.Offset}get Duration(){return this.privSimpleSpeechPhrase.Duration}}class Qe{static implTranslateRecognitionResult(e){let t=X.Canceled;switch(e){case Ge.Success:t=X.RecognizedSpeech;break;case Ge.NoMatch:case Ge.InitialSilenceTimeout:case Ge.BabbleTimeout:case Ge.EndOfDictation:t=X.NoMatch;break;case Ge.Error:default:t=X.Canceled}return t}static implTranslateCancelResult(e){let t=Y.EndOfStream;switch(e){case Ge.Success:case Ge.EndOfDictation:case Ge.NoMatch:t=Y.EndOfStream;break;case Ge.InitialSilenceTimeout:case Ge.BabbleTimeout:case Ge.Error:default:t=Y.Error}return t}static implTranslateCancelErrorCode(e){let t=Re.NoError;switch(e){case Ge.Error:t=Re.ServiceError;break;case Ge.TooManyRequests:t=Re.TooManyRequests;break;default:t=Re.NoError}return t}}class Ye{constructor(e){this.privDetailedSpeechPhrase=JSON.parse(e),this.privDetailedSpeechPhrase.RecognitionStatus=Ge[this.privDetailedSpeechPhrase.RecognitionStatus]}static fromJSON(e){return new Ye(e)}get RecognitionStatus(){return this.privDetailedSpeechPhrase.RecognitionStatus}get NBest(){return this.privDetailedSpeechPhrase.NBest}get Duration(){return this.privDetailedSpeechPhrase.Duration}get Offset(){return this.privDetailedSpeechPhrase.Offset}}class $e extends Be{constructor(e,t,r,n,i){super(e,t,r,n,i),this.privSpeechRecognizer=i}processTypeSpecificMessages(e){let t;const r=new ge;r.setProperty(de.SpeechServiceResponse_JsonResult,e.textBody);let n=!1;switch(e.path.toLowerCase()){case"speech.hypothesis":case"speech.fragment":const i=Ve.fromJSON(e.textBody),o=i.Offset+this.privRequestSession.currentTurnAudioOffset;t=new ie(this.privRequestSession.requestId,X.RecognizingSpeech,i.Text,i.Duration,o,void 0,e.textBody,r),this.privRequestSession.onHypothesis(o);const s=new ce(t,i.Duration,this.privRequestSession.sessionId);if(this.privSpeechRecognizer.recognizing)try{this.privSpeechRecognizer.recognizing(this.privSpeechRecognizer,s)}catch(e){}n=!0;break;case"speech.phrase":const a=Ke.fromJSON(e.textBody),c=Qe.implTranslateRecognitionResult(a.RecognitionStatus);if(this.privRequestSession.onPhraseRecognized(this.privRequestSession.currentTurnAudioOffset+a.Offset+a.Duration),X.Canceled===c){const e=Qe.implTranslateCancelResult(a.RecognitionStatus);this.cancelRecognitionLocal(e,Qe.implTranslateCancelErrorCode(a.RecognitionStatus),void 0)}else{if(!this.privRequestSession.isSpeechEnded||c!==X.NoMatch||a.RecognitionStatus===Ge.InitialSilenceTimeout){if(this.privRecognizerConfig.parameters.getProperty("OutputFormat")===$[$.Simple])t=new ie(this.privRequestSession.requestId,c,a.DisplayText,a.Duration,a.Offset+this.privRequestSession.currentTurnAudioOffset,void 0,e.textBody,r);else{const n=Ye.fromJSON(e.textBody);t=new ie(this.privRequestSession.requestId,c,n.RecognitionStatus===Ge.Success?n.NBest[0].Display:void 0,n.Duration,n.Offset+this.privRequestSession.currentTurnAudioOffset,void 0,e.textBody,r)}const n=new ce(t,t.offset,this.privRequestSession.sessionId);if(this.privSpeechRecognizer.recognized)try{this.privSpeechRecognizer.recognized(this.privSpeechRecognizer,n)}catch(e){}}if(this.privSuccessCallback){try{this.privSuccessCallback(t)}catch(e){this.privErrorCallback&&this.privErrorCallback(e)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}n=!0}return n}cancelRecognition(e,t,r,n,i){const o=new ge;if(o.setProperty("CancellationErrorCode",Re[n]),this.privSpeechRecognizer.canceled){const t=new pe(r,i,n,void 0,e);try{this.privSpeechRecognizer.canceled(this.privSpeechRecognizer,t)}catch(e){}}if(this.privSuccessCallback){const e=new ie(t,X.Canceled,void 0,void 0,void 0,i,void 0,o);try{this.privSuccessCallback(e),this.privSuccessCallback=void 0}catch(e){}}}}var Xe=r(126);class Ze{constructor(e,t,r,n,i,o){if(this.privIsDisposed=!1,this.dispose=()=>{this.privIsDisposed=!0,this.privConnectionMessageAdapter&&this.privConnectionMessageAdapter.close()},this.isDisposed=()=>this.privIsDisposed,this.state=()=>this.privConnectionMessageAdapter.state,this.open=()=>this.privConnectionMessageAdapter.open(),this.send=e=>this.privConnectionMessageAdapter.send(e),this.read=()=>this.privConnectionMessageAdapter.read(),!e)throw new _.a("uri");if(!n)throw new _.a("messageFormatter");this.privMessageFormatter=n;let s="",a=0;if(t)for(const r in t)if(r){s+=0===a&&-1===e.indexOf("?")?"?":"&";s+=`${r}=${encodeURIComponent(t[r])}`,a++}if(r)for(const e in r)if(e){s+=0===a?"?":"&";s+=`${e}=${encodeURIComponent(r[e])}`,a++}this.privUri=e+s,this.privId=o||Object(D.b)(),this.privConnectionMessageAdapter=new Xe.a(this.privUri,this.id,this.privMessageFormatter,i,r)}get id(){return this.privId}get events(){return this.privConnectionMessageAdapter.events}}class et{constructor(e,t,r,n){this.privProxyHostName=e,this.privProxyPort=t,this.privProxyUserName=r,this.privProxyPassword=n}static fromRecognizerConfig(e){return new et(e.parameters.getProperty(de.SpeechServiceConnection_ProxyHostName),parseInt(e.parameters.getProperty(de.SpeechServiceConnection_ProxyPort),10),e.parameters.getProperty(de.SpeechServiceConnection_ProxyUserName),e.parameters.getProperty(de.SpeechServiceConnection_ProxyPassword))}get HostName(){return this.privProxyHostName}get Port(){return this.privProxyPort}get UserName(){return this.privProxyUserName}get Password(){return this.privProxyPassword}}class tt{static get TestHooksParamName(){return"testhooks"}static get ConnectionIdHeader(){return"X-ConnectionId"}static get DeploymentIdParamName(){return"cid"}static get FormatParamName(){return"format"}static get LanguageParamName(){return"language"}static get TranslationFromParamName(){return"from"}static get TranslationToParamName(){return"to"}static get Profanify(){return"profanity"}static get EnableAudioLogging(){return"storeAudio"}static get EnableWordLevelTimestamps(){return"wordLevelTimestamps"}static get InitialSilenceTimeoutMs(){return"initialSilenceTimeoutMs"}static get EndSilenceTimeoutMs(){return"endSilenceTimeoutMs"}static get StableIntermediateThreshold(){return"stableIntermediateThreshold"}static get StableTranslation(){return"stableTranslation"}}class rt{setCommonUrlParams(e,t,r){this.setUrlParameter(de.SpeechServiceConnection_EnableAudioLogging,tt.EnableAudioLogging,e,t,r),this.setUrlParameter(de.SpeechServiceResponse_RequestWordLevelTimestamps,tt.EnableWordLevelTimestamps,e,t,r),this.setUrlParameter(de.SpeechServiceResponse_ProfanityOption,tt.Profanify,e,t,r),this.setUrlParameter(de.SpeechServiceConnection_InitialSilenceTimeoutMs,tt.InitialSilenceTimeoutMs,e,t,r),this.setUrlParameter(de.SpeechServiceConnection_EndSilenceTimeoutMs,tt.EndSilenceTimeoutMs,e,t,r),this.setUrlParameter(de.SpeechServiceResponse_StablePartialResultThreshold,tt.StableIntermediateThreshold,e,t,r);const n=JSON.parse(e.parameters.getProperty("ServiceProperties","{}"));Object.keys(n).forEach((e,r,i)=>{t[e]=n[e]})}setUrlParameter(e,t,r,n,i){const o=r.parameters.getProperty(e,void 0);!o||i&&-1!==i.search(t)||(n[t]=o.toLocaleLowerCase())}}var nt=r(128);class it{constructor(){this.toConnectionMessage=e=>{const t=new S.a;try{if(e.messageType===we.b.Text){const r=e.textContent;let n={},i=null;if(r){const e=r.split("\r\n\r\n");e&&e.length>0&&(n=this.parseHeaders(e[0]),e.length>1&&(i=e[1]))}t.resolve(new we.a(e.messageType,i,n,e.id))}else if(e.messageType===we.b.Binary){const r=e.binaryContent;let n={},i=null;if(!r||r.byteLength<2)throw new Error("Invalid binary message format. Header length missing.");const o=new DataView(r),s=o.getInt16(0);if(r.byteLength<s+2)throw new Error("Invalid binary message format. Header content missing.");let a="";for(let e=0;e<s;e++)a+=String.fromCharCode(o.getInt8(e+2));n=this.parseHeaders(a),r.byteLength>s+2&&(i=r.slice(2+s)),t.resolve(new we.a(e.messageType,i,n,e.id))}}catch(e){t.reject("Error formatting the message. Error: "+e)}return t.promise()},this.fromConnectionMessage=e=>{const t=new S.a;try{if(e.messageType===we.b.Text){const r=`${this.makeHeaders(e)}\r\n${e.textBody?e.textBody:""}`;t.resolve(new nt.a(we.b.Text,r,e.id))}else if(e.messageType===we.b.Binary){const r=this.makeHeaders(e),n=e.binaryBody,i=new Int8Array(this.stringToArrayBuffer(r)),o=new ArrayBuffer(2+i.byteLength+(n?n.byteLength:0)),s=new DataView(o);s.setInt16(0,i.length);for(let e=0;e<i.byteLength;e++)s.setInt8(2+e,i[e]);if(n){const e=new Int8Array(n);for(let t=0;t<e.byteLength;t++)s.setInt8(2+i.byteLength+t,e[t])}t.resolve(new nt.a(we.b.Binary,o,e.id))}}catch(e){t.reject("Error formatting the message. "+e)}return t.promise()},this.makeHeaders=e=>{let t="";if(e.headers)for(const r in e.headers)r&&(t+=`${r}: ${e.headers[r]}\r\n`);return t},this.parseHeaders=e=>{const t={};if(e){const r=e.match(/[^\r\n]+/g);if(t)for(const e of r)if(e){const r=e.indexOf(":"),n=r>0?e.substr(0,r).trim().toLowerCase():e,i=r>0&&e.length>r+1?e.substr(r+1).trim():"";t[n]=i}}return t},this.stringToArrayBuffer=e=>{const t=new ArrayBuffer(e.length),r=new DataView(t);for(let t=0;t<e.length;t++)r.setUint8(t,e.charCodeAt(t));return t}}}class ot extends rt{constructor(){super(...arguments),this.interactiveRelativeUri="/speech/recognition/interactive/cognitiveservices/v1",this.conversationRelativeUri="/speech/recognition/conversation/cognitiveservices/v1",this.dictationRelativeUri="/speech/recognition/dictation/cognitiveservices/v1",this.create=(e,t,r)=>{let n=e.parameters.getProperty(de.SpeechServiceConnection_Endpoint,void 0);const o=e.parameters.getProperty(de.SpeechServiceConnection_Region,void 0),s=e.parameters.getProperty(de.SpeechServiceConnection_Host,"wss://"+o+".stt.speech.microsoft.com"),a={},c=e.parameters.getProperty(de.SpeechServiceConnection_EndpointId,void 0),p=e.parameters.getProperty(de.SpeechServiceConnection_RecoLanguage,void 0);if(c?n&&-1!==n.search(tt.DeploymentIdParamName)||(a[tt.DeploymentIdParamName]=c):p&&(n&&-1!==n.search(tt.LanguageParamName)||(a[tt.LanguageParamName]=p)),n&&-1!==n.search(tt.FormatParamName)||(a[tt.FormatParamName]=e.parameters.getProperty("OutputFormat",$[$.Simple]).toLowerCase()),this.setCommonUrlParams(e,a,n),!n)switch(e.recognitionMode){case i.Conversation:n="true"===e.parameters.getProperty("ForceDication","false")?s+this.dictationRelativeUri:s+this.conversationRelativeUri;break;case i.Dictation:n=s+this.dictationRelativeUri;break;default:n=s+this.interactiveRelativeUri}const u={};return void 0!==t.token&&""!==t.token&&(u[t.headerName]=t.token),u[tt.ConnectionIdHeader]=r,e.parameters.setProperty(de.SpeechServiceConnection_Url,n),new Ze(n,a,u,new it,et.fromRecognizerConfig(e),r)}}}class st extends He{constructor(e,t){const r=e;L.throwIfNull(r,"speechConfig"),L.throwIfNullOrWhitespace(r.properties.getProperty(de.SpeechServiceConnection_RecoLanguage),de[de.SpeechServiceConnection_RecoLanguage]),super(t,r.properties,new ot),this.privDisposedSpeechRecognizer=!1}get endpointId(){return L.throwIfDisposed(this.privDisposedSpeechRecognizer),this.properties.getProperty(de.SpeechServiceConnection_EndpointId,"00000000-0000-0000-0000-000000000000")}get authorizationToken(){return this.properties.getProperty(de.SpeechServiceAuthorization_Token)}set authorizationToken(e){L.throwIfNullOrWhitespace(e,"token"),this.properties.setProperty(de.SpeechServiceAuthorization_Token,e)}get speechRecognitionLanguage(){return L.throwIfDisposed(this.privDisposedSpeechRecognizer),this.properties.getProperty(de.SpeechServiceConnection_RecoLanguage)}get outputFormat(){return L.throwIfDisposed(this.privDisposedSpeechRecognizer),this.properties.getProperty("OutputFormat",$[$.Simple])===$[$.Simple]?$.Simple:$.Detailed}get properties(){return this.privProperties}recognizeOnceAsync(e,t){this.recognizeOnceAsyncImpl(i.Interactive,e,t)}startContinuousRecognitionAsync(e,t){this.startContinuousRecognitionAsyncImpl(i.Conversation,e,t)}stopContinuousRecognitionAsync(e,t){this.stopContinuousRecognitionAsyncImpl(e,t)}startKeywordRecognitionAsync(e,t,r){L.throwIfNull(e,"model"),r&&r("Not yet implemented.")}stopKeywordRecognitionAsync(e,t){e&&e()}close(){L.throwIfDisposed(this.privDisposedSpeechRecognizer),this.dispose(!0)}dispose(e){this.privDisposedSpeechRecognizer||(e&&(this.implRecognizerStop(),this.privDisposedSpeechRecognizer=!0),super.dispose(e))}createRecognizerConfig(e){return new d(e,this.properties)}createServiceRecognizer(e,t,r,n){return new $e(e,t,r,n,this)}}class at extends rt{constructor(){super(...arguments),this.create=(e,t,r)=>{let n=e.parameters.getProperty(de.SpeechServiceConnection_Endpoint);if(!n){const t=e.parameters.getProperty(de.SpeechServiceConnection_IntentRegion);n=e.parameters.getProperty(de.SpeechServiceConnection_Host,"wss://speech.platform.bing.com")+"/speech/"+this.getSpeechRegionFromIntentRegion(t)+"/recognition/interactive/cognitiveservices/v1"}const i={format:"simple",language:e.parameters.getProperty(de.SpeechServiceConnection_RecoLanguage)};this.setCommonUrlParams(e,i,n);const o={};return void 0!==t.token&&""!==t.token&&(o[t.headerName]=t.token),o["X-ConnectionId"]=r,e.parameters.setProperty(de.SpeechServiceConnection_Url,n),new Ze(n,i,o,new it,et.fromRecognizerConfig(e),r)}}getSpeechRegionFromIntentRegion(e){switch(e){case"West US":case"US West":case"westus":return"uswest";case"West US 2":case"US West 2":case"westus2":return"uswest2";case"South Central US":case"US South Central":case"southcentralus":return"ussouthcentral";case"West Central US":case"US West Central":case"westcentralus":return"uswestcentral";case"East US":case"US East":case"eastus":return"useast";case"East US 2":case"US East 2":case"eastus2":return"useast2";case"West Europe":case"Europe West":case"westeurope":return"europewest";case"North Europe":case"Europe North":case"northeurope":return"europenorth";case"Brazil South":case"South Brazil":case"southbrazil":return"brazilsouth";case"Australia East":case"East Australia":case"eastaustralia":return"australiaeast";case"Southeast Asia":case"Asia Southeast":case"southeastasia":return"asiasoutheast";case"East Asia":case"Asia East":case"eastasia":return"asiaeast";default:return e}}}class ct{constructor(e,t){this.modelImpl=e,this.intentName=t}}class pt extends re{constructor(e,t,r,n,i,o){super(n,i,o),this.privReason=e,this.privErrorDetails=t,this.privErrorCode=r}get reason(){return this.privReason}get errorCode(){return this.privErrorCode}get errorDetails(){return this.privErrorDetails}}class ut{constructor(e){this.privIntentResponse=JSON.parse(e)}static fromJSON(e){return new ut(e)}get query(){return this.privIntentResponse.query}get topScoringIntent(){return this.privIntentResponse.topScoringIntent}get entities(){return this.privIntentResponse.entities}}class ht extends Be{constructor(e,t,r,n,i){super(e,t,r,n,i),this.privIntentRecognizer=i,this.privIntentDataSent=!1}setIntents(e,t){this.privAddedLmIntents=e,this.privUmbrellaIntent=t,this.privIntentDataSent=!0}processTypeSpecificMessages(e){let t,r,n=!1;const i=new ge;switch(e.messageType===we.b.Text&&i.setProperty(de.SpeechServiceResponse_JsonResult,e.textBody),e.path.toLowerCase()){case"speech.hypothesis":const o=Ve.fromJSON(e.textBody);if(t=new oe(void 0,this.privRequestSession.requestId,X.RecognizingIntent,o.Text,o.Duration,o.Offset+this.privRequestSession.currentTurnAudioOffset,void 0,e.textBody,i),this.privRequestSession.onHypothesis(t.offset),r=new re(t,o.Offset+this.privRequestSession.currentTurnAudioOffset,this.privRequestSession.sessionId),this.privIntentRecognizer.recognizing)try{this.privIntentRecognizer.recognizing(this.privIntentRecognizer,r)}catch(e){}n=!0;break;case"speech.phrase":const s=Ke.fromJSON(e.textBody);t=new oe(void 0,this.privRequestSession.requestId,Qe.implTranslateRecognitionResult(s.RecognitionStatus),s.DisplayText,s.Duration,s.Offset+this.privRequestSession.currentTurnAudioOffset,void 0,e.textBody,i),r=new re(t,t.offset,this.privRequestSession.sessionId);const a=()=>{if(this.privIntentRecognizer.recognized)try{this.privIntentRecognizer.recognized(this.privIntentRecognizer,r)}catch(e){}if(this.privSuccessCallback){try{this.privSuccessCallback(t)}catch(e){this.privErrorCallback&&this.privErrorCallback(e)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}};!1===this.privIntentDataSent||X.NoMatch===r.result.reason?(this.privRequestSession.onPhraseRecognized(r.offset+r.result.duration),a()):this.privPendingIntentArgs=r,n=!0;break;case"response":if(r=this.privPendingIntentArgs,this.privPendingIntentArgs=void 0,void 0===r){if(""===e.textBody)return;r=new re(new oe,0,this.privRequestSession.sessionId)}const c=ut.fromJSON(e.textBody);let p=this.privAddedLmIntents[c.topScoringIntent.intent];if(void 0!==this.privUmbrellaIntent&&(p=this.privUmbrellaIntent),null!==c&&void 0!==p){const t=void 0===p.intentName?c.topScoringIntent.intent:p.intentName;let n=r.result.reason;void 0!==t&&(n=X.RecognizedIntent);const i=void 0!==r.result.properties?r.result.properties:new ge;i.setProperty(de.LanguageUnderstandingServiceResponse_JsonResult,e.textBody),r=new re(new oe(t,r.result.resultId,n,r.result.text,r.result.duration,r.result.offset,r.result.errorDetails,r.result.json,i),r.offset,r.sessionId)}if(this.privRequestSession.onPhraseRecognized(r.offset+r.result.duration),this.privIntentRecognizer.recognized)try{this.privIntentRecognizer.recognized(this.privIntentRecognizer,r)}catch(e){}if(this.privSuccessCallback){try{this.privSuccessCallback(r.result)}catch(e){this.privErrorCallback&&this.privErrorCallback(e)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}n=!0}return n}cancelRecognition(e,t,r,n,i){const o=new ge;if(o.setProperty("CancellationErrorCode",Re[n]),this.privIntentRecognizer.canceled){const t=new pt(r,i,n,void 0,void 0,e);try{this.privIntentRecognizer.canceled(this.privIntentRecognizer,t)}catch(e){}}if(this.privSuccessCallback){const e=new oe(void 0,t,X.Canceled,void 0,void 0,void 0,i,void 0,o);try{this.privSuccessCallback(e),this.privSuccessCallback=void 0}catch(e){}}}}class vt extends He{constructor(e,t){L.throwIfNullOrUndefined(e,"speechConfig");const r=e;L.throwIfNullOrUndefined(r,"speechConfig"),super(t,r.properties,new at),this.privAddedIntents=[],this.privAddedLmIntents={},this.privDisposedIntentRecognizer=!1,this.privProperties=r.properties,L.throwIfNullOrWhitespace(this.properties.getProperty(de.SpeechServiceConnection_RecoLanguage),de[de.SpeechServiceConnection_RecoLanguage])}get speechRecognitionLanguage(){return L.throwIfDisposed(this.privDisposedIntentRecognizer),this.properties.getProperty(de.SpeechServiceConnection_RecoLanguage)}get authorizationToken(){return this.properties.getProperty(de.SpeechServiceAuthorization_Token)}set authorizationToken(e){this.properties.setProperty(de.SpeechServiceAuthorization_Token,e)}get properties(){return this.privProperties}recognizeOnceAsync(e,t){if(L.throwIfDisposed(this.privDisposedIntentRecognizer),0!==Object.keys(this.privAddedLmIntents).length||void 0!==this.privUmbrellaIntent){const e=this.buildSpeechContext();this.privReco.speechContext.setSection("intent",e.Intent),this.privReco.dynamicGrammar.addReferenceGrammar(e.ReferenceGrammars);this.privReco.setIntents(this.privAddedLmIntents,this.privUmbrellaIntent)}this.recognizeOnceAsyncImpl(i.Interactive,e,t)}startContinuousRecognitionAsync(e,t){if(0!==Object.keys(this.privAddedLmIntents).length){const e=this.buildSpeechContext();this.privReco.speechContext.setSection("intent",e.Intent),this.privReco.dynamicGrammar.addReferenceGrammar(e.ReferenceGrammars);this.privReco.setIntents(this.privAddedLmIntents,this.privUmbrellaIntent)}this.startContinuousRecognitionAsyncImpl(i.Conversation,e,t)}stopContinuousRecognitionAsync(e,t){this.stopContinuousRecognitionAsyncImpl(e,t)}startKeywordRecognitionAsync(e,t,r){L.throwIfNull(e,"model"),r&&r("Not yet implemented.")}stopKeywordRecognitionAsync(e,t){e&&e()}addIntent(e,t){L.throwIfDisposed(this.privDisposedIntentRecognizer),L.throwIfNullOrWhitespace(t,"intentId"),L.throwIfNullOrWhitespace(e,"simplePhrase"),this.privAddedIntents.push([t,e])}addIntentWithLanguageModel(e,t,r){L.throwIfDisposed(this.privDisposedIntentRecognizer),L.throwIfNullOrWhitespace(e,"intentId"),L.throwIfNull(t,"model");const n=t;L.throwIfNullOrWhitespace(n.appId,"model.appId"),this.privAddedLmIntents[e]=new ct(n,r)}addAllIntents(e,t){L.throwIfNull(e,"model");const r=e;L.throwIfNullOrWhitespace(r.appId,"model.appId"),this.privUmbrellaIntent=new ct(r,t)}close(){L.throwIfDisposed(this.privDisposedIntentRecognizer),this.dispose(!0)}createRecognizerConfig(e){return new d(e,this.properties)}createServiceRecognizer(e,t,r,n){return new ht(e,t,r,n,this)}dispose(e){this.privDisposedIntentRecognizer||e&&(this.privDisposedIntentRecognizer=!0,super.dispose(e))}buildSpeechContext(){let e,t,r;const n=[];void 0!==this.privUmbrellaIntent&&(e=this.privUmbrellaIntent.modelImpl.appId,t=this.privUmbrellaIntent.modelImpl.region,r=this.privUmbrellaIntent.modelImpl.subscriptionKey);for(const i of Object.keys(this.privAddedLmIntents)){const o=this.privAddedLmIntents[i];if(void 0===e)e=o.modelImpl.appId;else if(e!==o.modelImpl.appId)throw new Error("Intents must all be from the same LUIS model");if(void 0===t)t=o.modelImpl.region;else if(t!==o.modelImpl.region)throw new Error("Intents must all be from the same LUIS model in a single region");if(void 0===r)r=o.modelImpl.subscriptionKey;else if(r!==o.modelImpl.subscriptionKey)throw new Error("Intents must all use the same subscription key");const s="luis/"+e+"-PRODUCTION#"+i;n.push(s)}return{Intent:{id:e,key:void 0===r?this.privProperties.getProperty(de[de.SpeechServiceConnection_Key]):r,provider:"LUIS"},ReferenceGrammars:void 0===this.privUmbrellaIntent?n:["luis/"+e+"-PRODUCTION"]}}}class lt extends rt{constructor(){super(...arguments),this.create=(e,t,r)=>{let n=e.parameters.getProperty(de.SpeechServiceConnection_Endpoint,void 0);if(!n){const t=e.parameters.getProperty(de.SpeechServiceConnection_Region,void 0);n=e.parameters.getProperty(de.SpeechServiceConnection_Host,"wss://"+t+".s2s.speech.microsoft.com")+"/speech/translation/cognitiveservices/v1"}const i={from:e.parameters.getProperty(de.SpeechServiceConnection_RecoLanguage),to:e.parameters.getProperty(de.SpeechServiceConnection_TranslationToLanguages)};this.setCommonUrlParams(e,i,n),this.setUrlParameter(de.SpeechServiceResponse_TranslationRequestStablePartialResult,tt.StableTranslation,e,i,n);void 0!==e.parameters.getProperty(de.SpeechServiceConnection_TranslationVoice,void 0)&&(i.voice=e.parameters.getProperty(de.SpeechServiceConnection_TranslationVoice),i.features="texttospeech");const o={};return void 0!==t.token&&""!==t.token&&(o[t.headerName]=t.token),o["X-ConnectionId"]=r,e.parameters.setProperty(de.SpeechServiceConnection_Url,n),new Ze(n,i,o,new it,et.fromRecognizerConfig(e),r)}}}var dt,ft;!function(e){e[e.Success=0]="Success",e[e.Error=1]="Error"}(dt||(dt={}));class gt{constructor(e,t,r,n,i){this.privCancelReason=t,this.privErrorDetails=r,this.privResult=i,this.privSessionId=e,this.privErrorCode=n}get result(){return this.privResult}get sessionId(){return this.privSessionId}get reason(){return this.privCancelReason}get errorCode(){return this.privErrorCode}get errorDetails(){return this.privErrorDetails}}class yt{constructor(){this.privMap=new ge}get(e,t){return this.privMap.getProperty(e,t)}set(e,t){this.privMap.setProperty(e,t)}}class mt{constructor(e){this.privTranslationHypothesis=JSON.parse(e),this.privTranslationHypothesis.Translation.TranslationStatus=dt[this.privTranslationHypothesis.Translation.TranslationStatus]}static fromJSON(e){return new mt(e)}get Duration(){return this.privTranslationHypothesis.Duration}get Offset(){return this.privTranslationHypothesis.Offset}get Text(){return this.privTranslationHypothesis.Text}get Translation(){return this.privTranslationHypothesis.Translation}}class St{constructor(e){this.privTranslationPhrase=JSON.parse(e),this.privTranslationPhrase.RecognitionStatus=Ge[this.privTranslationPhrase.RecognitionStatus],void 0!==this.privTranslationPhrase.Translation&&(this.privTranslationPhrase.Translation.TranslationStatus=dt[this.privTranslationPhrase.Translation.TranslationStatus])}static fromJSON(e){return new St(e)}get RecognitionStatus(){return this.privTranslationPhrase.RecognitionStatus}get Offset(){return this.privTranslationPhrase.Offset}get Duration(){return this.privTranslationPhrase.Duration}get Text(){return this.privTranslationPhrase.Text}get Translation(){return this.privTranslationPhrase.Translation}}class Ct{constructor(e){this.privSynthesisEnd=JSON.parse(e),this.privSynthesisEnd.SynthesisStatus=Je[this.privSynthesisEnd.SynthesisStatus]}static fromJSON(e){return new Ct(e)}get SynthesisStatus(){return this.privSynthesisEnd.SynthesisStatus}get FailureReason(){return this.privSynthesisEnd.FailureReason}}class bt extends Be{constructor(e,t,r,n,i){super(e,t,r,n,i),this.privTranslationRecognizer=i}processTypeSpecificMessages(e){const t=new ge;let r=!1;switch(e.messageType===we.b.Text&&t.setProperty(de.SpeechServiceResponse_JsonResult,e.textBody),e.path.toLowerCase()){case"translation.hypothesis":const n=this.fireEventForResult(mt.fromJSON(e.textBody),t);if(this.privRequestSession.onHypothesis(this.privRequestSession.currentTurnAudioOffset+n.offset),this.privTranslationRecognizer.recognizing)try{this.privTranslationRecognizer.recognizing(this.privTranslationRecognizer,n)}catch(e){}r=!0;break;case"translation.phrase":const i=St.fromJSON(e.textBody);if(this.privRequestSession.onPhraseRecognized(this.privRequestSession.currentTurnAudioOffset+i.Offset+i.Duration),i.RecognitionStatus===Ge.Success){const e=this.fireEventForResult(i,t);if(this.privTranslationRecognizer.recognized)try{this.privTranslationRecognizer.recognized(this.privTranslationRecognizer,e)}catch(e){}if(this.privSuccessCallback){try{this.privSuccessCallback(e.result)}catch(e){this.privErrorCallback&&this.privErrorCallback(e)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}break}{const r=Qe.implTranslateRecognitionResult(i.RecognitionStatus),n=new ve(void 0,this.privRequestSession.requestId,r,i.Text,i.Duration,this.privRequestSession.currentTurnAudioOffset+i.Offset,void 0,e.textBody,t);if(r===X.Canceled){const e=Qe.implTranslateCancelResult(i.RecognitionStatus);this.cancelRecognitionLocal(e,Qe.implTranslateCancelErrorCode(i.RecognitionStatus),void 0)}else{if(!this.privRequestSession.isSpeechEnded||r!==X.NoMatch||i.RecognitionStatus===Ge.InitialSilenceTimeout){const e=new ue(n,n.offset,this.privRequestSession.sessionId);if(this.privTranslationRecognizer.recognized)try{this.privTranslationRecognizer.recognized(this.privTranslationRecognizer,e)}catch(e){}}if(this.privSuccessCallback){try{this.privSuccessCallback(n)}catch(e){this.privErrorCallback&&this.privErrorCallback(e)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}}r=!0;break;case"translation.synthesis":this.sendSynthesisAudio(e.binaryBody,this.privRequestSession.sessionId),r=!0;break;case"translation.synthesis.end":const o=Ct.fromJSON(e.textBody);switch(o.SynthesisStatus){case Je.Error:if(this.privTranslationRecognizer.synthesizing){const e=new le(X.Canceled,void 0),t=new he(e,this.privRequestSession.sessionId);try{this.privTranslationRecognizer.synthesizing(this.privTranslationRecognizer,t)}catch(e){}}if(this.privTranslationRecognizer.canceled){const e=new gt(this.privRequestSession.sessionId,Y.Error,o.FailureReason,Re.ServiceError,null);try{this.privTranslationRecognizer.canceled(this.privTranslationRecognizer,e)}catch(e){}}break;case Je.Success:this.sendSynthesisAudio(void 0,this.privRequestSession.sessionId)}r=!0}return r}cancelRecognition(e,t,r,n,i){const o=new ge;if(o.setProperty("CancellationErrorCode",Re[n]),this.privTranslationRecognizer.canceled){const t=new gt(e,r,i,n,void 0);try{this.privTranslationRecognizer.canceled(this.privTranslationRecognizer,t)}catch(e){}}if(this.privSuccessCallback){const e=new ve(void 0,t,X.Canceled,void 0,void 0,void 0,i,void 0,o);try{this.privSuccessCallback(e),this.privSuccessCallback=void 0}catch(e){}}}fireEventForResult(e,t){let r,n;if(void 0!==e.Translation.Translations){r=new yt;for(const t of e.Translation.Translations)r.set(t.Language,t.Text)}n=e instanceof St?e.Translation.TranslationStatus===dt.Success?X.TranslatedSpeech:X.RecognizedSpeech:X.TranslatingSpeech;const i=e.Offset+this.privRequestSession.currentTurnAudioOffset,o=new ve(r,this.privRequestSession.requestId,n,e.Text,e.Duration,i,e.Translation.FailureReason,JSON.stringify(e),t);return new ue(o,i,this.privRequestSession.sessionId)}sendSynthesisAudio(e,t){const r=void 0===e?X.SynthesizingAudioCompleted:X.SynthesizingAudio,n=new le(r,e),i=new he(n,t);if(this.privTranslationRecognizer.synthesizing)try{this.privTranslationRecognizer.synthesizing(this.privTranslationRecognizer,i)}catch(e){}}}class Pt extends He{constructor(e,t){const r=e;L.throwIfNull(r,"speechConfig"),super(t,r.properties,new lt),this.privDisposedTranslationRecognizer=!1,this.privProperties=r.properties.clone(),void 0!==this.properties.getProperty(de.SpeechServiceConnection_TranslationVoice,void 0)&&L.throwIfNullOrWhitespace(this.properties.getProperty(de.SpeechServiceConnection_TranslationVoice),de[de.SpeechServiceConnection_TranslationVoice]),L.throwIfNullOrWhitespace(this.properties.getProperty(de.SpeechServiceConnection_TranslationToLanguages),de[de.SpeechServiceConnection_TranslationToLanguages]),L.throwIfNullOrWhitespace(this.properties.getProperty(de.SpeechServiceConnection_RecoLanguage),de[de.SpeechServiceConnection_RecoLanguage])}get speechRecognitionLanguage(){return L.throwIfDisposed(this.privDisposedTranslationRecognizer),this.properties.getProperty(de.SpeechServiceConnection_RecoLanguage)}get targetLanguages(){return L.throwIfDisposed(this.privDisposedTranslationRecognizer),this.properties.getProperty(de.SpeechServiceConnection_TranslationToLanguages).split(",")}get voiceName(){return L.throwIfDisposed(this.privDisposedTranslationRecognizer),this.properties.getProperty(de.SpeechServiceConnection_TranslationVoice,void 0)}get authorizationToken(){return this.properties.getProperty(de.SpeechServiceAuthorization_Token)}set authorizationToken(e){this.properties.setProperty(de.SpeechServiceAuthorization_Token,e)}get properties(){return this.privProperties}recognizeOnceAsync(e,t){L.throwIfDisposed(this.privDisposedTranslationRecognizer),this.recognizeOnceAsyncImpl(i.Conversation,e,t)}startContinuousRecognitionAsync(e,t){this.startContinuousRecognitionAsyncImpl(i.Conversation,e,t)}stopContinuousRecognitionAsync(e,t){this.stopContinuousRecognitionAsyncImpl(e,t)}close(){L.throwIfDisposed(this.privDisposedTranslationRecognizer),this.dispose(!0)}dispose(e){this.privDisposedTranslationRecognizer||e&&(this.implRecognizerStop(),this.privDisposedTranslationRecognizer=!0,super.dispose(e))}createRecognizerConfig(e){return new d(e,this.properties)}createServiceRecognizer(e,t,r,n){return new bt(e,t,r,n,this)}}!function(e){e[e.NotRecognized=0]="NotRecognized",e[e.InitialSilenceTimeout=1]="InitialSilenceTimeout",e[e.InitialBabbleTimeout=2]="InitialBabbleTimeout"}(ft||(ft={}));class Rt{constructor(e){this.privReason=e}static fromResult(e){const t=Ke.fromJSON(e.json);let r=ft.NotRecognized;switch(t.RecognitionStatus){case Ge.BabbleTimeout:r=ft.InitialBabbleTimeout;break;case Ge.InitialSilenceTimeout:r=ft.InitialSilenceTimeout;break;default:r=ft.NotRecognized}return new Rt(r)}get reason(){return this.privReason}}class It{constructor(e,t,r){this.privReason=e,this.privErrorDetails=t,this.privErrorCode=r}static fromResult(e){let t=Y.Error,r=Re.NoError;if(e.json){const r=Ke.fromJSON(e.json);t=Qe.implTranslateCancelResult(r.RecognitionStatus)}return e.properties&&(r=Re[e.properties.getProperty("CancellationErrorCode",Re[Re.NoError])]),new It(t,e.errorDetails,r)}get reason(){return this.privReason}get errorDetails(){return this.privErrorDetails}get ErrorCode(){return this.privErrorCode}}class wt extends ee{}class Et extends ee{constructor(e,t,r){super(r),this.privJsonResult=e,this.privEventName=t}get jsonString(){return this.privJsonResult}get eventName(){return this.privEventName}}class Tt{static fromRecognizer(e){const t=e.internalData,r=new Tt;return r.privServiceRecognizer=t,r.privEventListener=r.privServiceRecognizer.connectionEvents.attach(e=>{"ConnectionEstablishedEvent"===e.name?r.connected&&r.connected(new wt(e.connectionId)):"ConnectionClosedEvent"===e.name&&r.disconnected&&r.disconnected(new wt(e.connectionId))}),r.privServiceEventListener=r.privServiceRecognizer.serviceEvents.attach(e=>{r.receivedServiceMessage&&r.receivedServiceMessage(new Et(e.jsonString,e.name))}),r}openConnection(){this.privServiceRecognizer.connect()}closeConnection(){this.privServiceRecognizer.disconnect()}close(){}}class Ot{constructor(e){this.privGrammerBuilder=e.dynamicGrammar}static fromRecognizer(e){const t=e.internalData;return new Ot(t)}addPhrase(e){this.privGrammerBuilder.addPhrase(e)}addPhrases(e){this.privGrammerBuilder.addPhrase(e)}clear(){this.privGrammerBuilder.clearPhrases()}}class At{constructor(){}}class _t extends At{constructor(){super(),this.privSpeechConfig=new me}get properties(){return this.privSpeechConfig.properties}get speechRecognitionLanguage(){return this.privSpeechConfig.speechRecognitionLanguage}set speechRecognitionLanguage(e){L.throwIfNullOrWhitespace(e,"value"),this.privSpeechConfig.speechRecognitionLanguage=e}setProperty(e,t){this.privSpeechConfig.setProperty(e,t)}getProperty(e,t){return this.privSpeechConfig.getProperty(e)}setProxy(e,t,r,n){this.setProperty(de.SpeechServiceConnection_ProxyHostName,e),this.setProperty(de.SpeechServiceConnection_ProxyPort,""+t),r&&this.setProperty(de.SpeechServiceConnection_ProxyUserName,r),n&&this.setProperty(de.SpeechServiceConnection_ProxyPassword,n)}setServiceProperty(e,t,r){this.privSpeechConfig.setServiceProperty(e,t,r)}close(){}}class Dt extends _t{constructor(){super()}static fromSubscription(e,t,r){L.throwIfNullOrWhitespace(e,"subscription"),L.throwIfNullOrWhitespace(t,"region");const n=new _t;return n.setProperty(de.Conversation_DialogType,"bot_framework"),n.setProperty(de.SpeechServiceConnection_Key,e),n.setProperty(de.SpeechServiceConnection_Region,t),r&&n.setProperty(de.Conversation_ApplicationId,r),n}static fromAuthorizationToken(e,t){L.throwIfNullOrWhitespace(e,"authorizationToken"),L.throwIfNullOrWhitespace(t,"region");const r=new _t;return r.setProperty(de.Conversation_DialogType,"bot_framework"),r.setProperty(de.SpeechServiceAuthorization_Token,e),r.setProperty(de.SpeechServiceConnection_Region,t),r}}class xt extends _t{constructor(){super()}static fromSubscription(e,t,r){L.throwIfNullOrWhitespace(e,"applicationId"),L.throwIfNullOrWhitespace(t,"subscription"),L.throwIfNullOrWhitespace(r,"region");const n=new _t;return n.setProperty(de.Conversation_DialogType,"custom_commands"),n.setProperty(de.Conversation_ApplicationId,e),n.setProperty(de.SpeechServiceConnection_Key,t),n.setProperty(de.SpeechServiceConnection_Region,r),n}static fromAuthorizationToken(e,t,r){L.throwIfNullOrWhitespace(e,"applicationId"),L.throwIfNullOrWhitespace(t,"authorizationToken"),L.throwIfNullOrWhitespace(r,"region");const n=new _t;return n.setProperty(de.Conversation_DialogType,"custom_commands"),n.setProperty(de.Conversation_ApplicationId,e),n.setProperty(de.SpeechServiceAuthorization_Token,t),n.setProperty(de.SpeechServiceConnection_Region,r),n}set applicationId(e){L.throwIfNullOrWhitespace(e,"value"),this.setProperty(de.Conversation_ApplicationId,e)}get applicationId(){return this.getProperty(de.Conversation_ApplicationId)}}const kt="convai.speech.microsoft.com",Mt={authHeader:"X-DLS-Secret",resourcePath:"",version:"v3"},Nt={authHeader:"X-CommandsAppId",resourcePath:"commands",version:"v1"};class jt extends rt{constructor(){super(...arguments),this.create=(e,t,r)=>{const n=e.parameters.getProperty(de.Conversation_ApplicationId,""),i=e.parameters.getProperty(de.Conversation_DialogType),o=e.parameters.getProperty(de.SpeechServiceConnection_Region),s=e.parameters.getProperty(de.SpeechServiceConnection_RecoLanguage,"en-US"),a={};a[tt.LanguageParamName]=s,a[tt.FormatParamName]=e.parameters.getProperty(de.SpeechServiceResponse_OutputFormatOption,$[$.Simple]).toLowerCase();const{resourcePath:c,version:p,authHeader:u}=function(e){switch(e){case"custom_commands":return Nt;case"bot_framework":return Mt}throw new Error(`Invalid dialog type '${e}'`)}(i),h={};null!=t.token&&""!==t.token&&(h[t.headerName]=t.token),h[tt.ConnectionIdHeader]=r,""!==n&&(h[u]=n);let v=e.parameters.getProperty(de.SpeechServiceConnection_Endpoint,"");return""===v&&(v=""===n?`wss://${o}.${kt}/api/${p}`:`wss://${o}.${kt}/${c}/api/${p}`),this.setCommonUrlParams(e,a,v),new Ze(v,a,h,new it,et.fromRecognizerConfig(e),r)}}}class zt{constructor(e,t){this.privActivity=e,this.privAudioStream=t}get activity(){return this.privActivity}get audioStream(){return this.privAudioStream}}class Lt{constructor(e){this.privActivityResponse=JSON.parse(e)}static fromJSON(e){return new Lt(e)}get conversationId(){return this.privActivityResponse.conversationId}get messageDataStreamType(){return this.privActivityResponse.messageDataStreamType}get messagePayload(){return this.privActivityResponse.messagePayload}get version(){return this.privActivityResponse.version}}var qt,Bt;!function(e){e[e.None=0]="None",e[e.TextToSpeechAudio=1]="TextToSpeechAudio"}(qt||(qt={}));class Ut{constructor(e,t){this.privRequestId=t,this.privIsCompleted=!1,this.privAudioStream=null,this.privTurnManager=e,this.resetTurnEndTimeout()}get audioStream(){return this.resetTurnEndTimeout(),this.privAudioStream}processActivityPayload(e){return e.messageDataStreamType===qt.TextToSpeechAudio&&(this.privAudioStream=G.createPullStream()),this.privAudioStream}endAudioStream(){null===this.privAudioStream||this.privAudioStream.isClosed||this.privAudioStream.close()}complete(){void 0!==this.privTimeoutToken&&clearTimeout(this.privTimeoutToken),this.endAudioStream()}resetTurnEndTimeout(){void 0!==this.privTimeoutToken&&clearTimeout(this.privTimeoutToken),this.privTimeoutToken=setTimeout(()=>{this.privTurnManager.CompleteTurn(this.privRequestId)},2e3)}}class Ft{constructor(){this.privTurnMap=new Map}StartTurn(e){if(this.privTurnMap.has(e))throw new _.b("Service error: There is already a turn with id:"+e);const t=new Ut(this,e);return this.privTurnMap.set(e,t),this.privTurnMap.get(e)}GetTurn(e){return this.privTurnMap.get(e)}CompleteTurn(e){if(!this.privTurnMap.has(e))throw new _.b("Service error: Received turn end for an unknown turn id:"+e);const t=this.privTurnMap.get(e);return t.complete(),this.privTurnMap.delete(e),t}}class Wt extends Be{constructor(e,t,r,n,i){super(e,t,r,n,i),this.sendMessage=e=>{const t=Object(D.a)(),r=Object(D.b)(),n={context:{interactionId:t},messagePayload:e,version:.5},i=JSON.stringify(n);this.fetchDialogConnection().onSuccessContinueWith(e=>{e.send(new qe(we.b.Text,"agent",r,"application/json",i))})},this.listenOnce=(e,t,r)=>(this.privRecognizerConfig.recognitionMode=e,this.privSuccessCallback=t,this.privErrorCallback=r,this.privDialogRequestSession.startNewRecognition(),this.privDialogRequestSession.listenForServiceTelemetry(this.privDialogAudioSource.events),this.dialogConnectImpl(),this.sendPreAudioMessages(),this.privDialogAudioSource.attach(this.privDialogRequestSession.audioNodeId).continueWithPromise(e=>{let t;return e.isError?(this.cancelRecognition(this.privDialogRequestSession.sessionId,this.privDialogRequestSession.requestId,Y.Error,Re.ConnectionFailure,e.error),S.c.fromError(e.error)):this.privDialogAudioSource.format.onSuccessContinueWithPromise(r=>(t=new be(e.result,r.avgBytesPerSec),this.privDialogRequestSession.onAudioSourceAttachCompleted(t,!1),this.privDialogAudioSource.deviceInfo.onSuccessContinueWithPromise(e=>(this.privRecognizerConfig.SpeechServiceConfig.Context.audio={source:e},this.configConnection().continueWithPromise(e=>{if(e.isError)return this.cancelRecognitionLocal(Y.Error,Re.ConnectionFailure,e.error),S.c.fromError(e.error);const r=new ee(this.privDialogRequestSession.sessionId);this.privRecognizer.sessionStarted&&this.privRecognizer.sessionStarted(this.privRecognizer,r);return this.sendAudio(t).on(e=>{},e=>{this.cancelRecognition(this.privDialogRequestSession.sessionId,this.privDialogRequestSession.requestId,Y.Error,Re.RuntimeError,e)}),S.c.fromResult(!0)})))))})),this.sendAudio=e=>this.privDialogAudioSource.format.onSuccessContinueWithPromise(t=>{const r=new S.a;let n=Date.now();const i=this.privRecognizerConfig.parameters.getProperty("SPEECH-TransmitLengthBeforThrottleMs","5000"),o=t.avgBytesPerSec/1e3*parseInt(i,10),s=this.privDialogRequestSession.recogNumber,a=()=>{this.privDialogIsDisposed||this.privDialogRequestSession.isSpeechEnded||!this.privDialogRequestSession.isRecognizing||this.privDialogRequestSession.recogNumber!==s||this.fetchDialogConnection().on(i=>{e.read().on(e=>{if(this.privDialogRequestSession.isSpeechEnded)return void r.resolve(!0);let s,c;!e||e.isEnd?(s=null,c=0):(s=e.buffer,this.privDialogRequestSession.onAudioSent(s.byteLength),c=o>=this.privDialogRequestSession.bytesSent?0:Math.max(0,n-Date.now())),setTimeout(()=>{null!==s&&(n=Date.now()+1e3*s.byteLength/(2*t.avgBytesPerSec));const o=i.send(new qe(we.b.Binary,"audio",this.privDialogRequestSession.requestId,null,s));e&&!e.isEnd?o.continueWith(e=>{a()}):(this.privDialogRequestSession.onSpeechEnded(),r.resolve(!0))},c)},e=>{this.privDialogRequestSession.isSpeechEnded?r.resolve(!0):r.reject(e)})},e=>{r.reject(e)})};return a(),r.promise()}),this.receiveDialogMessageOverride=()=>{const e=new S.a;return this.fetchDialogConnection().on(t=>t.read().onSuccessContinueWithPromise(t=>{const r=this.isDisposed(),n=!this.isDisposed()&&this.terminateMessageLoop;if(r||n)return e.resolve(void 0),S.c.fromResult(void 0);if(!t)return this.receiveDialogMessageOverride();const i=qe.fromConnectionMessage(t);switch(i.path.toLowerCase()){case"turn.start":{const e=i.requestId.toUpperCase();e!==this.privDialogRequestSession.requestId.toUpperCase()?this.privTurnStateManager.StartTurn(e):this.privDialogRequestSession.onServiceTurnStartResponse()}break;case"speech.startdetected":const e=Oe.fromJSON(i.textBody),t=new te(e.Offset,this.privDialogRequestSession.sessionId);this.privRecognizer.speechStartDetected&&this.privRecognizer.speechStartDetected(this.privRecognizer,t);break;case"speech.enddetected":let r;r=i.textBody.length>0?i.textBody:"{ Offset: 0 }";const n=Oe.fromJSON(r);this.privDialogRequestSession.onServiceRecognized(n.Offset+this.privDialogRequestSession.currentTurnAudioOffset);const o=new te(n.Offset+this.privDialogRequestSession.currentTurnAudioOffset,this.privDialogRequestSession.sessionId);this.privRecognizer.speechEndDetected&&this.privRecognizer.speechEndDetected(this.privRecognizer,o);break;case"turn.end":{const e=i.requestId.toUpperCase();if(e!==this.privDialogRequestSession.requestId.toUpperCase())this.privTurnStateManager.CompleteTurn(e);else{const e=new ee(this.privDialogRequestSession.sessionId);if(this.privDialogRequestSession.onServiceTurnEndResponse(!1),this.privDialogRequestSession.isSpeechEnded&&this.privRecognizer.sessionStopped&&this.privRecognizer.sessionStopped(this.privRecognizer,e),this.privSuccessCallback&&this.privLastResult){try{this.privSuccessCallback(this.privLastResult),this.privLastResult=null}catch(e){this.privErrorCallback&&this.privErrorCallback(e)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}}break;default:this.processTypeSpecificMessages(i)||this.serviceEvents&&this.serviceEvents.onEvent(new Ee.g(i.path.toLowerCase(),i.textBody))}return this.receiveDialogMessageOverride()}),t=>(this.terminateMessageLoop=!0,e.resolve(void 0),S.c.fromResult(void 0))),e.promise()},this.fetchDialogConnection=()=>this.configConnection(),this.sendAgentConfig=e=>{if(this.agentConfig&&!this.agentConfigSent){if("custom_commands"===this.privRecognizerConfig.parameters.getProperty(de.Conversation_DialogType)){const e=this.agentConfig.get();e.botInfo.commandsCulture=this.privRecognizerConfig.parameters.getProperty(de.SpeechServiceConnection_RecoLanguage,"en-us"),this.agentConfig.set(e)}const t=this.agentConfig.toJsonString();return this.agentConfigSent=!0,e.send(new qe(we.b.Text,"agent.config",this.privDialogRequestSession.requestId,"application/json",t))}return S.c.fromResult(!0)},this.sendAgentContext=e=>{const t=Object(D.a)(),r=this.privDialogServiceConnector.properties.getProperty(de.Conversation_Speech_Activity_Template),n={channelData:"",context:{interactionId:t},messagePayload:void 0===typeof r?void 0:r,version:.5},i=JSON.stringify(n);return e.send(new qe(we.b.Text,"speech.agent.context",this.privDialogRequestSession.requestId,"application/json",i))},this.privDialogServiceConnector=i,this.privDialogAuthentication=e,this.receiveMessageOverride=this.receiveDialogMessageOverride,this.privTurnStateManager=new Ft,this.recognizeOverride=this.listenOnce,this.connectImplOverride=this.dialogConnectImpl,this.configConnectionOverride=this.configConnection,this.fetchConnectionOverride=this.fetchDialogConnection,this.disconnectOverride=this.privDisconnect,this.privDialogAudioSource=r,this.privDialogRequestSession=new Ne(r.id()),this.privDialogConnectionFactory=t,this.privDialogIsDisposed=!1,this.agentConfigSent=!1,this.privLastResult=null}isDisposed(){return this.privDialogIsDisposed}dispose(e){this.privDialogIsDisposed=!0,this.privConnectionConfigPromise&&this.privConnectionConfigPromise.onSuccessContinueWith(t=>{t.dispose(e)})}privDisconnect(){this.cancelRecognition(this.privDialogRequestSession.sessionId,this.privDialogRequestSession.requestId,Y.Error,Re.NoError,"Disconnecting"),this.terminateMessageLoop=!0,this.agentConfigSent=!1,this.privDialogConnectionPromise.result().isCompleted?this.privDialogConnectionPromise.result().isError||(this.privDialogConnectionPromise.result().result.dispose(),this.privDialogConnectionPromise=null):this.privDialogConnectionPromise.onSuccessContinueWith(e=>{e.dispose()})}processTypeSpecificMessages(e){const t=new ge;let r,n;switch(e.messageType===we.b.Text&&t.setProperty(de.SpeechServiceResponse_JsonResult,e.textBody),e.path.toLowerCase()){case"speech.phrase":const i=Ke.fromJSON(e.textBody);if(this.privDialogRequestSession.onPhraseRecognized(this.privDialogRequestSession.currentTurnAudioOffset+i.Offset+i.Duration),i.RecognitionStatus===Ge.Success){const e=this.fireEventForResult(i,t);if(this.privLastResult=e.result,this.privDialogServiceConnector.recognized)try{this.privDialogServiceConnector.recognized(this.privDialogServiceConnector,e)}catch(e){}}n=!0;break;case"speech.hypothesis":const o=Ve.fromJSON(e.textBody),s=o.Offset+this.privDialogRequestSession.currentTurnAudioOffset;r=new ie(this.privDialogRequestSession.requestId,X.RecognizingSpeech,o.Text,o.Duration,s,void 0,e.textBody,t),this.privDialogRequestSession.onHypothesis(s);const a=new ce(r,o.Duration,this.privDialogRequestSession.sessionId);if(this.privDialogServiceConnector.recognizing)try{this.privDialogServiceConnector.recognizing(this.privDialogServiceConnector,a)}catch(e){}n=!0;break;case"audio":{const t=e.requestId.toUpperCase(),r=this.privTurnStateManager.GetTurn(t);try{e.binaryBody?r.audioStream.write(e.binaryBody):r.endAudioStream()}catch(e){}}n=!0;break;case"response":{const t=e.requestId.toUpperCase(),r=Lt.fromJSON(e.textBody),n=this.privTurnStateManager.GetTurn(t);if(r.conversationId){const e=this.agentConfig.get();e.botInfo.conversationId=r.conversationId,this.agentConfig.set(e)}const i=n.processActivityPayload(r),o=new zt(r.messagePayload,i);if(this.privDialogServiceConnector.activityReceived)try{this.privDialogServiceConnector.activityReceived(this.privDialogServiceConnector,o)}catch(e){}}n=!0}return n}cancelRecognition(e,t,r,n,i){if(this.terminateMessageLoop=!0,this.privDialogRequestSession.isRecognizing&&this.privDialogRequestSession.onStopRecognizing(),this.privDialogServiceConnector.canceled){const t=new ge;t.setProperty("CancellationErrorCode",Re[n]);const o=new pe(r,i,n,void 0,e);try{this.privDialogServiceConnector.canceled(this.privDialogServiceConnector,o)}catch(e){}if(this.privSuccessCallback){const e=new ie(void 0,X.Canceled,void 0,void 0,void 0,i,void 0,t);try{this.privSuccessCallback(e),this.privSuccessCallback=void 0}catch(e){}}}}sendWaveHeader(e){return this.audioSource.format.onSuccessContinueWithPromise(t=>e.send(new qe(we.b.Binary,"audio",this.privDialogRequestSession.requestId,null,t.header)))}dialogConnectImpl(e=!1){if(this.privDialogConnectionPromise)return this.privDialogConnectionPromise.result().isCompleted&&(this.privDialogConnectionPromise.result().isError||this.privDialogConnectionPromise.result().result.state()===Te.a.Disconnected)?(this.agentConfigSent=!1,this.privDialogConnectionPromise=null,this.terminateMessageLoop=!0,this.configConnection()):this.privDialogConnectionPromise;this.privDialogAuthFetchEventId=Object(D.b)(),void 0===this.privConnectionId&&(this.privConnectionId=Object(D.b)()),this.privDialogRequestSession.onPreConnectionStart(this.privDialogAuthFetchEventId,this.privConnectionId);const t=e?this.privDialogAuthentication.fetchOnExpiry(this.privDialogAuthFetchEventId):this.privDialogAuthentication.fetch(this.privDialogAuthFetchEventId);return this.privDialogConnectionPromise=t.continueWithPromise(t=>{if(t.isError)throw this.privDialogRequestSession.onAuthCompleted(!0,t.error),new Error(t.error);this.privDialogRequestSession.onAuthCompleted(!1);const r=this.privDialogConnectionFactory.create(this.privRecognizerConfig,t.result,this.privConnectionId);return this.privDialogRequestSession.listenForServiceTelemetry(r.events),r.events.attach(e=>{this.connectionEvents.onEvent(e)}),r.open().onSuccessContinueWithPromise(t=>200===t.statusCode?(this.privDialogRequestSession.onPreConnectionStart(this.privDialogAuthFetchEventId,this.privConnectionId),this.privDialogRequestSession.onConnectionEstablishCompleted(t.statusCode),S.c.fromResult(r)):403!==t.statusCode||e?(this.privDialogRequestSession.onConnectionEstablishCompleted(t.statusCode,t.reason),S.c.fromError(`Unable to contact server. StatusCode: ${t.statusCode}, ${this.privRecognizerConfig.parameters.getProperty(de.SpeechServiceConnection_Endpoint)} Reason: ${t.reason}`)):this.dialogConnectImpl(!0))}),this.privConnectionLoop=this.startMessageLoop(),this.privDialogConnectionPromise}startMessageLoop(){this.terminateMessageLoop=!1;return this.receiveDialogMessageOverride().on(e=>!0,e=>{this.cancelRecognition(this.privDialogRequestSession.sessionId,this.privDialogRequestSession.requestId,Y.Error,Re.RuntimeError,e)})}configConnection(){return this.privConnectionConfigPromise?this.privConnectionConfigPromise.result().isCompleted&&(this.privConnectionConfigPromise.result().isError||this.privConnectionConfigPromise.result().result.state()===Te.a.Disconnected)?(this.privConnectionConfigPromise=null,this.configConnection()):this.privConnectionConfigPromise:this.terminateMessageLoop?(this.terminateMessageLoop=!1,S.c.fromError("Connection to service terminated.")):(this.privConnectionConfigPromise=this.dialogConnectImpl().onSuccessContinueWithPromise(e=>this.sendSpeechServiceConfig(e,this.privDialogRequestSession,this.privRecognizerConfig.SpeechServiceConfig.serialize()).onSuccessContinueWithPromise(t=>this.sendAgentConfig(e).onSuccessContinueWith(t=>e))),this.privConnectionConfigPromise)}sendPreAudioMessages(){this.fetchDialogConnection().onSuccessContinueWith(e=>{this.sendAgentContext(e),this.sendWaveHeader(e)})}fireEventForResult(e,t){const r=Qe.implTranslateRecognitionResult(e.RecognitionStatus),n=e.Offset+this.privDialogRequestSession.currentTurnAudioOffset,i=new ie(this.privDialogRequestSession.requestId,r,e.DisplayText,e.Duration,n,void 0,JSON.stringify(e),t);return new ce(i,n,this.privDialogRequestSession.sessionId)}}class Ht extends He{constructor(e,t){const r=e;L.throwIfNull(e,"dialogConfig"),super(t,r.properties,new jt),this.isTurnComplete=!0,this.privIsDisposed=!1,this.privProperties=r.properties.clone();const n=this.buildAgentConfig();this.privReco.agentConfig.set(n)}connect(){this.privReco.connect()}disconnect(){this.privReco.disconnect()}get authorizationToken(){return this.properties.getProperty(de.SpeechServiceAuthorization_Token)}set authorizationToken(e){L.throwIfNullOrWhitespace(e,"token"),this.properties.setProperty(de.SpeechServiceAuthorization_Token,e)}get properties(){return this.privProperties}get speechActivityTemplate(){return this.properties.getProperty(de.Conversation_Speech_Activity_Template)}set speechActivityTemplate(e){this.properties.setProperty(de.Conversation_Speech_Activity_Template,e)}listenOnceAsync(e,t){if(this.isTurnComplete)try{L.throwIfDisposed(this.privIsDisposed),this.connect(),this.implRecognizerStop(),this.isTurnComplete=!1,this.privReco.recognize(i.Conversation,t=>{this.implRecognizerStop(),this.isTurnComplete=!0,e&&e(t)},e=>{this.implRecognizerStop(),this.isTurnComplete=!0,t&&t(e)}).on(e=>{},e=>{t&&t(e)})}catch(e){if(t)if(e instanceof Error){const r=e;t(r.name+": "+r.message)}else t(e);this.dispose(!0)}}sendActivityAsync(e){this.privReco.sendMessage(e)}close(){L.throwIfDisposed(this.privIsDisposed),this.dispose(!0)}dispose(e){this.privIsDisposed||e&&(this.implRecognizerStop(),this.privIsDisposed=!0,super.dispose(e))}createRecognizerConfig(e){return new d(e,this.privProperties)}createServiceRecognizer(e,t,r,n){return new Wt(e,t,r,n,this)}buildAgentConfig(){return{botInfo:{commType:this.properties.getProperty("Conversation_Communication_Type","Default"),commandsCulture:void 0,connectionId:this.properties.getProperty(de.Conversation_ApplicationId),conversationId:void 0,fromId:this.properties.getProperty(de.Conversation_From_Id,void 0)},version:.2}}}!function(e){e[e.UriQueryParameter=0]="UriQueryParameter"}(Bt||(Bt={}));class Vt{constructor(e){this.audioContext=null,this.gainNode=null,this.autoUpdateBufferTimer=0,this.init(e)}playAudioSample(e){this.ensureInitializedContext();const t=this.formatAudioData(e),r=new Float32Array(this.samples.length+t.length);r.set(this.samples,0),r.set(t,this.samples.length),this.samples=r}stopAudio(){null!==this.audioContext&&(this.samples=new Float32Array,clearInterval(this.autoUpdateBufferTimer),this.audioContext.close(),this.audioContext=null)}init(e){this.audioFormat=e,this.samples=new Float32Array}ensureInitializedContext(){if(null===this.audioContext){this.createAudioContext();const e=200;this.autoUpdateBufferTimer=setInterval(()=>{this.updateAudioBuffer()},e)}}createAudioContext(){this.audioContext=new AudioContext,this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=1,this.gainNode.connect(this.audioContext.destination),this.startTime=this.audioContext.currentTime}formatAudioData(e){switch(this.audioFormat.bitsPerSample){case 8:return this.formatArrayBuffer(new Int8Array(e),128);case 16:return this.formatArrayBuffer(new Int16Array(e),32768);case 32:return this.formatArrayBuffer(new Int32Array(e),2147483648);default:throw new _.b("Only WAVE_FORMAT_PCM (8/16/32 bps) format supported at this time")}}formatArrayBuffer(e,t){const r=new Float32Array(e.length);for(let n=0;n<e.length;n++)r[n]=e[n]/t;return r}updateAudioBuffer(){if(0===this.samples.length)return;const e=this.audioFormat.channels,t=this.audioContext.createBufferSource(),r=this.samples.length/e,n=this.audioContext.createBuffer(e,r,this.audioFormat.samplesPerSec);for(let t=0;t<e;t++){let r=t;const i=n.getChannelData(t);for(let t=0;t<this.samples.length;t++,r+=e)i[t]=this.samples[r]}this.startTime<this.audioContext.currentTime&&(this.startTime=this.audioContext.currentTime),t.buffer=n,t.connect(this.gainNode),t.start(this.startTime),this.startTime+=n.duration,this.samples=new Float32Array}}const Jt={apiVersion:"2.0",auth:{placeholderRegion:"westus",placeholderSubscriptionKey:"abcdefghijklmnopqrstuvwxyz012345"},clientAppId:"FC539C22-1767-4F1F-84BC-B4D811114F15",defaultLanguageCode:"en-US",defaultRequestOptions:{headers:{Accept:"application/json"},ignoreCache:!1,timeout:5e3},host:"dev.microsofttranslator.com",params:{apiVersion:"api-version",authorization:"Authorization",clientAppId:"X-ClientAppId",correlationId:"X-CorrelationId",languageCode:"language",nickname:"nickname",profanity:"profanity",requestId:"X-RequestId",roomId:"roomid",sessionToken:"token",subscriptionKey:"Ocp-Apim-Subscription-Key",subscriptionRegion:"Ocp-Apim-Subscription-Region",token:"X-CapitoToken"},restPath:"/capito/room",speechHost:"{region}.s2s.speech.microsoft.com",speechPath:"/speech/translation/cognitiveservices/v1",strings:{authInvalidSubscriptionKey:"You must specify either an authentication token to use, or a Cognitive Speech subscription key.",authInvalidSubscriptionRegion:"You must specify the Cognitive Speech region to use.",invalidArgs:"Required input not found: {arg}.",invalidCreateJoinConversationResponse:"Creating/Joining conversation failed with HTTP {status}.",invalidParticipantRequest:"The requested participant was not found.",permissionDeniedConnect:"Required credentials not found.",permissionDeniedConversation:"Invalid operation: only the host can {command} the conversation.",permissionDeniedParticipant:"Invalid operation: only the host can {command} a participant.",permissionDeniedSend:"Invalid operation: the conversation is not in a connected state.",permissionDeniedStart:"Invalid operation: there is already an active conversation."},textMessageMaxLength:1e3,webSocketPath:"/capito/translate"};function Gt(e,t={}){const r=function(e={}){return Object.keys(e).map(t=>encodeURIComponent(t)+"="+encodeURIComponent(e[t])).join("&")}(t);return r?e+(-1===e.indexOf("?")?"?":"&")+r:e}function Kt(e,t=null){return{data:t||e.statusText,headers:e.getAllResponseHeaders(),json:()=>JSON.parse(t||'"'+e.statusText+'"'),ok:!1,status:e.status,statusText:e.statusText}}function Qt(e,t,r={},n=null,i=Jt.defaultRequestOptions,o){const s=i.ignoreCache||Jt.defaultRequestOptions.ignoreCache,a=i.headers||Jt.defaultRequestOptions.headers,c=i.timeout||Jt.defaultRequestOptions.timeout,p=new XMLHttpRequest;p.open(e,Gt(t,r),!0),a&&Object.keys(a).forEach(e=>p.setRequestHeader(e,a[e])),s&&p.setRequestHeader("Cache-Control","no-cache"),p.timeout=c,p.onload=e=>{o(function(e){return{data:e.responseText,headers:e.getAllResponseHeaders(),json:()=>JSON.parse(e.responseText),ok:e.status>=200&&e.status<300,status:e.status,statusText:e.statusText}}(p))},p.onerror=e=>{o(Kt(p,"Failed to make request."))},p.ontimeout=e=>{o(Kt(p,"Request took longer than expected."))},"post"===e&&n?(p.setRequestHeader("Content-Type","application/json"),p.send(JSON.stringify(n))):p.send()}class Yt{constructor(e=[],t){this.participants=e,this.meId=t}addOrUpdateParticipant(e){if(void 0===e)return;const t=this.getParticipantIndex(e.id);return t>-1?this.participants.splice(t,1,e):this.participants.push(e),this.getParticipant(e.id)}getParticipantIndex(e){return this.participants.findIndex(t=>t.id===e)}getParticipant(e){return this.participants.find(t=>t.id===e)}deleteParticipant(e){this.participants=this.participants.filter(t=>t.id!==e)}get host(){return this.participants.find(e=>!0===e.isHost)}get me(){return this.getParticipant(this.meId)}}const $t="final",Xt="instant_message",Zt="partial",er="participant_command",tr="ChangeNickname",rr="EjectParticipant",nr="SetLockState",ir="SetMute",or="SetMuteAll",sr="SetProfanityFiltering",ar="SetTranslateToLanguages",cr="SetUseTTS";class pr{constructor(){}createOrJoin(e,t,r,n){try{L.throwIfNullOrUndefined(e,"args");const i=e.getProperty(de.SpeechServiceConnection_RecoLanguage,Jt.defaultLanguageCode),o=e.getProperty(de.ConversationTranslator_Name),s=e.getProperty(de.ConversationTranslator_Host,Jt.host),a=e.getProperty(de.ConversationTranslator_CorrelationId),c=e.getProperty(de.SpeechServiceConnection_Key),p=e.getProperty(de.SpeechServiceConnection_Region),u=e.getProperty(de.SpeechServiceAuthorization_Token);L.throwIfNullOrWhitespace(i,"languageCode"),L.throwIfNullOrWhitespace(o,"nickname"),L.throwIfNullOrWhitespace(s,"endpointHost");const h={};h[Jt.params.apiVersion]=Jt.apiVersion,h[Jt.params.languageCode]=i,h[Jt.params.nickname]=o;const v={};a&&(v[Jt.params.correlationId]=a),v[Jt.params.clientAppId]=Jt.clientAppId,void 0!==t?h[Jt.params.roomId]=t:(L.throwIfNullOrUndefined(p,Jt.strings.authInvalidSubscriptionRegion),v[Jt.params.subscriptionRegion]=p,c?v[Jt.params.subscriptionKey]=c:u?v[Jt.params.authorization]="Bearer "+u:L.throwIfNullOrUndefined(c,Jt.strings.authInvalidSubscriptionKey));const l={};l.headers=v;Qt("post",`https://${s}${Jt.restPath}`,h,null,l,e=>{const t=function(e,t){let r="";try{const n=t.trim().split(/[\r\n]+/),i={};n.forEach(e=>{const t=e.split(": "),r=t.shift().toLowerCase(),n=t.join(": ");i[r]=n}),r=i[e.toLowerCase()]}catch(e){}return r}(Jt.params.requestId,e.headers);if(!e.ok){if(n){let r,i=Jt.strings.invalidCreateJoinConversationResponse.replace("{status}",e.status.toString());try{r=JSON.parse(e.data),i+=` [${r.error.code}: ${r.error.message}]`}catch(t){i+=` [${e.data}]`}t&&(i+=" "+t),n(i)}return}const i=JSON.parse(e.data);if(i&&(i.requestId=t),r){try{r(i)}catch(e){n&&n(e)}r=void 0}})}catch(e){if(n)if(e instanceof Error){const t=e;n(t.name+": "+t.message)}else n(e)}}leave(e,t,r,n){try{L.throwIfNullOrUndefined(e,Jt.strings.invalidArgs.replace("{arg}","config")),L.throwIfNullOrWhitespace(t,Jt.strings.invalidArgs.replace("{arg}","token"));const i=e.getProperty(de.ConversationTranslator_Host,Jt.host),o=e.getProperty(de.ConversationTranslator_CorrelationId),s={};s[Jt.params.apiVersion]=Jt.apiVersion,s[Jt.params.sessionToken]=t;const a={};o&&(a[Jt.params.correlationId]=o);const c={};c.headers=a;Qt("delete",`https://${i}${Jt.restPath}`,s,null,c,e=>{if(e.ok,r){try{r()}catch(e){n&&n(e)}r=void 0}})}catch(e){if(n)if(e instanceof Error){const t=e;n(t.name+": "+t.message)}else n(e)}}}class ur extends we.a{constructor(e,t,r,n){super(e,t,r,n);const i=JSON.parse(this.textBody);void 0!==i.type&&(this.privConversationMessageType=i.type)}get conversationMessageType(){return this.privConversationMessageType}}class hr{constructor(){this.toConnectionMessage=e=>{const t=new S.a;try{if(e.messageType===we.b.Text){const r=new ur(e.messageType,e.textContent,{},e.id);t.resolve(r)}else e.messageType===we.b.Binary&&t.resolve(new ur(e.messageType,e.binaryContent,void 0,e.id))}catch(e){t.reject("Error formatting the message. Error: "+e)}return t.promise()},this.fromConnectionMessage=e=>{const t=new S.a;try{if(e.messageType===we.b.Text){const r=""+(e.textBody?e.textBody:"");t.resolve(new nt.a(we.b.Text,r,e.id))}}catch(e){t.reject("Error formatting the message. "+e)}return t.promise()}}}class vr extends rt{create(e,t,r){const n=e.parameters.getProperty(de.ConversationTranslator_Host,Jt.host),i=e.parameters.getProperty(de.ConversationTranslator_CorrelationId,Object(D.a)()),o=`wss://${n}${Jt.webSocketPath}`,s=e.parameters.getProperty(de.ConversationTranslator_Token,void 0);L.throwIfNullOrUndefined(s,"token");const a={};return a[Jt.params.apiVersion]=Jt.apiVersion,a[Jt.params.token]=s,a[Jt.params.correlationId]=i,new Ze(o,a,{},new hr,et.fromRecognizerConfig(e),r)}}class lr extends ee{constructor(e,t){super(t),this.privExpirationTime=e}get expirationTime(){return this.privExpirationTime}}class dr extends ve{constructor(e,t,r,n,i,o,s,a,c,p,u){super(t,n,i,o,s,a,c,p,u),this.privId=e,this.privOrigLang=r}get participantId(){return this.privId}get originalLang(){return this.privOrigLang}}class fr extends te{constructor(e,t,r,n,i){super(n,i),this.privReason=e,this.privErrorDetails=t,this.privErrorCode=r}get reason(){return this.privReason}get errorCode(){return this.privErrorCode}get errorDetails(){return this.privErrorDetails}}class gr{constructor(e){this.privIsDisposed=!1,this.privDetachables=new Array,this.onPreConnectionStart=(e,t)=>{this.privSessionId=t},this.onAuthCompleted=(e,t)=>{e&&this.onComplete()},this.onConnectionEstablishCompleted=(e,t)=>{200!==e&&403===e&&this.onComplete()},this.onServiceTurnEndResponse=e=>{e?this.privRequestId=Object(D.b)():this.onComplete()},this.dispose=e=>{if(!this.privIsDisposed){this.privIsDisposed=!0;for(const e of this.privDetachables)e.detach()}},this.onComplete=()=>{},this.privSessionId=e,this.privRequestId=Object(D.b)(),this.privRequestCompletionDeferral=new S.a}get sessionId(){return this.privSessionId}get requestId(){return this.privRequestId}get completionPromise(){return this.privRequestCompletionDeferral.promise()}}class yr extends ee{constructor(e,t){super(t),this.privIsMuted=e}get isMuted(){return this.privIsMuted}}class mr extends ee{constructor(e,t){super(t),this.privIsLocked=e}get isMuted(){return this.privIsLocked}}class Sr extends ee{constructor(e,t){super(t),this.privParticipant=e}get participant(){return this.privParticipant}}class Cr extends ee{constructor(e,t,r,n){super(n),this.privKey=t,this.privValue=r,this.privParticipantId=e}get value(){return this.privValue}get key(){return this.privKey}get id(){return this.privParticipantId}}class br extends ee{constructor(e,t,r,n,i,o,s,a,c){super(c),this.privRoomId=e,this.privSessionToken=t,this.privTranslateTo=r,this.privProfanityFilter=n,this.privRoomProfanityFilter=i,this.privIsRoomLocked=o,this.privIsRoomLocked=s,this.privParticipants=a}get sessionToken(){return this.privSessionToken}get conversationId(){return this.privRoomId}get translateTo(){return this.privTranslateTo}get profanityFilter(){return this.privProfanityFilter}get roomProfanityFilter(){return this.privRoomProfanityFilter}get isRoomLocked(){return this.privIsRoomLocked}get isMuteAll(){return this.privIsMuteAll}get participants(){return this.privParticipants}}class Pr{constructor(e,t,r){this.privPayload=t,this.privCommand=e,this.privSessionId=r}get payload(){return this.privPayload}get command(){return this.privCommand}get sessionId(){return this.privSessionId}}class Rr{constructor(e){this.privCommandResponse=JSON.parse(e)}static fromJSON(e){return new Rr(e)}get type(){return this.privCommandResponse.type}get command(){return this.privCommandResponse.command}get id(){return this.privCommandResponse.id}get nickname(){return this.privCommandResponse.nickname}get participantId(){return this.privCommandResponse.participantId}get roomid(){return this.privCommandResponse.roomid}get value(){return this.privCommandResponse.value}}class Ir{constructor(e){this.privParticipantsPayloadResponse=JSON.parse(e)}static fromJSON(e){return new Ir(e)}get roomid(){return this.privParticipantsPayloadResponse.roomid}get id(){return this.privParticipantsPayloadResponse.id}get command(){return this.privParticipantsPayloadResponse.command}get participants(){return this.privParticipantsPayloadResponse.participants}get token(){return this.privParticipantsPayloadResponse.token}get translateTo(){return this.privParticipantsPayloadResponse.translateTo}get profanityFilter(){return this.privParticipantsPayloadResponse.profanityFilter}get roomProfanityFilter(){return this.privParticipantsPayloadResponse.roomProfanityFilter}get roomLocked(){return this.privParticipantsPayloadResponse.roomLocked}get muteAll(){return this.privParticipantsPayloadResponse.muteAll}get type(){return this.privParticipantsPayloadResponse.type}}class wr{constructor(e){this.privParticipantPayloadResponse=JSON.parse(e)}static fromJSON(e){return new wr(e)}get nickname(){return this.privParticipantPayloadResponse.nickname}get locale(){return this.privParticipantPayloadResponse.locale}get usetts(){return this.privParticipantPayloadResponse.usetts}get ismuted(){return this.privParticipantPayloadResponse.ismuted}get ishost(){return this.privParticipantPayloadResponse.ishost}get participantId(){return this.privParticipantPayloadResponse.participantId}get avatar(){return this.privParticipantPayloadResponse.avatar}}class Er{constructor(e){this.privSpeechResponse=JSON.parse(e)}static fromJSON(e){return new Er(e)}get recognition(){return this.privSpeechResponse.recognition}get translations(){return this.privSpeechResponse.translations}get id(){return this.privSpeechResponse.id}get language(){return this.privSpeechResponse.language}get nickname(){return this.privSpeechResponse.nickname}get participantId(){return this.privSpeechResponse.participantId}get roomid(){return this.privSpeechResponse.roomid}get timestamp(){return this.privSpeechResponse.timestamp}get type(){return this.privSpeechResponse.type}get isFinal(){return"final"===this.privSpeechResponse.type}}class Tr{constructor(e){this.privTextResponse=JSON.parse(e)}static fromJSON(e){return new Tr(e)}get originalText(){return this.privTextResponse.originalText}get translations(){return this.privTextResponse.translations}get id(){return this.privTextResponse.id}get language(){return this.privTextResponse.language}get nickname(){return this.privTextResponse.nickname}get participantId(){return this.privTextResponse.participantId}get roomid(){return this.privTextResponse.roomid}get timestamp(){return this.privTextResponse.timestamp}get type(){return this.privTextResponse.type}}class Or extends Be{constructor(e,t,r,n,i){super(e,t,r,n,i),this.privUtteranceId="",this.sendMessageAsync=e=>{const t=new S.e;return this.fetchConversationConnection().continueWith(r=>{try{r.isError?t.reject(r.error):r.result.send(new ur(we.b.Text,e)).continueWith(e=>{try{e.isError?t.reject(e.error):t.resolve(e.result)}catch(e){t.reject("Unhandled inner error: "+e)}})}catch(e){t.reject("Unhandled error: "+e)}}),new S.b(t)},this.noOp=()=>{},this.receiveConversationMessageOverride=(e,t)=>{const r=new S.a;return this.fetchConversationConnection().on(e=>e.read().onSuccessContinueWithPromise(e=>{const t=this.isDisposed(),n=!this.isDisposed()&&this.terminateMessageLoop,i=this.privConversationRequestSession.sessionId;if(t||n)return r.resolve(void 0),S.c.fromResult(void 0);if(!e)return this.receiveConversationMessageOverride();try{switch(e.conversationMessageType.toLowerCase()){case"info":case"participant_command":case"command":const t=Rr.fromJSON(e.textBody);switch(t.command.toLowerCase()){case"participantlist":const r=Ir.fromJSON(e.textBody),n=r.participants.map(e=>({avatar:e.avatar,displayName:e.nickname,id:e.participantId,isHost:e.ishost,isMuted:e.ismuted,isUsingTts:e.usetts,preferredLanguage:e.locale}));this.privConversationServiceConnector.participantsListReceived&&this.privConversationServiceConnector.participantsListReceived(this.privConversationServiceConnector,new br(r.roomid,r.token,r.translateTo,r.profanityFilter,r.roomProfanityFilter,r.roomLocked,r.muteAll,n,i));break;case"settranslatetolanguages":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new Cr(t.participantId,ar,t.value,i));break;case"setprofanityfiltering":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new Cr(t.participantId,sr,t.value,i));break;case"setmute":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new Cr(t.participantId,ir,t.value,i));break;case"setmuteall":this.privConversationServiceConnector.muteAllCommandReceived&&this.privConversationServiceConnector.muteAllCommandReceived(this.privConversationServiceConnector,new yr(t.value,i));break;case"roomexpirationwarning":this.privConversationServiceConnector.conversationExpiration&&this.privConversationServiceConnector.conversationExpiration(this.privConversationServiceConnector,new lr(t.value,this.privConversationRequestSession.sessionId));break;case"setusetts":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new Cr(t.participantId,cr,t.value,i));break;case"setlockstate":this.privConversationServiceConnector.lockRoomCommandReceived&&this.privConversationServiceConnector.lockRoomCommandReceived(this.privConversationServiceConnector,new mr(t.value,i));break;case"changenickname":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new Cr(t.participantId,tr,t.nickname,i));break;case"joinsession":const o=wr.fromJSON(e.textBody),s={avatar:o.avatar,displayName:o.nickname,id:o.participantId,isHost:o.ishost,isMuted:o.ismuted,isUsingTts:o.usetts,preferredLanguage:o.locale};this.privConversationServiceConnector.participantJoinCommandReceived&&this.privConversationServiceConnector.participantJoinCommandReceived(this.privConversationServiceConnector,new Sr(s,i));break;case"leavesession":const a={id:t.participantId};this.privConversationServiceConnector.participantLeaveCommandReceived&&this.privConversationServiceConnector.participantLeaveCommandReceived(this.privConversationServiceConnector,new Sr(a,i));break;case"disconnectsession":t.participantId}break;case"partial":case"final":const r=Er.fromJSON(e.textBody),n=new dr(r.participantId,this.getTranslations(r.translations),r.language,void 0,void 0,r.recognition,void 0,void 0,e.textBody,void 0);r.isFinal?void 0!==n.text&&n.text.length>0&&r.id!==this.privUtteranceId&&this.privConversationServiceConnector.translationReceived&&this.privConversationServiceConnector.translationReceived(this.privConversationServiceConnector,new Pr($t,n,i)):this.privConversationServiceConnector.translationReceived&&this.privConversationServiceConnector.translationReceived(this.privConversationServiceConnector,new Pr(Zt,n,i)),this.privUtteranceId=r.id;break;case"translated_message":const o=Tr.fromJSON(e.textBody),s=new dr(o.participantId,this.getTranslations(o.translations),o.language,void 0,void 0,o.originalText,void 0,void 0,void 0,e.textBody,void 0);this.privConversationServiceConnector.translationReceived&&this.privConversationServiceConnector.translationReceived(this.privConversationServiceConnector,new Pr(Xt,s,i))}}catch(e){}return this.receiveConversationMessageOverride()}),e=>{this.terminateMessageLoop=!0}),r.promise()},this.fetchConversationConnection=()=>this.configConnection(),this.privConversationServiceConnector=i,this.privConversationAuthentication=e,this.receiveMessageOverride=this.receiveConversationMessageOverride,this.recognizeOverride=this.noOp,this.connectImplOverride=this.conversationConnectImpl,this.configConnectionOverride=this.configConnection,this.fetchConnectionOverride=this.fetchConversationConnection,this.disconnectOverride=this.privDisconnect,this.privConversationRequestSession=new gr(Object(D.b)()),this.privConversationConnectionFactory=t,this.privConversationIsDisposed=!1}isDisposed(){return this.privConversationIsDisposed}dispose(e){this.privConversationIsDisposed=!0,this.privConnectionConfigPromise&&this.privConnectionConfigPromise.onSuccessContinueWith(t=>{t.dispose(e)})}sendMessage(e){this.fetchConversationConnection().onSuccessContinueWith(t=>{t.send(new ur(we.b.Text,e))})}privDisconnect(){this.terminateMessageLoop||(this.cancelRecognition(this.privConversationRequestSession.sessionId,this.privConversationRequestSession.requestId,Y.Error,Re.NoError,"Disconnecting"),this.terminateMessageLoop=!0,this.privConversationConnectionPromise.result().isCompleted?this.privConversationConnectionPromise.result().isError||(this.privConversationConnectionPromise.result().result.dispose(),this.privConversationConnectionPromise=null):this.privConversationConnectionPromise.onSuccessContinueWith(e=>{e.dispose()}))}processTypeSpecificMessages(e,t,r){return!0}cancelRecognition(e,t,r,n,i){this.terminateMessageLoop=!0;const o=new fr(r,i,n,void 0,e);try{this.privConversationServiceConnector.canceled&&this.privConversationServiceConnector.canceled(this.privConversationServiceConnector,o)}catch(e){}}conversationConnectImpl(e=!1){if(this.privConversationConnectionPromise)return this.privConversationConnectionPromise.result().isCompleted&&(this.privConversationConnectionPromise.result().isError||this.privConversationConnectionPromise.result().result.state()===Te.a.Disconnected)?(this.privConnectionId=null,this.privConversationConnectionPromise=null,this.terminateMessageLoop=!0,this.conversationConnectImpl()):this.privConversationConnectionPromise;this.privConversationAuthFetchEventId=Object(D.b)(),void 0===this.privConnectionId&&(this.privConnectionId=Object(D.b)()),this.privConversationRequestSession.onPreConnectionStart(this.privConversationAuthFetchEventId,this.privConnectionId);const t=e?this.privConversationAuthentication.fetchOnExpiry(this.privConversationAuthFetchEventId):this.privConversationAuthentication.fetch(this.privConversationAuthFetchEventId);return this.privConversationConnectionPromise=t.continueWithPromise(t=>{if(t.isError)throw this.privConversationRequestSession.onAuthCompleted(!0,t.error),new Error(t.error);this.privConversationRequestSession.onAuthCompleted(!1);const r=this.privConversationConnectionFactory.create(this.privRecognizerConfig,t.result,this.privConnectionId);return r.events.attach(e=>{this.connectionEvents.onEvent(e)}),r.open().onSuccessContinueWithPromise(t=>{if(200===t.statusCode){this.privConversationRequestSession.onPreConnectionStart(this.privConversationAuthFetchEventId,this.privConnectionId),this.privConversationRequestSession.onConnectionEstablishCompleted(t.statusCode);const e=new ee(this.privConversationRequestSession.sessionId);return this.privConversationServiceConnector.connectionOpened&&this.privConversationServiceConnector.connectionOpened(this.privConversationServiceConnector,e),S.c.fromResult(r)}return 403!==t.statusCode||e?(this.privConversationRequestSession.onConnectionEstablishCompleted(t.statusCode,t.reason),S.c.fromError(`Unable to contact server. StatusCode: ${t.statusCode}, ${this.privRecognizerConfig.parameters.getProperty(de.SpeechServiceConnection_Endpoint)} Reason: ${t.reason}`)):this.conversationConnectImpl(!0)})}),this.privConnectionLoop=this.startMessageLoop(),this.privConversationConnectionPromise}startMessageLoop(){this.terminateMessageLoop=!1;return this.receiveConversationMessageOverride().on(e=>!0,e=>{this.cancelRecognition(this.privRequestSession?this.privRequestSession.sessionId:"",this.privRequestSession?this.privRequestSession.requestId:"",Y.Error,Re.RuntimeError,e)})}configConnection(){return this.privConnectionConfigPromise?this.privConnectionConfigPromise.result().isCompleted&&(this.privConnectionConfigPromise.result().isError||this.privConnectionConfigPromise.result().result.state()===Te.a.Disconnected)?(this.privConnectionConfigPromise=null,this.configConnection()):this.privConnectionConfigPromise:this.terminateMessageLoop?S.c.fromResult(void 0):(this.privConnectionConfigPromise=this.conversationConnectImpl().onSuccessContinueWith(e=>e),this.privConnectionConfigPromise)}getTranslations(e){let t;if(void 0!==e){t=new yt;for(const r of e)t.set(r.lang,r.translation)}return t}}class Ar extends He{constructor(e,t){const r=e;L.throwIfNull(r,"speechConfig"),super(t,r.properties,new vr),this.privIsDisposed=!1,this.privProperties=r.properties.clone()}set conversation(e){this.privRoom=e}get speechRecognitionLanguage(){return this.privSpeechRecognitionLanguage}get properties(){return this.privProperties}isDisposed(){return this.privIsDisposed}connect(e,t,r){try{L.throwIfDisposed(this.privIsDisposed),L.throwIfNullOrWhitespace(e,"token"),this.privReco.conversationTranslatorToken=e,this.privReco.connectAsync(t,r)}catch(e){if(r)if(e instanceof Error){const t=e;r(t.name+": "+t.message)}else r(e)}}disconnect(e,t){try{L.throwIfDisposed(this.privIsDisposed),this.privRoom=void 0,this.privReco.disconnectAsync(e,t)}catch(e){if(t)if(e instanceof Error){const r=e;t(r.name+": "+r.message)}else t(e);this.dispose(!0)}}sendMessageRequest(e,t,r){try{L.throwIfDisposed(this.privIsDisposed),L.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),L.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),L.throwIfNullOrWhitespace(e,"message");const n={participantId:this.privRoom.participantId,roomId:this.privRoom.roomId,text:e,type:Xt};this.sendMessage(JSON.stringify(n),t,r)}catch(e){if(r)if(e instanceof Error){const t=e;r(t.name+": "+t.message)}else r(e);this.dispose(!0)}}sendLockRequest(e,t,r){try{L.throwIfDisposed(this.privIsDisposed),L.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),L.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),L.throwIfNullOrUndefined(e,"isLocked");const n={command:nr,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:er,value:e};this.sendMessage(JSON.stringify(n),t,r)}catch(e){if(r)if(e instanceof Error){const t=e;r(t.name+": "+t.message)}else r(e);this.dispose(!0)}}sendMuteAllRequest(e,t,r){try{L.throwIfDisposed(this.privIsDisposed),L.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),L.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),L.throwIfNullOrUndefined(e,"isMuted");const n={command:or,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:er,value:e};this.sendMessage(JSON.stringify(n),t,r)}catch(e){if(r)if(e instanceof Error){const t=e;r(t.name+": "+t.message)}else r(e);this.dispose(!0)}}sendMuteRequest(e,t,r,n){try{L.throwIfDisposed(this.privIsDisposed),L.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),L.throwIfNullOrWhitespace(e,"participantId"),L.throwIfNullOrUndefined(t,"isMuted");const i={command:ir,participantId:e,roomid:this.privRoom.roomId,type:er,value:t};this.sendMessage(JSON.stringify(i),r,n)}catch(e){if(n)if(e instanceof Error){const t=e;n(t.name+": "+t.message)}else n(e);this.dispose(!0)}}sendEjectRequest(e,t,r){try{L.throwIfDisposed(this.privIsDisposed),L.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),L.throwIfNullOrWhitespace(e,"participantId");const n={command:rr,participantId:e,roomid:this.privRoom.roomId,type:er};if(this.sendMessage(JSON.stringify(n),t,r),t)try{t()}catch(e){r&&r(e)}}catch(e){if(r)if(e instanceof Error){const t=e;r(t.name+": "+t.message)}else r(e);this.dispose(!0)}}sendChangeNicknameRequest(e,t,r){try{L.throwIfDisposed(this.privIsDisposed),L.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),L.throwIfNullOrWhitespace(e,"nickname");const n={command:tr,nickname:e,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:er,value:e};this.sendMessage(JSON.stringify(n),t,r)}catch(e){if(r)if(e instanceof Error){const t=e;r(t.name+": "+t.message)}else r(e);this.dispose(!0)}}close(){L.throwIfDisposed(this.privIsDisposed),this.dispose(!0)}dispose(e){this.privIsDisposed||e&&(this.privIsDisposed=!0,super.dispose(e))}createRecognizerConfig(e){return new d(e,this.privProperties)}createServiceRecognizer(e,t,r,n){return new Or(e,t,r,n,this)}sendMessage(e,t,r){!function(e,t,r){e?e.continueWith(e=>{try{e.isError?r&&r(e.error):t&&t()}catch(t){r&&r(`'Unhandled error on promise callback: ${t}. InnerError: ${e.error}'`)}}):r&&r("Null promise")}(this.privReco.sendMessageAsync(e),t,r)}}class _r extends ee{constructor(e,t,r){super(r),this.privReason=e,this.privParticipant=t}get reason(){return this.privReason}get participants(){return this.privParticipant}}var Dr,xr;!function(e){e[e.JoinedConversation=0]="JoinedConversation",e[e.LeftConversation=1]="LeftConversation",e[e.Updated=2]="Updated"}(Dr||(Dr={}));class kr extends te{constructor(e,t,r){super(t,r),this.privResult=e}get result(){return this.privResult}}class Mr{constructor(e){this.privUserId=e}get userId(){return this.privUserId}}class Nr{constructor(e,t,r,n,i,o,s){this.privId=e,this.privAvatar=t,this.privDisplayName=r,this.privIsHost=n,this.privIsMuted=i,this.privIsUsingTts=o,this.privPreferredLanguage=s,this.privPoperties=new ge}get avatar(){return this.privAvatar}get displayName(){return this.privDisplayName}get id(){return this.privId}get preferredLanguage(){return this.privPreferredLanguage}get isHost(){return this.privIsHost}get isMuted(){return this.privIsMuted}get isUsingTts(){return this.privIsUsingTts}get properties(){return this.privPoperties}}class jr{constructor(){}static createConversationAsync(e,t,r){L.throwIfNullOrUndefined(e,Jt.strings.invalidArgs.replace("{arg}","config")),L.throwIfNullOrUndefined(e.region,Jt.strings.invalidArgs.replace("{arg}","SpeechServiceConnection_Region")),e.subscriptionKey||e.getProperty(de[de.SpeechServiceAuthorization_Token])||L.throwIfNullOrUndefined(e.subscriptionKey,Jt.strings.invalidArgs.replace("{arg}","SpeechServiceConnection_Key"));const n=new zr(e);return n.createConversationAsync(()=>{t&&t()},e=>{r&&r(e)}),n}}class zr extends jr{constructor(e){super(),this.privIsDisposed=!1,this.privIsConnected=!1,this.onConnected=e=>{this.privIsConnected=!0;try{this.privConversationTranslator.sessionStarted&&this.privConversationTranslator.sessionStarted(this.privConversationTranslator,e)}catch(e){}},this.onDisconnected=e=>{this.close(!1);try{this.privConversationTranslator.sessionStopped&&this.privConversationTranslator.sessionStopped(this.privConversationTranslator,e)}catch(e){}},this.onCanceled=(e,t)=>{this.close(!1);try{this.privConversationTranslator.canceled&&this.privConversationTranslator.canceled(this.privConversationTranslator,t)}catch(t){}},this.onParticipantUpdateCommandReceived=(e,t)=>{var r,n;try{const e=this.privParticipants.getParticipant(t.id);if(void 0!==e){switch(t.key){case tr:e.displayName=t.value;break;case cr:e.useTts=t.value;break;case sr:e.profanity=t.value;break;case ir:e.isMuted=t.value;break;case ar:e.translateToLanguages=t.value}this.privParticipants.addOrUpdateParticipant(e),(null===(r=this.privConversationTranslator)||void 0===r?void 0:r.participantsChanged)&&(null===(n=this.privConversationTranslator)||void 0===n||n.participantsChanged(this.privConversationTranslator,new _r(Dr.Updated,[this.toParticipant(e)],t.sessionId)))}}catch(t){}},this.onLockRoomCommandReceived=(e,t)=>{},this.onMuteAllCommandReceived=(e,t)=>{var r,n;try{this.privParticipants.participants.forEach(e=>e.isMuted=!e.isHost&&t.isMuted),(null===(r=this.privConversationTranslator)||void 0===r?void 0:r.participantsChanged)&&(null===(n=this.privConversationTranslator)||void 0===n||n.participantsChanged(this.privConversationTranslator,new _r(Dr.Updated,this.toParticipants(!1),t.sessionId)))}catch(t){}},this.onParticipantJoinCommandReceived=(e,t)=>{var r,n;try{const e=this.privParticipants.addOrUpdateParticipant(t.participant);void 0!==e&&(null===(r=this.privConversationTranslator)||void 0===r?void 0:r.participantsChanged)&&(null===(n=this.privConversationTranslator)||void 0===n||n.participantsChanged(this.privConversationTranslator,new _r(Dr.JoinedConversation,[this.toParticipant(e)],t.sessionId)))}catch(t){}},this.onParticipantLeaveCommandReceived=(e,t)=>{var r,n;try{const e=this.privParticipants.getParticipant(t.participant.id);void 0!==e&&(this.privParticipants.deleteParticipant(t.participant.id),(null===(r=this.privConversationTranslator)||void 0===r?void 0:r.participantsChanged)&&(null===(n=this.privConversationTranslator)||void 0===n||n.participantsChanged(this.privConversationTranslator,new _r(Dr.LeftConversation,[this.toParticipant(e)],t.sessionId))))}catch(t){}},this.onTranslationReceived=(e,t)=>{var r,n,i,o,s,a;try{switch(t.command){case $t:(null===(r=this.privConversationTranslator)||void 0===r?void 0:r.transcribed)&&(null===(n=this.privConversationTranslator)||void 0===n||n.transcribed(this.privConversationTranslator,new kr(t.payload,void 0,t.sessionId)));break;case Zt:(null===(i=this.privConversationTranslator)||void 0===i?void 0:i.transcribing)&&(null===(o=this.privConversationTranslator)||void 0===o||o.transcribing(this.privConversationTranslator,new kr(t.payload,void 0,t.sessionId)));break;case Xt:(null===(s=this.privConversationTranslator)||void 0===s?void 0:s.textMessageReceived)&&(null===(a=this.privConversationTranslator)||void 0===a||a.textMessageReceived(this.privConversationTranslator,new kr(t.payload,void 0,t.sessionId)))}}catch(t){}},this.onParticipantsListReceived=(e,t)=>{var r,n;try{if(void 0!==t.sessionToken&&null!==t.sessionToken&&(this.privRoom.token=t.sessionToken),this.privParticipants.participants=[...t.participants],void 0!==this.privParticipants.me&&(this.privIsReady=!0),(null===(r=this.privConversationTranslator)||void 0===r?void 0:r.participantsChanged)&&(null===(n=this.privConversationTranslator)||void 0===n||n.participantsChanged(this.privConversationTranslator,new _r(Dr.JoinedConversation,this.toParticipants(!0),t.sessionId))),this.me.isHost){const e=this.privConversationTranslator.properties.getProperty(de.ConversationTranslator_Name);void 0!==e&&e.length>0&&e!==this.me.displayName&&this.changeNicknameAsync(e)}}catch(t){}},this.onConversationExpiration=(e,t)=>{var r,n;try{(null===(r=this.privConversationTranslator)||void 0===r?void 0:r.conversationExpiration)&&(null===(n=this.privConversationTranslator)||void 0===n||n.conversationExpiration(this.privConversationTranslator,t))}catch(t){}},this.privProperties=new ge,this.privManager=new pr;e.getProperty(de[de.SpeechServiceConnection_RecoLanguage])||e.setProperty(de[de.SpeechServiceConnection_RecoLanguage],Jt.defaultLanguageCode),this.privLanguage=e.getProperty(de[de.SpeechServiceConnection_RecoLanguage]),0===e.targetLanguages.length&&e.addTargetLanguage(this.privLanguage);e.getProperty(de[de.SpeechServiceResponse_ProfanityOption])||e.setProfanity(fe.Masked);let t=e.getProperty(de[de.ConversationTranslator_Name]);(null==t||t.length<=1||t.length>50)&&(t="Host"),e.setProperty(de[de.ConversationTranslator_Name],t),this.privConfig=e;const r=e;L.throwIfNull(r,"speechConfig"),this.privProperties=r.properties.clone(),this.privIsConnected=!1,this.privParticipants=new Yt,this.privIsReady=!1}set conversationTranslator(e){this.privConversationTranslator=e}get room(){return this.privRoom}get connection(){return this.privConversationRecognizer}get authorizationToken(){return this.privToken}set authorizationToken(e){L.throwIfNullOrWhitespace(e,"authorizationToken"),this.privToken=e}get config(){return this.privConfig}get conversationId(){return this.privRoom?this.privRoom.roomId:""}get properties(){return this.privProperties}get speechRecognitionLanguage(){return this.privLanguage}get isMutedByHost(){var e,t;return!(null===(e=this.privParticipants.me)||void 0===e?void 0:e.isHost)&&(null===(t=this.privParticipants.me)||void 0===t?void 0:t.isMuted)}get isConnected(){return this.privIsConnected&&this.privIsReady}get participants(){return this.toParticipants(!0)}get me(){return this.toParticipant(this.privParticipants.me)}get host(){return this.toParticipant(this.privParticipants.host)}createConversationAsync(e,t){try{this.privConversationRecognizer&&this.handleError(new Error(Jt.strings.permissionDeniedStart),t),this.privManager.createOrJoin(this.privProperties,void 0,r=>{r||this.handleError(new Error(Jt.strings.permissionDeniedConnect),t),this.privRoom=r,this.handleCallback(e,t)},e=>{this.handleError(e,t)})}catch(e){this.handleError(e,t)}}startConversationAsync(e,t){try{this.privConversationRecognizer&&this.handleError(new Error(Jt.strings.permissionDeniedStart),t),L.throwIfNullOrUndefined(this.privRoom,Jt.strings.permissionDeniedConnect),this.privParticipants.meId=this.privRoom.participantId,this.privConversationRecognizer=new Ar(this.privConfig),this.privConversationRecognizer.conversation=this.privRoom,this.privConversationRecognizerConnection=Tt.fromRecognizer(this.privConversationRecognizer),this.privConversationRecognizerConnection.connected=this.onConnected,this.privConversationRecognizerConnection.disconnected=this.onDisconnected,this.privConversationRecognizer.canceled=this.onCanceled,this.privConversationRecognizer.participantUpdateCommandReceived=this.onParticipantUpdateCommandReceived,this.privConversationRecognizer.lockRoomCommandReceived=this.onLockRoomCommandReceived,this.privConversationRecognizer.muteAllCommandReceived=this.onMuteAllCommandReceived,this.privConversationRecognizer.participantJoinCommandReceived=this.onParticipantJoinCommandReceived,this.privConversationRecognizer.participantLeaveCommandReceived=this.onParticipantLeaveCommandReceived,this.privConversationRecognizer.translationReceived=this.onTranslationReceived,this.privConversationRecognizer.participantsListReceived=this.onParticipantsListReceived,this.privConversationRecognizer.conversationExpiration=this.onConversationExpiration,this.privConversationRecognizer.connect(this.privRoom.token,()=>{this.handleCallback(e,t)},e=>{this.handleError(e,t)})}catch(e){this.handleError(e,t)}}joinConversationAsync(e,t,r,n,i){try{L.throwIfNullOrWhitespace(e,Jt.strings.invalidArgs.replace("{arg}","conversationId")),L.throwIfNullOrWhitespace(t,Jt.strings.invalidArgs.replace("{arg}","nickname")),L.throwIfNullOrWhitespace(r,Jt.strings.invalidArgs.replace("{arg}","language")),this.privManager.createOrJoin(this.privProperties,e,e=>{L.throwIfNullOrUndefined(e,Jt.strings.permissionDeniedConnect),this.privRoom=e,this.privConfig.authorizationToken=e.cognitiveSpeechAuthToken,n&&n(e.cognitiveSpeechAuthToken)},e=>{this.handleError(e,i)})}catch(e){this.handleError(e,i)}}deleteConversationAsync(e,t){try{L.throwIfNullOrUndefined(this.privProperties,Jt.strings.permissionDeniedConnect),L.throwIfNullOrWhitespace(this.privRoom.token,Jt.strings.permissionDeniedConnect),this.privManager.leave(this.privProperties,this.privRoom.token,()=>{this.handleCallback(e,t)},e=>{this.handleError(e,t)}),this.dispose()}catch(e){this.handleError(e,t)}}endConversationAsync(e,t){try{this.close(!0),this.handleCallback(e,t)}catch(e){this.handleError(e,t)}}lockConversationAsync(e,t){var r;try{L.throwIfDisposed(this.privIsDisposed),L.throwIfDisposed(this.privConversationRecognizer.isDisposed()),L.throwIfNullOrUndefined(this.privRoom,Jt.strings.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(Jt.strings.permissionDeniedConversation.replace("{command}","lock")),t),null===(r=this.privConversationRecognizer)||void 0===r||r.sendLockRequest(!0,()=>{this.handleCallback(e,t)},e=>{this.handleError(e,t)})}catch(e){this.handleError(e,t)}}muteAllParticipantsAsync(e,t){var r;try{L.throwIfDisposed(this.privIsDisposed),L.throwIfDisposed(this.privConversationRecognizer.isDisposed()),L.throwIfNullOrUndefined(this.privConversationRecognizer,Jt.strings.permissionDeniedSend),L.throwIfNullOrUndefined(this.privRoom,Jt.strings.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(Jt.strings.permissionDeniedConversation.replace("{command}","mute")),t),null===(r=this.privConversationRecognizer)||void 0===r||r.sendMuteAllRequest(!0,()=>{this.handleCallback(e,t)},e=>{this.handleError(e,t)})}catch(e){this.handleError(e,t)}}muteParticipantAsync(e,t,r){var n;try{L.throwIfDisposed(this.privIsDisposed),L.throwIfDisposed(this.privConversationRecognizer.isDisposed()),L.throwIfNullOrWhitespace(e,Jt.strings.invalidArgs.replace("{arg}","userId")),L.throwIfNullOrUndefined(this.privRoom,Jt.strings.permissionDeniedSend),this.canSend||this.handleError(new Error(Jt.strings.permissionDeniedSend),r),this.me.isHost||this.me.id===e||this.handleError(new Error(Jt.strings.permissionDeniedParticipant.replace("{command}","mute")),r);-1===this.privParticipants.getParticipantIndex(e)&&this.handleError(new Error(Jt.strings.invalidParticipantRequest),r),null===(n=this.privConversationRecognizer)||void 0===n||n.sendMuteRequest(e,!0,()=>{this.handleCallback(t,r)},e=>{this.handleError(e,r)})}catch(e){this.handleError(e,r)}}removeParticipantAsync(e,t,r){var n;try{L.throwIfDisposed(this.privIsDisposed),L.throwIfDisposed(this.privConversationRecognizer.isDisposed()),L.throwIfNullOrUndefined(this.privRoom,Jt.strings.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(Jt.strings.permissionDeniedParticipant.replace("{command}","remove")),r);let i="";if("string"==typeof e)i=e;else if(e.hasOwnProperty("id")){i=e.id}else if(e.hasOwnProperty("userId")){i=e.userId}L.throwIfNullOrWhitespace(i,Jt.strings.invalidArgs.replace("{arg}","userId"));-1===this.participants.findIndex(e=>e.id===i)&&this.handleError(new Error(Jt.strings.invalidParticipantRequest),r),null===(n=this.privConversationRecognizer)||void 0===n||n.sendEjectRequest(i,()=>{this.handleCallback(t,r)},e=>{this.handleError(e,r)})}catch(e){this.handleError(e,r)}}unlockConversationAsync(e,t){var r;try{L.throwIfDisposed(this.privIsDisposed),L.throwIfDisposed(this.privConversationRecognizer.isDisposed()),L.throwIfNullOrUndefined(this.privRoom,Jt.strings.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(Jt.strings.permissionDeniedConversation.replace("{command}","unlock")),t),null===(r=this.privConversationRecognizer)||void 0===r||r.sendLockRequest(!1,()=>{this.handleCallback(e,t)},e=>{this.handleError(e,t)})}catch(e){this.handleError(e,t)}}unmuteAllParticipantsAsync(e,t){var r;try{L.throwIfDisposed(this.privIsDisposed),L.throwIfDisposed(this.privConversationRecognizer.isDisposed()),L.throwIfNullOrUndefined(this.privRoom,Jt.strings.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(Jt.strings.permissionDeniedConversation.replace("{command}","unmute all")),t),null===(r=this.privConversationRecognizer)||void 0===r||r.sendMuteAllRequest(!1,()=>{this.handleCallback(e,t)},e=>{this.handleError(e,t)})}catch(e){this.handleError(e,t)}}unmuteParticipantAsync(e,t,r){var n;try{L.throwIfDisposed(this.privIsDisposed),L.throwIfDisposed(this.privConversationRecognizer.isDisposed()),L.throwIfNullOrWhitespace(e,Jt.strings.invalidArgs.replace("{arg}","userId")),L.throwIfNullOrUndefined(this.privRoom,Jt.strings.permissionDeniedSend),this.canSend||this.handleError(new Error(Jt.strings.permissionDeniedSend),r),this.me.isHost||this.me.id===e||this.handleError(new Error(Jt.strings.permissionDeniedParticipant.replace("{command}","mute")),r);-1===this.privParticipants.getParticipantIndex(e)&&this.handleError(new Error(Jt.strings.invalidParticipantRequest),r),null===(n=this.privConversationRecognizer)||void 0===n||n.sendMuteRequest(e,!1,()=>{this.handleCallback(t,r)},e=>{this.handleError(e,r)})}catch(e){this.handleError(e,r)}}sendTextMessageAsync(e,t,r){var n;try{L.throwIfDisposed(this.privIsDisposed),L.throwIfDisposed(this.privConversationRecognizer.isDisposed()),L.throwIfNullOrWhitespace(e,Jt.strings.invalidArgs.replace("{arg}","message")),L.throwIfNullOrUndefined(this.privRoom,Jt.strings.permissionDeniedSend),this.canSend||this.handleError(new Error(Jt.strings.permissionDeniedSend),r),e.length>Jt.textMessageMaxLength&&this.handleError(new Error(Jt.strings.invalidArgs.replace("{arg}","message length")),r),null===(n=this.privConversationRecognizer)||void 0===n||n.sendMessageRequest(e,()=>{this.handleCallback(t,r)},e=>{this.handleError(e,r)})}catch(e){this.handleError(e,r)}}changeNicknameAsync(e,t,r){var n;try{L.throwIfDisposed(this.privIsDisposed),L.throwIfDisposed(this.privConversationRecognizer.isDisposed()),L.throwIfNullOrWhitespace(e,Jt.strings.invalidArgs.replace("{arg}","nickname")),L.throwIfNullOrUndefined(this.privRoom,Jt.strings.permissionDeniedSend),this.canSend||this.handleError(new Error(Jt.strings.permissionDeniedSend),r),null===(n=this.privConversationRecognizer)||void 0===n||n.sendChangeNicknameRequest(e,()=>{this.handleCallback(t,r)},e=>{this.handleError(e,r)})}catch(e){this.handleError(e,r)}}isDisposed(){return this.privIsDisposed}dispose(e){var t;this.isDisposed||(this.privIsDisposed=!0,null===(t=this.config)||void 0===t||t.close(),this.privConversationRecognizerConnection&&(this.privConversationRecognizerConnection.closeConnection(),this.privConversationRecognizerConnection.close(),this.privConversationRecognizerConnection=void 0),this.privConfig=void 0,this.privLanguage=void 0,this.privProperties=void 0,this.privRoom=void 0,this.privToken=void 0,this.privManager=void 0,this.privConversationRecognizer=void 0,this.privIsConnected=!1,this.privIsReady=!1,this.privParticipants=void 0,this.privRoom=void 0)}close(e){var t,r,n;try{this.privIsConnected=!1,null===(t=this.privConversationRecognizerConnection)||void 0===t||t.closeConnection(),null===(r=this.privConversationRecognizerConnection)||void 0===r||r.close(),this.privConversationRecognizer.close(),this.privConversationRecognizerConnection=void 0,this.privConversationRecognizer=void 0,null===(n=this.privConversationTranslator)||void 0===n||n.dispose()}catch(e){}e&&this.dispose()}get canSend(){var e;return this.privIsConnected&&!(null===(e=this.privParticipants.me)||void 0===e?void 0:e.isMuted)}get canSendAsHost(){var e;return this.privIsConnected&&(null===(e=this.privParticipants.me)||void 0===e?void 0:e.isHost)}handleCallback(e,t){if(e){try{e()}catch(e){t&&t(e)}e=void 0}}handleError(e,t){if(t)if(e instanceof Error){const r=e;t(r.name+": "+r.message)}else t(e)}toParticipants(e){const t=this.privParticipants.participants.map(e=>this.toParticipant(e));return e?t:t.filter(e=>!1===e.isHost)}toParticipant(e){return new Nr(e.id,e.avatar,e.displayName,e.isHost,e.isMuted,e.isUsingTts,e.preferredLanguage)}}!function(e){e[e.Inactive=0]="Inactive",e[e.Connecting=1]="Connecting",e[e.Connected=2]="Connected"}(xr||(xr={}));class Lr{constructor(e){this.privIsDisposed=!1,this.privIsSpeaking=!1,this.privSpeechState=xr.Inactive,this.onSpeechConnected=e=>{this.privSpeechState=xr.Connected},this.onSpeechDisconnected=e=>{this.privSpeechState=xr.Inactive,this.cancelSpeech()},this.onSpeechRecognized=(e,t)=>{var r;(null===(r=t.result)||void 0===r?void 0:r.errorDetails)&&(this.cancelSpeech(),this.fireCancelEvent(t.result.errorDetails))},this.onSpeechRecognizing=(e,t)=>{},this.onSpeechCanceled=(e,t)=>{if(this.privSpeechState!==xr.Inactive)try{this.cancelSpeech()}catch(e){this.privSpeechState=xr.Inactive}},this.onSpeechSessionStarted=(e,t)=>{this.privSpeechState=xr.Connected},this.onSpeechSessionStopped=(e,t)=>{this.privSpeechState=xr.Inactive},this.privProperties=new ge,this.privAudioConfig=e}get properties(){return this.privProperties}get speechRecognitionLanguage(){return this.privSpeechRecognitionLanguage}get participants(){var e;return null===(e=this.privConversation)||void 0===e?void 0:e.participants}joinConversationAsync(e,t,r,n,i){try{if("string"==typeof e){L.throwIfNullOrUndefined(e,Jt.strings.invalidArgs.replace("{arg}","conversation id")),L.throwIfNullOrWhitespace(t,Jt.strings.invalidArgs.replace("{arg}","nickname")),this.privConversation&&this.handleError(new Error(Jt.strings.permissionDeniedStart),i);let o=r;null!=o&&""!==o||(o=Jt.defaultLanguageCode),this.privSpeechTranslationConfig=Se.fromSubscription(Jt.auth.placeholderSubscriptionKey,Jt.auth.placeholderRegion),this.privSpeechTranslationConfig.setProfanity(fe.Masked),this.privSpeechTranslationConfig.addTargetLanguage(o),this.privSpeechTranslationConfig.setProperty(de[de.SpeechServiceConnection_RecoLanguage],o),this.privSpeechTranslationConfig.setProperty(de[de.ConversationTranslator_Name],t);const s=this.privProperties.getProperty(de.ConversationTranslator_Host);s&&this.privSpeechTranslationConfig.setProperty(de[de.ConversationTranslator_Host],s);const a=this.privProperties.getProperty(de.SpeechServiceConnection_Host);a&&this.privSpeechTranslationConfig.setProperty(de[de.SpeechServiceConnection_Host],a),this.privConversation=new zr(this.privSpeechTranslationConfig),this.privConversation.conversationTranslator=this,this.privConversation.joinConversationAsync(e,t,o,e=>{e||this.handleError(new Error(Jt.strings.permissionDeniedConnect),i),this.privSpeechTranslationConfig.authorizationToken=e,this.privConversation.startConversationAsync(()=>{this.handleCallback(n,i)},e=>{this.handleError(e,i)})},e=>{this.handleError(e,i)})}else"object"==typeof e?(L.throwIfNullOrUndefined(e,Jt.strings.invalidArgs.replace("{arg}","conversation id")),L.throwIfNullOrWhitespace(t,Jt.strings.invalidArgs.replace("{arg}","nickname")),this.privProperties.setProperty(de.ConversationTranslator_Name,t),this.privConversation=e,this.privConversation.conversationTranslator=this,L.throwIfNullOrUndefined(this.privConversation,Jt.strings.permissionDeniedConnect),L.throwIfNullOrUndefined(this.privConversation.room.token,Jt.strings.permissionDeniedConnect),this.privSpeechTranslationConfig=e.config,this.handleCallback(r,n)):this.handleError(new Error(Jt.strings.invalidArgs.replace("{arg}","invalid conversation type")),n)}catch(e){this.handleError(e,"string"==typeof r?i:n)}}leaveConversationAsync(e,t){try{this.cancelSpeech(),this.privConversation.endConversationAsync(()=>{this.privConversation.deleteConversationAsync(()=>{this.handleCallback(e,t),this.dispose()},e=>{this.handleError(e,t)})},e=>{this.handleError(e,t)})}catch(e){this.handleError(e,t)}}sendTextMessageAsync(e,t,r){var n;try{L.throwIfNullOrUndefined(this.privConversation,Jt.strings.permissionDeniedSend),L.throwIfNullOrWhitespace(e,Jt.strings.invalidArgs.replace("{arg}",e)),null===(n=this.privConversation)||void 0===n||n.sendTextMessageAsync(e,t,r)}catch(e){this.handleError(e,r)}}startTranscribingAsync(e,t){try{L.throwIfNullOrUndefined(this.privConversation,Jt.strings.permissionDeniedSend),L.throwIfNullOrUndefined(this.privConversation.room.token,Jt.strings.permissionDeniedConnect),this.canSpeak||this.handleError(new Error(Jt.strings.permissionDeniedSend),t),void 0===this.privTranslationRecognizer?this.connectTranslatorRecognizer(()=>{this.startContinuousRecognition(()=>{this.privIsSpeaking=!0,this.handleCallback(e,t)},e=>{this.privIsSpeaking=!1,this.cancelSpeech(),this.handleError(e,t)})},e=>{this.handleError(e,t)}):this.startContinuousRecognition(()=>{this.privIsSpeaking=!0,this.handleCallback(e,t)},e=>{this.privIsSpeaking=!1,this.cancelSpeech(),this.handleError(e,t)})}catch(e){this.handleError(e,t),this.cancelSpeech()}}stopTranscribingAsync(e,t){var r;try{if(!this.privIsSpeaking)return this.cancelSpeech(),void this.handleCallback(e,t);this.privIsSpeaking=!1,null===(r=this.privTranslationRecognizer)||void 0===r||r.stopContinuousRecognitionAsync(()=>{this.handleCallback(e,t)},e=>{this.handleError(e,t),this.cancelSpeech()})}catch(e){this.handleError(e,t),this.cancelSpeech()}}isDisposed(){return this.privIsDisposed}dispose(e){var t,r;this.isDisposed&&!this.privIsSpeaking||(this.cancelSpeech(),this.privIsDisposed=!0,null===(t=this.privSpeechTranslationConfig)||void 0===t||t.close(),this.privSpeechRecognitionLanguage=void 0,this.privProperties=void 0,this.privAudioConfig=void 0,this.privSpeechTranslationConfig=void 0,null===(r=this.privConversation)||void 0===r||r.dispose(),this.privConversation=void 0)}connectTranslatorRecognizer(e,t){try{void 0===this.privAudioConfig&&(this.privAudioConfig=V.fromDefaultMicrophoneInput()),this.privSpeechTranslationConfig.getProperty(de[de.SpeechServiceConnection_Key])===Jt.auth.placeholderSubscriptionKey&&this.privSpeechTranslationConfig.setProperty(de[de.SpeechServiceConnection_Key],"");const r=encodeURIComponent(this.privConversation.room.token);let n=this.privSpeechTranslationConfig.getProperty(de[de.SpeechServiceConnection_Host],Jt.speechHost);n=n.replace("{region}",this.privConversation.room.cognitiveSpeechRegion);const i=`wss://${n}${Jt.speechPath}?${Jt.params.token}=${r}`;this.privSpeechTranslationConfig.setProperty(de[de.SpeechServiceConnection_Endpoint],i),this.privTranslationRecognizer=new Pt(this.privSpeechTranslationConfig,this.privAudioConfig),this.privTranslationRecognizerConnection=Tt.fromRecognizer(this.privTranslationRecognizer),this.privTranslationRecognizerConnection.connected=this.onSpeechConnected,this.privTranslationRecognizerConnection.disconnected=this.onSpeechDisconnected,this.privTranslationRecognizer.recognized=this.onSpeechRecognized,this.privTranslationRecognizer.recognizing=this.onSpeechRecognizing,this.privTranslationRecognizer.canceled=this.onSpeechCanceled,this.privTranslationRecognizer.sessionStarted=this.onSpeechSessionStarted,this.privTranslationRecognizer.sessionStopped=this.onSpeechSessionStopped,this.handleCallback(e,t)}catch(e){this.handleError(e,t),this.cancelSpeech()}}startContinuousRecognition(e,t){this.privTranslationRecognizer.startContinuousRecognitionAsync(e,t)}fireCancelEvent(e){var t,r,n;try{if(this.canceled){const i=new fr(null!==(t=null==e?void 0:e.reason)&&void 0!==t?t:Y.Error,null!==(r=null==e?void 0:e.errorDetails)&&void 0!==r?r:e,null!==(n=null==e?void 0:e.errorCode)&&void 0!==n?n:Re.RuntimeError,void 0,null==e?void 0:e.sessionId);this.canceled(this,i)}}catch(e){}}cancelSpeech(){var e,t;try{this.privIsSpeaking=!1,null===(e=this.privTranslationRecognizer)||void 0===e||e.stopContinuousRecognitionAsync(),null===(t=this.privTranslationRecognizerConnection)||void 0===t||t.closeConnection(),this.privTranslationRecognizerConnection=void 0,this.privTranslationRecognizer=void 0,this.privSpeechState=xr.Inactive}catch(e){}}get canSpeak(){return!!this.privConversation.isConnected&&(!this.privIsSpeaking&&this.privSpeechState!==xr.Connected&&this.privSpeechState!==xr.Connecting&&!this.privConversation.isMutedByHost)}handleCallback(e,t){if(e){try{e()}catch(e){t&&t(e)}e=void 0}}handleError(e,t){if(t)if(e instanceof Error){const r=e;t(r.name+": "+r.message)}else t(e)}}p.a.instance.attachListener(new class{constructor(e=n.a.Warning){this.onEvent=e=>{if(e.eventType>=this.privLogLevelFilter){const t=this.toString(e);switch(e.eventType){case n.a.Debug:console.debug(t);break;case n.a.Info:console.info(t);break;case n.a.Warning:console.warn(t);break;case n.a.Error:console.error(t);break;default:console.log(t)}}},this.toString=e=>{const t=[""+e.EventTime,""+e.Name];for(const r in e)if(r&&e.hasOwnProperty(r)&&"eventTime"!==r&&"eventType"!==r&&"eventId"!==r&&"name"!==r&&"constructor"!==r){const n=e[r];let i="<NULL>";null!=n&&(i="number"==typeof n||"string"==typeof n?n.toString():JSON.stringify(n)),t.push(`${r}: ${i}`)}return t.join(" | ")},this.privLogLevelFilter=e}})},function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r(1),i=r(62);class o{static get instance(){return o.privInstance}}o.privInstance=new i.a,o.setEventSource=e=>{if(!e)throw new n.a("eventSource");o.privInstance=e}}]);