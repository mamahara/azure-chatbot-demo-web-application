"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = shareObservable;

/* global Observable */
function shareObservable(observable) {
  var observers = [];
  var subscription;
  return new Observable(function (observer) {
    if (!subscription) {
      subscription = observable.subscribe({
        complete: function complete() {
          observers.forEach(function (observer) {
            return observer.complete();
          });
        },
        error: function error(err) {
          observers.forEach(function (observer) {
            return observer.error(err);
          });
        },
        next: function next(value) {
          observers.forEach(function (observer) {
            return observer.next(value);
          });
        }
      });
    }

    observers.push(observer);
    return function () {
      observers = observers.filter(function (o) {
        return o !== observer;
      });

      if (!observers.length) {
        subscription.unsubscribe();
        subscription = null;
      }
    };
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9zaGFyZU9ic2VydmFibGUuanMiXSwibmFtZXMiOlsic2hhcmVPYnNlcnZhYmxlIiwib2JzZXJ2YWJsZSIsIm9ic2VydmVycyIsInN1YnNjcmlwdGlvbiIsIk9ic2VydmFibGUiLCJvYnNlcnZlciIsInN1YnNjcmliZSIsImNvbXBsZXRlIiwiZm9yRWFjaCIsImVycm9yIiwiZXJyIiwibmV4dCIsInZhbHVlIiwicHVzaCIsImZpbHRlciIsIm8iLCJsZW5ndGgiLCJ1bnN1YnNjcmliZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBO0FBRWUsU0FBU0EsZUFBVCxDQUF5QkMsVUFBekIsRUFBcUM7QUFDbEQsTUFBSUMsU0FBUyxHQUFHLEVBQWhCO0FBQ0EsTUFBSUMsWUFBSjtBQUVBLFNBQU8sSUFBSUMsVUFBSixDQUFlLFVBQUFDLFFBQVEsRUFBSTtBQUNoQyxRQUFJLENBQUNGLFlBQUwsRUFBbUI7QUFDakJBLE1BQUFBLFlBQVksR0FBR0YsVUFBVSxDQUFDSyxTQUFYLENBQXFCO0FBQ2xDQyxRQUFBQSxRQURrQyxzQkFDdkI7QUFDVEwsVUFBQUEsU0FBUyxDQUFDTSxPQUFWLENBQWtCLFVBQUFILFFBQVE7QUFBQSxtQkFBSUEsUUFBUSxDQUFDRSxRQUFULEVBQUo7QUFBQSxXQUExQjtBQUNELFNBSGlDO0FBS2xDRSxRQUFBQSxLQUxrQyxpQkFLNUJDLEdBTDRCLEVBS3ZCO0FBQ1RSLFVBQUFBLFNBQVMsQ0FBQ00sT0FBVixDQUFrQixVQUFBSCxRQUFRO0FBQUEsbUJBQUlBLFFBQVEsQ0FBQ0ksS0FBVCxDQUFlQyxHQUFmLENBQUo7QUFBQSxXQUExQjtBQUNELFNBUGlDO0FBU2xDQyxRQUFBQSxJQVRrQyxnQkFTN0JDLEtBVDZCLEVBU3RCO0FBQ1ZWLFVBQUFBLFNBQVMsQ0FBQ00sT0FBVixDQUFrQixVQUFBSCxRQUFRO0FBQUEsbUJBQUlBLFFBQVEsQ0FBQ00sSUFBVCxDQUFjQyxLQUFkLENBQUo7QUFBQSxXQUExQjtBQUNEO0FBWGlDLE9BQXJCLENBQWY7QUFhRDs7QUFFRFYsSUFBQUEsU0FBUyxDQUFDVyxJQUFWLENBQWVSLFFBQWY7QUFFQSxXQUFPLFlBQU07QUFDWEgsTUFBQUEsU0FBUyxHQUFHQSxTQUFTLENBQUNZLE1BQVYsQ0FBaUIsVUFBQUMsQ0FBQztBQUFBLGVBQUlBLENBQUMsS0FBS1YsUUFBVjtBQUFBLE9BQWxCLENBQVo7O0FBRUEsVUFBSSxDQUFDSCxTQUFTLENBQUNjLE1BQWYsRUFBdUI7QUFDckJiLFFBQUFBLFlBQVksQ0FBQ2MsV0FBYjtBQUNBZCxRQUFBQSxZQUFZLEdBQUcsSUFBZjtBQUNEO0FBQ0YsS0FQRDtBQVFELEdBM0JNLENBQVA7QUE0QkQiLCJzb3VyY2VSb290IjoiZGlyZWN0bGluZXNwZWVjaDovLy8iLCJzb3VyY2VzQ29udGVudCI6WyIvKiBnbG9iYWwgT2JzZXJ2YWJsZSAqL1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBzaGFyZU9ic2VydmFibGUob2JzZXJ2YWJsZSkge1xuICBsZXQgb2JzZXJ2ZXJzID0gW107XG4gIGxldCBzdWJzY3JpcHRpb247XG5cbiAgcmV0dXJuIG5ldyBPYnNlcnZhYmxlKG9ic2VydmVyID0+IHtcbiAgICBpZiAoIXN1YnNjcmlwdGlvbikge1xuICAgICAgc3Vic2NyaXB0aW9uID0gb2JzZXJ2YWJsZS5zdWJzY3JpYmUoe1xuICAgICAgICBjb21wbGV0ZSgpIHtcbiAgICAgICAgICBvYnNlcnZlcnMuZm9yRWFjaChvYnNlcnZlciA9PiBvYnNlcnZlci5jb21wbGV0ZSgpKTtcbiAgICAgICAgfSxcblxuICAgICAgICBlcnJvcihlcnIpIHtcbiAgICAgICAgICBvYnNlcnZlcnMuZm9yRWFjaChvYnNlcnZlciA9PiBvYnNlcnZlci5lcnJvcihlcnIpKTtcbiAgICAgICAgfSxcblxuICAgICAgICBuZXh0KHZhbHVlKSB7XG4gICAgICAgICAgb2JzZXJ2ZXJzLmZvckVhY2gob2JzZXJ2ZXIgPT4gb2JzZXJ2ZXIubmV4dCh2YWx1ZSkpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBvYnNlcnZlcnMucHVzaChvYnNlcnZlcik7XG5cbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgb2JzZXJ2ZXJzID0gb2JzZXJ2ZXJzLmZpbHRlcihvID0+IG8gIT09IG9ic2VydmVyKTtcblxuICAgICAgaWYgKCFvYnNlcnZlcnMubGVuZ3RoKSB7XG4gICAgICAgIHN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgICBzdWJzY3JpcHRpb24gPSBudWxsO1xuICAgICAgfVxuICAgIH07XG4gIH0pO1xufVxuIl19